---
# Modules Schema 定義
apiVersion: v1
kind: ConfigMap
metadata:
  name: modules-schema
  namespace: machinenativenops-modules
data:
  schema.yaml: |
    # Root Modules Configuration Schema
    type: object
    properties:
      modules:
        type: array
        items:
          type: object
          properties:
            name:
              type: string
              pattern: "^[a-z0-9-]+$"
            version:
              type: string
              pattern: "^\\d+\\.\\d+\\.\\d+$"
            description:
              type: string
            entrypoint:
              type: string
            group:
              type: string
            priority:
              type: integer
              minimum: 0
              maximum: 100
            enabled:
              type: boolean
            auto_start:
              type: boolean
            dependencies:
              type: array
              items:
                type: object
                properties:
                  name:
                    type: string
                  version:
                    type: string
                  optional:
                    type: boolean
            resources:
              type: object
              properties:
                cpu:
                  type: object
                  properties:
                    request:
                      type: string
                    limit:
                      type: string
                memory:
                  type: object
                  properties:
                    request:
                      type: string
                    limit:
                      type: string
          required: ["name", "version", "description", "entrypoint", "group", "priority", "enabled", "auto_start", "dependencies", "resources"]
      groups:
        type: array
        items:
          type: object
          properties:
            name:
              type: string
            description:
              type: string
            priority:
              type: integer
            criticality:
              type: string
              enum: ["critical", "high", "medium", "low"]
            auto_start:
              type: boolean
            fail_fast:
              type: boolean
          required: ["name", "description", "priority", "criticality", "auto_start", "fail_fast"]
    required: ["modules", "groups"]