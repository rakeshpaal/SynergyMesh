apiVersion: machinenativeops.io/v2
kind: NamingPolicy
metadata:
  annotations:
    machinenativeops.io/lastReviewed: '2025-12-17'
    machinenativeops.io/version: v1.0.0
  description: CI/CD Pipeline 命名规范
  labels:
    machinenativeops.io/category: cicd
    machinenativeops.io/team: platform
  name: pipeline-naming-standard
spec:
  components:
    action:
      description: Pipeline 动作
      enum:
      - build
      - test
      - deploy
      - release
      - rollback
      - validate
      - security
    repository:
      description: 代码仓库名称
      examples:
      - payment-service
      - user-api
      - order-processor
      pattern: ^[a-z0-9-]+$
    target:
      description: 目标环境或范围
      enum:
      - dev
      - staging
      - prod
      - all
  enforcement:
    autoReject: true
    level: error
    scope:
    - github-actions
    - gitlab-ci
    - jenkins
  environmentVariables:
    examples:
    - DATABASE_URL
    - API_KEY
    - DEPLOY_TARGET
    - BUILD_NUMBER
    - GIT_COMMIT_SHA
    pattern: UPPER_SNAKE_CASE
  examples:
    invalid:
    - fix: payment-service-build-all
      name: PaymentService-Build-All
      reason: 使用大写字母
    - fix: payment-service-build-all
      name: payment_service_build_all
      reason: 使用下划线分隔符
    - fix: payment-service-build-prod
      name: payment-service-build-production
      reason: 环境名应使用缩写 'prod' 而非 'production'
    - fix: payment-service-build-all
      name: build-payment-service
      reason: 组件顺序错误，应该是 repository-action-target
    valid:
    - components:
        action: build
        repository: payment-service
        target: all
      description: 支付服务构建（所有环境）
      name: payment-service-build-all
    - components:
        action: test
        repository: user-api
        target: all
      description: 用户 API 测试
      name: user-api-test-all
    - components:
        action: deploy
        repository: order-processor
        target: prod
      description: 订单处理器生产部署
      name: order-processor-deploy-prod
    - components:
        action: security
        repository: payment-service
        target: all
      description: 支付服务安全扫描
      name: payment-service-security-all
    - components:
        action: rollback
        repository: user-api
        target: prod
      description: 用户 API 生产回滚
      name: user-api-rollback-prod
  metadata:
    nextReviewDate: '2026-06-17'
    owner: platform-team
    reviewDate: '2025-12-17'
    version: v1.0.0
  pattern: '{{ .repository }}-{{ .action }}-{{ .target }}'
  references:
  - title: GitHub Actions Documentation
    url: https://docs.github.com/en/actions
  - title: GitLab CI/CD Documentation
    url: https://docs.gitlab.com/ee/ci/
  schemaRef: schemas/pipeline-naming.schema.yaml
  secrets:
    examples:
    - SECRET_API_KEY
    - SECRET_DATABASE_PASSWORD
    - SECRET_SSH_KEY
    pattern: UPPER_SNAKE_CASE with prefix
    prefix: SECRET_
  stageNaming:
    description: Pipeline 内部阶段的命名规范
    examples:
    - 01-checkout
    - 02-build
    - 03-unit-test
    - 04-integration-test
    - 05-security-scan
    - 06-docker-build
    - 07-push-registry
    - 08-deploy
    - 09-smoke-test
    - 10-notify
    pattern: '{{ .order }}-{{ .stageName }}'
  triggerNaming:
    manual:
      description: 手动触发
      examples:
      - on-manual-deploy
      - on-manual-rollback
    pullRequest:
      description: PR 触发
      examples:
      - on-pr-main
      - on-pr-develop
    push:
      description: 推送触发
      examples:
      - on-push-main
      - on-push-develop
      - on-push-release
    schedule:
      description: 定时触发
      examples:
      - on-schedule-nightly
      - on-schedule-weekly
  validation:
    description: 'Pipeline 命名规范：

      - 格式: {repository}-{action}-{target}

      - 使用小写字母和连字符

      - action: build, test, deploy, release

      - target: dev, staging, prod, all

      '
