apiVersion: machinenativeops.io/v2
kind: NamingPolicy
metadata:
  annotations:
    machinenativeops.io/lastReviewed: '2025-12-17'
    machinenativeops.io/owner: platform-team@example.com
    machinenativeops.io/version: v1.0.0
  description: Kubernetes Deployment 资源的标准命名规范
  labels:
    machinenativeops.io/category: kubernetes
    machinenativeops.io/resourceType: deployment
    machinenativeops.io/team: platform
  name: k8s-deployment-standard
spec:
  enforcement:
    autoReject: true
    ciIntegration: true
    exemptions:
    - legacy-payment-system
    - third-party-*
    level: error
    scope:
    - production
    - staging
    - dev
  errorMessages:
    invalidEnvironment: '环境名 ''{{ .environment }}'' 无效。

      允许的值: dev, staging, prod

      '
    invalidVersion: '版本号 ''{{ .version }}'' 不符合语义化版本规范。

      格式: vMAJOR.MINOR.PATCH[-PRERELEASE]

      例如: v1.0.0, v2.3.1-beta1

      '
    patternMismatch: '资源名称 ''{{ .actualName }}'' 不符合命名规范。

      期望格式: {{ .pattern }}

      例如: prod-payment-deploy-v1.3.0

      '
  examples:
    invalid:
    - fix: prod-payment-deploy-v1.3.0
      name: production-payment-deploy-v1.3.0
      reason: 环境名应使用缩写 'prod' 而非 'production'
    - fix: prod-payment-deploy-v1.3.0
      name: prod_payment_deploy_1.3.0
      reason: 使用下划线分隔符，且版本号缺少 'v' 前缀
    - fix: prod-payment-service-deploy-v1.3.0
      name: prod-Payment-Service-deploy-v1.3.0
      reason: 包含大写字母
    - fix: prod-payment-deploy-v1.3.0
      name: prod-payment-deployment-v1.3.0
      reason: 资源类型应使用缩写 'deploy' 而非 'deployment'
    valid:
    - components:
        app: payment
        environment: prod
        resourceType: deploy
        version: v1.3.0
      description: 生产环境支付服务 v1.3.0
      name: prod-payment-deploy-v1.3.0
    - components:
        app: user-api
        environment: staging
        resourceType: deploy
        version: v2.0.0-beta1
      description: 预发布环境用户 API v2.0.0-beta1
      name: staging-user-api-deploy-v2.0.0-beta1
    - components:
        app: order-processor
        environment: dev
        resourceType: deploy
        version: v1.0.0
      description: 开发环境订单处理器 v1.0.0
      name: dev-order-processor-deploy-v1.0.0
  metadata:
    approvers:
    - tech-lead@example.com
    - architect@example.com
    changelog:
    - changes:
      - 初始版本
      - 定义 Kubernetes Deployment 命名标准
      date: '2025-12-17'
      version: v1.0.0
    nextReviewDate: '2026-06-17'
    owner: platform-team
    reviewDate: '2025-12-17'
    version: v1.0.0
  pattern: '{{ .environment }}-{{ .app }}-deploy-{{ .version }}'
  references:
  - title: Kubernetes Object Names
    url: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/
  - title: DNS-1123 Subdomain Names
    url: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-subdomain-names
  - title: Semantic Versioning
    url: https://semver.org/
  relatedPolicies:
  - api-naming
  - pipeline-naming
  schemaRef: schemas/resource-name.schema.yaml
  validation:
    customPattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
    description: '命名必须符合 DNS-1123 子域名规范：

      - 只包含小写字母、数字、连字符

      - 以字母或数字开头和结尾

      - 总长度不超过 63 字符

      '
    maxLength: 63
    minLength: 10
