apiVersion: machinenativeops.io/v2
kind: GovernancePolicy
metadata:
  annotations:
    machinenativeops.io/lastReviewed: '2025-12-17'
    machinenativeops.io/version: v1.0.0
  description: 变更管理流程与规范
  labels:
    machinenativeops.io/category: process
    machinenativeops.io/domain: change-management
  name: change-management-policy
spec:
  approvalProcess:
    CAB:
      decisionCriteria:
      - 风险评估合理
      - 测试充分
      - 回滚方案明确
      - 影响评估完整
      - 资源准备就绪
      description: 变更咨询委员会
      meetingSchedule:
        day: Monday
        frequency: Weekly
        time: 10:00 UTC
      members:
        optional:
        - role: Product Manager
        - role: Customer Support Lead
        required:
        - count: 1
          role: Change Manager
        - count: 1
          role: Tech Lead
        - count: 1
          role: Security Lead
  audit:
    logFormat: JSON
    requiredFields:
    - changeId
    - requester
    - approver
    - implementationDate
    - outcome
    - rollbackStatus
    retention: 3 years
  changeTypes:
  - approval:
      method: Auto
      requiredApprovers: 0
      sla: 即时
    characteristics:
    - 经过充分测试和文档化
    - 风险低、影响小
    - 有明确的回滚方案
    description: 低风险、预先批准、可自动执行的变更
    examples:
    - 应用配置更新（非关键参数）
    - 定期补丁更新
    - 预先批准的基础设施扩容
    monitoring:
      alertThreshold: medium
      required: true
    type: 标准变更
  - approval:
      method: CAB
      requiredApprovers: 2
      sla: 2 business days
    characteristics:
    - 中等风险和影响
    - 需要 CAB 或技术负责人审批
    - 需要详细的实施和回滚计划
    description: 需要评估和批准的常规变更
    examples:
    - 应用版本升级
    - 数据库 schema 变更
    - 网络配置调整
    monitoring:
      alertThreshold: high
      required: true
    testing:
      environments:
      - dev
      - staging
      required: true
    type: 常规变更
  - approval:
      method: Manager
      requiredApprovers: 1
      sla: 1 hour
    characteristics:
    - 用于解决生产事故
    - 简化审批流程
    - 事后追溯审查
    description: 紧急情况下的快速变更
    examples:
    - 生产故障修复
    - 安全漏洞紧急补丁
    - 性能问题紧急优化
    monitoring:
      alertThreshold: critical
      required: true
    postImplementation:
      reviewRequired: true
      reviewWithin: 24 hours
    type: 紧急变更
  changeWindows:
    dev:
      allowed:
      - day: Any
        description: 无限制
        time: Any
    production:
      allowed:
      - day: Tuesday
        description: 常规维护窗口
        time: 02:00-04:00 UTC
      - day: Thursday
        description: 常规维护窗口
        time: 02:00-04:00 UTC
      blackout:
      - dates: Nov 20-30
        period: Black Friday Week
      - dates: Dec 20 - Jan 5
        period: Year End Holiday
      - description: 根据业务日历确定
        period: Major Sales Events
    staging:
      allowed:
      - day: Any
        description: 工作时间
        time: 08:00-18:00 UTC
  communication:
    stakeholderNotification:
      advance: 24 hours
      channels:
      - 'Slack (#engineering, #operations)'
      - Email (team distribution lists)
      - Status Page (external)
      template: templates/forms/change-notification.template.md
    statusUpdates:
      channels:
      - Slack (#change-status)
      frequency: Every 30 minutes during implementation
  enforcement:
    level: error
    violations:
      penalties:
      - 'First offense: Warning'
      - 'Second offense: Mandatory retraining'
      - 'Third offense: Escalation to management'
  implementationRequirements:
    duringImplementation:
    - 实时监控关键指标
    - 保持沟通渠道畅通
    - 按步骤执行实施计划
    - 记录实施过程
    postChecks:
    - 验证变更成功
    - 检查服务健康状态
    - 验证关键业务流程
    - 监控错误率和性能指标
    - 更新文档
    - 通知变更完成
    preChecks:
    - 备份关键数据
    - 验证回滚方案可用
    - 确认监控和告警正常
    - 通知相关团队和利益相关者
    - 准备沟通模板
  metadata:
    approvers:
    - cto@example.com
    - vp-engineering@example.com
    nextReviewDate: '2026-06-17'
    owner: change-management-board
    reviewDate: '2025-12-17'
    version: v1.0.0
  metrics:
  - calculation: 成功变更数 / 总变更数
    name: 变更成功率
    target: '> 95%'
  - calculation: 从申请到完成的平均时间
    name: 平均交付时间
    target: < 3 天
  - calculation: 紧急变更数 / 总变更数
    name: 紧急变更比例
    target: < 5%
  - calculation: 需要回滚的变更数 / 总变更数
    name: 回滚率
    target: < 2%
  references:
  - title: ITIL Change Management
    url: https://www.axelos.com/certifications/itil-service-management
  - title: Google SRE Book - Managing Change
    url: https://sre.google/sre-book/managing-change/
  riskLevels:
  - approvalRequired: TechLead
    criteria:
    - 影响范围小（< 100 用户）
    - 有完整的回滚方案
    - 在非高峰时段执行
    - 在预发布环境充分测试
    level: 低
    testingRequirements:
    - 单元测试覆盖率 > 80%
    - 集成测试通过
  - approvalRequired: CAB
    criteria:
    - 影响范围中等（100-1000 用户）
    - 可能需要短暂停机（< 5 分钟）
    - 涉及多个服务
    level: 中
    testingRequirements:
    - 单元测试 + 集成测试
    - 预发布环境验证
    - 性能测试
  - approvalRequired: CAB + Manager
    criteria:
    - 影响范围大（> 1000 用户）
    - 需要停机或服务降级
    - 涉及数据迁移
    - 架构级别变更
    level: 高
    testingRequirements:
    - 全面测试（单元、集成、E2E）
    - 预发布环境完整验证
    - 性能和压力测试
    - 灾难恢复演练
  rollbackCriteria:
    automatic:
    - 健康检查连续失败 3 次
    - 错误率超过 5%
    - 响应时间超过基线 200%
    - 可用性低于 99%
    manual:
    - 关键业务流程失败
    - 数据一致性问题
    - 安全漏洞发现
    - 预期之外的副作用
  training:
    certification: Change Management Certification
    frequency: Annually
    requiredFor:
    - All engineers
    - Product managers
    - Operations team
