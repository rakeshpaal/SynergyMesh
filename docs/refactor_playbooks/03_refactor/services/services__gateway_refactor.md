# services/gateway é‡æ§‹åŠ‡æœ¬ï¼ˆRefactor Playbookï¼‰

- Cluster IDï¼š`services/gateway`
- å°æ‡‰ç›®éŒ„ï¼š`services/gateway/`, `services/api/`
- å°æ‡‰é›†æˆåŠ‡æœ¬ï¼š
  - `docs/refactor_playbooks/02_integration/services__gateway_integration.md`
- Legacy Assetsï¼š
  - `gateway-old-lua-router`

---

## 1. Cluster æ¦‚è¦½

æœ¬ cluster æ˜¯ **API Gateway èˆ‡æœå‹™å±¤**ï¼Œè² è²¬ï¼š
- API è·¯ç”±èˆ‡è² è¼‰å¹³è¡¡
- èªè­‰èˆ‡æˆæ¬Šæ•´åˆ
- é€Ÿç‡é™åˆ¶èˆ‡é…é¡ç®¡ç†

### ä¸»è¦èªè¨€èˆ‡å•é¡Œ

- âš ï¸ **Lua** (é•è¦)ï¼šèˆŠè·¯ç”±é‚è¼¯éœ€ç§»é™¤
- âš ï¸ **C++** (å±¤ç´šä¸ç•¶)ï¼šä¸é©åˆæœå‹™å±¤
- âœ… TypeScript/Go æ˜¯ç›®æ¨™èªè¨€

---

## 2. å•é¡Œç›¤é»

### Hotspot æª”æ¡ˆ

| æª”æ¡ˆ | Score | åš´é‡æ€§ | å•é¡Œ |
|------|-------|--------|------|
| `services/gateway/router.lua` | 88 | HIGH | ç¦ç”¨èªè¨€ + éŒ¯èª¤å±¤ç´š |
| `services/api/handler.cpp` | 70 | MEDIUM | C++ ä¸é©åˆæœå‹™å±¤ |

### Migration Flow

- `services:lua` â†’ `removed`
- `services:cpp` â†’ `autonomous:cpp` æˆ–æ”¹å¯«ç‚º TS/Go

---

## 3. P0 è¡Œå‹•ï¼ˆ24-48å°æ™‚ï¼‰

âœ… **è¡Œå‹• 1**: `services/gateway/router.lua` (score: 88, HIGH)
- **æ“ä½œ**: æ”¹å¯«ç‚º Go
- **æ­¥é©Ÿ**:
  1. ä½¿ç”¨ `gorilla/mux` æˆ– `chi` é‡å¯«è·¯ç”±
  2. ä¿æŒè·¯ç”±è¦å‰‡ç­‰åƒ¹
  3. æ–°å¢æ¸¬è©¦
  4. ç°åº¦ç™¼å¸ƒ (10% â†’ 100%)
- **é ä¼°**: 12-16 å°æ™‚

âœ… **è¡Œå‹• 2**: å‚™ä»½è‡³ legacy_scratch
- æ›´æ–° `legacy_assets_index.yaml`

### é©—æ”¶æ¢ä»¶
- âœ… ç„¡ Lua æª”æ¡ˆ
- âœ… åŠŸèƒ½ç­‰åƒ¹ï¼ˆæ•´åˆæ¸¬è©¦é€šéï¼‰
- âœ… æ•ˆèƒ½ç„¡é€€åŒ– (< 5%)

---

## 4. P1 è¡Œå‹•ï¼ˆä¸€é€±å…§ï¼‰

- è©•ä¼° `handler.cpp`ï¼šæ”¹å¯«ç‚º TS æˆ– Go
- é‡çµ„ç›®éŒ„çµæ§‹ï¼ˆåˆ†é›¢ Go/TSï¼‰
- è£œå…… API æ–‡ä»¶ (OpenAPI/gRPC)

---

## 5. é©—æ”¶æŒ‡æ¨™

| æŒ‡æ¨™ | ç•¶å‰ | ç›®æ¨™ |
|------|------|------|
| èªè¨€é•è¦æ•¸ | 2 | 0 |
| Lua æª”æ¡ˆ | 1 | 0 |
| C++ æª”æ¡ˆ | 1 | 0 |
| Hotspot Max | 88 | < 50 |
| æ¸¬è©¦è¦†è“‹ç‡ | å¾…æ¸¬é‡ | > 85% |

---

**ç‹€æ…‹**: ğŸŸ¡ å¯¦ä½œä¸­  
**æœ€å¾Œæ›´æ–°**: 2025-12-06
