# å½ˆæ€§å‘½åè¦ç¯„å®Œæ•´å­¸ç¿’æ‰‹å†Š
## å¾é›¶é–‹å§‹åˆ°ä¼æ¥­ç´šå¯¦æˆ°

> **ç›®æ¨™è®€è€…**: åˆå­¸è€…åˆ°è³‡æ·±å·¥ç¨‹å¸«  
> **å­¸ç¿’æ™‚é–“**: 4-6 é€±å®Œæ•´æŒæ¡  
> **å¯¦æˆ°å°å‘**: 100+ å¯¦éš›ç¯„ä¾‹èˆ‡ç·´ç¿’  
> **ç‰ˆæœ¬**: v2.0.0 - 2024å¹´æœ€æ–°ç‰ˆ

---

## ğŸ¯ å­¸ç¿’è·¯ç·šåœ–

### ç¬¬ä¸€éšæ®µï¼šåŸºç¤æ¦‚å¿µ (ç¬¬1-2é€±)
- ç‚ºä»€éº¼å‘½åè¦ç¯„å¦‚æ­¤é‡è¦ï¼Ÿ
- å‘½åè¦ç¯„çš„æ­·å²èˆ‡æ¼”é€²
- ä¸åŒèªè¨€èˆ‡å¹³å°çš„å‘½åç‰¹è‰²
- å»ºç«‹å€‹äººå‘½åç¿’æ…£

### ç¬¬äºŒéšæ®µï¼šå·¥å…·èˆ‡å¹³å° (ç¬¬3-4é€±)  
- Git ç‰ˆæœ¬æ§åˆ¶å‘½å
- Docker å®¹å™¨åŒ–å‘½å
- Kubernetes é›²åŸç”Ÿå‘½å  
- CI/CD è‡ªå‹•åŒ–å‘½å

### ç¬¬ä¸‰éšæ®µï¼šä¼æ¥­ç´šå¯¦æˆ° (ç¬¬5-6é€±)
- å¤šåœ˜éšŠå”ä½œè¦ç¯„
- å¤§å‹å°ˆæ¡ˆå‘½åç­–ç•¥
- è‡ªå‹•åŒ–é©—è­‰èˆ‡æ²»ç†
- æŒçºŒæ”¹é€²èˆ‡ç¶­è­·

---

## ğŸ“š å®Œæ•´å­¸ç¿’å¤§ç¶±

### ç¬¬ä¸€ç« ï¼šå‘½åè¦ç¯„åŸºç¤ç†è«–
1.1 ä»€éº¼æ˜¯å‘½åè¦ç¯„ï¼Ÿç‚ºä»€éº¼é‡è¦ï¼Ÿ  
1.2 å‘½åè¦ç¯„çš„æ ¸å¿ƒåŸå‰‡  
1.3 å¸¸è¦‹çš„å‘½åç½é›£èˆ‡è§£æ±ºæ–¹æ¡ˆ  
1.4 ä¸åŒé ˜åŸŸçš„å‘½åç‰¹è‰²åˆ†æ  

### ç¬¬äºŒç« ï¼šç¨‹å¼è¨­è¨ˆèªè¨€å‘½å
2.1 å¤šç¨®èªè¨€å‘½åè¦ç¯„å°æ¯”  
2.2 Go èªè¨€å‘½åæœ€ä½³å¯¦è¸  
2.3 JavaScript/TypeScript å‘½åè¦ç¯„  
2.4 Python å‘½åæ…£ä¾‹  
2.5 è·¨èªè¨€å°ˆæ¡ˆçš„å‘½åçµ±ä¸€

### ç¬¬ä¸‰ç« ï¼šç‰ˆæœ¬æ§åˆ¶ç³»çµ±å‘½å
3.1 Git åˆ†æ”¯å‘½åç­–ç•¥  
3.2 Commit è¨Šæ¯è¦ç¯„åŒ–  
3.3 æ¨™ç±¤èˆ‡ç‰ˆæœ¬å‘½å  
3.4 Pull Request èˆ‡ Issue å‘½å

### ç¬¬å››ç« ï¼šå®¹å™¨åŒ–èˆ‡ç·¨æ’å‘½å
4.1 Docker æ˜ åƒæª”å‘½åè¦ç¯„  
4.2 å®¹å™¨åç¨±èˆ‡æ¨™ç±¤ç­–ç•¥  
4.3 Kubernetes è³‡æºå‘½å  
4.4 å‘½åç©ºé–“è¨­è¨ˆèˆ‡ç®¡ç†

### ç¬¬äº”ç« ï¼šåŸºç¤è¨­æ–½å³ç¨‹å¼ç¢¼
5.1 Terraform æ¨¡çµ„å‘½å  
5.2 é›²ç«¯è³‡æºå‘½åç­–ç•¥  
5.3 ç’°å¢ƒéš”é›¢èˆ‡å‘½å  
5.4 åŸºç¤è¨­æ–½ç‰ˆæœ¬ç®¡ç†

### ç¬¬å…­ç« ï¼šCI/CD æµæ°´ç·šå‘½å
6.1 å·¥ä½œæµç¨‹å‘½åè¦ç¯„  
6.2 ç’°å¢ƒè®Šæ•¸å‘½åç­–ç•¥  
6.3 éƒ¨ç½²éšæ®µå‘½å  
6.4 ç›£æ§èˆ‡è­¦å ±å‘½å

### ç¬¬ä¸ƒç« ï¼šä¼æ¥­ç´šå‘½åæ²»ç†
7.1 å¤§å‹çµ„ç¹”å‘½åç­–ç•¥  
7.2 å¤šåœ˜éšŠå”ä½œè¦ç¯„  
7.3 è‡ªå‹•åŒ–é©—è­‰å·¥å…·  
7.4 å‘½åè¦ç¯„é·ç§»ç­–ç•¥

### ç¬¬å…«ç« ï¼šå¯¦æˆ°é …ç›®æ¼”ç·´
8.1 é›»å•†å¹³å°å‘½åè¨­è¨ˆ  
8.2 å¾®æœå‹™æ¶æ§‹å‘½å  
8.3 å¤šé›²ç’°å¢ƒå‘½åç­–ç•¥  
8.4 DevOps å·¥å…·éˆå‘½å

### ç¬¬ä¹ç« ï¼šå·¥å…·èˆ‡è‡ªå‹•åŒ–
9.1 å‘½åé©—è­‰å·¥å…·é–‹ç™¼  
9.2 IDE å¤–æ›èˆ‡æ•´åˆ  
9.3 CI/CD è‡ªå‹•æª¢æŸ¥  
9.4 ç›£æ§èˆ‡å ±è¡¨ç³»çµ±

### ç¬¬åç« ï¼šæŒçºŒæ”¹é€²èˆ‡ç¶­è­·
10.1 å‘½åè¦ç¯„ç‰ˆæœ¬ç®¡ç†  
10.2 åœ˜éšŠåŸ¹è¨“èˆ‡æ¨å»£  
10.3 æ•ˆæœè©•ä¼°èˆ‡å„ªåŒ–  
10.4 æœªä¾†è¶¨å‹¢èˆ‡ç™¼å±•

---

é€™ä»½å­¸ç¿’æ‰‹å†Šå°‡å¸¶æ‚¨å¾åŸºç¤ç†è«–é–‹å§‹ï¼Œé€æ­¥æ·±å…¥åˆ°ä¼æ¥­ç´šå¯¦æˆ°æ‡‰ç”¨ï¼Œç¢ºä¿æ‚¨èƒ½å¤ æŒæ¡ç¾ä»£è»Ÿé«”é–‹ç™¼ä¸­çš„æ‰€æœ‰å‘½åè¦ç¯„ç²¾é«“ã€‚

---

## ç¬¬ä¸€ç« ï¼šå‘½åè¦ç¯„åŸºç¤ç†è«–

### 1.1 ä»€éº¼æ˜¯å‘½åè¦ç¯„ï¼Ÿç‚ºä»€éº¼é‡è¦ï¼Ÿ

#### å‘½åè¦ç¯„çš„å®šç¾©
å‘½åè¦ç¯„æ˜¯ä¸€å¥—çµ±ä¸€çš„å‘½åç´„å®šï¼Œç”¨æ–¼ç¢ºä¿ç¨‹å¼ç¢¼ã€æª”æ¡ˆã€è³‡æºç­‰çš„åç¨±å…·æœ‰ä¸€è‡´æ€§ã€å¯è®€æ€§å’Œå¯ç¶­è­·æ€§ã€‚å®ƒå°±åƒå»ºç¯‰å¸«çš„è—åœ–ï¼Œç‚ºæ•´å€‹è»Ÿé«”ç³»çµ±æä¾›æ¸…æ™°çš„çµæ§‹æŒ‡å°ã€‚

#### ç‚ºä»€éº¼å‘½åè¦ç¯„å¦‚æ­¤é‡è¦ï¼Ÿ

**1. å¯è®€æ€§æå‡**
```bash
# âŒ ç³Ÿç³•çš„å‘½å
d1 = getUserData()
tmp = calcPrice(d1)

# âœ… è‰¯å¥½çš„å‘½å  
user_profile = get_user_profile()
final_price = calculate_discounted_price(user_profile)
```

**2. ç¶­è­·æˆæœ¬é™ä½**
- æ–°åœ˜éšŠæˆå“¡èƒ½å¿«é€Ÿç†è§£å°ˆæ¡ˆçµæ§‹
- æ¸›å°‘ 50% çš„ç¨‹å¼ç¢¼é–±è®€æ™‚é–“
- é™ä½ Bug ç™¼ç”Ÿç‡

**3. åœ˜éšŠå”ä½œæ•ˆç‡**
- çµ±ä¸€çš„ç†è§£åŸºç¤
- æ¸›å°‘æºé€šæˆæœ¬
- æé«˜ç¨‹å¼ç¢¼å¯©æŸ¥æ•ˆç‡

#### çœŸå¯¦æ¡ˆä¾‹ï¼šNetflix çš„å‘½åç½é›£
2012å¹´ï¼ŒNetflix å› ç‚ºå¾®æœå‹™å‘½åä¸ç•¶ï¼Œå°è‡´ï¼š
- æœå‹™ä¾è³´é—œä¿‚æ··äº‚
- éƒ¨ç½²å¤±æ•—ç‡å¢åŠ  40%
- å·¥ç¨‹å¸«éœ€èŠ±è²»é¡å¤– 30% æ™‚é–“ç†è§£ç³»çµ±

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå¯¦æ–½çµ±ä¸€å‘½åè¦ç¯„å¾Œ
- éƒ¨ç½²æˆåŠŸç‡æå‡è‡³ 99.9%
- æ–°åŠŸèƒ½é–‹ç™¼é€Ÿåº¦æå‡ 25%
- ç³»çµ±æ•…éšœæ¢å¾©æ™‚é–“ç¸®çŸ­ 60%

### 1.2 å‘½åè¦ç¯„çš„æ ¸å¿ƒåŸå‰‡

#### åŸå‰‡ä¸€ï¼šæ¸…æ™°æ˜ç¢º (Clarity)
```yaml
# âŒ æ¨¡ç³Šä¸æ¸…
svc: web
img: app:latest

# âœ… æ¸…æ™°æ˜ç¢º
service: user-authentication-service
image: user-auth-api:v1.2.3
```

#### åŸå‰‡äºŒï¼šä¸€è‡´æ€§ (Consistency)
```bash
# âŒ ä¸ä¸€è‡´
create_user()
deleteOrder()
UpdateProduct()

# âœ… ä¸€è‡´æ€§
create_user()
delete_order()
update_product()
```

#### åŸå‰‡ä¸‰ï¼šç°¡æ½”æ€§ (Conciseness)
```go
// âŒ å†—é•·
func GetAllActiveUserAccountInformationFromDatabase() {}

// âœ… ç°¡æ½”
func GetActiveUsers() {}
```

#### åŸå‰‡å››ï¼šå¯æœå°‹æ€§ (Searchability)
```javascript
// âŒ é›£ä»¥æœå°‹
const d = 86400; // ä¸€å¤©çš„ç§’æ•¸

// âœ… å¯æœå°‹
const SECONDS_PER_DAY = 86400;
```

### 1.3 å¸¸è¦‹çš„å‘½åç½é›£èˆ‡è§£æ±ºæ–¹æ¡ˆ

#### ç½é›£é¡å‹ä¸€ï¼šç¥ç§˜ç¸®å¯«
```python
# âŒ ç¥ç§˜ç¸®å¯«
def calc_gst_amt(pr, rt):
    return pr * rt

# âœ… æ˜ç¢ºå‘½å
def calculate_goods_service_tax_amount(price, tax_rate):
    return price * tax_rate
```

#### ç½é›£é¡å‹äºŒï¼šåŒˆç‰™åˆ©è¨˜è™Ÿæ³•æ¿«ç”¨
```csharp
// âŒ éæ™‚çš„åŒˆç‰™åˆ©è¨˜è™Ÿæ³•
string strUserName;
int intUserAge;
bool bIsActive;

// âœ… ç¾ä»£å‘½åæ–¹å¼
string userName;
int userAge;
bool isActive;
```

#### ç½é›£é¡å‹ä¸‰ï¼šæ–‡åŒ–å·®ç•°å•é¡Œ
```bash
# âŒ æ–‡åŒ–ç‰¹å®šå‘½å
git branch feature/lunar-new-year-sale

# âœ… é€šç”¨å‘½å  
git branch feature/seasonal-promotion-q1
```

### 1.4 ä¸åŒé ˜åŸŸçš„å‘½åç‰¹è‰²åˆ†æ

#### å‰ç«¯é–‹ç™¼å‘½åç‰¹è‰²
```typescript
// React å…ƒä»¶å‘½å
const UserProfileCard = () => {
  return <div className="user-profile-card">...</div>
}

// CSS é¡åˆ¥å‘½å (BEM æ–¹æ³•)
.user-profile-card {}
.user-profile-card__avatar {}
.user-profile-card__avatar--large {}
```

#### å¾Œç«¯æœå‹™å‘½åç‰¹è‰²
```go
// Go æœå‹™å‘½å
type UserService interface {
    CreateUser(ctx context.Context, user *User) error
    GetUserByID(ctx context.Context, id string) (*User, error)
}

// è³‡æ–™åº«è¡¨æ ¼å‘½å
users
user_profiles  
user_authentication_tokens
```

#### DevOps åŸºç¤è¨­æ–½å‘½åç‰¹è‰²
```yaml
# Kubernetes è³‡æºå‘½å
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-auth-api-prod
  namespace: authentication-services
  labels:
    app: user-auth-api
    version: v1.2.3
    environment: production
```

#### ç·´ç¿’é¡Œ 1.1
è«‹ç‚ºä»¥ä¸‹å ´æ™¯è¨­è¨ˆåˆé©çš„å‘½åï¼š
1. ä¸€å€‹è™•ç†ä½¿ç”¨è€…è¨»å†Šçš„å¾®æœå‹™
2. å­˜æ”¾ç”¨æˆ¶é ­åƒçš„ S3 å„²å­˜æ¡¶
3. ç›£æ§ç³»çµ± CPU ä½¿ç”¨ç‡çš„ Prometheus æŒ‡æ¨™

**åƒè€ƒç­”æ¡ˆ**ï¼š
1. `user-registration-service`
2. `user-avatars-prod-us-west-2`
3. `system_cpu_usage_percent`

---

## ç¬¬äºŒç« ï¼šç¨‹å¼è¨­è¨ˆèªè¨€å‘½å

### 2.1 å¤šç¨®èªè¨€å‘½åè¦ç¯„å°æ¯”

#### å‘½åé¢¨æ ¼å°ç…§è¡¨

| èªè¨€ | è®Šæ•¸/å‡½æ•¸ | é¡åˆ¥/çµæ§‹ | å¸¸æ•¸ | æª”æ¡ˆåç¨± |
|------|-----------|-----------|------|----------|
| Go | camelCase | PascalCase | UPPER_SNAKE | snake_case.go |
| JavaScript | camelCase | PascalCase | UPPER_SNAKE | kebab-case.js |
| Python | snake_case | PascalCase | UPPER_SNAKE | snake_case.py |
| Java | camelCase | PascalCase | UPPER_SNAKE | PascalCase.java |
| C# | camelCase | PascalCase | PascalCase | PascalCase.cs |
| Rust | snake_case | PascalCase | UPPER_SNAKE | snake_case.rs |

### 2.2 Go èªè¨€å‘½åæœ€ä½³å¯¦è¸

#### åŸºæœ¬è¦å‰‡
```go
// âœ… æ­£ç¢ºçš„ Go å‘½åé¢¨æ ¼
package userservice

import (
    "context"
    "time"
)

// å¸¸æ•¸ä½¿ç”¨é§å³°å¼ï¼Œé¦–å­—æ¯å¤§å¯«è¡¨ç¤º exported
const (
    DefaultTimeout = 30 * time.Second
    maxRetries     = 3  // å°å¯«è¡¨ç¤º private
)

// çµæ§‹é«”ä½¿ç”¨ PascalCase
type UserProfile struct {
    ID        string    `json:"id"`
    Email     string    `json:"email"`
    CreatedAt time.Time `json:"created_at"`
}

// ä»‹é¢å‘½åé€šå¸¸ä»¥ -er çµå°¾
type UserRepository interface {
    CreateUser(ctx context.Context, user *UserProfile) error
    GetUserByID(ctx context.Context, id string) (*UserProfile, error)
}

// æ–¹æ³•ä½¿ç”¨ camelCaseï¼Œé¦–å­—æ¯å¤§å¯«è¡¨ç¤º public
func (r *userRepository) CreateUser(ctx context.Context, user *UserProfile) error {
    // å€åŸŸè®Šæ•¸ä½¿ç”¨ camelCaseï¼Œé¦–å­—æ¯å°å¯«
    currentTime := time.Now()
    user.CreatedAt = currentTime
    
    return nil
}
```

#### Go å°ˆæ¡ˆçµæ§‹å‘½å
```
project-root/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ user-service/          # æ‡‰ç”¨ç¨‹å¼é€²å…¥é»
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ internal/                  # ç§æœ‰ç¨‹å¼ç¢¼
â”‚   â”œâ”€â”€ user/                 # é ˜åŸŸæ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ service.go
â”‚   â”‚   â”œâ”€â”€ repository.go
â”‚   â”‚   â””â”€â”€ handler.go
â”‚   â””â”€â”€ config/               # é…ç½®æ¨¡çµ„
â”‚       â””â”€â”€ config.go
â”œâ”€â”€ pkg/                      # å¯é‡ç”¨çš„å…¬é–‹ç¨‹å¼ç¢¼
â”‚   â””â”€â”€ logger/
â”‚       â””â”€â”€ logger.go
â”œâ”€â”€ api/                      # API å®šç¾©
â”‚   â””â”€â”€ openapi.yaml
â”œâ”€â”€ deployments/              # éƒ¨ç½²é…ç½®
â”‚   â””â”€â”€ kubernetes/
â””â”€â”€ go.mod
```

### 2.3 JavaScript/TypeScript å‘½åè¦ç¯„

#### ES6+ ç¾ä»£ JavaScript å‘½å
```javascript
// âœ… ç¾ä»£ JavaScript å‘½åè¦ç¯„
const API_BASE_URL = 'https://api.example.com';
const DEFAULT_TIMEOUT = 5000;

class UserService {
    constructor(apiClient) {
        this.apiClient = apiClient;
        this._cache = new Map(); // ç§æœ‰å±¬æ€§å‰ç¶´ _
    }
    
    async getUserProfile(userId) {
        // ä½¿ç”¨ camelCase
        const cacheKey = `user_${userId}`;
        
        if (this._cache.has(cacheKey)) {
            return this._cache.get(cacheKey);
        }
        
        try {
            const userProfile = await this.apiClient.get(`/users/${userId}`);
            this._cache.set(cacheKey, userProfile);
            return userProfile;
        } catch (error) {
            throw new Error(`Failed to fetch user profile: ${error.message}`);
        }
    }
    
    // äº‹ä»¶è™•ç†å‡½æ•¸ä»¥ handle é–‹é ­
    handleUserLogin(loginData) {
        return this.validateAndProcessLogin(loginData);
    }
    
    // å¸ƒæ—å€¼å‡½æ•¸ä»¥ is/has/can é–‹é ­
    isUserActive(user) {
        return user.status === 'active' && user.lastLoginAt > Date.now() - 86400000;
    }
}

// å·¥å» å‡½æ•¸ä»¥ create é–‹é ­
function createUserService(apiClient) {
    return new UserService(apiClient);
}

// é«˜éšå‡½æ•¸ä½¿ç”¨å‹•è© + åè©
const withAuthentication = (component) => {
    return (props) => {
        // HOC å¯¦ä½œ
    };
};
```

#### TypeScript ç‰¹å®šå‘½åè¦ç¯„
```typescript
// âœ… TypeScript å‘½åæœ€ä½³å¯¦è¸
interface UserProfile {
    readonly id: string;
    email: string;
    firstName: string;
    lastName: string;
    isActive: boolean;
}

// å‹åˆ¥åˆ¥åä½¿ç”¨ PascalCase
type UserRole = 'admin' | 'user' | 'guest';
type CreateUserRequest = Omit<UserProfile, 'id'>;

// æ³›å‹åƒæ•¸ä½¿ç”¨å–®å€‹å¤§å¯«å­—æ¯
interface Repository<T, K = string> {
    findById(id: K): Promise<T | null>;
    save(entity: T): Promise<T>;
}

// è£é£¾å™¨ä½¿ç”¨ camelCase
function logExecutionTime(target: any, propertyName: string, descriptor: PropertyDescriptor) {
    // è£é£¾å™¨å¯¦ä½œ
}

class UserRepository implements Repository<UserProfile> {
    @logExecutionTime
    async findById(id: string): Promise<UserProfile | null> {
        // å¯¦ä½œ
        return null;
    }
}
```

### 2.4 Python å‘½åæ…£ä¾‹

#### PEP 8 å‘½åæ¨™æº–
```python
# âœ… Python å‘½åè¦ç¯„ (PEP 8)
import os
import sys
from typing import Optional, List, Dict, Any
from datetime import datetime

# å¸¸æ•¸ä½¿ç”¨ UPPER_SNAKE_CASE
API_BASE_URL = 'https://api.example.com'
DEFAULT_TIMEOUT = 30
MAX_RETRY_ATTEMPTS = 3

class UserService:
    """ä½¿ç”¨è€…æœå‹™é¡åˆ¥ - é¡åˆ¥åç¨±ä½¿ç”¨ PascalCase"""
    
    def __init__(self, api_client):
        self.api_client = api_client
        self._cache = {}  # ç§æœ‰å±¬æ€§ä»¥åº•ç·šé–‹é ­
        self.__secret_key = None  # åç¨±ä¿®é£¾ä½¿ç”¨é›™åº•ç·š
    
    def get_user_profile(self, user_id: str) -> Optional[Dict[str, Any]]:
        """
        ç²å–ä½¿ç”¨è€…è³‡æ–™ - å‡½æ•¸åç¨±ä½¿ç”¨ snake_case
        
        Args:
            user_id: ä½¿ç”¨è€… ID
            
        Returns:
            ä½¿ç”¨è€…è³‡æ–™å­—å…¸æˆ– None
        """
        cache_key = f"user_{user_id}"
        
        if cache_key in self._cache:
            return self._cache[cache_key]
            
        try:
            user_profile = self.api_client.get(f"/users/{user_id}")
            self._cache[cache_key] = user_profile
            return user_profile
        except Exception as error:
            logger.error(f"Failed to fetch user profile: {error}")
            return None
    
    def is_user_active(self, user: Dict[str, Any]) -> bool:
        """å¸ƒæ—å‡½æ•¸ä»¥ is_ é–‹é ­"""
        return (
            user.get('status') == 'active' 
            and user.get('last_login_at', 0) > datetime.now().timestamp() - 86400
        )
    
    @staticmethod
    def validate_email(email: str) -> bool:
        """éœæ…‹æ–¹æ³•ä½¿ç”¨ snake_case"""
        import re
        email_pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
        return re.match(email_pattern, email) is not None

# æ¨¡çµ„å±¤ç´šå‡½æ•¸ä½¿ç”¨ snake_case
def create_user_service(api_client) -> UserService:
    """å·¥å» å‡½æ•¸"""
    return UserService(api_client)

# ä¾‹å¤–é¡åˆ¥ä»¥ Error æˆ– Exception çµå°¾
class UserNotFoundError(Exception):
    """ç•¶æ‰¾ä¸åˆ°ä½¿ç”¨è€…æ™‚æ‹‹å‡ºçš„ä¾‹å¤–"""
    pass

class InvalidUserDataError(ValueError):
    """ç•¶ä½¿ç”¨è€…è³‡æ–™ç„¡æ•ˆæ™‚æ‹‹å‡ºçš„ä¾‹å¤–"""
    pass
```

### 2.5 è·¨èªè¨€å°ˆæ¡ˆçš„å‘½åçµ±ä¸€

#### çµ±ä¸€çš„ API è¨­è¨ˆ
```yaml
# REST API è·¯å¾‘çµ±ä¸€ä½¿ç”¨ kebab-case
GET  /api/v1/user-profiles/{id}
POST /api/v1/user-profiles
PUT  /api/v1/user-profiles/{id}
DELETE /api/v1/user-profiles/{id}

# GraphQL ä½¿ç”¨ camelCase
query {
  userProfile(id: "123") {
    firstName
    lastName
    isActive
    createdAt
  }
}
```

#### è³‡æ–™åº«å‘½åçµ±ä¸€
```sql
-- è¡¨æ ¼åç¨±ä½¿ç”¨ snake_case è¤‡æ•¸å½¢å¼
CREATE TABLE user_profiles (
    id UUID PRIMARY KEY,
    first_name VARCHAR(100) NOT NULL,
    last_name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ç´¢å¼•å‘½åè¦å‰‡ï¼šidx_è¡¨å_æ¬„ä½å
CREATE INDEX idx_user_profiles_email ON user_profiles(email);
CREATE INDEX idx_user_profiles_active_created ON user_profiles(is_active, created_at);
```

#### ç·´ç¿’é¡Œ 2.1
è«‹å°‡ä»¥ä¸‹ç³Ÿç³•çš„å‘½åæ”¹å¯«ç‚ºç¬¦åˆå„èªè¨€è¦ç¯„çš„è‰¯å¥½å‘½åï¼š

**JavaScript:**
```javascript
// âŒ éœ€è¦æ”¹é€²
var u = {};
function getdata(i) {
    return DB.find(i);
}
class usrmgr {
    delUsr(id) {}
}
```

**Python:**
```python
# âŒ éœ€è¦æ”¹é€²  
def GetUserData(ID):
    return db.Find(ID)

class UserMGR:
    def DelUser(self, ID):
        pass
```

**åƒè€ƒç­”æ¡ˆå°‡åœ¨ä¸‹ä¸€ç« ç¯€æä¾›**

---

## ç¬¬ä¸‰ç« ï¼šç‰ˆæœ¬æ§åˆ¶ç³»çµ±å‘½å

### 3.1 Git åˆ†æ”¯å‘½åç­–ç•¥

#### Git Flow åˆ†æ”¯å‘½åè¦ç¯„
```bash
# ä¸»è¦åˆ†æ”¯ - æ°¸çºŒå­˜åœ¨
main                    # ä¸»åˆ†æ”¯ï¼ˆç”Ÿç”¢ç’°å¢ƒï¼‰
develop                 # é–‹ç™¼åˆ†æ”¯ï¼ˆæ•´åˆç’°å¢ƒï¼‰

# åŠŸèƒ½åˆ†æ”¯ - è‡¨æ™‚åˆ†æ”¯
feature/user-authentication     # åŠŸèƒ½é–‹ç™¼
feature/payment-integration    # æ”¯ä»˜æ•´åˆ
feature/mobile-responsive      # æ‰‹æ©Ÿç‰ˆéŸ¿æ‡‰å¼

# ä¿®å¾©åˆ†æ”¯
hotfix/security-patch-v1.2.1   # ç·Šæ€¥ä¿®å¾©
bugfix/login-error-handling     # ä¸€èˆ¬éŒ¯èª¤ä¿®å¾©

# ç™¼å¸ƒåˆ†æ”¯
release/v1.3.0         # ç‰ˆæœ¬ç™¼å¸ƒæº–å‚™
release/v2.0.0-beta    # Beta ç‰ˆæœ¬ç™¼å¸ƒ
```

#### GitHub Flow ç°¡åŒ–åˆ†æ”¯ç­–ç•¥
```bash
# ä¸»åˆ†æ”¯
main

# åŠŸèƒ½åˆ†æ”¯ï¼ˆç›´æ¥å¾ main åˆ†å‡ºï¼‰
add-user-dashboard
fix-memory-leak
update-dependencies
refactor-authentication-service
```

#### åˆ†æ”¯å‘½åæœ€ä½³å¯¦è¸
```bash
# âœ… è‰¯å¥½çš„åˆ†æ”¯å‘½å
feature/jira-123-user-profile-editing
hotfix/critical-sql-injection-fix
refactor/extract-user-service-layer
docs/api-documentation-update

# âŒ ç³Ÿç³•çš„åˆ†æ”¯å‘½å
feature/stuff
fix/bug
john-working-branch
temp-branch-delete-later
```

### 3.2 Commit è¨Šæ¯è¦ç¯„åŒ–

#### Conventional Commits è¦ç¯„
```bash
# æ ¼å¼ï¼š<type>(<scope>): <description>
#
# <body>
#
# <footer>

# åŸºæœ¬ç¯„ä¾‹
feat: add user authentication API
fix: resolve memory leak in user service
docs: update API documentation
style: format code according to prettier rules
refactor: extract user validation logic
test: add unit tests for payment service
chore: update dependencies

# åŒ…å«ç¯„åœçš„ç¯„ä¾‹
feat(auth): implement OAuth2 integration
fix(payment): handle edge case in refund process
docs(api): add examples for user endpoints
refactor(database): optimize user query performance

# ç ´å£æ€§è®Šæ›´
feat!: change user API response format

BREAKING CHANGE: user API now returns different response structure
```

#### å®Œæ•´çš„ Commit è¨Šæ¯ç¯„ä¾‹
```bash
feat(user-service): add email verification feature

- Implement email verification workflow
- Add email template system
- Create verification token management
- Update user registration process

Closes #456
Co-authored-by: Jane Smith <jane@example.com>
```

#### commitlint é…ç½®
```javascript
// commitlint.config.js
module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'type-enum': [
      2,
      'always',
      [
        'feat',     // æ–°åŠŸèƒ½
        'fix',      // éŒ¯èª¤ä¿®å¾©
        'docs',     // æ–‡ä»¶æ›´æ–°
        'style',    // ç¨‹å¼ç¢¼æ ¼å¼èª¿æ•´
        'refactor', // é‡æ§‹
        'perf',     // æ•ˆèƒ½å„ªåŒ–
        'test',     // å¢åŠ æ¸¬è©¦
        'chore',    // å»ºç½®æˆ–è¼”åŠ©å·¥å…·è®Šå‹•
        'revert',   // æ’¤éŠ·å…ˆå‰çš„ commit
        'ci',       // CI ç›¸é—œè®Šå‹•
      ],
    ],
    'subject-max-length': [2, 'always', 100],
    'subject-case': [2, 'always', 'lower-case'],
    'subject-empty': [2, 'never'],
    'header-max-length': [2, 'always', 100],
  },
};
```

### 3.3 æ¨™ç±¤èˆ‡ç‰ˆæœ¬å‘½å

#### èªæ„åŒ–ç‰ˆæœ¬æ§åˆ¶ (Semantic Versioning)
```bash
# ç‰ˆæœ¬æ ¼å¼ï¼šMAJOR.MINOR.PATCH[-PRERELEASE][+BUILD]

# æ­£å¼ç‰ˆæœ¬
v1.0.0          # åˆå§‹ç‰ˆæœ¬
v1.0.1          # ä¿®å¾©ç‰ˆæœ¬ï¼ˆå‘å¾Œç›¸å®¹ï¼‰
v1.1.0          # åŠŸèƒ½ç‰ˆæœ¬ï¼ˆå‘å¾Œç›¸å®¹ï¼‰  
v2.0.0          # ä¸»è¦ç‰ˆæœ¬ï¼ˆå¯èƒ½ä¸å‘å¾Œç›¸å®¹ï¼‰

# é ç™¼å¸ƒç‰ˆæœ¬
v1.2.0-alpha.1  # Alpha ç‰ˆæœ¬
v1.2.0-beta.1   # Beta ç‰ˆæœ¬
v1.2.0-rc.1     # Release Candidate

# åŒ…å«å»ºç½®è³‡è¨Š
v1.2.0+20231201.abc123f
v1.2.0-beta.1+exp.sha.5114f85
```

#### Git æ¨™ç±¤æ“ä½œç¯„ä¾‹
```bash
# å‰µå»ºè¼•é‡æ¨™ç±¤
git tag v1.0.0

# å‰µå»ºé™„è¨»æ¨™ç±¤ï¼ˆæ¨è–¦ï¼‰
git tag -a v1.0.0 -m "Release version 1.0.0

Features:
- User authentication system
- Payment integration  
- Mobile responsive design

Bug fixes:
- Fix memory leak in user service
- Resolve login timeout issue"

# æ¨é€æ¨™ç±¤åˆ°é ç«¯
git push origin v1.0.0
git push origin --tags

# æŸ¥çœ‹æ¨™ç±¤è³‡è¨Š
git show v1.0.0
```

### 3.4 Pull Request èˆ‡ Issue å‘½å

#### Pull Request å‘½åè¦ç¯„
```bash
# æ ¼å¼ï¼š[TYPE] Description (#issue-number)

# åŠŸèƒ½ PR
[FEAT] Add user profile editing functionality (#123)
[FEAT] Implement real-time notifications (#456)

# ä¿®å¾© PR  
[FIX] Resolve login session timeout issue (#789)
[HOTFIX] Critical security patch for XSS vulnerability (#999)

# é‡æ§‹ PR
[REFACTOR] Extract user service into separate module (#234)
[PERF] Optimize database queries for user dashboard (#567)

# æ–‡ä»¶ PR
[DOCS] Update API documentation with new endpoints (#345)
[DOCS] Add contributing guidelines (#678)
```

#### Issue å‘½åè¦ç¯„
```bash
# Bug å ±å‘Š
[BUG] User login fails with special characters in password
[BUG] Memory leak in background sync process
[CRITICAL] Data corruption in user profiles table

# åŠŸèƒ½è«‹æ±‚
[FEATURE] Add export functionality to user dashboard  
[ENHANCEMENT] Improve loading performance on mobile devices
[FEATURE REQUEST] Integration with third-party analytics

# ä»»å‹™
[TASK] Update dependencies to latest versions
[CHORE] Clean up deprecated code in user service
[MAINTENANCE] Database backup strategy implementation
```

#### GitHub Issue ç¯„æœ¬
```markdown
---
name: Bug Report
about: Create a report to help us improve
title: '[BUG] '
labels: 'bug, needs-triage'
assignees: ''
---

## ğŸ› Bug Description
A clear and concise description of what the bug is.

## ğŸ”„ Steps to Reproduce
1. Go to '...'
2. Click on '....'
3. Scroll down to '....'
4. See error

## âœ… Expected Behavior
A clear and concise description of what you expected to happen.

## ğŸ“¸ Screenshots
If applicable, add screenshots to help explain your problem.

## ğŸŒ Environment
- OS: [e.g. iOS]
- Browser: [e.g. chrome, safari]
- Version: [e.g. 22]

## ğŸ“ Additional Context
Add any other context about the problem here.
```

#### å¯¦æˆ°æ¼”ç·´ 3.1
è«‹ç‚ºä»¥ä¸‹æƒ…å¢ƒè¨­è¨ˆåˆé©çš„å‘½åï¼š

1. **åˆ†æ”¯å‘½å**ï¼šä½ æ­£åœ¨é–‹ç™¼ä¸€å€‹æ–°çš„ä½¿ç”¨è€…æ¬Šé™ç®¡ç†ç³»çµ±
2. **Commit è¨Šæ¯**ï¼šä½ ä¿®å¾©äº†ä¸€å€‹å°è‡´æ”¯ä»˜å¤±æ•—çš„é—œéµ bug
3. **ç‰ˆæœ¬æ¨™ç±¤**ï¼šä½ çš„æ‡‰ç”¨ç¨‹å¼å·²ç¶“æ˜¯ v1.5.2ï¼Œç¾åœ¨è¦ç™¼å¸ƒä¸€å€‹åŒ…å«æ–°åŠŸèƒ½çš„ç‰ˆæœ¬
4. **Pull Request**ï¼šä½ é‡æ§‹äº†è³‡æ–™åº«é€£æ¥é‚è¼¯ä»¥æå‡æ•ˆèƒ½

**åƒè€ƒç­”æ¡ˆ**ï¼š
1. `feature/user-permission-management-system`
2. `fix(payment): resolve transaction failure in checkout process`
3. `v1.6.0`
4. `[PERF] Refactor database connection pooling for better performance (#456)`

---

## ç¬¬å››ç« ï¼šDevOps èˆ‡é›²ç«¯å¹³å°å‘½å

### 4.1 Kubernetes è³‡æºå‘½åè¦ç¯„

#### åŸºæœ¬å‘½ååŸå‰‡
Kubernetes è³‡æºå‘½åå¿…é ˆéµå¾ª DNS-1123 æ¨™æº–ï¼š
- åªèƒ½åŒ…å«å°å¯«å­—æ¯ã€æ•¸å­—å’Œé€£å­—è™Ÿ (-)
- å¿…é ˆä»¥å­—æ¯æˆ–æ•¸å­—é–‹é ­å’Œçµå°¾
- æœ€é•· 63 å€‹å­—å…ƒ

#### Pod èˆ‡ Deployment å‘½å
```yaml
# âœ… è‰¯å¥½çš„ Deployment å‘½å
apiVersion: apps/v1
kind: Deployment
metadata:
  name: user-auth-api-prod          # æœå‹™-ç”¨é€”-ç’°å¢ƒ
  namespace: authentication-services
  labels:
    app: user-auth-api
    component: backend
    version: v1.2.3
    environment: production
    team: platform-engineering
spec:
  replicas: 3
  selector:
    matchLabels:
      app: user-auth-api
      environment: production
  template:
    metadata:
      name: user-auth-api-pod       # Pod åç¨±æ¨¡æ¿
      labels:
        app: user-auth-api
        component: backend
        version: v1.2.3
        environment: production
```

#### Service èˆ‡ Ingress å‘½å
```yaml
# Service å‘½åè¦ç¯„
apiVersion: v1
kind: Service
metadata:
  name: user-auth-api-svc           # æœå‹™åç¨± + svc å¾Œç¶´
  namespace: authentication-services
  labels:
    app: user-auth-api
    tier: backend
spec:
  selector:
    app: user-auth-api
  ports:
  - name: http-api                  # é€£æ¥åŸ åç¨±è¦æœ‰æ„ç¾©
    port: 80
    targetPort: 8080
  - name: health-check
    port: 8081
    targetPort: 8081

---
# Ingress å‘½åè¦ç¯„
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: user-auth-api-ingress       # æœå‹™åç¨± + ingress å¾Œç¶´
  namespace: authentication-services
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: auth-api.production.example.com    # ç’°å¢ƒ.æœå‹™.ç¶²åŸŸ
    http:
      paths:
      - path: /api/v1/auth
        pathType: Prefix
        backend:
          service:
            name: user-auth-api-svc
            port:
              number: 80
```

#### ConfigMap èˆ‡ Secret å‘½å
```yaml
# ConfigMap å‘½å
apiVersion: v1
kind: ConfigMap
metadata:
  name: user-auth-api-config        # æœå‹™åç¨± + config å¾Œç¶´
  namespace: authentication-services
data:
  app.env: "production"
  log.level: "info"
  database.host: "postgres.internal.example.com"

---
# Secret å‘½å
apiVersion: v1
kind: Secret
metadata:
  name: user-auth-api-secrets       # æœå‹™åç¨± + secrets å¾Œç¶´
  namespace: authentication-services
type: Opaque
data:
  database-password: <base64-encoded-password>
  jwt-secret-key: <base64-encoded-jwt-key>
```

### 4.2 Docker æ˜ åƒæª”å‘½åç­–ç•¥

#### æ˜ åƒæª”æ¨™ç±¤å‘½åè¦ç¯„
```bash
# åŸºæœ¬æ ¼å¼ï¼šregistry/namespace/repository:tag
# ç¯„ä¾‹ï¼šregistry.company.com/platform/user-auth-api:v1.2.3

# âœ… è‰¯å¥½çš„æ˜ åƒæª”å‘½å
registry.company.com/platform/user-auth-api:v1.2.3
registry.company.com/platform/user-auth-api:v1.2.3-alpine
registry.company.com/platform/user-auth-api:latest
registry.company.com/platform/user-auth-api:main-abc123f
registry.company.com/platform/user-auth-api:pr-456-def789a

# ç’°å¢ƒç‰¹å®šæ¨™ç±¤
registry.company.com/platform/user-auth-api:v1.2.3-prod
registry.company.com/platform/user-auth-api:v1.2.3-staging
registry.company.com/platform/user-auth-api:v1.2.3-dev

# âŒ ç³Ÿç³•çš„æ˜ åƒæª”å‘½å
myapp:1
app:latest
user-service:john-version
image:final-v2-really-final
```

#### Dockerfile å¤šéšæ®µå»ºç½®å‘½å
```dockerfile
# âœ… è‰¯å¥½çš„å¤šéšæ®µå»ºç½®å‘½å
FROM node:18-alpine AS base-dependencies
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

FROM node:18-alpine AS build-stage
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .
RUN npm run build

FROM node:18-alpine AS production-runtime
WORKDIR /app
COPY --from=base-dependencies /app/node_modules ./node_modules
COPY --from=build-stage /app/dist ./dist
COPY package*.json ./
EXPOSE 8080
CMD ["npm", "start"]
```

### 4.3 é›²ç«¯è³‡æºå‘½åè¦ç¯„

#### AWS è³‡æºå‘½å
```bash
# S3 Bucket å‘½åï¼ˆå…¨çƒå”¯ä¸€ï¼‰
company-user-avatars-prod-us-west-2
company-application-logs-staging-eu-west-1
company-backup-database-prod-ap-southeast-1

# EC2 Instance å‘½å
prod-web-server-01-us-west-2
staging-api-server-02-eu-west-1
dev-database-server-01-us-east-1

# RDS Instance å‘½å
prod-postgres-user-db-primary
prod-postgres-user-db-replica-01
staging-mysql-analytics-db

# Lambda Function å‘½å
prod-user-registration-processor
prod-image-thumbnail-generator
staging-email-notification-sender

# CloudFormation Stack å‘½å
user-service-infrastructure-prod
monitoring-stack-staging
networking-foundation-prod
```

#### Azure è³‡æºå‘½å
```bash
# Resource Group å‘½å
rg-user-service-prod-eastus
rg-monitoring-shared-westus2
rg-networking-hub-centralus

# Virtual Machine å‘½å
vm-web-prod-01-eastus
vm-api-staging-02-westus2
vm-db-prod-primary-centralus

# Storage Account å‘½åï¼ˆåªèƒ½å°å¯«å­—æ¯å’Œæ•¸å­—ï¼‰
sauserserviceprodeastus
samonitoringsharedwestus2
sabackupprodcentralus

# App Service å‘½å
app-user-api-prod-eastus
app-admin-portal-staging-westus2
```

#### Google Cloud Platform è³‡æºå‘½å
```bash
# Project ID å‘½å
company-user-service-prod
company-analytics-platform-dev
company-infrastructure-shared

# Compute Engine Instance å‘½å
prod-web-server-01-us-west1-a
staging-api-server-02-europe-west1-b
dev-database-server-01-asia-east1-c

# Cloud Storage Bucket å‘½å
company-user-uploads-prod-us
company-application-logs-staging-eu
company-backup-data-prod-asia

# Cloud Function å‘½å
prod-user-notification-processor
staging-image-resize-handler
dev-data-transformation-pipeline
```

### 4.4 ç›£æ§èˆ‡æ—¥èªŒå‘½å

#### Prometheus æŒ‡æ¨™å‘½å
```bash
# æ ¼å¼ï¼š<namespace>_<subsystem>_<name>_<unit>

# âœ… è‰¯å¥½çš„æŒ‡æ¨™å‘½å
http_requests_total                    # HTTP è«‹æ±‚ç¸½æ•¸
http_request_duration_seconds         # HTTP è«‹æ±‚æŒçºŒæ™‚é–“
database_connections_active           # è³‡æ–™åº«é€£æ¥æ•¸
memory_usage_bytes                    # è¨˜æ†¶é«”ä½¿ç”¨é‡
cpu_usage_percent                     # CPU ä½¿ç”¨ç‡ç™¾åˆ†æ¯”

# æ¥­å‹™æŒ‡æ¨™
user_registrations_total              # ä½¿ç”¨è€…è¨»å†Šç¸½æ•¸
payment_transactions_success_total    # æˆåŠŸæ”¯ä»˜äº¤æ˜“æ•¸
email_notifications_sent_total       # å·²ç™¼é€éƒµä»¶é€šçŸ¥æ•¸

# å…·é«”ç¯„ä¾‹é…ç½®
# è¨ˆæ•¸å™¨
user_service_http_requests_total{method="GET",status="200",endpoint="/api/v1/users"}
user_service_http_requests_total{method="POST",status="201",endpoint="/api/v1/users"}

# ç›´æ–¹åœ–
user_service_http_request_duration_seconds{method="GET",endpoint="/api/v1/users"}
user_service_database_query_duration_seconds{operation="select",table="users"}

# é‡è¦
user_service_active_connections
user_service_memory_usage_bytes
user_service_cpu_usage_percent
```

#### æ—¥èªŒå‘½åèˆ‡çµæ§‹åŒ–
```json
{
  "timestamp": "2024-01-15T10:30:45Z",
  "level": "INFO",
  "logger": "user-auth-service",
  "message": "User login successful",
  "service": {
    "name": "user-auth-api",
    "version": "v1.2.3",
    "environment": "production"
  },
  "request": {
    "id": "req-abc123def456",
    "method": "POST",
    "path": "/api/v1/auth/login",
    "user_agent": "Mozilla/5.0...",
    "ip": "192.168.1.100"
  },
  "user": {
    "id": "user-789xyz",
    "email": "user@example.com"
  },
  "performance": {
    "duration_ms": 145,
    "database_queries": 2,
    "cache_hits": 1
  },
  "tags": {
    "team": "platform-engineering",
    "component": "authentication",
    "feature": "user-login"
  }
}
```

### 4.5 CI/CD Pipeline å‘½å

#### GitHub Actions Workflow å‘½å
```yaml
# .github/workflows/user-service-ci-cd.yml
name: User Service CI/CD Pipeline

on:
  push:
    branches: [main, develop]
    paths: ['services/user-service/**']
  pull_request:
    branches: [main]
    paths: ['services/user-service/**']

jobs:
  unit-tests:
    name: Run Unit Tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source Code
        uses: actions/checkout@v4
      
      - name: Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      
      - name: Install Dependencies
        run: npm ci
      
      - name: Run Unit Tests with Coverage
        run: npm run test:coverage

  integration-tests:
    name: Run Integration Tests
    needs: unit-tests
    runs-on: ubuntu-latest

  build-and-push-image:
    name: Build and Push Docker Image
    needs: [unit-tests, integration-tests]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'

#### Jenkins Pipeline å‘½å
```groovy
// Jenkinsfile
pipeline {
    agent any
    
    environment {
        DOCKER_REGISTRY = 'registry.company.com'
        IMAGE_NAME = 'platform/user-auth-api'
        KUBECONFIG_CREDENTIAL = 'k8s-prod-config'
    }
    
    stages {
        stage('Checkout Source Code') {
            steps {
                checkout scm
            }
        }
        
        stage('Run Code Quality Checks') {
            parallel {
                stage('ESLint Code Analysis') {
                    steps {
                        sh 'npm run lint'
                    }
                }
                stage('Security Vulnerability Scan') {
                    steps {
                        sh 'npm audit --audit-level high'
                    }
                }
            }
        }
        
        stage('Execute Unit Tests') {
            steps {
                sh 'npm run test:unit'
            }
            post {
                always {
                    publishTestResults testResultsPattern: 'test-results.xml'
                    publishCoverageReport coveragePattern: 'coverage/lcov.info'
                }
            }
        }
        
        stage('Build Docker Image') {
            steps {
                script {
                    def imageTag = "${BUILD_NUMBER}-${GIT_COMMIT.take(7)}"
                    docker.build("${IMAGE_NAME}:${imageTag}")
                }
            }
        }
        
        stage('Deploy to Staging Environment') {
            when {
                branch 'develop'
            }
            steps {
                sh './scripts/deploy-to-staging.sh'
            }
        }
        
        stage('Deploy to Production Environment') {
            when {
                branch 'main'
            }
            steps {
                input message: 'Deploy to production?', ok: 'Deploy'
                sh './scripts/deploy-to-production.sh'
            }
        }
    }
    
    post {
        failure {
            slackSend(
                channel: '#platform-engineering',
                color: 'danger',
                message: "âŒ Pipeline failed: ${env.JOB_NAME} - ${env.BUILD_NUMBER}"
            )
        }
        success {
            slackSend(
                channel: '#platform-engineering',
                color: 'good',
                message: "âœ… Pipeline succeeded: ${env.JOB_NAME} - ${env.BUILD_NUMBER}"
            )
        }
    }
}
```

#### GitLab CI/CD Pipeline å‘½å
```yaml
# .gitlab-ci.yml
stages:
  - code-quality
  - test
  - build
  - deploy-staging
  - deploy-production

variables:
  DOCKER_REGISTRY: registry.company.com
  IMAGE_NAME: platform/user-auth-api
  POSTGRES_DB: test_database
  POSTGRES_USER: test_user
  POSTGRES_PASSWORD: test_password

before_script:
  - echo "Starting pipeline for $CI_PROJECT_NAME"

code-quality-analysis:
  stage: code-quality
  image: node:18-alpine
  script:
    - npm ci
    - npm run lint
    - npm run format:check
  artifacts:
    reports:
      codequality: code-quality-report.json

security-vulnerability-scan:
  stage: code-quality
  image: node:18-alpine
  script:
    - npm audit --audit-level high
    - npm run security:scan
  allow_failure: true

unit-tests:
  stage: test
  image: node:18-alpine
  services:
    - postgres:15-alpine
  script:
    - npm ci
    - npm run test:unit
  coverage: '/Lines\s*:\s*(\d+\.\d+)%/'
  artifacts:
    reports:
      junit: test-results.xml
      coverage_report:
        coverage_format: cobertura
        path: coverage/cobertura-coverage.xml

integration-tests:
  stage: test
  image: node:18-alpine
  services:
    - postgres:15-alpine
    - redis:7-alpine
  script:
    - npm ci
    - npm run test:integration
  dependencies:
    - unit-tests

build-docker-image:
  stage: build
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
    - docker build -t $CI_REGISTRY_IMAGE:latest .
    - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - docker push $CI_REGISTRY_IMAGE:latest
  only:
    - main
    - develop

deploy-to-staging:
  stage: deploy-staging
  image: kubectl:latest
  script:
    - kubectl config use-context staging-cluster
    - kubectl set image deployment/user-auth-api-staging user-auth-api=$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - kubectl rollout status deployment/user-auth-api-staging
  environment:
    name: staging
    url: https://api-staging.company.com
  only:
    - develop

deploy-to-production:
  stage: deploy-production
  image: kubectl:latest
  script:
    - kubectl config use-context production-cluster
    - kubectl set image deployment/user-auth-api-prod user-auth-api=$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - kubectl rollout status deployment/user-auth-api-prod
  environment:
    name: production
    url: https://api.company.com
  when: manual
  only:
    - main
```

### 4.6 Infrastructure as Code å‘½å

#### Terraform è³‡æºå‘½å
```hcl
# main.tf - AWS è³‡æºå‘½åç¯„ä¾‹

# VPC å‘½å
resource "aws_vpc" "main_vpc" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true
  
  tags = {
    Name        = "vpc-user-service-prod"
    Environment = "production"
    Project     = "user-service"
    Team        = "platform-engineering"
  }
}

# Subnet å‘½å
resource "aws_subnet" "public_subnet_1a" {
  vpc_id            = aws_vpc.main_vpc.id
  cidr_block        = "10.0.1.0/24"
  availability_zone = "us-west-2a"
  
  map_public_ip_on_launch = true
  
  tags = {
    Name = "subnet-public-1a-user-service-prod"
    Type = "public"
    AZ   = "us-west-2a"
  }
}

resource "aws_subnet" "private_subnet_1a" {
  vpc_id            = aws_vpc.main_vpc.id
  cidr_block        = "10.0.10.0/24"
  availability_zone = "us-west-2a"
  
  tags = {
    Name = "subnet-private-1a-user-service-prod"
    Type = "private"
    AZ   = "us-west-2a"
  }
}

# Security Group å‘½å
resource "aws_security_group" "web_server_sg" {
  name_prefix = "sg-web-server-"
  description = "Security group for web servers"
  vpc_id      = aws_vpc.main_vpc.id
  
  ingress {
    description = "HTTPS traffic"
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
  
  ingress {
    description = "HTTP traffic"
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
  
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
  
  tags = {
    Name = "sg-web-server-user-service-prod"
  }
}

# EC2 Instance å‘½å
resource "aws_instance" "web_server" {
  count = 2
  
  ami           = "ami-0c02fb55956c7d316"
  instance_type = "t3.medium"
  
  subnet_id              = aws_subnet.public_subnet_1a.id
  vpc_security_group_ids = [aws_security_group.web_server_sg.id]
  
  user_data = file("${path.module}/scripts/install-web-server.sh")
  
  tags = {
    Name = "ec2-web-server-${count.index + 1}-user-service-prod"
    Role = "web-server"
    Index = count.index + 1
  }
}

# RDS Instance å‘½å
resource "aws_db_instance" "postgres_primary" {
  identifier = "rds-postgres-user-service-prod-primary"
  
  engine         = "postgres"
  engine_version = "15.3"
  instance_class = "db.t3.medium"
  
  allocated_storage     = 100
  max_allocated_storage = 1000
  storage_type         = "gp2"
  storage_encrypted    = true
  
  db_name  = "userservice"
  username = "dbadmin"
  password = var.db_password
  
  vpc_security_group_ids = [aws_security_group.database_sg.id]
  db_subnet_group_name   = aws_db_subnet_group.main.name
  
  backup_retention_period = 7
  backup_window          = "03:00-04:00"
  maintenance_window     = "sun:04:00-sun:05:00"
  
  skip_final_snapshot = false
  final_snapshot_identifier = "rds-postgres-user-service-prod-final-snapshot"
  
  tags = {
    Name = "rds-postgres-user-service-prod-primary"
  }
}

# Load Balancer å‘½å
resource "aws_lb" "application_load_balancer" {
  name               = "alb-user-service-prod"
  internal           = false
  load_balancer_type = "application"
  security_groups    = [aws_security_group.alb_sg.id]
  subnets            = [aws_subnet.public_subnet_1a.id, aws_subnet.public_subnet_1b.id]
  
  enable_deletion_protection = true
  
  tags = {
    Name = "alb-user-service-prod"
  }
}

# S3 Bucket å‘½å
resource "aws_s3_bucket" "user_uploads" {
  bucket = "company-user-uploads-prod-${random_string.bucket_suffix.result}"
  
  tags = {
    Name        = "s3-user-uploads-prod"
    Purpose     = "user-file-storage"
    Environment = "production"
  }
}

resource "random_string" "bucket_suffix" {
  length  = 8
  special = false
  upper   = false
}
```

#### Ansible Playbook å‘½å
```yaml
# playbooks/deploy-user-service.yml
---
- name: Deploy User Service to Production Servers
  hosts: production_web_servers
  become: yes
  vars:
    service_name: user

#### Jenkins Pipeline å‘½å
```groovy
// Jenkinsfile
pipeline {
    agent any
    
    environment {
        DOCKER_REGISTRY = 'registry.company.com'
        IMAGE_NAME = 'platform/user-auth-api'
        KUBECONFIG_CREDENTIAL = 'k8s-prod-config'
    }
    
    stages {
        stage('Checkout Source Code') {
            steps {
                checkout scm
            }
        }
        
        stage('Run Code Quality Checks') {
            parallel {
                stage('ESLint Code Analysis') {
                    steps {
                        sh 'npm run lint'
                    }
                }
                stage('Security Vulnerability Scan') {
                    steps {
                        sh 'npm audit --audit-level high'
                    }
                }
            }
        }
        
        stage('Execute Unit Tests') {
            steps {
                sh 'npm run test:unit'
            }
            post {
                always {
                    publishTestResults testResultsPattern: 'test-results.xml'
                    publishCoverageReport coveragePattern: 'coverage/lcov.info'
                }
            }
        }
        
        stage('Build Docker Image') {
            steps {
                script {
                    def imageTag = "${BUILD_NUMBER}-${GIT_COMMIT.take(7)}"
                    docker.build("${IMAGE_NAME}:${imageTag}")
                }
            }
        }
        
        stage('Deploy to Staging Environment') {
            when {
                branch 'develop'
            }
            steps {
                sh './scripts/deploy-to-staging.sh'
            }
        }
        
        stage('Deploy to Production Environment') {
            when {
                branch 'main'
            }
            steps {
                input message: 'Deploy to production?', ok: 'Deploy'
                sh './scripts/deploy-to-production.sh'
            }
        }
    }
    
    post {
        failure {
            slackSend(
                channel: '#platform-engineering',
                color: 'danger',
                message: "âŒ Pipeline failed: ${env.JOB_NAME} - ${env.BUILD_NUMBER}"
            )
        }
        success {
            slackSend(
                channel: '#platform-engineering',
                color: 'good',
                message: "âœ… Pipeline succeeded: ${env.JOB_NAME} - ${env.BUILD_NUMBER}"
            )
        }
    }
}
```

#### GitLab CI/CD Pipeline å‘½å
```yaml
# .gitlab-ci.yml
stages:
  - code-quality
  - test
  - build
  - deploy-staging
  - deploy-production

variables:
  DOCKER_REGISTRY: registry.company.com
  IMAGE_NAME: platform/user-auth-api
  POSTGRES_DB: test_database
  POSTGRES_USER: test_user
  POSTGRES_PASSWORD: test_password

before_script:
  - echo "Starting pipeline for $CI_PROJECT_NAME"

code-quality-analysis:
  stage: code-quality
  image: node:18-alpine
  script:
    - npm ci
    - npm run lint
    - npm run format:check
  artifacts:
    reports:
      codequality: code-quality-report.json

security-vulnerability-scan:
  stage: code-quality
  image: node:18-alpine
  script:
    - npm audit --audit-level high
    - npm run security:scan
  allow_failure: true

unit-tests:
  stage: test
  image: node:18-alpine
  services:
    - postgres:15-alpine
  script:
    - npm ci
    - npm run test:unit
  coverage: '/Lines\s*:\s*(\d+\.\d+)%/'
  artifacts:
    reports:
      junit: test-results.xml
      coverage_report:
        coverage_format: cobertura
        path: coverage/cobertura-coverage.xml

integration-tests:
  stage: test
  image: node:18-alpine
  services:
    - postgres:15-alpine
    - redis:7-alpine
  script:
    - npm ci
    - npm run test:integration
  dependencies:
    - unit-tests

build-docker-image:
  stage: build
  image: docker:20.10.16
  services:
    - docker:20.10.16-dind
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - docker build -t $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA .
    - docker build -t $CI_REGISTRY_IMAGE:latest .
    - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - docker push $CI_REGISTRY_IMAGE:latest
  only:
    - main
    - develop

deploy-to-staging:
  stage: deploy-staging
  image: kubectl:latest
  script:
    - kubectl config use-context staging-cluster
    - kubectl set image deployment/user-auth-api-staging user-auth-api=$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - kubectl rollout status deployment/user-auth-api-staging
  environment:
    name: staging
    url: https://api-staging.company.com
  only:
    - develop

deploy-to-production:
  stage: deploy-production
  image: kubectl:latest
  script:
    - kubectl config use-context production-cluster
    - kubectl set image deployment/user-auth-api-prod user-auth-api=$CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
    - kubectl rollout status deployment/user-auth-api-prod
  environment:
    name: production
    url: https://api.company.com
  when: manual
  only:
    - main
```

### 4.7 Infrastructure as Code å‘½å

#### Terraform è³‡æºå‘½å
```hcl
# main.tf - AWS è³‡æºå‘½åç¯„ä¾‹

# VPC å‘½å
resource "aws_vpc" "main_vpc" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true
  
  tags = {
    Name        = "vpc-user-service-prod"
    Environment = "production"
    Project     = "user-service"
    Team        = "platform-engineering"
  }
}

# Subnet å‘½å
resource "aws_subnet" "public_subnet_1a" {
  vpc_id            = aws_vpc.main_vpc.id
  cidr_block        = "10.0.1.0/24"
  availability_zone = "us-west-2a"
  
  map_public_ip_on_launch = true
  
  tags = {
    Name = "subnet-public-1a-user-service-prod"
    Type = "public"
    AZ   = "us-west-2a"
  }
}

resource "aws_subnet" "private_subnet_1a" {
  vpc_id            = aws_vpc.main_vpc.id
  cidr_block        = "10.0.10.0/24"
  availability_zone = "us-west-2a"
  
  tags = {
    Name = "subnet-private-1a-user-service-prod"
    Type = "private"
    AZ   = "us-west-2a"
  }
}

# Security Group å‘½å
resource "aws_security_group" "web_server_sg" {
  name_prefix = "sg-web-server-"
  description = "Security group for web servers"
  vpc_id      = aws_vpc.main_vpc.id
  
  ingress {
    description = "HTTPS traffic"
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
  
  ingress {
    description = "HTTP traffic"
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }
  
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
  
  tags = {
    Name = "sg-web-server-user-service-prod"
  }
}

# EC2 Instance å‘½å
resource "aws_instance" "web_server" {
  count = 2
  
  ami           = "ami-0c02fb55956c7d316"
  instance_type = "t3.medium"
  
  subnet_id              = aws_subnet.public_subnet_1a.id
  vpc_security_group_ids = [aws_security_group.web_server_sg.id]
  
  user_data = file("${path.module}/scripts/install-web-server.sh")
  
  tags = {
    Name = "ec2-web-server-${count.index + 1}-user-service-prod"
    Role = "web-server"
    Index = count.index + 1
  }
}

# RDS Instance å‘½å
resource "aws_db_instance" "postgres_primary" {
  identifier = "rds-postgres-user-service-prod-primary"
  
  engine         = "postgres"
  engine_version = "15.3"
  instance_class = "db.t3.medium"
  
  allocated_storage     = 100
  max_allocated_storage = 1000
  storage_type         = "gp2"
  storage_encrypted    = true
  
  db_name  = "userservice"
  username = "dbadmin"
  password = var.db_password
  
  vpc_security_group_ids = [aws_security_group.database_sg.id]
  db_subnet_group_name   = aws_db_subnet_group.main.name
  
  backup_retention_period = 7
  backup_window          = "03:00-04:00"
  maintenance_window     = "sun:04:00-sun:05:00"
  
  skip_final_snapshot = false
  final_snapshot_identifier = "rds-postgres-user-service-prod-final-snapshot"
  
  tags = {
    Name = "rds-postgres-user-service-prod-primary"
  }
}

# Load Balancer å‘½å
resource "aws_lb" "application_load_balancer" {
  name               = "alb-user-service-prod"
  internal           = false
  load_balancer_type = "application"
  security_groups    = [aws_security_group.alb_sg.id]
  subnets            = [aws_subnet.public_subnet_1a.id, aws_subnet.public_subnet_1b.id]
  
  enable_deletion_protection = true
  
  tags = {
    Name = "alb-user-service-prod"
  }
}

# S3 Bucket å‘½å
resource "aws_s3_bucket" "user_uploads" {
  bucket = "company-user-uploads-prod-${random_string.bucket_suffix.result}"
  
  tags = {
    Name        = "s3-user-uploads-prod"
    Purpose     = "user-file-storage"
    Environment = "production"
  }
}

resource "random_string" "bucket_suffix" {
  length  = 8
  special = false
  upper   = false
}
```

#### Ansible Playbook å‘½å
```yaml
# playbooks/deploy-user-service.yml
---
- name: Deploy

---

#### Ansible Playbook å‘½å
```yaml
# playbooks/deploy-user-service.yml
---
- name: Deploy User Service to Production Servers
  hosts: production_web_servers
  become: yes
  vars:
    service_name: user-auth-api
    service_version: "{{ ansible_service_version | default('latest') }}"
    deployment_environment: production
    
  tasks:
    - name: Create service directory structure
      file:
        path: "/opt/{{ service_name }}"
        state: directory
        owner: app
        group: app
        mode: '0755'
    
    - name: Download service configuration files
      template:
        src: "{{ item.src }}"
        dest: "/opt/{{ service_name }}/{{ item.dest }}"
        owner: app
        group: app
        mode: '0644'
      loop:
        - { src: 'config.production.yml.j2', dest: 'config.yml' }
        - { src: 'docker-compose.yml.j2', dest: 'docker-compose.yml' }
    
    - name: Pull latest docker image
      docker_image:
        name: "registry.company.com/platform/{{ service_name }}"
        tag: "{{ service_version }}"
        source: pull
    
    - name: Start service containers
      docker_compose:
        project_src: "/opt/{{ service_name }}"
        state: present
        services:
          - user-auth-api
          - redis-cache
          - postgres-db

# playbooks/setup-monitoring.yml
---
- name: Setup Monitoring Infrastructure
  hosts: monitoring_servers
  become: yes
  vars:
    prometheus_version: "2.40.0"
    grafana_version: "9.3.0"
    
  roles:
    - role: prometheus-server
      vars:
        prometheus_config_file: prometheus.production.yml
        prometheus_data_dir: /opt/prometheus/data
    
    - role: grafana-server
      vars:
        grafana_config_file: grafana.production.ini
        grafana_data_dir: /opt/grafana/data
```

#### Helm Chart å‘½å
```yaml
# charts/user-service/Chart.yaml
apiVersion: v2
name: user-service
description: User authentication and management service
type: application
version: 1.2.3
appVersion: "v1.2.3"
keywords:
  - authentication
  - user-management
  - api
home: https://github.com/company/user-service
sources:
  - https://github.com/company/user-service
maintainers:
  - name: Platform Engineering Team
    email: platform-engineering@company.com

# charts/user-service/values.yaml
# é è¨­å€¼é…ç½®
nameOverride: ""
fullnameOverride: ""

image:
  repository: registry.company.com/platform/user-auth-api
  pullPolicy: IfNotPresent
  tag: "v1.2.3"

service:
  type: ClusterIP
  port: 80
  targetPort: 8080
  name: http-api

ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: api.company.com
      paths:
        - path: /v1/auth
          pathType: Prefix
  tls:
    - secretName: user-service-tls
      hosts:
        - api.company.com

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# charts/user-service/templates/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "user-service.fullname" . }}
  labels:
    {{- include "user-service.labels" . | nindent 4 }}
spec:
  {{- if not .Values.autoscaling.enabled }}
  replicas: {{ .Values.replicaCount }}
  {{- end }}
  selector:
    matchLabels:
      {{- include "user-service.selectorLabels" . | nindent 6 }}
  template:
    metadata:
      annotations:
        checksum/config: {{ include (print $.Template.BasePath "/configmap.yaml") . | sha256sum }}
      labels:
        {{- include "user-service.selectorLabels" . | nindent 8 }}
    spec:
      containers:
        - name: {{ .Chart.Name }}
          image: "{{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }}"
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
            - name: health
              containerPort: 8081
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /health/live
              port: health
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            httpGet:
              path: /health/ready
              port: health
            initialDelaySeconds: 5
            periodSeconds: 5
          resources:
            {{- toYaml .Values.resources | nindent 12 }}
```

### 4.8 ç’°å¢ƒç‰¹å®šå‘½åç­–ç•¥

#### å¤šç’°å¢ƒè³‡æºå€åˆ†
```bash
# ç’°å¢ƒå‰ç¶´å‘½åç­–ç•¥
# æ ¼å¼ï¼š{environment}-{service}-{component}-{region}

# é–‹ç™¼ç’°å¢ƒ
dev-user-api-app-us-west-2
dev-user-api-db-us-west-2
dev-user-api-cache-us-west-2

# æ¸¬è©¦ç’°å¢ƒ
test-user-api-app-us-west-2
test-user-api-db-us-west-2
test-user-api-cache-us-west-2

# é ç™¼å¸ƒç’°å¢ƒ
staging-user-api-app-us-west-2
staging-user-api-db-us-west-2
staging-user-api-cache-us-west-2

# ç”Ÿç”¢ç’°å¢ƒ
prod-user-api-app-us-west-2
prod-user-api-db-us-west-2
prod-user-api-cache-us-west-2
```

#### ç’°å¢ƒè®Šæ•¸å‘½å
```bash
# æ‡‰ç”¨ç¨‹å¼ç’°å¢ƒè®Šæ•¸å‘½å
# æ ¼å¼ï¼š{SERVICE}_{CATEGORY}_{SPECIFIC_NAME}

# è³‡æ–™åº«ç›¸é—œ
USER_SERVICE_DB_HOST=postgres.prod.internal.company.com
USER_SERVICE_DB_PORT=5432
USER_SERVICE_DB_NAME=userservice
USER_SERVICE_DB_USERNAME=app_user
USER_SERVICE_DB_PASSWORD=${USER_SERVICE_DB_PASSWORD}
USER_SERVICE_DB_SSL_MODE=require
USER_SERVICE_DB_POOL_SIZE=20
USER_SERVICE_DB_TIMEOUT=30

# Redis å¿«å–ç›¸é—œ
USER_SERVICE_CACHE_HOST=redis.prod.internal.company.com
USER_SERVICE_CACHE_PORT=6379
USER_SERVICE_CACHE_PASSWORD=${USER_SERVICE_CACHE_PASSWORD}
USER_SERVICE_CACHE_DB=0
USER_SERVICE_CACHE_TTL=3600

# æ‡‰ç”¨ç¨‹å¼è¨­å®š
USER_SERVICE_APP_PORT=8080
USER_SERVICE_APP_HOST=0.0.0.0
USER_SERVICE_APP_LOG_LEVEL=info
USER_SERVICE_APP_METRICS_ENABLED=true
USER_SERVICE_APP_HEALTH_CHECK_PORT=8081

# JWT ç›¸é—œ
USER_SERVICE_JWT_SECRET=${USER_SERVICE_JWT_SECRET}
USER_SERVICE_JWT_EXPIRY=24h
USER_SERVICE_JWT_REFRESH_EXPIRY=168h

# ç¬¬ä¸‰æ–¹æœå‹™
USER_SERVICE_EMAIL_PROVIDER=sendgrid
USER_SERVICE_EMAIL_API_KEY=${USER_SERVICE_EMAIL_API_KEY}
USER_SERVICE_NOTIFICATION_WEBHOOK_URL=${USER_SERVICE_NOTIFICATION_WEBHOOK_URL}

# ç›£æ§èˆ‡æ—¥èªŒ
USER_SERVICE_METRICS_ENDPOINT=/metrics
USER_SERVICE_LOG_FORMAT=json
USER_SERVICE_TRACE_ENABLED=true
USER_SERVICE_SENTRY_DSN=${USER_SERVICE_SENTRY_DSN}
```

### 4.9 ç½é›£å¾©åŸèˆ‡å‚™ä»½å‘½å

#### å‚™ä»½è³‡æºå‘½å
```bash
# è³‡æ–™åº«å‚™ä»½å‘½å
# æ ¼å¼ï¼šbackup-{service}-{type}-{timestamp}
backup-user-service-db-full-20240115-030000
backup-user-service-db-incremental-20240115-120000
backup-user-service-db-transaction-log-20240115-150000

# S3 å‚™ä»½ Bucket
company-backups-user-service-prod-us-west-2
company-backups-user-service-staging-us-west-2
company-disaster-recovery-user-service-prod-us-east-1

# å¿«ç…§å‘½å
snap-user-service-db-prod-20240115-030000
snap-user-service-app-volume-prod-20240115-030000
```

#### ç½é›£å¾©åŸè¨ˆç•«å‘½å
```yaml
# disaster-recovery/user-service-dr-plan.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: user-service-dr-plan
  namespace: disaster-recovery
data:
  recovery-time-objective: "4h"
  recovery-point-objective: "1h"
  primary-region: "us-west-2"
  secondary-region: "us-east-1"
  backup-schedule: "0 3 * * *"  # æ¯æ—¥å‡Œæ™¨ 3 é»
  
  restoration-steps: |
    1. Verify secondary region infrastructure
    2. Restore database from latest backup
    3. Update DNS records to point to secondary region
    4. Scale up application instances
    5. Run health checks and validation tests
    6. Notify operations team of successful failover
```

### 4.10 å®‰å…¨èˆ‡åˆè¦å‘½å

#### Security Group èˆ‡ç¶²è·¯ ACL å‘½å
```bash
# Security Group å‘½åæ…£ä¾‹
sg-web-tier-public-prod           # Web å±¤å…¬ç”¨å®‰å…¨ç¾¤çµ„
sg-app-tier-private-prod          # æ‡‰ç”¨ç¨‹å¼å±¤ç§ç”¨å®‰å…¨ç¾¤çµ„
sg-db-tier-restricted-prod        # è³‡æ–™åº«å±¤é™åˆ¶å­˜å–å®‰å…¨ç¾¤çµ„
sg-bastion-host-admin-prod        # å ¡å£˜ä¸»æ©Ÿç®¡ç†å“¡å­˜å–
sg-monitoring-internal-prod       # ç›£æ§æœå‹™å…§éƒ¨å­˜å–

# Network ACL å‘½å
nacl-public-subnet-prod           # å…¬ç”¨å­ç¶²è·¯ ACL
nacl-private-subnet-prod          # ç§ç”¨å­ç¶²è·¯ ACL
nacl-database-subnet-prod         # è³‡æ–™åº«å­ç¶²è·¯ ACL
```

#### æ†‘è­‰èˆ‡é‡‘é‘°ç®¡ç†å‘½å
```bash
# SSL/TLS æ†‘è­‰å‘½å
cert-api-company-com-prod         # API åŸŸåæ†‘è­‰
cert-admin-company-com-prod       # ç®¡ç†ä»‹

---

#### Ansible Playbook å‘½å
```yaml
# playbooks/deploy-user-service.yml
---
- name: Deploy User Service to Production Servers
  hosts: production_web_servers
  become: yes
  vars:
    service_name: user-auth-api
    service_version: "{{ ansible_service_version | default('latest') }}"
    deployment_environment: production
    
  tasks:
    - name: Create service directory structure
      file:
        path: "/opt/{{ service_name }}"
        state: directory
        owner: app
        group: app
        mode: '0755'
    
    - name: Download service configuration files
      template:
        src: "{{ item.src }}"
        dest: "/opt/{{ service_name }}/{{ item.dest }}"
        owner: app
        group: app
        mode: '0644'
      loop:
        - { src: 'config.production.yml.j2', dest: 'config.yml' }
        - { src: 'docker-compose.yml.j2', dest: 'docker-compose.yml' }
    
    - name: Pull latest docker image
      docker_image:
        name: "registry.company.com/platform/{{ service_name }}"
        tag: "{{ service_version }}"
        source: pull
    
    - name: Start service containers
      docker_compose:
        project_src: "/opt/{{ service_name }}"
        state: present
        services:
          - user-auth-api
          - redis-cache
          - postgres-db

# playbooks/setup-monitoring.yml
---
- name: Setup Monitoring Infrastructure
  hosts: monitoring_servers
  become: yes
  vars:
    prometheus_version: "2.40.0"
    grafana_version: "9.3.0"
    
  roles:
    - role: prometheus-server
      vars:
        prometheus_config_file: prometheus.production.yml
        prometheus_data_dir: /opt/prometheus/data
    
    - role: grafana-server
      vars:
        grafana_config_file: grafana.production.ini
        grafana_data_dir: /opt/grafana/data
```

#### Helm Chart å‘½å
```yaml
# charts/user-service/Chart.yaml
apiVersion: v2
name: user-service
description: User authentication and management service
type: application
version: 1.2.3
appVersion: "v1.2.3"
keywords:
  - authentication
  - user-management
  - api
home: https://github.com/company/user-service
sources:
  - https://github.com/company/user-service
maintainers:
  - name: Platform Engineering Team
    email: platform-engineering@company.com

# charts/user-service/values.yaml
# é è¨­å€¼é…ç½®
nameOverride: ""
fullnameOverride: ""

image:
  repository: registry.company.com/platform/user-auth-api
  pullPolicy: IfNotPresent
  tag: "v1.2.3"

service:
  type: ClusterIP
  port: 80
  targetPort: 8080
  name: http-api

ingress:
  enabled: true
  className: "nginx"
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: api.company.com
      paths:
        - path: /v1/auth
          pathType: Prefix
  tls:
    - secretName: user-service-tls
      hosts:
        - api.company.com

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
```

### 4.8 ç’°å¢ƒç‰¹å®šå‘½åç­–ç•¥

#### å¤šç’°å¢ƒè³‡æºå€åˆ†
```bash
# ç’°å¢ƒå‰ç¶´å‘½åç­–ç•¥
# æ ¼å¼ï¼š{environment}-{service}-{component}-{region}

# é–‹ç™¼ç’°å¢ƒ
dev-user-api-app-us-west-2
dev-user-api-db-us-west-2
dev-user-api-cache-us-west-2

# æ¸¬è©¦ç’°å¢ƒ
test-user-api-app-us-west-2
test-user-api-db-us-west-2
test-user-api-cache-us-west-2

# é ç™¼å¸ƒç’°å¢ƒ
staging-user-api-app-us-west-2
staging-user-api-db-us-west-2
staging-user-api-cache-us-west-2

# ç”Ÿç”¢ç’°å¢ƒ
prod-user-api-app-us-west-2
prod-user-api-db-us-west-2
prod-user-api-cache-us-west-2
```

#### ç’°å¢ƒè®Šæ•¸å‘½å
```bash
# æ‡‰ç”¨ç¨‹å¼ç’°å¢ƒè®Šæ•¸å‘½å
# æ ¼å¼ï¼š{SERVICE}_{CATEGORY}_{SPECIFIC_NAME}

# è³‡æ–™åº«ç›¸é—œ
USER_SERVICE_DB_HOST=postgres.prod.internal.company.com
USER_SERVICE_DB_PORT=5432
USER_SERVICE_DB_NAME=userservice
USER_SERVICE_DB_USERNAME=app_user
USER_SERVICE_DB_PASSWORD=${USER_SERVICE_DB_PASSWORD}
USER_SERVICE_DB_SSL_MODE=require
USER_SERVICE_DB_POOL_SIZE=20
USER_SERVICE_DB_TIMEOUT=30

# Redis å¿«å–ç›¸é—œ
USER_SERVICE_CACHE_HOST=redis.prod.internal.company.com
USER_SERVICE_CACHE_PORT=6379
USER_SERVICE_CACHE_PASSWORD=${USER_SERVICE_CACHE_PASSWORD}
USER_SERVICE_CACHE_DB=0
USER_SERVICE_CACHE_TTL=3600

# æ‡‰ç”¨ç¨‹å¼è¨­å®š
USER_SERVICE_APP_PORT=8080
USER_SERVICE_APP_HOST=0.0.0.0
USER_SERVICE_APP_LOG_LEVEL=info
USER_SERVICE_APP_METRICS_ENABLED=true
USER_SERVICE_APP_HEALTH_CHECK_PORT=8081

# JWT ç›¸é—œ
USER_SERVICE_JWT_SECRET=${USER_SERVICE_JWT_SECRET}
USER_SERVICE_JWT_EXPIRY=24h
USER_SERVICE_JWT_REFRESH_EXPIRY=168h

# ç¬¬ä¸‰æ–¹æœå‹™
USER_SERVICE_EMAIL_PROVIDER=sendgrid
USER_SERVICE_EMAIL_API_KEY=${USER_SERVICE_EMAIL_API_KEY}
USER_SERVICE_NOTIFICATION_WEBHOOK_URL=${USER_SERVICE_NOTIFICATION_WEBHOOK_URL}

# ç›£æ§èˆ‡æ—¥èªŒ
USER_SERVICE_METRICS_ENDPOINT=/metrics
USER_SERVICE_LOG_FORMAT=json
USER_SERVICE_TRACE_ENABLED=true
USER_SERVICE_SENTRY_DSN=${USER_SERVICE_SENTRY_DSN}
```

### 4.9 ç½é›£å¾©åŸèˆ‡å‚™ä»½å‘½å

#### å‚™ä»½è³‡æºå‘½å
```bash
# è³‡æ–™åº«å‚™ä»½å‘½å
# æ ¼å¼ï¼šbackup-{service}-{type}-{timestamp}
backup-user-service-db-full-20240115-030000
backup-user-service-db-incremental-20240115-120000
backup-user-service-db-transaction-log-20240115-150000

# S3 å‚™ä»½ Bucket
company-backups-user-service-prod-us-west-2
company-backups-user-service-staging-us-west-2
company-disaster-recovery-user-service-prod-us-east-1

# å¿«ç…§å‘½å
snap-user-service-db-prod-20240115-030000
snap-user-service-app-volume-prod-20240115-030000
```

#### ç½é›£å¾©åŸè¨ˆç•«å‘½å
```yaml
# disaster-recovery/user-service-dr-plan.yml
apiVersion: v1
kind: ConfigMap
metadata:
  name: user-service-dr-plan
  namespace: disaster-recovery
data:
  recovery-time-objective: "4h"
  recovery-point-objective: "1h"
  primary-region: "us-west-2"
  secondary-region: "us-east-1"
  backup-schedule: "0 3 * * *"  # æ¯æ—¥å‡Œæ™¨ 3 é»
  
  restoration-steps: |
    1. Verify secondary region infrastructure
    2. Restore database from latest backup
    3. Update DNS records to point to secondary region
    4. Scale up application instances
    5. Run health checks and validation tests
    6. Notify operations team of successful failover
```

### 4.10 å®‰å…¨èˆ‡åˆè¦å‘½å

#### Security Group èˆ‡ç¶²è·¯ ACL å‘½å
```bash
# Security Group å‘½åæ…£ä¾‹
sg-web-tier-public-prod           # Web å±¤å…¬ç”¨å®‰å…¨ç¾¤çµ„
sg-app-tier-private-prod          # æ‡‰ç”¨ç¨‹å¼å±¤ç§ç”¨å®‰å…¨ç¾¤çµ„
sg-db-tier-restricted-prod        # è³‡æ–™åº«å±¤é™åˆ¶å­˜å–å®‰å…¨ç¾¤çµ„
sg-bastion-host-admin-prod        # å ¡å£˜ä¸»æ©Ÿç®¡ç†å“¡å­˜å–
sg-monitoring-internal-prod       # ç›£æ§æœå‹™å…§éƒ¨å­˜å–

# Network ACL å‘½å
nacl-public-subnet-prod           # å…¬ç”¨å­ç¶²è·¯ ACL
nacl-private-subnet-prod          # ç§ç”¨å­ç¶²è·¯ ACL
nacl-database-subnet-prod         # è³‡æ–™åº«å­ç¶²è·¯ ACL
```

#### æ†‘è­‰èˆ‡é‡‘é‘°ç®¡ç†å‘½å
```bash
# SSL/TLS æ†‘è­‰å‘½å
cert-api-company-com-prod         # API åŸŸåæ†‘è­‰
cert-admin-company-com-prod       # ç®¡ç†ä»‹é¢æ†‘è­‰
cert-wildcard-company-com-prod    # è¬ç”¨å­—å…ƒæ†‘è­‰

# KMS é‡‘é‘°å‘½å
kms-user-service-encryption-prod  # ç”¨æˆ¶æœå‹™åŠ å¯†é‡‘é‘°
kms-database-encryption-prod      # è³‡æ–™åº«åŠ å¯†é‡‘é‘°
kms-backup-encryption-prod        # å‚™ä»½åŠ å¯†é‡‘é‘°

# Secrets Manager å‘½å
secret-user-service-db-credentials-prod
secret-user-service-api-keys-prod
secret-user-service-jwt-signing-key-prod
```

---

# å‘½åè¦ç¯„ç ”ç©¶å ±å‘Šï¼ˆç¬¬äº”ç« è‡³ç¬¬åç« è£œå®Œï¼‰

---

## ç¬¬äº”ç«  åŸºç¤è¨­æ–½å³ç¨‹å¼ç¢¼å‘½åè¦ç¯„

### 5.1 IaC å‘½ååŸå‰‡èˆ‡é‡è¦æ€§

åœ¨ç¾ä»£ DevOps å¯¦è¸ä¸­ï¼Œã€ŒåŸºç¤è¨­æ–½å³ç¨‹å¼ç¢¼ï¼ˆInfrastructure as Code, IaCï¼‰ã€å·²æˆç‚ºç®¡ç†èˆ‡éƒ¨ç½²é›²ç«¯åŸºç¤è¨­æ–½çš„æ¨™æº–æ‰‹æ®µã€‚IaC ä½¿å¾—åŸºç¤è¨­æ–½çš„å®šç¾©ã€éƒ¨ç½²å’Œè®Šæ›´éƒ½èƒ½åƒå‚³çµ±æ‡‰ç”¨ç¨‹å¼ç¢¼ä¸€æ¨£ï¼Œæ¥å—ç‰ˆæœ¬æ§åˆ¶ã€å¯©æŸ¥ã€é‡è¤‡åŸ·è¡Œèˆ‡è‡ªå‹•åŒ–éƒ¨ç½²[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://ithelp.ithome.com.tw/articles/10387507?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "1")ã€‚ç„¶è€Œï¼Œéš¨è‘— IaC è¦æ¨¡æ“´å¤§ï¼Œè³‡æºå‘½åä¸ç•¶æœƒå°è‡´è³‡æºæ··æ·†ã€æ¬Šé™é…ç½®éŒ¯èª¤ã€ç‹€æ…‹æª”æ¡ˆææ¯€ç­‰åš´é‡å¾Œæœã€‚å› æ­¤ï¼Œå‘½åè¦ç¯„ç›´æ¥å½±éŸ¿åˆ°è‡ªå‹•åŒ–èˆ‡åŸºç¤è¨­æ–½çš„å¯ç¶­è­·æ€§ã€‚

ä¸€å¥—è‰¯å¥½çš„å‘½åè¦ç¯„é ˆå…¼é¡§ä»¥ä¸‹åŸå‰‡ï¼š
- **å”¯ä¸€æ€§èˆ‡å¯è¾¨è­˜æ€§**ï¼šæ¯å€‹è³‡æºåç¨±å¿…é ˆåœ¨å…¶å‘½åç©ºé–“å…§å”¯ä¸€ä¸”èƒ½é«˜æ•ˆæºé€šç”¨é€”ã€‚
- **ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æ¨¡çµ„ã€è³‡æºã€è®Šæ•¸éƒ½æ‡‰éµå¾ªçµ±ä¸€çš„è¦å‰‡ï¼ˆå¦‚å°å¯«å­—æ¯åŠ åº•ç·šã€å–®æ•¸/è¤‡æ•¸å°æ˜ ã€ä¸å¯æ··ç”¨å¤§å°å¯«ï¼‰ã€‚
- **æè¿°æ€§**ï¼šåç¨±éœ€ç›´æ¥åæ˜ è³‡æºå±¬æ€§ï¼Œä¾‹å¦‚è§’è‰²ã€ç”¨é€”ã€æ‰€å±¬ç’°å¢ƒã€‚
- **å¯æ“´å……æ€§èˆ‡å¯é©æ‡‰æ€§**ï¼šé ç•™å¿…è¦çš„ç¶­åº¦ï¼ˆå¦‚å°ˆæ¡ˆã€ç’°å¢ƒã€å±¤ç´šç­‰ï¼‰ï¼Œä¾¿æ–¼çµ„ç¹”æœªä¾†æ“´å¢ã€‚
- **å¯è‡ªå‹•åŒ–æ€§**ï¼šä¾¿æ–¼è‡ªå‹•åŒ–è…³æœ¬è™•ç†ã€æ ¡é©—æˆ–ç”Ÿæˆã€‚

é‡å°å¯¦å‹™ï¼ŒçŸ¥åé–‹ç™¼è€… Devin Liu åœ¨ HackMD ç« ç¯€ä¸­æ¨è–¦é¡åˆ¥ã€å±¬æ€§ã€å¸¸æ•¸ç­‰å‡ä»¥ PascalCase å‘½åï¼Œåƒæ•¸èˆ‡æ¬„ä½æ¡ç”¨ camelCaseï¼Œè³‡æ–™åº«èˆ‡åº•å±¤è³‡æºå¯ç”¨ snake_caseï¼Œè€Œç¶²å€ç­‰å ´åˆå‰‡æ¡ kebab-caseï¼Œä»¥ä¾¿èˆ‡ç¾ä»£èªè¨€å’Œå·¥å…·éˆä¸€è‡´ã€‚

### 5.2 Terraform è³‡æºèˆ‡æ¨¡çµ„å‘½åæ…£ä¾‹

Terraform å»£æ³›ç”¨æ–¼è·¨é›²ç«¯å¹³å°çš„ IaCã€‚æœ‰æ•ˆçš„å‘½åæ…£ä¾‹å¯é™ä½é‡æ§‹ã€ç’°å¢ƒéš”é›¢åŠå¤šåœ˜éšŠå”ä½œçš„é¢¨éšª[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://www.terraform-best-practices.com/zh/naming?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "2")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://blog.csdn.net/gitblog_00673/article/details/151257639?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "3")ã€‚

**Terraform å‘½åå¯¦è¸å»ºè­°**ï¼š
- **è³‡æºå¡Šåç¨±ï¼ˆResource Nameï¼‰**ï¼š
    - æ ¼å¼ï¼š`resource "<provider>_<type>" "<logical_name>" { ... }`
    - `<provider>_<type>`ä¸€å¾‹ç”¨å°å¯«åº•ç·šï¼Œå¦‚`aws_s3_bucket`ã€‚
    - `<logical_name>`å¯ç”¨ single, plural, conciseï¼Œå»ºè­°ä¸å¯å†—é¤˜ï¼ˆå¦‚`public`ã€`db`ã€`web` è€Œé`public_s3_bucket`ï¼‰ã€‚
    - **ç¯„ä¾‹**ï¼š
      ```hcl
      resource "aws_route_table" "public" { ... }
      resource "aws_nat_gateway" "this" { ... }
      ```

- **è®Šæ•¸/è¼¸å‡º/è³‡æ–™æºå‘½å**ï¼š
    - è®Šæ•¸åè‹¥å‹åˆ¥ç‚º list/map è¦ç”¨è¤‡æ•¸ã€‚
    - å¿…é ˆåŠ ä¸Š`description`ã€‚
    - é¿å…é‡è¤‡ provider/typeï¼Œç›´æ¥ä½¿ç”¨æè¿°æ€§å‘½åå¦‚ `db_subnet_group`ã€‚

- **tags/labels**ï¼š
    - AWS æ”¯æ´æ™‚ï¼Œçµ±ä¸€åœ¨ blocks æœ€å¾Œï¼Œç”¨ Name èˆ‡æ›´å…·å‚™åˆ†ç¾¤ã€æ¸…ç†ä¾¿æ·æ€§ä¹‹æ¨™ç±¤ï¼ˆå¯ include ç’°å¢ƒã€åŠŸèƒ½ï¼‰ã€‚
    - ç¯„ä¾‹ï¼š
      ```hcl
      tags = { Name = "web-prod-api" }
      ```

- **name vs name_prefix çš„ä½¿ç”¨**ï¼š
    - `name`ï¼šç”¨æ–¼éœ€ç©©å®šå”¯ä¸€åä¹‹æ°¸ä¹…è³‡æºï¼ˆå¦‚ S3ï¼‰ã€‚
    - `name_prefix`ï¼šç”¨æ–¼è‡¨æ™‚ã€éœ€å¤§æ‰¹é‡è‡ªå‹•ç”¢ç”Ÿè³‡æºï¼Œé¿å…åç¨±è¡çªã€‚
    - ä¸å¯åŒæ™‚æŒ‡å®šå…©è€…ï¼Œå¦å‰‡ç·¨è­¯å¤±æ•—ã€‚

- **æ¨¡çµ„ï¼ˆModuleï¼‰å‘½å**ï¼š
    - æ¨™æº–ç‚º `module "<logical_name>" { source = ... }`ï¼Œå‘½åå»ºè­°å¸¶ä¸ŠåŠŸèƒ½èˆ‡ç’°å¢ƒï¼Œå¦‚ `vpc_prod`ã€‚
    - å…§éƒ¨è³‡æºå‘½åå‰‡å¸¶å…¥æ¨¡çµ„åï¼Œåˆ©æ–¼è¿½è¹¤ã€‚
    - **çµæ§‹ç¤ºä¾‹**ï¼š
      ```
      main.tf
      â”œâ”€â”€ resource "aws_nat_gateway" "this" {...}
      â”œâ”€â”€ resource "aws_route_table" "private" {...}
      â””â”€â”€ resource "aws_instance" "bastion" {...}
      ```

- **å°ˆæ¡ˆèˆ‡ç’°å¢ƒå‰ç¶´**ï¼š
    - å»ºè­°æ˜ç¤ºå°ˆæ¡ˆã€åŠŸèƒ½ã€ç’°å¢ƒï¼š
      - `{project}-{env}-{component}`ï¼ˆå¦‚`ai-prod-redis`ï¼‰

**è¡Œæ¥­è¦ç¯„å‘é»èˆ‡è‡ªå‹•åŒ–è£œæ•‘**ï¼š
- ç¦ç”¨è³‡æºåç¨±çš„ç¡¬ç·¨ç¢¼èˆ‡ä¸ä¸€è‡´å¤§å°å¯«/åˆ†éš”ç¬¦ï¼ˆå»ºè­° `_`ï¼‰ã€‚
- åˆ©ç”¨ Lint å·¥å…·æˆ– IDE æ’ä»¶åšéœæ…‹åˆ†æï¼ˆå¦‚ Semgrepã€å¸¶æœ‰æ­£è¦è¡¨ç¤ºçš„ç‰¹è£½ formattersï¼‰ã€‚
- ä»¥ Git pre-commit hook å¼·åˆ¶æ ¼å¼æª¢æŸ¥ã€‚
- å‡ºç¾é‡æ§‹éœ€æ±‚æ™‚ï¼Œå…ˆç”¨è‡ªå‹•è…³æœ¬æ‰¹æ¬¡è™•ç† state æª”å°ç…§èˆ‡è³‡æºå°å…¥ã€‚

### 5.3 AWS CloudFormation èˆ‡ CDK å‘½åç­–ç•¥

AWS CloudFormation èˆ‡ CDK å‡å¯ç®¡ç† AWS åŸºç¤è¨­æ–½ï¼Œå‘½åè¦ç¯„æœ‰åŠ©æ–¼é¿å…è³‡æºé‡è¦†ã€é‹ç¶­æ··æ·†åŠç‰ˆæœ¬ç®¡ç†é›£é¡Œ[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://docs.aws.amazon.com/zh_tw/AWSCloudFormation/latest/TemplateReference/aws-properties-name.html?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "4")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://docs.aws.amazon.com/zh_tw/cdk/v2/guide/projects.html?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "5")ã€‚

- **CloudFormation å‘½åç‰¹é»**ï¼š
    - å¤§å¤šæ•¸è³‡æºå¯è‡ªè¨‚åç¨±ï¼Œé è¨­å‰‡è‡ªå‹•ç”Ÿæˆï¼ˆå¦‚`Stack-Resource-randomid`ï¼‰ã€‚
    - è‹¥è‡ªè¨‚ï¼Œéœ€æ–¼ç¯„æœ¬ä¸­æ˜ç¢ºæŒ‡å®šä¸”ä¸å¯é‡è¤‡ï¼›å‘½ååƒ…å¯ç”¨ ASCII å­—æ¯æ•¸å­—èˆ‡ä¸­æ©«ç·šï¼Œä¸å¯ä»¥ä¸­æ©«ç·šçµå°¾ï¼Œä¸” 63 å­—å…ƒå…§ã€‚
    - yaml/json property éœ€è¦é¡ä¼¼ï¼š
      ```yaml
      Properties:
        TableName: "orders-prod-v1"
      ```

- **CDK å‘½åèˆ‡å°ˆæ¡ˆçµæ§‹**ï¼š
    - å»ºè­°æ–‡ä»¶çµæ§‹ä»¥å°ˆæ¡ˆç‚ºé ‚å±¤ + stack åç¨±ï¼Œä¾‹å¦‚ï¼š
      ```
      /lib/my-cdk-ts-project-stack.ts
      /bin/my-cdk-ts-project.ts
      ```
    - äºŒæ¬¡é–‹ç™¼æ™‚ï¼ŒStack id æ‡‰æ˜ç¢ºåˆ—å‡ºå¦‚`MyCdkProdStack`ã€‚
    - CDK ç¨‹å¼ç¢¼å…§è³‡æºè­˜åˆ¥é€šå¸¸å¸¶æœ‰ stack/cluster/åŠŸèƒ½ï¼Œä¾¿æ–¼ versioning åŠè³‡æºæŸ¥æ‰¾ã€‚

- **ç’°å¢ƒç¶­åº¦æ¨™è¨»**ï¼š
    - åˆ©ç”¨ Stack è®Šæ•¸èˆ‡ tagsï¼Œåœ¨å…¨å€ç®¡ç†ä¸‹å¯ä¾ç…§ä¸åŒ Project/Env/System ç¶­è­·è³‡æºå”¯ä¸€æ€§ã€‚
    - å»ºè­°æ‰€æœ‰é‡è¦è³‡æºçš†åŠ  `Environment`ã€`Project`ã€`Module` æ¨™ç±¤ï¼Œæå‡æœå°‹èˆ‡å¾ŒæœŸç¶­è­·æ•ˆç‡ã€‚

### 5.4 å¯¦å‹™å»ºè­°èˆ‡è½åœ°ç¯„ä¾‹

- åˆ¶å®š IaC å‘½åè¦ç¯„æ–‡ä»¶æ™‚ï¼Œéœ€å…ˆåˆ†é¡é½Šå…¨ï¼ˆè³‡æºã€æ¨¡çµ„ã€ç›®éŒ„ã€å°ˆæ¡ˆã€ç’°å¢ƒç­‰ï¼‰ã€‚
- æ¨å‹•å…¬å¸å±¤ç´šæ¨¡çµ„å€‰åº«ï¼Œå¼·åˆ¶å‘½åè¦å‰‡å¯©æ ¸èˆ‡è‡ªå‹•åŒ–è…³æœ¬å°å…¥ã€‚
- ä»¥`lint`èˆ‡`pre-commit`è‡ªå‹•æ ¡é©—å–ä»£å–®ä¸€äººå·¥ code reviewã€‚
- åš´æ ¼å€åˆ†ä¸åŒç’°å¢ƒï¼ˆdevã€stagingã€prodï¼‰è³‡æºï¼Œä¿è­‰ tag èˆ‡å‘½åæ–¹å¼ä¸€çµ„å³èƒ½å”¯ä¸€å®šä½ã€‚
- åœ¨ Git Flow/PR åˆä½µæ™‚åŠ  CI æª¢æŸ¥å‘½åè¦ç¯„ï¼Œéƒ½æœªé€šéå‰‡æ‹’çµ•é€²å…¥ä¸»ç·šã€‚

---

## ç¬¬å…­ç«  CI/CD æµæ°´ç·šå‘½åçµæ§‹èˆ‡æœ€ä½³å¯¦è¸

### 6.1 CI/CD æµæ°´ç·šå‘½åçš„åƒ¹å€¼èˆ‡åŸå‰‡

CI/CDï¼ˆContinuous Integration/Continuous Deliveryï¼‰æµæ°´ç·šè²«ç©¿æ–¼ç¾ä»£é–‹ç™¼åˆ°éƒ¨ç½²çš„æ¯å€‹ç’°ç¯€ï¼Œè‰¯å¥½çš„å‘½åè¦ç¯„å°æ–¼ä»£ç¢¼å›æº¯ã€ç•°å¸¸å®šä½ã€ä»»å‹™è‡ªå‹•èª¿åº¦æ¥µç‚ºé—œéµã€‚å‘½åéš¨è‘—è‡ªå‹•åŒ–æ·±åº¦æå‡ï¼Œç›´æ¥é—œä¿‚åˆ°åœ˜éšŠæºé€šã€ç›£æ§å¯è¿½è¹¤æ€§èˆ‡æµç¨‹æ²»ç†æ•ˆç‡ã€‚

æœ€æ ¸å¿ƒåŸå‰‡æœ‰ï¼š
- **èªæ„æ˜ç¢ºã€å¯è­˜åˆ¥**ï¼šåç¨±å³è¡Œç‚ºï¼Œè¦‹åçŸ¥ç¾©ï¼Œè®“æ–°æˆå“¡ä¸€çœ¼èƒ½ç†è§£æ­¤è§¸ç™¼å…§å®¹ã€æ‰€æœ‰éšæ®µåŠŸèƒ½ã€‚
- **åˆ†å±¤ä¸€è‡´æ€§**ï¼šæ ¹æ“šå°ˆæ¡ˆã€ç”¢å“ç·šã€ä»»å‹™æ€§è³ªåˆ†å±¤è¦åŠƒï¼›æ‰€æœ‰ pipelineã€stageã€job å‡æ‡‰çµ±ä¸€å‘½åè¦å‰‡ã€‚
- **ç’°å¢ƒç¶­åº¦æ˜ç¤º**ï¼šæ˜ç¢ºæ¨™è¨» target environmentï¼Œå¦‚ dev/test/staging/prodã€‚
- **ç‰ˆæœ¬èˆ‡è¿­ä»£å¯è¿½æº¯**ï¼šæ”¯æ´ç‰ˆæœ¬æ§åˆ¶èˆ‡å¤šç’°å¢ƒéƒ¨ç½²çš„è³‡æ–™å®šä½ã€‚

### 6.2 Jenkins Pipeline å‘½åè¦ç¯„

Jenkins æ˜¯ä¸»æµçš„è‡ªå‹•åŒ–æµç¨‹å¼•æ“ï¼Œæ”¯æŒ declarative pipeline åŠ scripted pipeline[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://www.jenkins.io/zh/doc/book/pipeline/syntax/?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "6")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://zhuanlan.zhihu.com/p/583812704?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "7")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://blog.csdn.net/zero_open/article/details/137816238?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "8")ã€‚

**å‘½åè¦ç¯„å»ºè­°**ï¼š
- pipeline åç¨±èˆ‡å°ˆæ¡ˆæˆ–ç”¢å“ç·šä¸€è‡´ï¼ˆå¦‚ `AI Search API - Staging - Release`ï¼‰ã€‚
- stageï¼šä»¥å‹•ä½œç‚ºä¸»èªï¼Œé¦–å­—å¤§å¯«ï¼Œæ˜ç¢ºèªªæ˜åŠŸèƒ½ï¼Œä¾‹å¦‚ `Build`ã€`Unit Test`ã€`Deploy to Prod`ã€‚
- job åç¨±éµå¾ã€Œå‹•ä½œ-å°è±¡-ç’°å¢ƒã€çµæ§‹ï¼Œå¦‚ `publish-image-dev`ã€‚
- agent æ¨™ç±¤ï¼ˆå¦‚ `docker-maven`ã€`nodejs-14`ï¼‰é ˆæè¿°æ€§ï¼Œæ¸…æ¥šåæ˜ é‹ä½œå¹³å°æˆ–ç”¨é€”ã€‚
- parameters/environment åƒæ•¸ï¼ˆä¾‹ï¼š`DEPLOY_ENV`ã€`DEBUG_ENABLE`ï¼‰å¿…ç”¨å…¨å¤§å¯« undeline åˆ†éš”ã€‚
- ä¸¦è¡Œ stageï¼šåŠ å…¥å…·é«”åç¨±å€åˆ†ï¼Œå¦‚ `Test-Chrome`ã€`Test-Firefox`ã€‚

**ç¯„ä¾‹**ï¼š
```groovy
pipeline {
  agent any
  stages {
    stage('Build') {
      steps { ... }
    }
    stage('Test') {
      steps { ... }
    }
    stage('Deploy to Production') {
      steps { ... }
    }
  }
}
```

- å»ºè­°åˆ©ç”¨ `input`ã€`triggers` ç­‰æŒ‡ä»¤æ™‚ï¼Œå°æ¯å€‹è‡ªå‹•æˆ–æ‰‹å‹•åŸ·è¡Œæ¢ä»¶æ˜ç¢ºå‘½åï¼Œå¦‚ `cron('H 4 * * 1-5')`ã€‚

### 6.3 GitLab CI/CD èˆ‡ GitHub Actions å·¥ä½œæµç¨‹å‘½å

**GitLab CI/CD**ï¼ˆ`.gitlab-ci.yml`ï¼‰è¦å‰‡å»ºè­°[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://hackmd.io/@CloudyWing/Hym3ZoBT1g?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "9")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://ithelp.ithome.com.tw/articles/10344451?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "10")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://blog.csdn.net/weixin_47877869/article/details/145616371?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "11")ï¼š
- pipeline/workflow: å¯å®šç¾©æ•´é«”æ¨™é¡Œï¼Œåƒæ•¸å¦‚ `workflow: name: "deploy-main-production"`ã€‚
- stage: æ¨è–¦æ¡ç”¨ `build`ã€`test`ã€`deploy`ã€`quality`ã€`notify` ç­‰å‹•è©æ€§åç¨±ï¼Œä¾¿æ–¼æ©«å‘æ¯”è¼ƒåŠè‡ªå‹•åŒ–æ“´å±•ã€‚
- job: è·Ÿ Jenkins çš„ `å‹•ä½œ-å°è±¡-ç’°å¢ƒ`ï¼Œå¦‚ `build-backend-image`ã€`test-e2e-staging`ã€`deploy-prod`.
- è®Šæ•¸åç¨±å…¨å¤§å¯«åº•ç·šåˆ†éš”ï¼ˆ`DOCKER_IMAGE_NAME`ï¼‰ã€‚
- å¤šç’°å¢ƒå¯ç”¨ `deploy-dev`ã€`deploy-staging`ã€`deploy-prod` ç­‰æ˜ç¢ºå€åˆ†ï¼Œé¿å…é‡è¦†ã€‚
- artifacts/cache:
  - åç¨±æ‡‰èˆ‡å·¥ä½œéšæ®µé—œè¯ï¼Œå¦‚ `build` éšæ®µç”¢å‡º `build_artifacts`ï¼Œå¿«å–éµå¸¶ pipeline id æˆ– commit hash é˜²æ­¢è¦†è“‹è¡çªã€‚
- æª”æ¡ˆå‘½åæ”¯æ´ include/inheritï¼Œå¦‚ `.gitlab-ci-build.yml`ã€`.gitlab-ci-test.yml`.
- template/template yaml ç”¨ `_template`ã€`.` å‰ç¶´æ¨™æ˜ä¸å¯ç›´æ¥åŸ·è¡Œï¼Œåƒ…ä¾›å¼•ç”¨ã€‚

**GitHub Actions** å·¥ä½œæµå‘½åè¦å‰‡ç›¸ä¼¼ï¼Œå»ºè­° workflows ä»¥ç”¢å“æ¨¡çµ„ + æµæ°´ç·šåŠŸèƒ½æè¿°ï¼Œå¦‚ `build-and-release-python-sdk.yml`ï¼›jobs åŠ steps ä¹Ÿæ¡ç›´è­¯å¼èªæ„ã€‚

 ### 6.4 å‘½åè¦ç¯„ä¿éšœå¯¦å‹™

- **å‘½åæ²»ç†æµç¨‹**ï¼š
    - è¨­å®šå°ˆæ¡ˆæ¨¡æ¿ï¼Œå¼·åˆ¶æ¯ä¸€æ¢æµæ°´ç·šå¾æ¨¡æ¿è¤‡è£½ã€‚
    - æ–°å¢/è®Šæ›´ pipeline/job åšäº‹å‰å¯©è¦ˆï¼ŒPR review checkã€‚
    - ä½¿ç”¨è‡ªå‹•å‘½åè¦å‰‡æª¢æŸ¥ï¼ˆå¦‚æ·ºå…¥é è¨­æ’ä»¶/è…³æœ¬ï¼‰ã€‚
    - å®šæœŸå¯©æŸ¥ã€å„ªåŒ–å·²ä¸Šç·š pipeline èˆ‡ job åç¨±ï¼Œæ·˜æ±°èˆŠæœ‰éæ¨™æº–å‘½åã€‚
    - æ–‡ä»¶åŒ–æ‰€æœ‰å‘½åè¦ç¯„æ–¼å°ˆå±¬æ‰‹å†Šä¸¦ç‰ˆæœ¬ç®¡ç†ã€‚

--- 

## ç¬¬ä¸ƒç«  ä¼æ¥­ç´šå‘½åæ²»ç†ç­–ç•¥èˆ‡æ¡†æ¶

### 7.1 ä¼æ¥­å‘½åæ²»ç†çš„æŒ‘æˆ°

ä¼æ¥­åœ¨å¤§è¦æ¨¡ DevOpsã€é›²ç«¯ã€å¾®æœå‹™èˆ‡è³‡æ–™æ²»ç†èƒŒæ™¯ä¸‹ï¼Œå‘½åè¦ç¯„å¿…é ˆå‡ç´šç‚ºå…¨çµ„ç¹”å”ä½œæ¡†æ¶ã€‚ä¸€æ—¦å‘½åæ··äº‚å°‡é€ æˆä»¥ä¸‹å•é¡Œ[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://zhuanlan.zhihu.com/p/502755740?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "12")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://www.esensoft.com/industry-news/dx-51865.html?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "13")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://blog.csdn.net/qq_20245171/article/details/145456548?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "14")ï¼š
- å¤šåœ˜éšŠå°è‡´å‘½åæ¨™æº–åˆ†æ­§ï¼Œç”¢ç”Ÿè·¨éƒ¨é–€æºé€šå¤±éˆã€‚
- è‡ªå‹•åŒ–ä¸²æ¥ã€è³‡æºæƒæè…³æœ¬èˆ‡ç›£æ§æ··äº‚ï¼Œå°è‡´ç¶­è­·èˆ‡æŸ¥éŒ¯æˆæœ¬æµ®å¢ã€‚
- ç‰ˆæœ¬ç®¡ç†èˆ‡æ•¸æ“šè¿½è¹¤å›°é›£ï¼Œç”¢ç”Ÿå®‰å…¨ç‡ˆè™Ÿéºæ¼ã€æ¬Šé™é¢¨éšªã€‚

### 7.2 å‘½åæ²»ç†ç­–ç•¥èˆ‡åŸ·è¡Œæ¡†æ¶

**å‘½åæ²»ç†ç­–ç•¥åŒ…å«**ï¼š
- **æ¨™æº–åŒ–æ¡†æ¶ï¼ˆå¦‚ DAMA, DCMMï¼‰**ï¼šä¸»æ¡†æ¶éœ€åŒ…æ‹¬æ¨™æº–ã€æµç¨‹ã€çµ„ç¹”ã€å·¥å…·èˆ‡ç›£ç£ç­‰æ©Ÿåˆ¶ã€‚
- **å‘½åè¦ç¯„å§”å“¡æœƒ**ï¼šåŒ…å«é–‹ç™¼ã€ç¶­é‹ã€è³‡è¨Šå®‰å…¨ã€åˆè¦èˆ‡ç”¢å“ç¶“ç†å…±åŒåƒèˆ‡ï¼Œå®šæœŸå¯©æŸ¥ä¸¦ä¿®è¨‚è¦ç¯„ã€‚
- **ç­–ç•¥æ–‡ä»¶åŒ–**ï¼šæ‰€æœ‰å‘½åè¦ç¯„çš†éœ€ä»¥è¦ç« ã€ç« å‰‡ã€å¯¦ä½œå»ºè­°æ–‡æª”æ˜æ–‡åŒ–ï¼Œä¸¦åŠ å…¥çŸ¥è­˜åº«ã€‚
- **è‡ªå‹•åŒ–èˆ‡å·¥å…·æ”¯æŒ**ï¼šå°å…¥éœæ…‹æª¢æŸ¥ã€æ¨¡æ¿é©—è­‰ã€Policy as Codeï¼ˆå¦‚ Open Policy Agentï¼‰æ”¯æ´æŒçºŒæ²»ç†ã€‚
- **ç‰ˆæœ¬ç®¡ç†åˆ¶åº¦**ï¼šå®šæœŸè©•ä¼°ã€ç™¼å¸ƒèˆ‡å…¬å‘Šè¦å‰‡è®Šå‹•ï¼Œä¸¦ä¿æŒæ‰€æœ‰é–‹ç™¼åŠç¶­é‹æ–‡ä»¶ä¸€è‡´åŒæ­¥ï¼ˆè¦‹ä¸‹ç¯€ï¼‰ã€‚

**ä¼æ¥­å‘½åæ²»ç†æ¡†æ¶è¡¨ï¼ˆç¤ºæ„ï¼‰**ï¼š

| ç¶­åº¦      | å…·é«”æªæ–½èˆ‡å·¥å…·ç¯„ä¾‹     | æ¨è¡Œè¦é»                |
|--|--|--|
| çµ„ç¹”   | è¨­å°ˆè²¬åœ˜éšŠï¼Œåˆ¶å®šèˆ‡ç¨½æ ¸   | æ±ºç­–æ¬Šé™æ˜ç¢ºåŒ–ï¼Œå®šæ™‚åŸ¹è¨“ |
| æµç¨‹   | Pull Request æª¢æŸ¥ã€CI å‘½å Lint | ç„¡é€šéä¸å¾—åˆä½µ |
| å·¥å…·éˆ | GitLab/Jenkins pre-hookã€å‘½åæª¢æŸ¥è…³æœ¬ | è‡ªå‹•åµéŒ¯èˆ‡å³æ™‚å›é¥‹ |
| æ–‡æª”   | è¦ç¯„æ–‡ä»¶ã€å‘½åæŸ¥è©¢å¹³å°   | ä¿è­‰çŸ¥è­˜å‚³æ‰¿ã€æŸ¥æ‰¾ä¾¿åˆ©   |
| æŒçºŒæ”¹å–„ | æ”¶é›†åé¥‹å®šæœŸç›¤é»         | è¿­ä»£èª¿æ•´ç­–ç•¥             |

### 7.3 å‘½åç­–ç•¥æ–‡ä»¶åŒ–èˆ‡ç‰ˆæœ¬ç®¡ç†

- æ‰€æœ‰å‘½åè¦ç¯„ã€æ¨£æ¿ã€ç¯„ä¾‹é ˆé€²è¡Œå°ˆæ¡ˆç´šæˆ–çµ„ç¹”ç´šç‰ˆæœ¬æ§åˆ¶ï¼Œå„²å­˜åœ¨ä¼æ¥­ Git/ConfigCenterã€‚
- è¦å‰‡æ‰‹å†Šéœ€åŒ…å«ï¼š
    - åˆå§‹ç”Ÿæ•ˆæ—¥æœŸã€æ­·æ¬¡è®Šæ›´æ‘˜è¦ã€å‰¯æœ¬è™Ÿã€‚
    - ä¸»è¦å‘½åæ…£ä¾‹ã€‚
    - ä¾‹å¤–è™•ç†ç”³è«‹æµç¨‹ã€‚
    - å»¢æ£„èˆ‡è®Šæ›´å‘½åæµç¨‹/å·¥å…·ä»‹ç´¹ã€‚
- æ¯ä¸€å¹´å®šæœŸç›¤é»èˆ‡å›é¡§ï¼Œé‚€è«‹åœ˜éšŠ feedbackï¼Œæœ‰å¿…è¦å‰‡é‡å¤§ç‰ˆæœ¬å‡ç´šä¸¦å»£æ³›åŸ¹è¨“ã€‚

### 7.4 è¡Œæ¥­æ¡†æ¶èˆ‡æœ€ä½³å¯¦è¸

- DAMAã€CMMIã€ITSSã€DCMM ç­‰æŒ‡å¼•è³‡ç”¢å‘½åè¦ç¯„ã€è³‡æ–™è³ªé‡æ¨™æº–ã€æ•¸æ“šæ²»ç†æ¶æ§‹[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://zhuanlan.zhihu.com/p/502755740?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "12")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://www.esensoft.com/industry-news/dx-51865.html?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "13")ã€‚
- åœ‹éš›çµ„ç¹”å¤šé‡è¦–å¾ç­–ç•¥åˆ°è½åœ°å·¥å…·éˆæ•´åˆï¼Œå»ºè­°åœ¨æœ¬åœ°å°å…¥æ™‚å…ˆå°è¦æ¨¡è©¦è¡Œï¼Œé€æ­¥æ¨å»£è‡³å…¨å…¬å¸ã€‚
- å¯¦éš›æ¡ˆä¾‹é¡¯ç¤ºï¼Œå°ˆé–€è¨­å®šå‘½åç¨½æ ¸æŒ‡æ¨™èƒ½æŠ‘åˆ¶å‘½åå“è³ªåŠ£åŒ–ï¼Œäº¦æ˜“è‡ªå‹•ç”¢ç”Ÿå…¨åŸŸè³‡æºåœ–ã€æœ‰åŠ©å¾ŒçºŒè³‡å®‰è¿½æŸ¥ã€‚

---

## ç¬¬å…«ç«  å‘½åå¯¦æˆ°é …ç›®æ¼”ç·´

### 8.1 å¾®æœå‹™å°ˆæ¡ˆå‘½åæ¼”ç·´

ä»¥å¾®æœå‹™æ¶æ§‹ç‚ºä¾‹ï¼Œå¾®æœå‹™åã€API endpointã€Database tableã€æ¶ˆæ¯ä½‡åˆ—ç­‰å‘½åéƒ½æ‡‰ä¸€è‡´éµå¾ªçµ„ç¹”è¦ç¯„ï¼Œä»¥åˆ©æ—¥å¾Œé‹ç¶­ã€éƒ¨ç½²èˆ‡ç•°å¸¸è¿½è¹¤[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://blog.csdn.net/fwk19840301/article/details/79488507?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "15")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://developer.aliyun.com/article/1279379?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "16")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://blogs.vmware.com/vmware-taiwan/2022/12/15/%e9%9b%b2%e5%8e%9f%e7%94%9f%e6%99%82%e4%bb%a3%e4%b8%8b%e5%be%ae%e6%9c%8d%e5%8b%99%e6%9e%b6%e6%a7%8b%e6%bc%94%e9%80%b2%e4%b9%8b%e8%b7%af-10/?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "17")ã€‚

#### å¯¦å‹™å»ºè­°ï¼š
- å¾®æœå‹™åçµæ§‹ï¼š`<çµ„ç¹”>-<æ¥­å‹™ç·š>-<åŠŸèƒ½æ¨¡çµ„>`ï¼Œå¦‚ `ai-finance-billing`ã€‚
- API è·¯å¾‘ï¼š `/api/v1/{service}/{resource}`ï¼Œçµåˆç‰ˆæœ¬èˆ‡åŠŸèƒ½ã€‚
- Database/Topic/Queueï¼šåŒæ¨£ä»¥ä¸‰æ®µå¼çµæ§‹ï¼Œä¿æŒå°å¯«èˆ‡åº•ç·šåˆ†éš”ã€‚

**ç¯„ä¾‹**ï¼š
```yaml
service-name: ai-finance-billing
api: /api/v1/ai-finance-billing/payments
db-table: billing_transactions
mq-topic: ai-finance-billing-payments
```

### 8.2 é›²åŸç”Ÿç’°å¢ƒå‘½åå¯¦ä½œ

é›²åŸç”Ÿï¼ˆCloud Nativeï¼‰ç’°å¢ƒä¸‹æ‰€æœ‰è³‡æºå¦‚ Clusterã€Podã€Ingressã€Serviceã€å®¹å™¨æ˜ åƒéƒ½æ‡‰æœ‰å‘½åæº–å‰‡[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://s.itho.me/ccms_slides/2024/7/8/d52ab517-6cbf-4bec-af58-4f59b0501487.pdf?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "18")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://carger.tips/%e9%9b%b2%e5%8e%9f%e7%94%9f%e6%87%89%e7%94%a8%e9%96%8b%e7%99%bc%e5%85%a5%e9%96%80%e6%8c%87%e5%8d%97-docker-k8s-%e5%92%8c-service-mesh-%e6%9e%b6%e6%a7%8b%e8%a7%a3%e6%9e%90?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "19")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://docker.robertchang.me/images/?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "20")ã€‚

#### Kubernetes è³‡æºå‘½åç¯„ä¾‹ï¼š
- Cluster: `open-data-cluster`
- Namespace: `<product>-<env>` (å¦‚ `billing-prod`)
- Pod: `<service>-app` (å¦‚ `ai-backend-app`)
- Service: `<service>-service` (å¦‚ `ai-backend-service`)
- Ingress: `<service>-ingress`
- å®¹å™¨æ˜ åƒåç¨±: `{registry}/{project}/{service}:{tag}`

### 8.3 CI/CD æµæ°´ç·šèˆ‡è§¸ç™¼å™¨å‘½åæ¼”ç·´

å¯¦ä½œæ™‚å»ºè­°å…¨æµç¨‹ä½¿ç”¨ã€Œå°ˆæ¡ˆ-æ¨¡çµ„-ç’°å¢ƒ-åŠŸèƒ½ã€å‘½åï¼Œä¾‹å¦‚ï¼š
- Jenkinsfile: `ci-ai-backend-staging-build-release`
- GitLab CI/CD workflow: `workflow: name: "ai-backend-staging-pipeline"`
- Job: `test-e2e-prod`

**å¯¦å‹™æ¼”ç·´è¦é»**ï¼š
- ä¸»åˆ†æ”¯è‡ªå‹•åŒ–æµæ°´ç·šéœ€æ˜ç¤ºç”¨é€”ã€‚
- å¤šç’°å¢ƒéƒ¨ç½²æ™‚ï¼Œç”±åƒæ•¸å‘½åå‚³é ensure fully scopedï¼ˆä¾‹ï¼š`$DEPLOY_ENV`ï¼‰ã€‚
- Artifacts/Cache åŠ å…¥ pipeline hash æˆ–åˆ†æ”¯æ¨™ç¤ºã€‚

### 8.4 å‘½åè¦ç¯„æ¨è¡Œèˆ‡è½åœ°ç¶“é©—

- å®šæœŸçµ„ç¹”è·¨éƒ¨é–€å‘½åè¦ç¯„å·¥ä½œåŠï¼Œå¾å…¸å‹å¤±æ•—æ¡ˆä¾‹ï¼ˆå¦‚åç¨±é‡è¤‡ã€æœªæ˜ç¤ºç’°å¢ƒï¼‰åæ¨èª¿æ•´ã€‚
- æä¾›è‡ªå‹•åŒ–å‘½åç”Ÿæˆæ¨¡çµ„ï¼ˆå¦‚ Spinnaker/Argo/Harness pipeline templatesï¼‰ï¼Œé¿å…æ‰‹å‹•ç–æ¼[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://blog.csdn.net/gitblog_00606/article/details/152004810?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "21")ã€‚
- çµåˆ PR reviewã€CI æª¢æŸ¥èˆ‡ README å¼·åŒ–æ–°æˆå“¡ onboarding æˆåŠŸç‡ã€‚
- æ¨å‹•æ–‡æª”åŒ–èˆ‡æŸ¥è©¢å·¥å…·ï¼ŒåŠ é€Ÿå‘½åè¦ç¯„æ‡‰ç”¨èˆ‡å•é¡Œè‡ªæŸ¥ã€‚

---

## ç¬¬ä¹ç«  å‘½åç­–ç•¥å·¥å…·èˆ‡è‡ªå‹•åŒ–

### 9.1 å·¥å…·éˆæ•´åˆå‘½åç­–ç•¥

ç¾ä»£ DevOps å·¥å…·éˆåŒ…æ‹¬ Gitã€Jenkinsã€GitHub Actionsã€GitLab CI/CDã€Dockerã€Kubernetesã€Terraformã€Ansibleã€Prometheusã€Grafana ç­‰[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://carger.tips/%e7%b0%a1%e5%96%ae%e6%98%93%e6%87%82%e7%9a%84-devops-%e8%87%aa%e5%8b%95%e5%8c%96%e5%b7%a5%e5%85%b7%e9%8f%88%e5%85%a5%e9%96%80%e6%8c%87%e5%8d%97?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "22")ã€‚å‘½åç­–ç•¥é ˆæ©«è·¨æ‰€æœ‰å·¥å…·èˆ‡è‡ªå‹•åŒ–æµç¨‹ã€‚

- **è‡ªå‹•åŒ–æª¢æŸ¥å·¥å…·**ï¼šé–‹ç™¼å°è£å‘½å lint moduleï¼Œå¦‚ terraform-lintã€yamllintã€GitHub Super-Linterã€‚
- **å‘½åè¦ç¯„å³ç¨‹å¼ç¢¼**ï¼šç”¨ Policy as Code/OPA è§£æ±ºè¤‡é›œè³‡æºçš„å‘½åè¦å‰‡é©—è­‰ã€‚
- **è·¨å·¥å…·éˆæˆæœ¬æ§ç®¡**ï¼šé€é tags/labels/å‘½åæ¨¡æ¿è¦ç¯„ï¼Œé…åˆå¯è¦–åŒ–å„€è¡¨æ¿ï¼ˆå¦‚ ELKã€Prometheus/Grafanaï¼‰ä¸€è‡´è¿½è¹¤ã€å¯©è¨ˆè³‡æºã€‚

### 9.2 å‘½åè‡ªå‹•åŒ–èˆ‡å“è³ªæª¢æŸ¥å·¥å…·

- **éœæ…‹ç¨‹å¼æƒæå™¨**ï¼šCI è§¸ç™¼æ™‚ï¼Œä»¥å®šåˆ¶ regex ã€èªæ³•æ¨¹è§£ææª¢æŸ¥è³‡æº/æµæ°´ç·šæ˜¯å¦ç¬¦åˆå‘½åéœ€æ±‚ã€‚
- **å‘½åç”Ÿæˆå·¥å…·**ï¼šè¼¸å…¥å°ˆæ¡ˆã€æ¨¡çµ„ã€ç’°å¢ƒã€åŠŸèƒ½åƒæ•¸ï¼Œè‡ªå‹• output çµ±ä¸€æ ¼å¼åç¨±ã€‚
- **è‡ªå‹•å¯©æŸ¥ CLI/IDE æ’ä»¶**ï¼šå¦‚ VSCodeã€JetBrains Linterï¼Œä¸é€šéå‰‡æ‹’çµ• push/mergeã€‚
- **ä¼æ¥­ç´šå‘½åç®¡ç†å¹³å°**ï¼šé›†ä¸­å¼ç®¡ç†æ‰€æœ‰å‘½åè¦å‰‡ã€ç¯„æœ¬ã€ç¯„ä¾‹ã€API æŸ¥è©¢ï¼Œé™ä½ onboarding æˆæœ¬ã€‚
- **æ¯”å°ç¯©æª¢è…³æœ¬ç¯„ä¾‹**ï¼ˆä»¥ Bash for Kubernetes + Spinnakerï¼‰ï¼š
  ```bash
  function generate_resource_name() {
    env=$1; app=$2; env_type=$3
    echo "${env}-${app}-${env_type}-v${VERSION}"
  }
  ```
- **Pipeline å‘½åå®‰å…¨ç¶²**ï¼šè¨­è¨ˆè‡ªå‹•å‘½åæ¨¡æ¿ + è¦å‰‡è®Šæ›´å¿«ç¯©ç³»çµ±ï¼Œé™ä½äººç‚ºèª¤å·®ã€‚

### 9.3 å·¥å…·èˆ‡å‘½åè¦ç¯„å°æ‡‰è¡¨

| å·¥å…·         | æ”¯æ´å‘½åè¦ç¯„æ–¹å¼            | å¯¦è¸å»ºè­°                           |
|--------------|------------------------|------------------------------|
| Terraform    | æ¨¡çµ„/è³‡æºåç¨±ã€tags   | å…¨å°å¯«åº•ç·šï¼Œå°ˆæ¡ˆ-ç’°å¢ƒ-é¡å‹      |
| Jenkins CI/CD| pipeline/stage/job å   | å‹•ä½œ-å°è±¡-ç’°å¢ƒï¼Œæµæ°´ç·šæ¨¡æ¿ç¹¼æ‰¿   |
| GitLab CI    | stage, job, artifacts | yml include èˆ‡åç¨±å‰ç¶´çµ±ä¸€     |
| Kubernetes   | clusterã€namespaceã€pod/service | rfc1123 æ ¼å¼ã€å°å¯« + `-`         |
| Docker       | æ˜ åƒæª”/volume/container| `project-service-env:tag`     |
| AWS CDK      | stack id/bucket name   | PascalCase åŠå¤§å¯«ç’°å¢ƒ tag       |

### 9.4 è‡ªå‹•åŒ–æ¨é€²é—œéµæ­¥é©Ÿ

- åˆå§‹åŒ–å°å…¥æ™‚å¼·åˆ¶è³‡æº/æµç¨‹/ä»£ç¢¼ä¸‰å±¤éƒ½åŠ è¨»æ˜å‘½åæ¨™æº–ã€‚
- CI/CD é è¨­åŠ å‘½åå“è³ªæª¢æŸ¥ï¼Œä¸é”æ¨™ auto block build/deployã€‚
- æ¯æ¬¡å°å…¥æ–°å·¥å…·æ™‚ï¼Œå…ˆé‡å°å‘½åæµç¨‹åšæ˜ å°„æ¸¬è©¦æ¨¡æ¿ã€‚
- é‡è¦å‘½åè¦å‰‡è®Šæ›´èµ° PDCA æµç¨‹ï¼šè¦åŠƒã€åŸ·è¡Œã€è‡ªå‹•é©—è­‰ã€å®šæœŸä¿®è¨‚ã€‚

---

## ç¬¬åç«  æŒçºŒæ”¹é€²èˆ‡å‘½åç¶­è­·å¯¦å‹™

### 10.1 æŒçºŒæ”¹é€²ç†å¿µèˆ‡æµç¨‹

å‘½åè¦ç¯„ä¸å¯èƒ½ä¸€æ¬¡åˆ°ä½ï¼Œå…¶æœ€ä½³å¯¦è¸ä¾†è‡ªæŒçºŒå„ªåŒ–è¿­ä»£[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://ahaslides.com/zh-TW/blog/continuous-improvement-examples/?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "23")[43dcd9a7-70db-4a1f-b0ae-981daa162054](https://www.managertoday.com.tw/articles/view/55730?citationMarker=43dcd9a7-70db-4a1f-b0ae-981daa162054 "24")ã€‚ä¼æ¥­/åœ˜éšŠæ‡‰åƒè€ƒ PDCA(R)ï¼ˆPlan-Do-Check-Act-Recordï¼‰å¾ªç’°ï¼š
- **Plan**ï¼šæ“¬å®šå‘½åè¦ç¯„ã€å¯¦ä½œæ–¹æ¡ˆã€é©—è­‰ç›®æ¨™ã€‚
- **Do**ï¼šè½åœ°åŸ·è¡Œã€ç”¢å‡ºæ¨£æœ¬ã€å•Ÿå‹•è‡ªå‹•åŒ–è…³æœ¬ã€‚
- **Check**ï¼šå›é¡§åŸ·è¡Œçµæœã€æ”¶é›†åœ˜éšŠåé¥‹ã€å¯©æŸ¥ä¾‹å¤–ç‹€æ³ã€‚
- **Act**ï¼šé‡å°å¯¦å‹™ç™¼ç¾ï¼Œä¿®æ”¹å‘½åè¦ç¯„ä¸¦é«˜é€±æœŸç™¼ä½ˆã€‚
- **Record**ï¼šç´€éŒ„æ‰€æœ‰æˆåŠŸã€å¤±æ•—ã€ä¾‹å¤–åŠåŸå› ï¼Œä¾›çŸ¥è­˜ç®¡ç†åŠç¶“é©—è¤‡è£½ã€‚

### 10.2 å‘½åç¶­è­·é€±æœŸèˆ‡çŸ¥è­˜å‚³æ‰¿

- **å®šæœŸå¯©æ ¸èˆ‡ç›¤é»**ï¼šå¦‚æ¯å­£é€²è¡Œå‘½åè¦ç¯„å¤§ç›¤é»ï¼Œæ­é…å ±è¡¨å·¥å…·åˆ†æå‡ºç¾é »ç‡æœ€é«˜çš„æ½›åœ¨è¦ç¯„å•é¡Œï¼ˆå¦‚é‡åã€å‘½åéé•·ã€æœªæ˜ç¤ºç’°å¢ƒç­‰ï¼‰ã€‚
- **çŸ¥è­˜å ±å‘Š/å›é¥‹æ©Ÿåˆ¶**ï¼šè¨­ç½®å›é¥‹é »é“ï¼ˆä¾‹ï¼šConfluence commentã€å…§éƒ¨å·¥å–®ç³»çµ±ï¼‰ï¼Œè®“æ‰€æœ‰é–‹ç™¼/é‹ç¶­æˆå“¡ä¸»å‹•å›å ±ç–‘ç¾©ã€‚
- **åŸ¹è¨“èˆ‡æºé€š**ï¼šæ–°è¦å‰‡æ–½è¡Œæ™‚ï¼Œå¿…é ˆä»¥ç·šä¸Š/ç·šä¸‹åŸ¹è¨“ã€è¦–é »æ•™å­¸ã€æ¨™æº–ä½œæ¥­æ‰‹å†Š(SoP)åŠ å¿«å…¨å“¡ç†Ÿæ‚‰èˆ‡æ¥å—ã€‚
- **è‡ªå‹•æé†’èˆ‡é è­¦**ï¼šåˆ©ç”¨è‡ªå‹•è…³æœ¬æŠ“å–é•è¦å‘½åï¼Œè‡ªå‹•å›å ±ç®¡ç†å“¡æˆ–è²¬ä»»åœ˜éšŠã€‚

### 10.3 å‘½åè¦ç¯„æŒçºŒè¿­ä»£æ©Ÿåˆ¶å¯¦ä¾‹

- **ç¯„ä¾‹**ï¼šæŸå¤§å‹é‡‘èæ©Ÿæ§‹åœ¨2019å¹´å°å…¥å‘½åè¦ç¯„æ™‚ï¼Œå…ˆä»¥ pre-commit linter ç›£ç®¡æ‰€æœ‰ IaCã€Jenkinsfileã€Kubernetes yaml æª”æ¡ˆã€‚æ¯å›å­£åº¦ç”±æ¶æ§‹å§”å“¡æœƒå¬é–‹å‘½åå“è³ªå›é¡§æœƒï¼Œæ ¹æ“šç•°å¸¸æ¡ˆä¾‹ä¿®è¨‚ç­–ç•¥ï¼Œä¸¦æ–¼ README.md åŠå…§éƒ¨ wiki å…¬å‘Šæ–°è¦å®šã€‚åœ˜éšŠå¯æ–¼ Slack/Teams ä¸Šæäº¤å»ºè­°ï¼Œç¶“å¯©æ ¸ç´å…¥ä¸‹æœŸå›é¡§ã€‚

### 10.4 æœªä¾†å±•æœ›èˆ‡å»ºè­°

- ä¸æ–·å¼·åŒ–ã€Œå‘½åç­–ç•¥å³ç¨‹å¼ç¢¼ã€å“²å­¸ï¼Œä¸»å¼µæ‰€æœ‰å‘½åè¦ç¯„éƒ½ä»¥è…³æœ¬åŒ–ã€ç­–ç•¥åŒ–æ–¹å¼è‡ªå‹•é©—è­‰è½åœ°ã€‚
- å¯†åˆ‡é—œæ³¨å·¥å…·éˆæ›´æ–°å‹•æ…‹ï¼ŒåŠæ™‚èª¿æ•´ç­–ç•¥èˆ‡æ–‡ä»¶ã€‚
- æ¨å»£ã€Œé€æ˜è‡ªå‹•åŒ–å‘½åæ²»ç†ã€æ–‡åŒ–ï¼Œä½¿æ¯ä½æˆå“¡çš†èƒ½çŸ¥æ˜“è¡Œå¾ã€åé¥‹å³æ™‚ã€‚
- åœ¨çµ„ç¹”è¦æ¨¡æ“´å¼µæ™‚ï¼Œè€ƒæ…®å¼•å…¥ AI åŠ©åŠ›å‘½åå»ºè­°èˆ‡æª¢æŸ¥ã€è‡ªå‹•ç”¢ç”Ÿè³‡æºå”¯ä¸€åç¨±ã€‚

---

# ç¸½çµ

æœ¬å ±å‘Šå¾åŸºç¤è¨­æ–½å³ç¨‹å¼ç¢¼åˆ° CI/CDã€ä¼æ¥­ç´šæ²»ç†ã€å·¥å…·è‡ªå‹•åŒ–ã€å¯¦æˆ°æ¡ˆä¾‹åŠæŒçºŒæ”¹å–„ï¼Œç³»çµ±æ€§ç¸½çµäº†ç¾ä»£ DevOps æµç¨‹ä¸­å‘½åè¦ç¯„çš„å…¨æ–¹ä½æ‡‰ç”¨èˆ‡æœ€ä½³å¯¦è¸ã€‚é€éå»ºç«‹åš´è¬¹çš„ä¸€è‡´æ€§å‘½åè¦ç¯„ä¸¦çµåˆè‡ªå‹•åŒ–å·¥å…·èˆ‡æŒçºŒæ”¹é€²å¾ªç’°ï¼Œä¼æ¥­æ‰èƒ½åœ¨è¤‡é›œå¿«é€Ÿæ¼”é€²çš„é›²åŸç”Ÿèˆ‡è‡ªå‹•åŒ–æ™‚ä»£ï¼Œç©©å¥ã€é«˜æ•ˆåœ°æˆé•·èˆ‡æ‡‰å°å„ç¨® IT æŒ‘æˆ°ã€‚ä»¥ä¸Šå…§å®¹å¯ä½œç‚ºæœªä¾†æ“¬å®šã€å¯¦åšèˆ‡æ²»ç† DevOps/Cloud åŸºç¤è¨­æ–½å‘½åæ¨™æº–çš„é‡è¦åƒè€ƒä¾æ“šã€‚

---