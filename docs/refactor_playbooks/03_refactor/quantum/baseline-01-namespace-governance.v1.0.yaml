apiVersion: machinenativeops.io/v2
kind: Namespace
metadata:
  name: intelligent-hyperautomation-baseline
  labels:
    machinenativeops.io/baseline.level: L-A
    machinenativeops.io/baseline.version: v1.0.0
    machinenativeops.io/baseline.type: namespace-governance
    machinenativeops.io/constitutional: 'true'
    machinenativeops.io/layer: L1
    machinenativeops.io/enforcement: mandatory
    machinenativeops.io/region: global
    machinenativeops.io/zone: constitutional
  annotations:
    machinenativeops.io/description: 命名空間治理基線 / Namespace Governance Foundation
    machinenativeops.io/purpose: 建立 L1 憲法級命名空間隔離與標籤規範 / Establish L1 constitutional
      namespace isolation and labeling standards
    machinenativeops.io/capability-scope: namespace-lifecycle,label-enforcement,resource-isolation
    machinenativeops.io/conflict-priority: '1000'
    machinenativeops.io/state-machine: DECLARED->REGISTERED->COORDINATED->ACTIVE
    machinenativeops.io/last-validated: '2025-10-25T00:00:00Z'
    machinenativeops.io/validation-hash: sha256:baseline1-namespace-gov-foundation
    machinenativeops.io/source-repo: https://github.com/org/baseline-foundations
    machinenativeops.io/source-path: baselines/01-namespace-governance
    machinenativeops.io/sync-policy: automated
---
apiVersion: machinenativeops.io/v2
kind: ConfigMap
metadata:
  name: namespace-governance-policy
  namespace: machinenativenops
  labels:
    machinenativeops.io/baseline.component: policy-definition
    machinenativeops.io/policy.type: namespace-governance
data:
  namespace-naming-convention.yaml: "version: v1.0.0\nenforced: true\npatterns:\n\
    \  production:\n    regex: \"^[a-z][a-z0-9-]*-(prod|production)$\"\n    description:\
    \ \"生產環境命名規範 / Production environment naming\"\n    examples:\n      - \"service-a-prod\"\
    \n      - \"data-pipeline-production\"\n  staging:\n    regex: \"^[a-z][a-z0-9-]*-(stg|staging)$\"\
    \n    description: \"預備環境命名規範 / Staging environment naming\"\n  development:\n\
    \    regex: \"^[a-z][a-z0-9-]*-(dev|development)$\"\n    description: \"開發環境命名規範\
    \ / Development environment naming\"\n  feature:\n    regex: \"^[a-z][a-z0-9-]*-feature-[a-z0-9-]+$\"\
    \n    description: \"特性分支命名規範 / Feature branch naming\"\n  tenant:\n    regex:\
    \ \"^tenant-[a-z0-9]+-(dev|stg|prod)$\"\n    description: \"租戶隔離命名規範 / Tenant\
    \ isolation naming\"\nforbidden_prefixes:\n  - \"kube-\"\n  - \"kubernetes-\"\n\
    \  - \"system-\"\nmax_length: 63\nmin_length: 3\n"
  mandatory-labels.yaml: "version: v1.0.0\nenforced: true\nrequired_labels:\n  - key:\
    \ \"app.kubernetes.io/name\"\n    description: \"應用程式名稱 / Application name\"\n\
    \    validation: \"^[a-z][a-z0-9-]*$\"\n  - key: \"app.kubernetes.io/version\"\
    \n    description: \"應用程式版本 / Application version\"\n    validation: \"^v?[0-9]+\\\
    \\.[0-9]+\\\\.[0-9]+(-[a-z0-9-]+)?$\"\n  - key: \"app.kubernetes.io/component\"\
    \n    description: \"元件類型 / Component type\"\n    allowed_values:\n      - \"\
    frontend\"\n      - \"backend\"\n      - \"database\"\n      - \"cache\"\n   \
    \   - \"queue\"\n      - \"worker\"\n      - \"api\"\n  - key: \"app.kubernetes.io/part-of\"\
    \n    description: \"所屬系統 / Part of system\"\n    validation: \"^[a-z][a-z0-9-]*$\"\
    \n  - key: \"app.kubernetes.io/managed-by\"\n    description: \"管理工具 / Managed\
    \ by tool\"\n    allowed_values:\n      - \"argocd\"\n      - \"flux\"\n     \
    \ - \"helm\"\n      - \"kustomize\"\n  - key: \"environment\"\n    description:\
    \ \"環境標籤 / Environment label\"\n    allowed_values:\n      - \"production\"\n\
    \      - \"staging\"\n      - \"development\"\n      - \"feature\"\n  - key: \"\
    owner\"\n    description: \"負責團隊 / Owner team\"\n    validation: \"^[a-z][a-z0-9-]*@[a-z0-9.-]+$\"\
    \n  - key: \"cost-center\"\n    description: \"成本中心 / Cost center\"\n    validation:\
    \ \"^CC-[0-9]{4,6}$\"\n  - key: \"compliance.level\"\n    description: \"合規等級\
    \ / Compliance level\"\n    allowed_values:\n      - \"public\"\n      - \"internal\"\
    \n      - \"confidential\"\n      - \"restricted\"\n  - key: \"baseline.level\"\
    \n    description: \"基線層級 / Baseline level\"\n    validation: \"^L-[A-Z]$\"\n\
    optional_labels:\n  - key: \"security.scan.required\"\n    default: \"true\"\n\
    \  - key: \"backup.enabled\"\n    default: \"false\"\n  - key: \"monitoring.tier\"\
    \n    default: \"standard\"\n"
  lifecycle-states.yaml: "version: v1.0.0\nstates:\n  DECLARED:\n    description:\
    \ \"命名空間已宣告，等待註冊 / Namespace declared, awaiting registration\"\n    allowed_transitions:\n\
    \      - \"REGISTERED\"\n    annotations_required:\n      - \"baseline.io/capability-scope\"\
    \n  REGISTERED:\n    description: \"已註冊到能力圖譜 / Registered to capability graph\"\
    \n    allowed_transitions:\n      - \"COORDINATED\"\n      - \"CONFLICTED\"\n\
    \    validation_required:\n      - \"label-compliance\"\n      - \"naming-convention\"\
    \n  COORDINATED:\n    description: \"完成衝突解析，準備啟動 / Conflict resolved, ready for\
    \ activation\"\n    allowed_transitions:\n      - \"ACTIVE\"\n      - \"DEGRADED\"\
    \n    prerequisites:\n      - \"resource-quota-assigned\"\n      - \"network-policy-applied\"\
    \n  ACTIVE:\n    description: \"正常運行狀態 / Normal operation state\"\n    allowed_transitions:\n\
    \      - \"DEGRADED\"\n      - \"CONFLICTED\"\n      - \"RETIRED\"\n    monitoring_required:\
    \ true\n  CONFLICTED:\n    description: \"檢測到衝突，暫停服務 / Conflict detected, service\
    \ suspended\"\n    allowed_transitions:\n      - \"COORDINATED\"\n      - \"TERMINATED\"\
    \n    auto_remediation: true\n  DEGRADED:\n    description: \"降級運行，部分功能受限 / Degraded\
    \ operation, partial functionality\"\n    allowed_transitions:\n      - \"ACTIVE\"\
    \n      - \"CONFLICTED\"\n      - \"TERMINATED\"\n    alert_severity: warning\n\
    \  RETIRED:\n    description: \"已退役，等待清理 / Retired, awaiting cleanup\"\n    allowed_transitions:\n\
    \      - \"TERMINATED\"\n    grace_period_days: 30\n  TERMINATED:\n    description:\
    \ \"終止運行 / Terminated\"\n    final_state: true\n"
---
apiVersion: machinenativeops.io/v2
kind: ConfigMap
metadata:
  name: capability-registry-schema
  namespace: machinenativenops
  labels:
    machinenativeops.io/baseline.component: capability-registry
    machinenativeops.io/schema.type: capability-declaration
data:
  capability-declaration.schema.yaml: "version: v1.0.0\nschema_type: capability-declaration\n\
    required_fields:\n  - capability_id\n  - capability_name\n  - capability_version\n\
    \  - namespace\n  - scope\n  - dependencies\n  - conflict_domains\ncapability_declaration:\n\
    \  capability_id:\n    type: string\n    pattern: \"^cap-[a-z0-9-]+$\"\n    description:\
    \ \"能力唯一識別碼 / Capability unique identifier\"\n  capability_name:\n    type: string\n\
    \    description: \"能力名稱 / Capability name\"\n  capability_version:\n    type:\
    \ string\n    pattern: \"^v[0-9]+\\\\.[0-9]+\\\\.[0-9]+$\"\n  namespace:\n   \
    \ type: string\n    description: \"所屬命名空間 / Owning namespace\"\n  scope:\n   \
    \ type: object\n    required:\n      - resource_types\n      - operations\n  \
    \    - boundaries\n    properties:\n      resource_types:\n        type: array\n\
    \        items:\n          enum:\n            - \"compute\"\n            - \"\
    network\"\n            - \"storage\"\n            - \"security\"\n           \
    \ - \"observability\"\n            - \"quantum\"\n      operations:\n        type:\
    \ array\n        items:\n          enum:\n            - \"create\"\n         \
    \   - \"read\"\n            - \"update\"\n            - \"delete\"\n         \
    \   - \"patch\"\n            - \"watch\"\n      boundaries:\n        type: object\n\
    \        properties:\n          namespace_scoped:\n            type: boolean\n\
    \          cluster_scoped:\n            type: boolean\n          cross_cluster:\n\
    \            type: boolean\n  dependencies:\n    type: array\n    items:\n   \
    \   type: object\n      required:\n        - capability_id\n        - version_constraint\n\
    \      properties:\n        capability_id:\n          type: string\n        version_constraint:\n\
    \          type: string\n        optional:\n          type: boolean\n        \
    \  default: false\n  conflict_domains:\n    type: array\n    description: \"潛在衝突域\
    \ / Potential conflict domains\"\n    items:\n      type: string\n  priority_weight:\n\
    \    type: integer\n    minimum: 0\n    maximum: 1000\n    default: 500\n  health_check:\n\
    \    type: object\n    properties:\n      endpoint:\n        type: string\n  \
    \    interval_seconds:\n        type: integer\n      timeout_seconds:\n      \
    \  type: integer\n"
---
apiVersion: machinenativeops.io/v2
kind: Service
metadata:
  name: capability-registry-service
  namespace: machinenativenops
  labels:
    machinenativeops.io/baseline.component: capability-registry
    machinenativeops.io/name: capability-registry
    machinenativeops.io/version: v1.0.0
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: capability-registry
  ports:
  - name: http-api
    port: 8080
    targetPort: 8080
    protocol: TCP
  - name: grpc-api
    port: 9090
    targetPort: 9090
    protocol: TCP
  - name: metrics
    port: 9091
    targetPort: 9091
    protocol: TCP
---
apiVersion: machinenativeops.io/v2
kind: ServiceAccount
metadata:
  name: namespace-governance-controller
  namespace: machinenativenops
  labels:
    machinenativeops.io/baseline.component: governance-controller
automountServiceAccountToken: true
---
apiVersion: machinenativeops.io/v2
kind: ClusterRole
metadata:
  name: namespace-governance-controller
  labels:
    machinenativeops.io/baseline.component: governance-controller
rules:
- apiGroups:
  - ''
  resources:
  - namespaces
  verbs:
  - get
  - list
  - watch
  - update
  - patch
- apiGroups:
  - ''
  resources:
  - events
  verbs:
  - create
  - patch
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  - mutatingwebhookconfigurations
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
---
apiVersion: machinenativeops.io/v2
kind: ClusterRoleBinding
metadata:
  name: namespace-governance-controller
  labels:
    machinenativeops.io/baseline.component: governance-controller
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: namespace-governance-controller
subjects:
- kind: ServiceAccount
  name: namespace-governance-controller
  namespace: intelligent-hyperautomation-baseline
