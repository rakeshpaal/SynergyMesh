---
apiVersion: v1
kind: ConfigMap
metadata:
  name: security-baseline-policy
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.level: L-A
    baseline.version: v1.0.0
    baseline.type: security-rbac
    baseline.dependency: namespace-governance
  annotations:
    baseline.io/description: "安全與存取控制基線 / Security and RBAC Foundation"
    baseline.io/purpose: "建立零信任架構與最小權限原則 / Establish Zero Trust architecture and least privilege principles"
    baseline.io/capability-scope: "authentication,authorization,encryption,audit"
    baseline.io/conflict-priority: "950"
    baseline.io/state-machine: "REGISTERED->COORDINATED->ACTIVE"
data:
  zero-trust-principles.yaml: |
    version: v1.0.0
    principles:
      verify_explicitly:
        description: "明確驗證所有存取請求 / Verify all access requests explicitly"
        implementation:
          - "OIDC authentication required"
          - "mTLS for all service-to-service communication"
          - "API Gateway with JWT validation"
        validation_points:
          - "ingress-gateway"
          - "service-mesh"
          - "api-endpoints"
      least_privilege:
        description: "最小權限授予 / Grant least privilege access"
        implementation:
          - "Role-based access control (RBAC)"
          - "Just-in-time access provisioning"
          - "Time-bound permissions"
        enforcement:
          deny_by_default: true
          explicit_allow_only: true
      assume_breach:
        description: "假設已被入侵態勢 / Assume breach posture"
        implementation:
          - "Network segmentation"
          - "Encrypted data at rest and in transit"
          - "Continuous monitoring and anomaly detection"
        monitoring:
          - "audit-logs"
          - "security-events"
          - "behavior-analytics"
  rbac-role-matrix.yaml: |
    version: v1.0.0
    roles:
      cluster-admin:
        level: L0-CONSTITUTIONAL
        description: "叢集管理員（僅限 L1 層）/ Cluster administrator (L1 only)"
        permissions:
          - "all:all:all"
        assignment_process: "manual-approval-required"
        max_users: 3
        audit_retention_days: 2555
      platform-operator:
        level: L1-GOVERNANCE
        description: "平台操作員 / Platform operator"
        permissions:
          - "namespaces:read,update"
          - "deployments:read,update,rollback"
          - "services:read,update"
          - "configmaps:read,update"
          - "secrets:read"
        namespaces:
          - "all-except-kube-system"
        mfa_required: true
      developer:
        level: L2-APPLICATION
        description: "應用程式開發者 / Application developer"
        permissions:
          - "deployments:read"
          - "pods:read,logs"
          - "services:read"
          - "configmaps:read"
        namespaces:
          - "assigned-only"
        approval_required: false
      viewer:
        level: L3-READONLY
        description: "唯讀檢視者 / Read-only viewer"
        permissions:
          - "all:read"
        namespaces:
          - "assigned-only"
        default_role: true
      ci-cd-automation:
        level: L2-AUTOMATION
        description: "CI/CD 自動化服務帳戶 / CI/CD automation service account"
        permissions:
          - "deployments:create,update,delete"
          - "configmaps:create,update,delete"
          - "secrets:create,update"
          - "pods:read,delete"
        namespaces:
          - "assigned-workload-namespaces"
        token_rotation_days: 30
        audit_all_actions: true
  encryption-standards.yaml: |
    version: v1.0.0
    data_at_rest:
      kubernetes_secrets:
        encryption_provider: "aes-gcm"
        key_length_bits: 256
        rotation_days: 90
        backend: "vault"
      persistent_volumes:
        encryption_required: true
        algorithm: "AES-256-XTS"
        key_management: "external-kms"
    data_in_transit:
      service_mesh:
        mtls_mode: "STRICT"
        tls_version_min: "1.3"
        cipher_suites:
          - "TLS_AES_256_GCM_SHA384"
          - "TLS_CHACHA20_POLY1305_SHA256"
      ingress:
        tls_termination: "edge"
        tls_version_min: "1.3"
        hsts_enabled: true
        hsts_max_age_seconds: 31536000
    post_quantum_cryptography:
      enabled: true
      algorithms:
        - "CRYSTALS-Kyber"
        - "CRYSTALS-Dilithium"
      hybrid_mode: true
      classical_fallback: "RSA-4096"
  authentication-config.yaml: |
    version: v1.0.0
    providers:
      oidc:
        enabled: true
        issuer_url: "https://idp.example.com"
        client_id: "kubernetes-cluster"
        username_claim: "email"
        groups_claim: "groups"
        required_claims:
          - "email_verified:true"
      service_account:
        enabled: true
        token_ttl_seconds: 3600
        projected_volume_enabled: true
        audience: "kubernetes.default.svc"
      certificate:
        enabled: true
        ca_bundle: "base64-encoded-ca-cert"
        client_cert_validation: "require-and-verify"
    session_management:
      idle_timeout_minutes: 30
      absolute_timeout_hours: 8
      concurrent_sessions_max: 3
  audit-policy.yaml: |
    version: v1.0.0
    audit_levels:
      metadata:
        description: "記錄請求元數據 / Log request metadata"
        resources:
          - "configmaps"
          - "endpoints"
      request:
        description: "記錄請求主體 / Log request body"
        resources:
          - "secrets"
          - "deployments"
          - "statefulsets"
      request_response:
        description: "記錄請求與回應 / Log request and response"
        resources:
          - "rbac.authorization.k8s.io/*"
          - "certificates.k8s.io/*"
    retention:
      log_rotation_days: 90
      archive_storage: "s3-compliant"
      encryption_at_rest: true
    alerting:
      unauthorized_access:
        severity: "critical"
        notification: "pagerduty"
      privileged_escalation:
        severity: "high"
        notification: "slack"
      anomalous_behavior:
        severity: "medium"
        notification: "email"
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: security-policy-enforcer
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.component: security-enforcer
automountServiceAccountToken: true
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: security-baseline-enforcer
  labels:
    baseline.component: security-enforcer
rules:
  - apiGroups:
      - ""
    resources:
      - serviceaccounts
      - secrets
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - "rbac.authorization.k8s.io"
    resources:
      - roles
      - rolebindings
      - clusterroles
      - clusterrolebindings
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
  - apiGroups:
      - "networking.k8s.io"
    resources:
      - networkpolicies
    verbs:
      - get
      - list
      - watch
      - create
      - update
  - apiGroups:
      - "policy"
    resources:
      - podsecuritypolicies
    verbs:
      - use
  - apiGroups:
      - "cert-manager.io"
    resources:
      - certificates
      - issuers
    verbs:
      - get
      - list
      - watch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: security-baseline-enforcer
  labels:
    baseline.component: security-enforcer
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: security-baseline-enforcer
subjects:
  - kind: ServiceAccount
    name: security-policy-enforcer
    namespace: intelligent-hyperautomation-baseline
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: developer-restricted
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.rbac: developer-template
  annotations:
    rbac.io/description: "受限開發者角色模板 / Restricted developer role template"
rules:
  - apiGroups:
      - ""
    resources:
      - pods
      - pods/log
      - pods/status
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - "apps"
    resources:
      - deployments
      - replicasets
      - statefulsets
    verbs:
      - get
      - list
      - watch
  - apiGroups:
      - ""
    resources:
      - services
      - endpoints
    verbs:
      - get
      - list
  - apiGroups:
      - ""
    resources:
      - configmaps
    verbs:
      - get
      - list
    resourceNames:
      - "app-config-*"
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: ci-cd-deployer
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.rbac: ci-cd-template
  annotations:
    rbac.io/description: "CI/CD 部署者角色模板 / CI/CD deployer role template"
rules:
  - apiGroups:
      - "apps"
    resources:
      - deployments
      - replicasets
      - statefulsets
      - daemonsets
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
      - delete
  - apiGroups:
      - ""
    resources:
      - pods
    verbs:
      - get
      - list
      - delete
  - apiGroups:
      - ""
    resources:
      - services
      - endpoints
    verbs:
      - get
      - list
      - create
      - update
      - patch
  - apiGroups:
      - ""
    resources:
      - configmaps
      - secrets
    verbs:
      - get
      - list
      - create
      - update
      - patch
  - apiGroups:
      - "batch"
    resources:
      - jobs
      - cronjobs
    verbs:
      - get
      - list
      - create
      - update
      - delete
---
apiVersion: v1
kind: Secret
metadata:
  name: encryption-key-rotation-schedule
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.component: encryption-management
type: Opaque
stringData:
  rotation-schedule.yaml: |
    version: v1.0.0
    rotation_policies:
      kubernetes_secrets:
        interval_days: 90
        grace_period_days: 7
        notification_days_before: 14
      service_account_tokens:
        interval_days: 30
        auto_rotate: true
      tls_certificates:
        interval_days: 365
        renewal_threshold_days: 30
      api_keys:
        interval_days: 180
        rotation_window_hours: 4
    enforcement:
      block_expired: true
      warn_expiring: true
      auto_remediation: true
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: pod-security-standards
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.component: pod-security
data:
  baseline-pod-security.yaml: |
    version: v1.0.0
    security_context_defaults:
      run_as_non_root: true
      run_as_user: 1000
      run_as_group: 3000
      fs_group: 2000
      allow_privilege_escalation: false
      read_only_root_filesystem: true
      seccomp_profile:
        type: "RuntimeDefault"
      capabilities:
        drop:
          - "ALL"
        add: []
    restricted_policies:
      host_network: false
      host_pid: false
      host_ipc: false
      privileged: false
      host_path_volumes: false
      proc_mount: "Default"
    required_labels:
      - "app.kubernetes.io/name"
      - "security.baseline/level"
    admission_control:
      enforce_mode: "enforce"
      audit_annotations: true
