changelog:
- changes:
  - 初始版本
  - 建立三階段處理流程
  - 定義高階推理引擎
  - 建立目錄映射規則
  date: '2025-12-08'
  version: 1.0.0
checkpoints:
  phase_0_complete:
    criteria:
    - 所有資產已分類
    - 決策報告已生成
    - 風險已評估
    name: 暫存區處理完成
  phase_1_complete:
    criteria:
    - 解構報告已生成
    - 依賴圖譜已繪製
    - 知識已萃取
    name: 解構分析完成
  phase_2_complete:
    criteria:
    - 目標結構已定義
    - 映射表已建立
    - 遷移計畫已產生
    name: 集成設計完成
  phase_3_complete:
    criteria:
    - 所有 P1 任務完成
    - 所有 P2 任務完成
    - 驗收條件滿足
    name: 重構執行完成
description: 智能重構引擎 - 舊資產解構、分析、集成與嵌入決策系統
directory_mapping:
  type_rules:
  - patterns:
    - '*engine*'
    - '*processor*'
    - '*manager*'
    - '*handler*'
    priority: high
    target: core/modules/
    type: core_module
  - patterns:
    - '*ai*'
    - '*ml*'
    - '*model*'
    - '*inference*'
    priority: high
    target: core/ai_engines/
    type: ai_component
  - patterns:
    - '*.yaml'
    - '*.yml'
    - '*config*'
    - '*settings*'
    priority: medium
    target: config/
    type: configuration
  - patterns:
    - '*deployment*'
    - '*service*'
    - '*ingress*'
    - '*rbac*'
    priority: medium
    target: infrastructure/kubernetes/
    type: kubernetes
  - patterns:
    - '*policy*'
    - '*rule*'
    - '*compliance*'
    - '*audit*'
    priority: medium
    target: governance/
    type: governance
  - patterns:
    - '*.md'
    - '*readme*'
    - '*guide*'
    - '*spec*'
    priority: low
    target: docs/
    type: documentation
  - patterns:
    - '*auto*'
    - '*bot*'
    - '*workflow*'
    - '*pipeline*'
    priority: medium
    target: automation/
    type: automation
  - patterns:
    - '*service*'
    - '*api*'
    - '*gateway*'
    - '*endpoint*'
    priority: high
    target: services/
    type: service
  - patterns:
    - '*tool*'
    - '*script*'
    - '*util*'
    - '*helper*'
    priority: low
    target: tools/
    type: tool
  vocabulary_mapping:
    namespaces:
<<<<<<< HEAD
      axiom-system: machinenativeops
      src/ai: src/ai
      unmanned-island: machinenativeops
=======
      "machinenativeops": "machinenativeops"
      "unmanned-island": "machinenativeops"
      "src/ai": "src/ai"

    # 術語映射
    terminology:
      "executor": "engine"
      "plugin": "module"
      "handler": "processor"
      "manager": "coordinator"

    # 路徑映射
>>>>>>> main
    paths:
      bin/: tools/
      lib/: shared/
      src/: core/
    terminology:
      executor: engine
      handler: processor
      manager: coordinator
      plugin: module
execution:
  logging:
    include_timestamps: true
    level: INFO
    output_dir: _logs/
  modes:
    automatic:
      default: false
      description: 自動執行，僅在關鍵點暫停
    dry_run:
      default: true
      description: 模擬執行，不實際修改檔案
    interactive:
      default: false
      description: 互動模式，每步驟需確認
  safety:
    backup_before_change: true
    require_confirmation_for:
    - delete
    - overwrite
    - merge
    rollback_on_failure: true
integrations:
  ci_workflows: ../../.github/workflows/
  language_governance: ../../governance/language-governance-report.md
  machinenativeops_config: ../../machinenativeops.yaml
  module_map: ../../config/system-module-map.yaml
name: RefactorEngine
phases:
  phase_0_staging:
    config_file: config/legacy-scratch-processor.yaml
    description: 將舊資產放入暫存區，進行高階推理分析
    name: 暫存區處理
    workflow:
      step_1_intake:
        actions:
        - 驗證檔案完整性
        - 提取基本 metadata
        - 分配唯一 asset_id
        description: 接收舊資產到 _legacy_scratch/
        name: 資產接收
      step_2_scan:
        actions:
        - 提取關鍵詞彙 (keywords)
        - 識別架構模式 (patterns)
        - 映射引用關係 (references)
        - 偵測功能屬性 (capabilities)
        description: 掃描舊資產中的詞彙、結構、引用
        name: 詞彙映射掃描
      step_3_reasoning:
        actions:
        - 分析語意相似度
        - 計算目標匹配分數
        - 決定整合方式 (整體 vs 嵌入)
        - 產生位置建議
        description: 使用 AI 推理決定分佈位置
        name: 高階推理決策
      step_4_output:
        description: 輸出結構化決策報告
        name: 決策輸出
        outputs:
        - placement_decision.yaml
        - integration_plan.md
        - risk_assessment.md
  phase_1_deconstruction:
    analysis_dimensions:
    - description: 架構模式分析
      dimension: architecture
      extracts:
      - layers
      - components
      - boundaries
      - patterns
    - description: 功能清單
      dimension: functionality
      extracts:
      - features
      - capabilities
      - apis
      - interfaces
    - description: 依賴關係
      dimension: dependencies
      extracts:
      - internal_deps
      - external_deps
      - circular_deps
    - description: 品質狀態
      dimension: quality
      extracts:
      - complexity
      - coverage
      - violations
      - debt
    - description: 知識萃取
      dimension: knowledge
      extracts:
      - design_decisions
      - lessons_learned
      - best_practices
    description: 深度分析舊資產的架構、功能、依賴
    name: 解構分析
    output_dir: 01_deconstruction
  phase_2_integration:
    config_file: config/integration-processor.yaml
    description: 設計新架構、定義邊界、規劃遷移
    design_aspects:
    - aspect: boundaries
      description: 模組邊界定義
      outputs:
      - module_boundaries.yaml
      - api_contracts.md
    - aspect: mapping
      description: 新舊映射表
      outputs:
      - component_mapping.yaml
      - path_migration.yaml
    - aspect: optimization
      description: 目錄結構最佳化
      outputs:
      - directory_blueprint.md
      - structure_graph.mermaid
    - aspect: strategy
      description: 遷移策略
      outputs:
      - migration_plan.md
      - rollback_plan.md
    name: 集成設計
    output_dir: 02_integration
  phase_3_refactor:
    description: 執行重構計畫，分 P1/P2/P3 優先級
    name: 重構執行
    output_dir: 03_refactor
    priority_levels:
      P1:
        criteria:
        - 阻塞 CI/CD 的問題
        - 安全漏洞 (Semgrep HIGH)
        - 核心功能缺失
        - 目錄結構建立
        name: 緊急處理
        timeframe: 24-48 小時
      P2:
        criteria:
        - 語言遷移
        - 架構邊界修復
        - API 契約更新
        - 測試補充
        name: 重要重構
        timeframe: 1 週內
      P3:
        criteria:
        - 技術債清理
        - 效能優化
        - 文檔完善
        - 監控強化
        name: 持續優化
        timeframe: 長期
reasoning_engine:
  decision_types:
    archive:
      actions:
      - 萃取設計決策
      - 記錄 lessons learned
      - 移到 archive 目錄
      conditions:
      - 舊資產已過時
      - 功能已被取代
      - 僅有歷史參考價值
      description: 歸檔 - 僅保留知識，不整合程式碼
    embedded_integration:
      actions:
      - 識別嵌入點
      - 合併程式碼
      - 解決衝突
      - 更新測試
      conditions:
      - 舊資產為功能片段
      - 需要與現有程式碼合併
      - 存在重疊功能
      description: 嵌入式整合 - 部分嵌入到現有結構
    full_integration:
      actions:
      - 創建目標目錄
      - 複製並適配所有檔案
      - 更新引用路徑
      - 添加到索引
      conditions:
      - 舊資產為完整模組
      - 無重大衝突
      - 目標位置明確
      description: 整體整合 - 完整導入到目標目錄
    reference_only:
      actions:
      - 建立介面層
      - 創建 adapter
      - 記錄引用關係
      conditions:
      - 舊資產為外部依賴
      - 不適合直接整合
      - 需要保持獨立演進
      description: 僅引用 - 保持分離但建立連結
  description: 負責分析舊資產並決策分佈位置的 AI 引擎
  modes:
    dependency_analysis:
      description: 依賴分析 - 分析引用關係
      weight: 0.25
    pattern_recognition:
      description: 模式識別 - 識別架構模式
      weight: 0.2
    semantic_analysis:
      description: 語意分析 - 理解舊資產的功能意圖
      weight: 0.3
    structural_matching:
      description: 結構匹配 - 比對現有專案結構
      weight: 0.25
  name: HighLevelReasoningEngine
report_format:
  sections:
  - id: overview
    name: 目錄現況總覽
    required: true
  - id: problems
    name: 識別的問題
    required: true
    subsections:
    - 問題描述
    - 影響範圍
    - 分類
    - 阻抗/衝突
  - id: target_structure
    includes: 結構圖譜 (Mermaid/ASCII)
    name: 重構設計：目標結構
    required: true
  - id: execution_plan
    name: 執行計畫：正確順序
    phases:
    - 'P1: 建立/更新目錄結構'
    - 'P2: 檔案遷移/整合'
    - 'P3: 清理/驗證'
    required: true
  - id: validation
    name: 驗收條件
    required: true
  template_file: templates/ANALYSIS_REPORT_TEMPLATE.md
system:
  id: refactor-engine-v1
  root_path: docs/refactor_playbooks
validation:
  post_execution:
  - 驗證所有檔案已遷移
  - 檢查引用路徑正確
  - 執行測試套件
  - 更新索引檔案
  pre_execution:
  - 檢查目標目錄存在
  - 驗證無命名衝突
  - 確認依賴完整
version: 1.0.0
