---
# PersistentVolumeClaim for HLP Executor Core state storage
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: hlp-executor-state
  namespace: unmanned-island-system
  labels:
    app: hlp-executor-core
    component: execution-engine
    storage-type: state
  annotations:
    description: "Persistent storage for HLP Executor Core execution state and checkpoints"
    volume.beta.kubernetes.io/storage-provisioner: "kubernetes.io/default-provisioner"
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi
  # storageClassName: standard  # Uncomment and adjust based on your cluster's storage classes
  volumeMode: Filesystem

---
# ConfigMap for HLP Executor Core configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: hlp-executor-config
  namespace: unmanned-island-system
  labels:
    app: hlp-executor-core
    component: execution-engine
  annotations:
    description: "Configuration for HLP Executor Core"
data:
  executor.yaml: |
    # HLP Executor Core Configuration

    # Execution Settings
    execution:
      max_concurrent_executions: 1000
      max_plan_units_per_execution: 500
      state_history_retention_days: 7
      default_timeout_seconds: 3600

    # DAG Orchestration
    dag_orchestration:
      topological_sort_enabled: true
      risk_weighted_scheduling: true
      critical_path_analysis: true
      max_width_parallelization: true
      max_parallel_tasks: 100

    # State Machine
    state_machine:
      initial_state: "PENDING"
      checkpoint_frequency: "per-phase"
      recovery_strategy: "last-known-good-state"
      states:
        - name: "PENDING"
          timeout_seconds: 300
        - name: "SCHEDULING"
          timeout_seconds: 600
        - name: "EXECUTING"
          timeout_seconds: 3600
        - name: "VERIFYING"
          timeout_seconds: 300
        - name: "COMMIT"
          final_state: true
        - name: "FAILED"
          final_state: true
        - name: "ROLLBACK"
          recovery_state: true

    # Partial Rollback
    partial_rollback:
      enabled: true
      checkpoint_retention: 5
      scope_levels:
        - "phase"
        - "plan-unit"
        - "artifact"
      triggers:
        - condition: "validation-failure"
          scope: "phase"
          action: "rollback-current-phase"
        - condition: "resource-exhaustion"
          scope: "plan-unit"
          action: "reschedule-with-backoff"
        - condition: "security-violation"
          scope: "entire-execution"
          action: "emergency-stop-and-rollback"

    # Retry Policies
    retry_policies:
      base_delay_ms: 2000
      max_attempts: 4
      max_delay_ms: 30000
      jitter_enabled: true
      risk_adaptive_enabled: true
      exponential_backoff: true

    # Circuit Breaker
    circuit_breaker:
      failure_threshold: 5
      recovery_timeout_seconds: 30
      half_open_max_calls: 3

    # Quantum Integration
    quantum:
      enabled: false
      fallback_mode: "classical"
      scheduler_endpoint: "quantum-scheduler.unmanned-island-system.svc.cluster.local:8888"
      circuit_optimizer_endpoint: "quantum-circuit-optimizer.unmanned-island-system.svc.cluster.local:8889"

    # Knowledge Graph Integration
    knowledge_graph:
      enabled: true
      kg_builder_endpoint: "kg-graph-builder.unmanned-island-system.svc.cluster.local:8890"
      vector_search_endpoint: "kg-vector-hybrid.unmanned-island-system.svc.cluster.local:8891"

    # Observability
    observability:
      metrics:
        enabled: true
        port: 9090
        path: "/metrics"
      logging:
        format: "json"
        level: "INFO"
        correlation_id: "trace-context"
        structured: true
      tracing:
        enabled: true
        sampling_rate: 0.1
        exporters:
          - "jaeger"
          - "otel-collector"

    # Performance SLO
    performance:
      dag_parse_latency_p95_ms: 120
      state_transition_latency_p90_ms: 50
      recovery_time_objective_seconds: 30
      availability_target: 0.999

    # Security
    security:
      slsa_level: 3
      requires_signing: true
      network_policy_enabled: true
      rbac_enabled: true
      trust_bundle_path: "/etc/unmanned-island/trust"

---
# ConfigMap for trust bundle placeholder
apiVersion: v1
kind: ConfigMap
metadata:
  name: unmanned-island-trust-bundle
  namespace: unmanned-island-system
  labels:
    app: unmanned-island
    component: security
  annotations:
    description: "Trust bundle for certificate validation"
data:
  ca-bundle.crt: |
    # Placeholder for CA certificates
    # Replace with actual CA certificates in production
    # -----BEGIN CERTIFICATE-----
    # ... CA certificate content ...
    # -----END CERTIFICATE-----

  hlp-executor-core.pub: |
    # Placeholder for HLP Executor Core public key
    # Replace with actual public key for signature verification
    # -----BEGIN PUBLIC KEY-----
    # ... public key content ...
    # -----END PUBLIC KEY-----
