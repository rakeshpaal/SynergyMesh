---
version: v1.0
kind: CanonicalNamingSpec
metadata:
  name: canonical-naming-governance
  owner: platform-governance
  description: Single-source machine spec for naming governance with URN/URI mapping

naming:
  allowed_chars: "[a-z0-9-]"
  case: lower
  max_length: 63
  segments:
    - domain
    - component
    - environment
    - region
    - version
    - suffix
  environments:
    - dev
    - test
    - staging
    - prod
    - learn
    - sandbox
  reserved_tokens:
    - core
    - internal
    - system
    - legacy
    - experimental
  qualifier_rules:
    max_qualifiers: 12
    key_pattern: "^[a-z0-9][a-z0-9-]{0,29}$"
    value_pattern: "^[a-zA-Z0-9.:@/+%-]{0,127}$"
  canonical_regex: "^(team|tenant|dev|test|staging|prod|learn)-[a-z0-9-]{1,56}[a-z0-9]$"
  suffix_map:
    namespace: "ns"
    deployment: "deploy"
    service: "svc"
    configmap: "config"
    secret: "secret"
    pvc: "pvc"
    job: "job"

required_labels:
  - environment
  - tenant
  - app.kubernetes.io/managed-by

urn_template: "urn:axiom:{domain}:{component}:env:{environment}:{version}"
annotations:
  canonical_urn: "axiom.io/canonical-urn"
  qualifiers: "axiom.io/qualifiers"

validation:
  gatekeeper:
    constraint_templates:
      - name: K8sRequiredLabels
        required_labels_ref: required_labels
      - name: K8sNamingPattern
        pattern_ref: naming.canonical_regex
        max_length_ref: naming.max_length
    failure_policy: Fail
  ci:
    conftest_policy: governance/23-policies/conftest/naming_policy.rego
    kubeval: true
    yamllint: true

migration:
  strategy: warn-and-plan
  dry_run_report: reports/canonical-naming-mapping.csv
  risk_tags:
    - high
    - medium
    - low
