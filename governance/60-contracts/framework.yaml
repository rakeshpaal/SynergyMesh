---
# Contract Registry Framework
# 契約註冊表框架配置

metadata:
  name: "Contract Registry Framework"
  version: "1.0.0"
  description: "Contract-driven module interface governance"
  owner: "Contract Governance Team"
  created_at: "2025-12-11"
  updated_at: "2025-12-11"

# Contract Definition Standard
contract_standard:
  format: "yaml"
  schema_version: "1.0"

  required_fields:
    - id
    - name
    - version
    - status
    - owner
    - interface
    - behavior

  optional_fields:
    - dependencies
    - deprecation_notice
    - migration_guide

# Versioning Policy
versioning:
  policy: "semantic_versioning"
  format: "MAJOR.MINOR.PATCH"

  breaking_changes:
    trigger: "major_version_increment"
    notice_period_days: 180
    migration_support: true

  backward_compatibility:
    required_for:
      - minor_versions
      - patch_versions

    compatibility_testing:
      enabled: true
      automated: true
      failure_blocks_release: true

# Contract Testing
testing:
  frameworks:
    - name: "Pact"
      type: "consumer_driven"
      enabled: true

    - name: "Spring Cloud Contract"
      type: "producer_driven"
      enabled: true

    - name: "OpenAPI Validator"
      type: "schema_validation"
      enabled: true

  test_stages:
    - schema_validation
    - behavior_verification
    - compatibility_testing
    - integration_testing

  coverage_requirements:
    minimum_coverage: 80
    critical_paths_coverage: 100

# Contract Lifecycle
lifecycle:
  states:
    draft:
      allowed_actions: ["edit", "validate", "delete"]

    review:
      allowed_actions: ["approve", "reject", "request_changes"]
      approvers_required: 2

    approved:
      allowed_actions: ["publish"]

    published:
      allowed_actions: ["deprecate", "patch_update"]
      immutable_fields: ["id", "major_version"]

    deprecated:
      allowed_actions: ["retire"]
      support_period_days: 365

    retired:
      allowed_actions: ["archive"]
      read_only: true

# API Standards
api_standards:
  rest:
    specification: "OpenAPI 3.0"
    conventions:
      - use_http_methods_correctly
      - versioning_in_url
      - consistent_naming
      - proper_status_codes

  grpc:
    specification: "Protocol Buffers 3"
    conventions:
      - semantic_versioning
      - backward_compatibility
      - proper_error_handling

  graphql:
    specification: "GraphQL Schema Definition"
    conventions:
      - schema_versioning
      - deprecation_directives
      - proper_error_handling

# Contract Registry
registry:
  storage:
    backend: "git"
    path: "governance/60-contracts/registry/"
    versioning: true

  indexing:
    enabled: true
    search_fields:
      - contract_id
      - module_id
      - tags
      - owner

  access_control:
    read: "public"
    write: "authenticated"
    approve: "authorized_approvers"

# Compatibility Matrix
compatibility:
  matrix_generation:
    enabled: true
    update_frequency: "on_contract_publish"

  compatibility_levels:
    - full_compatible
    - backward_compatible
    - forward_compatible
    - incompatible

  conflict_resolution:
    strategy: "explicit_approval"
    notification: true

# Integration Points
integrations:
  policy_framework: "10-policy"
  intent_orchestration: "20-intent"
  agent_platform: "30-agents"
  automation_system: "39-automation"
  self_healing: "40-self-healing"
  audit_system: "70-audit"
  feedback_loop: "80-feedback"
