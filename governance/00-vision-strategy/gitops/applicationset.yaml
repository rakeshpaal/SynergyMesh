# Argo CD ApplicationSet for GaC Resources
# Auto-deploys all governance resources to K8s cluster
# Phase 3 - GitOps Integration

apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: governance-resources
  namespace: argocd
  annotations:
    gac-phase: "3-gitops"
    strategic-source: "governance/00-vision-strategy"
spec:
  generators:
    - list:
        elements:
          - name: governance-crds
            path: crd
            namespace: default
          - name: governance-instances
            path: k8s
            namespace: governance
  template:
    metadata:
      name: "gac-{{name}}"
      labels:
        gac-phase: "3-gitops"
        governance-tier: "strategic"
    spec:
      project: default
      source:
        repoURL: https://github.com/SynergyMesh-admin/SynergyMesh.git
        targetRevision: main
        path: "governance/00-vision-strategy/{{path}}"
      destination:
        server: https://kubernetes.default.svc
        namespace: "{{namespace}}"
      syncPolicy:
        automated:
          prune: true
          selfHeal: true
          allowEmpty: false
        syncOptions:
          - CreateNamespace=true
          - PruneLast=true
        retry:
          limit: 5
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 3m
