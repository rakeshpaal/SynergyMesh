version: "1.0.0"
skeleton_id: "testing-governance"

schemas:
  testing_governance_input:
    type: object
    description: "測試治理請求：測試計劃、覆蓋評估或品質策略設計"
    properties:
      action_type:
        type: string
        enum:
          - "plan_testing"
          - "set_coverage"
          - "design_strategy"
          - "validate_quality"
          - "assess_risk"
        description: "執行動作類型"
      component_name:
        type: string
        description: "要測試的組件或模組名稱"
      test_scope:
        type: object
        properties:
          test_types:
            {
              type: array,
              items:
                {
                  enum:
                    ["unit", "integration", "e2e", "performance", "security"],
                },
            }
          areas_of_focus: { type: array, items: { type: string } }
          risk_level: { enum: ["low", "medium", "high", "critical"] }
        description: "測試範圍與關注領域"
      constraints:
        type: object
        properties:
          time_budget_hours: { type: number }
          automation_preference: { type: string }
          test_environment_limits: { type: array, items: { type: string } }
        description: "測試約束條件"
    required:
      - action_type
      - component_name

  testing_governance_report:
    type: object
    description: "測試治理評估報告：覆蓋率分析與品質狀態"
    properties:
      component_name: { type: string }
      test_strategy:
        type: object
        properties:
          testing_approach: { type: string }
          test_pyramid:
            type: object
            properties:
              unit_tests_percentage: { type: number }
              integration_tests_percentage: { type: number }
              e2e_tests_percentage: { type: number }
          test_execution_time: { type: string }
      coverage_analysis:
        type: object
        properties:
          line_coverage_percentage: { type: number, minimum: 0, maximum: 100 }
          branch_coverage_percentage: { type: number, minimum: 0, maximum: 100 }
          critical_path_coverage: { type: number, minimum: 0, maximum: 100 }
          coverage_gaps:
            type: array
            items: { type: string }
          untested_scenarios:
            type: array
            items: { type: string }
      quality_metrics:
        type: object
        properties:
          defect_density: { type: number }
          test_pass_rate: { type: number }
          flaky_test_rate: { type: number }
          mean_time_to_fix: { type: string }
      quality_gates:
        type: array
        items:
          type: object
          properties:
            gate_name: { type: string }
            required: { type: boolean }
            current_status: { enum: ["pass", "fail", "warning"] }
            threshold: { type: string }
      risk_assessment:
        type: object
        properties:
          high_risk_areas: { type: array, items: { type: string } }
          untested_critical_paths: { type: array, items: { type: string } }
          recommendations: { type: array, items: { type: string } }
      timestamp: { type: string, format: "date-time" }
    required:
      - component_name
      - coverage_analysis
      - quality_metrics

  testing_governance_suggestion:
    type: object
    description: "測試治理改善建議：覆蓋擴展、自動化或測試優化"
    properties:
      component_name: { type: string }
      suggestion_type:
        type: string
        enum:
          - "increase_coverage"
          - "improve_automation"
          - "refactor_tests"
          - "risk_based_testing"
          - "performance_testing_addition"
      coverage_gaps_identified:
        type: array
        items: { type: string }
      proposed_tests:
        type: array
        items:
          type: object
          properties:
            test_case: { type: string }
            test_type: { type: string }
            priority: { enum: ["high", "medium", "low"] }
            estimated_effort: { type: string }
      automation_opportunities:
        type: array
        items:
          type: object
          properties:
            scenario: { type: string }
            current_approach: { type: string }
            automation_approach: { type: string }
            effort_reduction_percentage: { type: number }
      expected_improvements:
        type: object
        properties:
          coverage_increase_percentage: { type: number }
          defect_detection_improvement: { type: number }
          test_execution_time_reduction: { type: number }
      timeline_and_effort:
        type: object
        properties:
          implementation_phases: { type: array, items: { type: string } }
          total_effort_hours: { type: number }
    required:
      - component_name
      - suggestion_type
      - proposed_tests
