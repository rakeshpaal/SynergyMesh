{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schema.superroot.kn/mndoc/knowledge-graph/v1",
  "title": "Knowledge Graph Schema v1",
  "description": "定義知識圖譜結構。Schema for representing repository knowledge as a graph with nodes and edges.",
  "type": "object",
  "required": ["$schema", "version", "id", "nodes", "edges"],
  "properties": {
    "$schema": {
      "type": "string",
      "const": "https://schema.superroot.kn/mndoc/knowledge-graph/v1",
      "description": "Schema namespace identifier"
    },
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Graph version"
    },
    "id": {
      "type": "string",
      "description": "Graph identifier"
    },
    "title": {
      "type": "string",
      "description": "Human-readable title"
    },
    "description": {
      "type": "string",
      "description": "Graph description"
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "Generation timestamp"
    },
    "source_repo": {
      "type": "string",
      "description": "Source repository path"
    },
    "nodes": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/node"
      },
      "description": "Graph nodes representing entities"
    },
    "edges": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/edge"
      },
      "description": "Graph edges representing relationships"
    },
    "statistics": {
      "type": "object",
      "properties": {
        "total_nodes": { "type": "integer" },
        "total_edges": { "type": "integer" },
        "nodes_by_type": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        },
        "edges_by_type": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        }
      },
      "description": "Graph statistics"
    },
    "meta": {
      "type": "object",
      "description": "Additional metadata"
    }
  },
  "additionalProperties": false,
  "$defs": {
    "node": {
      "type": "object",
      "required": ["id", "type", "label"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique node identifier"
        },
        "type": {
          "type": "string",
          "enum": ["system", "subsystem", "component", "module", "file", "directory", "config", "document", "workflow", "schema", "capability", "feature", "tag"],
          "description": "Node type"
        },
        "label": {
          "type": "string",
          "description": "Display label"
        },
        "path": {
          "type": "string",
          "description": "File/directory path"
        },
        "description": {
          "type": "string",
          "description": "Node description"
        },
        "properties": {
          "type": "object",
          "description": "Additional node properties"
        },
        "tags": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Node tags"
        }
      },
      "additionalProperties": false
    },
    "edge": {
      "type": "object",
      "required": ["source", "target", "type"],
      "properties": {
        "source": {
          "type": "string",
          "description": "Source node ID"
        },
        "target": {
          "type": "string",
          "description": "Target node ID"
        },
        "type": {
          "type": "string",
          "enum": ["contains", "depends_on", "references", "implements", "extends", "configures", "documents", "provides", "consumes", "triggers", "validates", "tagged_with"],
          "description": "Relationship type"
        },
        "label": {
          "type": "string",
          "description": "Edge label"
        },
        "weight": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Edge weight (0-1)"
        },
        "properties": {
          "type": "object",
          "description": "Additional edge properties"
        }
      },
      "additionalProperties": false
    }
  }
}
