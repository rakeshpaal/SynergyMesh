---
# PaC Framework Configuration
# Policy as Code 框架配置

metadata:
  name: "PaC Framework"
  version: "1.0.0"
  description: "Enterprise Policy as Code governance framework"
  owner: "Policy Governance Team"
  created_at: "2025-12-11"
  updated_at: "2025-12-11"

# Framework Architecture
architecture:
  layers:
    strategy_layer:
      description: "策略層 - 定義高階治理規則與合規政策"
      components:
        - base_policies
        - domain_policies
        - compliance_standards

    orchestration_layer:
      description: "協調層 - 策略閘與執行協調"
      components:
        - policy_gates
        - policy_engine
        - suppress_manager

    execution_layer:
      description: "執行層 - 實際策略驗證與執行"
      components:
        - opa_runtime
        - conftest
        - custom_validators

    observability_layer:
      description: "觀測層 - 監控、審計與度量"
      components:
        - policy_metrics
        - audit_logger
        - violation_tracker

# Policy Categories
policy_categories:
  architecture:
    priority: "high"
    enforcement: "blocking"
    policies:
      - dependency_rules
      - layer_boundaries
      - module_contracts

  security:
    priority: "critical"
    enforcement: "blocking"
    policies:
      - authentication
      - authorization
      - encryption
      - secrets_management

  compliance:
    priority: "high"
    enforcement: "blocking"
    policies:
      - data_privacy
      - audit_requirements
      - retention_policies

  quality:
    priority: "medium"
    enforcement: "warning"
    policies:
      - code_standards
      - documentation
      - test_coverage

# Policy Gates Configuration
policy_gates:
  ci_gate:
    stage: "continuous_integration"
    trigger: "on_pull_request"
    policies:
      - architecture_policies
      - security_policies
      - quality_policies
    enforcement_level: "blocking"
    timeout_seconds: 300

  deployment_gate:
    stage: "deployment"
    trigger: "on_release"
    policies:
      - security_policies
      - compliance_policies
      - deployment_policies
    enforcement_level: "blocking"
    timeout_seconds: 600

  runtime_gate:
    stage: "runtime"
    trigger: "on_request"
    policies:
      - authorization_policies
      - rate_limit_policies
    enforcement_level: "blocking"
    timeout_seconds: 5

# Suppress Mechanism
suppress_mechanism:
  enabled: true
  approval_required: true
  approval_levels:
    low_risk:
      approvers: ["team_lead"]
      max_duration_days: 30
    medium_risk:
      approvers: ["security_team", "compliance_team"]
      max_duration_days: 90
    high_risk:
      approvers: ["ciso", "cto"]
      max_duration_days: 30

  audit_requirements:
    - suppress_reason
    - business_justification
    - risk_assessment
    - mitigation_plan
    - expiry_date

  auto_expiry: true
  notification_before_expiry_days: 7

# Policy Lifecycle
policy_lifecycle:
  phases:
    explore:
      duration_days: 30
      enforcement: "audit_only"
      notification: true

    silent:
      duration_days: 60
      enforcement: "warning"
      notification: true

    adapt:
      duration_days: 90
      enforcement: "warning"
      notification: true
      block_on_critical: true

    enforce:
      enforcement: "blocking"
      notification: true

# Tool Integration
tools:
  opa:
    enabled: true
    version: "latest"
    config_path: "opa-policies/"
    bundle_mode: true

  conftest:
    enabled: true
    version: "latest"
    policy_path: "conftest/policy/"
    namespace: "main"

  checkov:
    enabled: true
    version: "latest"
    frameworks: ["terraform", "kubernetes", "dockerfile"]

  custom_validators:
    enabled: true
    path: "validators/"

# Metrics and Monitoring
metrics:
  collection_enabled: true
  export_format: ["prometheus", "json"]
  metrics:
    - name: "policy_compliance_rate"
      type: "gauge"
      description: "Percentage of policy compliance"

    - name: "policy_violation_count"
      type: "counter"
      description: "Total policy violations"

    - name: "suppress_request_rate"
      type: "gauge"
      description: "Rate of suppress requests"

    - name: "policy_execution_time"
      type: "histogram"
      description: "Policy execution duration"

# Feedback Loop
feedback_loop:
  enabled: true
  channels:
    - metrics_analysis
    - violation_patterns
    - suppress_trends

  optimization_triggers:
    - violation_threshold: 100
    - suppress_rate_threshold: 0.15
    - execution_time_threshold_ms: 1000

  auto_adjustment:
    enabled: true
    requires_approval: true

# Integration Points
integrations:
  governance_automation: "39-automation"
  audit_system: "70-audit"
  feedback_system: "80-feedback"
  contract_registry: "60-contracts"
  existing_policies: "23-policies"
