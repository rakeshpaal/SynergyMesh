# ═══════════════════════════════════════════════════════════════════════════════
#                    HLP Executor Core - Security Policy
#                    HLP 執行器核心 - 安全政策配置
# ═══════════════════════════════════════════════════════════════════════════════

policy_id: "hlp-executor-security-policy"
version: "1.0.0"
effective_date: "2025-12-07"
last_updated: "2025-12-07"
owner: "Security Team"
status: "active"

# ═══════════════════════════════════════════════════════════════════════════════
# Policy Metadata
# ═══════════════════════════════════════════════════════════════════════════════
metadata:
  description: "Security and compliance policy for HLP Executor Core Plugin"
  scope: "HLP Executor Core Plugin and related components"
  classification: "internal"
  tags:
    - "security"
    - "compliance"
    - "hlp-executor"
    - "slsa-l3"
    - "quantum-safe"

# ═══════════════════════════════════════════════════════════════════════════════
# GDPR Compliance (General Data Protection Regulation)
# ═══════════════════════════════════════════════════════════════════════════════
compliance:
  gdpr:
    enabled: true
    version: "2018"
    
    # Data retention
    data_retention:
      execution_logs: "7d"
      checkpoint_data: "7d"
      audit_logs: "90d"
      metrics_data: "30d"
      pii_data: "not_applicable"  # No PII stored
    
    # Data portability
    data_portability:
      enabled: true
      formats:
        - "JSON"
        - "CSV"
      request_processing_time: "30d"
    
    # Lawful basis for processing
    lawfulness:
      basis: "legitimate-interest"
      description: "Processing necessary for system operation and security"
      documented: true
    
    # Right to erasure
    right_to_erasure:
      enabled: true
      retention_exception: "legal_obligations"
      automated: true
    
    # Data minimization
    data_minimization:
      enabled: true
      collect_only_necessary: true
      regular_review: "quarterly"
    
    # Privacy by design
    privacy_by_design:
      enabled: true
      default_privacy_settings: "high"
      privacy_impact_assessment: "completed"

  # ═══════════════════════════════════════════════════════════════════════════════
  # SOC 2 Type II Compliance (System and Organization Controls)
  # ═══════════════════════════════════════════════════════════════════════════════
  soc2_type2:
    enabled: true
    version: "2017"
    
    # Trust Service Categories
    categories:
      - security
      - availability
      - processing_integrity
      - confidentiality
    
    # Security Controls
    security_controls:
      # Access Controls
      - name: "access-logging"
        description: "Log all access attempts"
        implemented: true
        tested: true
      
      - name: "authentication"
        description: "Multi-factor authentication required"
        implemented: true
        tested: true
      
      - name: "authorization"
        description: "Role-based access control"
        implemented: true
        tested: true
      
      - name: "encryption-at-rest"
        description: "Data encrypted at rest"
        implemented: true
        algorithm: "AES-256-GCM"
      
      - name: "encryption-in-transit"
        description: "Data encrypted in transit"
        implemented: true
        protocol: "TLS 1.3"
      
      # Monitoring Controls
      - name: "security-monitoring"
        description: "Continuous security monitoring"
        implemented: true
        tool: "prometheus"
      
      - name: "intrusion-detection"
        description: "Intrusion detection system"
        implemented: true
        type: "network-based"
      
      - name: "vulnerability-scanning"
        description: "Regular vulnerability scanning"
        implemented: true
        frequency: "weekly"
    
    # Availability Controls
    availability_controls:
      - name: "multi-az-deployment"
        description: "Deploy across multiple availability zones"
        implemented: true
        min_zones: 3
      
      - name: "automated-failover"
        description: "Automatic failover to healthy instances"
        implemented: true
        rto: "30s"
      
      - name: "backup-and-recovery"
        description: "Regular backups and recovery procedures"
        implemented: true
        frequency: "daily"
        retention: "7d"
      
      - name: "load-balancing"
        description: "Distribute load across instances"
        implemented: true
        type: "round-robin"
    
    # Audit and Compliance
    audit:
      enabled: true
      frequency: "annual"
      last_audit_date: "2025-01-01"
      next_audit_date: "2026-01-01"
      auditor: "External SOC 2 Auditor"

  # ═══════════════════════════════════════════════════════════════════════════════
  # Quantum-Safe Cryptography
  # ═══════════════════════════════════════════════════════════════════════════════
  quantum_safe:
    enabled: true
    
    # NIST Post-Quantum Cryptography Standards
    algorithms:
      # Key Encapsulation Mechanism (KEM)
      - name: "ML-KEM-768"
        type: "key-encapsulation"
        standard: "FIPS 203"
        security_level: 3
        description: "Module-Lattice-Based Key-Encapsulation Mechanism"
        use_case:
          - "key-exchange"
          - "session-establishment"
      
      # Digital Signature Algorithm (DSA)
      - name: "ML-DSA-65"
        type: "digital-signature"
        standard: "FIPS 204"
        security_level: 3
        description: "Module-Lattice-Based Digital Signature Algorithm"
        use_case:
          - "authentication"
          - "code-signing"
          - "certificate-signing"
      
      # Backup classical algorithms (for hybrid mode)
      - name: "ECDSA-P384"
        type: "digital-signature"
        standard: "FIPS 186-4"
        use_case:
          - "hybrid-signature"
      
      - name: "ECDH-P384"
        type: "key-exchange"
        standard: "NIST SP 800-56A"
        use_case:
          - "hybrid-key-exchange"
    
    # Transition Plan
    transition_plan:
      strategy: "hybrid-classical-pq"
      description: "Use both classical and post-quantum algorithms during transition"
      phases:
        - phase: 1
          name: "Assessment"
          status: "completed"
          description: "Assess cryptographic inventory"
        
        - phase: 2
          name: "Hybrid Deployment"
          status: "in-progress"
          description: "Deploy hybrid classical-PQ cryptography"
          target_date: "2025-Q4"
        
        - phase: 3
          name: "Full PQ Migration"
          status: "planned"
          description: "Migrate to pure post-quantum cryptography"
          target_date: "2026-Q2"
      
      backward_compatibility: true
      deprecation_timeline:
        rsa_2048: "2026-Q4"
        ecdsa_p256: "2027-Q2"
    
    # Implementation Details
    implementation:
      libraries:
        - name: "liboqs"
          version: "0.9.0+"
          description: "Open Quantum Safe library"
        
        - name: "boringssl"
          version: "latest"
          description: "Google's fork of OpenSSL with PQ support"
      
      key_management:
        hybrid_keys: true
        key_rotation_period: "90d"
        key_size_minimum:
          classical: 256
          post_quantum: 768
      
      certificate_management:
        hybrid_certificates: true
        ca_algorithm: "ML-DSA-65"
        leaf_algorithm: "ML-DSA-65 + ECDSA-P384"

# ═══════════════════════════════════════════════════════════════════════════════
# Additional Security Policies
# ═══════════════════════════════════════════════════════════════════════════════

# Authentication and Authorization
authentication:
  methods:
    - "mutual-tls"
    - "service-account-token"
    - "oauth2"
  
  multi_factor: true
  session_timeout: "24h"
  token_rotation: "1h"

authorization:
  model: "rbac"  # Role-Based Access Control
  
  roles:
    - name: "hlp-executor-admin"
      permissions:
        - "execute:*"
        - "rollback:*"
        - "checkpoint:*"
        - "config:write"
    
    - name: "hlp-executor-operator"
      permissions:
        - "execute:read"
        - "execute:write"
        - "rollback:read"
        - "checkpoint:read"
    
    - name: "hlp-executor-viewer"
      permissions:
        - "execute:read"
        - "rollback:read"
        - "checkpoint:read"
  
  principle_of_least_privilege: true
  regular_access_review: "quarterly"

# Network Security
network_security:
  encryption_in_transit: "required"
  protocols:
    - "TLS 1.3"
    - "mTLS"
  
  network_policies:
    enabled: true
    default_deny: true
    
    ingress_rules:
      - from: "self-healing-system"
        ports: [8080, 9090, 50051]
    
    egress_rules:
      - to: "self-healing-system"
        ports: [443, 8443]
      - to: "kube-dns"
        ports: [53]

# Data Security
data_security:
  encryption_at_rest: "required"
  algorithm: "AES-256-GCM"
  
  classification:
    - level: "public"
      handling: "no_special_handling"
    - level: "internal"
      handling: "encryption_required"
    - level: "confidential"
      handling: "encryption_required + access_logging"
    - level: "restricted"
      handling: "encryption_required + access_logging + approval_required"
  
  data_lifecycle:
    - stage: "creation"
      controls: ["classification", "encryption"]
    - stage: "storage"
      controls: ["encryption", "access_control", "backup"]
    - stage: "processing"
      controls: ["audit_logging", "access_control"]
    - stage: "disposal"
      controls: ["secure_deletion", "audit_logging"]

# Security Monitoring and Incident Response
security_monitoring:
  enabled: true
  
  monitoring_scope:
    - "authentication_events"
    - "authorization_failures"
    - "unusual_access_patterns"
    - "security_policy_violations"
    - "encryption_failures"
  
  alert_thresholds:
    failed_auth_attempts: 5
    unusual_access_pattern_score: 0.8
    policy_violation_count: 1
  
  incident_response:
    enabled: true
    response_time_target: "15m"
    escalation_path:
      - "security-team"
      - "platform-lead"
      - "ciso"
    
    automated_response:
      enabled: true
      actions:
        - "block_suspicious_ip"
        - "revoke_compromised_tokens"
        - "trigger_circuit_breaker"

# Compliance Reporting
reporting:
  enabled: true
  frequency: "monthly"
  
  reports:
    - name: "security-compliance-report"
      recipients: ["security-team", "compliance-officer"]
    - name: "audit-log-summary"
      recipients: ["security-team"]
    - name: "vulnerability-assessment"
      recipients: ["security-team", "engineering-lead"]
  
  retention: "2y"
