---
# Compliance Standards / 合規標準定義
# Extracted from: baseline-05-compliance-attestation.v1.0.yaml
# Purpose: Define supported compliance frameworks and their controls

apiVersion: governance.synergymesh.io/v1
kind: Policy
metadata:
  name: compliance-standards
  version: v1.0.0
  category: compliance-attestation
  enforcement: mandatory
  priority: 800
  description: "合規框架標準與控制要求 / Compliance framework standards and control requirements"

spec:
  version: v1.0.0

  supported_frameworks:
    soc2_type2:
      enabled: true
      version: "2017"
      description: "SOC 2 Type II - Service Organization Control 2"

      controls:
        cc6_1:
          name: "邏輯與實體存取控制 / Logical and Physical Access Controls"
          category: "Common Criteria"
          requirements:
            - "Multi-factor authentication for all privileged access"
            - "Access review performed quarterly"
            - "Automated deprovisioning within 24 hours"
            - "Role-based access control (RBAC) implemented"
            - "Principle of least privilege enforced"

          validation_frequency: "daily"

          evidence_collection:
            - "iam-audit-logs"
            - "access-review-reports"
            - "mfa-enrollment-status"
            - "rbac-role-assignments"

          automation:
            policy_engine: "OPA Gatekeeper"
            drift_detection: true
            auto_remediation: false

        cc7_2:
          name: "系統監控 / System Monitoring"
          category: "Common Criteria"
          requirements:
            - "Continuous monitoring of security events"
            - "Automated alerting for anomalies"
            - "Incident response plan documented and tested"
            - "Log retention for at least 90 days"
            - "SIEM integration for real-time analysis"

          validation_frequency: "real-time"

          evidence_collection:
            - "security-event-logs"
            - "alert-history"
            - "incident-reports"
            - "siem-integration-status"

          automation:
            monitoring_tool: "Prometheus + Grafana"
            alerting_system: "AlertManager"
            incident_tracking: "PagerDuty"

        cc7_3:
          name: "系統操作 / System Operations"
          category: "Common Criteria"
          requirements:
            - "Change management process documented"
            - "Backup and recovery procedures tested quarterly"
            - "Capacity planning and monitoring"
            - "Patch management policy enforced"

          validation_frequency: "weekly"

          evidence_collection:
            - "change-management-logs"
            - "backup-test-reports"
            - "capacity-metrics"
            - "patch-compliance-reports"

      audit_requirements:
        retention_years: 7
        annual_assessment: true
        penetration_testing: "quarterly"
        vulnerability_scanning: "weekly"
        external_auditor_required: true

    gdpr:
      enabled: true
      version: "2018/679"
      description: "General Data Protection Regulation"

      principles:
        data_minimization:
          description: "僅收集必要資料 / Collect only necessary data"

          controls:
            - "PII identification and classification"
            - "Data retention policies enforced"
            - "Automated data purging after retention period"
            - "Data inventory maintained"

          validation:
            data_discovery_tool: "automated-pii-scanner"
            classification_labels: true
            retention_automation: true

        purpose_limitation:
          description: "資料使用限於宣告目的 / Data used only for stated purposes"

          controls:
            - "Consent management system implemented"
            - "Purpose tags on all data stores"
            - "Access control based on purpose"
            - "Audit trail for data usage"

          validation:
            consent_records: true
            purpose_based_access: true

        data_subject_rights:
          description: "資料主體權利 / Data subject rights"

          controls:
            - "Right to access automated process"
            - "Right to erasure implemented"
            - "Data portability enabled"
            - "Right to rectification process"

          validation:
            self_service_portal: true
            response_time_sla: "30-days"
            deletion_verification: true

      breach_notification:
        authority_notification_hours: 72
        data_subject_notification_required: true
        documentation_required: true
        notification_template: "gdpr-breach-notification.yaml"
        incident_severity_assessment: true

      data_protection_officer:
        required: true
        contact: "dpo@example.com"
        responsibilities:
          - "Monitor GDPR compliance"
          - "Conduct DPIAs"
          - "Cooperate with supervisory authorities"

    pci_dss:
      enabled: true
      version: "4.0"
      description: "Payment Card Industry Data Security Standard"

      requirements:
        requirement_1:
          name: "安裝與維護網路安全控制 / Install and Maintain Network Security Controls"
          sub_requirements:
            - id: "1.2.1"
              description: "Network segmentation implemented"
              controls:
                - "Microsegmentation with NetworkPolicies"
                - "DMZ zone for cardholder data"
                - "Firewall rules documented"
            - id: "1.3.1"
              description: "Ingress/egress traffic restrictions"
              controls:
                - "Default deny all policy"
                - "Explicit allow rules only"
                - "Traffic monitoring enabled"

        requirement_3:
          name: "保護儲存的帳戶資料 / Protect Stored Account Data"
          sub_requirements:
            - id: "3.5.1"
              description: "Encryption of cardholder data at rest"
              controls:
                - "AES-256-GCM encryption"
                - "Key rotation every 90 days"
                - "Hardware Security Module (HSM) for key storage"
            - id: "3.6.1"
              description: "Cryptographic key management"
              controls:
                - "Key generation documented"
                - "Key distribution secured"
                - "Key retirement process"

        requirement_10:
          name: "記錄並監控所有存取 / Log and Monitor All Access"
          sub_requirements:
            - id: "10.2.1"
              description: "Audit trail for all access to cardholder data"
              controls:
                - "Kubernetes audit logs enabled"
                - "Application-level logging"
                - "Immutable log storage"

      quarterly_scan: true
      annual_assessment: true
      penetration_testing_frequency: "annual"
      qsa_required: true

    iso27001:
      enabled: true
      version: "2022"
      description: "Information Security Management System"

      annex_a_controls:
        a5_organizational:
          - "A.5.1: Information security policies"
          - "A.5.8: Information security in project management"

        a8_asset_management:
          - "A.8.1: Responsibility for assets"
          - "A.8.2: Information classification"
          - "A.8.3: Media handling"

        a12_operations_security:
          - "A.12.1: Operational procedures"
          - "A.12.4: Logging and monitoring"
          - "A.12.6: Technical vulnerability management"

      isms_scope: "All Kubernetes clusters and workloads"
      certification_body: "ISO Accredited Certifier"
      surveillance_audit_frequency: "annual"

    hipaa:
      enabled: false
      reason: "Healthcare data not processed"
      future_consideration: true

  policy_as_code_integration:
    enabled: true
    engines:
      - name: "OPA Gatekeeper"
        version: "v3.14.0"
        policies: "governance/01-architecture/policies/conftest/"
      - name: "Kyverno"
        version: "v1.11.0"
        policies: "infrastructure/kubernetes/kyverno-policies/"

    validation_mode: "enforce"
    audit_mode: true

  attestation_generation:
    enabled: true
    frequency: "every-6-hours"
    providers:
      - "cosign"
      - "in-toto"
      - "slsa-provenance"
    storage: "s3://compliance-evidence-bucket/attestations/"

  evidence_collection:
    audit_logs_retention_days: 2555 # 7 years
    configuration_snapshots: "hourly"
    security_scans: "daily"
    access_reviews: "quarterly"
    storage_location: "s3://compliance-evidence-bucket/"
    encryption: "AES-256-GCM"
    immutable_storage: true

  reporting:
    compliance_dashboard: true
    dashboard_url: "https://compliance.example.com/dashboard"
    automated_reports:
      - type: "SOC2"
        frequency: "monthly"
        recipients: ["compliance-team@example.com"]
      - type: "GDPR"
        frequency: "quarterly"
        recipients: ["dpo@example.com", "legal@example.com"]
      - type: "PCI-DSS"
        frequency: "quarterly"
        recipients: ["security-team@example.com"]

  related_policies:
    - audit-policy
    - rbac-role-matrix
    - pod-security-standards
    - network-segmentation-policy

  references:
    - description: "SOC 2 Trust Services Criteria"
      url: "https://www.aicpa.org/soc2"
    - description: "GDPR Official Text"
      url: "https://gdpr-info.eu/"
    - description: "PCI DSS v4.0"
      url: "https://www.pcisecuritystandards.org/"
    - description: "ISO/IEC 27001:2022"
      url: "https://www.iso.org/standard/27001"
