apiVersion: constraints.gatekeeper.sh/v1beta1
kind: K8sNamingPattern
metadata:
  name: enforce-canonical-naming
  annotations:
    description: "Enforce canonical naming pattern on resources"
spec:
  enforcementAction: deny
  match:
    kinds:
      - apiGroups: [""]
        kinds: ["Namespace", "Service"]
      - apiGroups: ["apps"]
        kinds: ["Deployment", "StatefulSet"]
    excludedNamespaces:
      - kube-system
      - kube-public
      - kube-node-lease
      - gatekeeper-system
      - default
  parameters:
    pattern: "^(?!.*--)(team|tenant|dev|test|staging|prod|learn|sandbox)-[a-z0-9]+(?:-[a-z0-9]+)*$"
    maxLength: 63
    message: "Resource name must follow canonical naming pattern: {env}-{component}-{suffix}, lowercase alphanumeric with hyphens, no consecutive hyphens, max 63 chars. See governance/29-docs/canonical-naming-governance-report.md"
