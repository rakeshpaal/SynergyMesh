# ═══════════════════════════════════════════════════════════════════════════════
#                    Behavior Contract: island_ai
#                    行為契約：島嶼 AI 多代理系統
# ═══════════════════════════════════════════════════════════════════════════════
#
# Purpose: Define expected behaviors for multi-agent AI orchestration system
# 用途: 定義多代理 AI 編排系統的預期行為
#
# Version: 1.0.0
# Owner: @ai-research-team
# Last Updated: 2025-12-07
# Status: Experimental
# ═══════════════════════════════════════════════════════════════════════════════

contract:
  module: "island_ai"
  version: "1.0.0"
  status: "experimental"
  owner: "@ai-research-team"

  description: |
    Island AI provides multi-agent AI orchestration with self-learning governance,
    agent collaboration, and autonomous decision-making capabilities.

    島嶼 AI 提供多代理 AI 編排，具有自學習治理、代理協作和自主決策能力。

  experimental_note: |
    This module is experimental and under active development.
    APIs and behaviors may change without notice.
    Not recommended for production use until promoted to active status.

# ============================================================================
# API Contracts | API 契約
# ============================================================================

api:
  base_path: "/api/v1/island-ai"

  endpoints:
    # ─────────────────────────────────────────────────────────────────────────
    # Agent Orchestration
    # ─────────────────────────────────────────────────────────────────────────
    - name: "Create Agent Team"
      method: POST
      path: "/teams"

      description: |
        Create multi-agent team for collaborative task execution.
        創建多代理團隊以進行協作任務執行。

      input_schema:
        type: "object"
        required: ["task", "agent_roles"]
        properties:
          task: { type: "string" }
          agent_roles: { type: "array" }
          collaboration_mode: { type: "string", enum: ["sequential", "parallel", "hierarchical"] }
          constraints: { type: "object" }

      output_schema:
        type: "object"
        properties:
          team_id: { type: "string" }
          agents: { type: "array" }
          collaboration_plan: { type: "object" }

      guarantees:
        - "Agent roles validated"
        - "Collaboration plan generated"
        - "Resource allocation performed"

      experimental_note: "API may change as we refine multi-agent coordination"

      performance:
        response_time_p50: "< 500ms"
        response_time_p99: "< 2s"

    # ─────────────────────────────────────────────────────────────────────────
    # Task Delegation
    # ─────────────────────────────────────────────────────────────────────────
    - name: "Delegate Task"
      method: POST
      path: "/teams/{team_id}/delegate"

      description: "Delegate task to agent team"

      input_schema:
        type: "object"
        required: ["task_description"]
        properties:
          task_description: { type: "string" }
          priority: { type: "string" }
          deadline: { type: "string", format: "date-time" }

      output_schema:
        type: "object"
        properties:
          delegation_id: { type: "string" }
          assigned_agents: { type: "array" }
          execution_plan: { type: "object" }

      guarantees:
        - "Task decomposed appropriately"
        - "Agents selected based on capabilities"

    # ─────────────────────────────────────────────────────────────────────────
    # Self-Learning Governance
    # ─────────────────────────────────────────────────────────────────────────
    - name: "Update Governance Rules"
      method: POST
      path: "/governance/learn"

      description: |
        Self-learning governance rule updates based on outcomes.
        基於結果的自學習治理規則更新。

      input_schema:
        type: "object"
        required: ["rule_type", "feedback"]
        properties:
          rule_type: { type: "string" }
          feedback:
            type: "object"
            properties:
              outcome: { type: "string" }
              effectiveness: { type: "number" }

      output_schema:
        type: "object"
        properties:
          rule_id: { type: "string" }
          updated: { type: "boolean" }
          new_version: { type: "string" }

      guarantees:
        - "Rule changes logged"
        - "Rollback available"
        - "Human approval required for critical rules"

      experimental_note: "Self-learning feature under active research"

    # ─────────────────────────────────────────────────────────────────────────
    # Agent Communication
    # ─────────────────────────────────────────────────────────────────────────
    - name: "Agent Message"
      method: POST
      path: "/teams/{team_id}/messages"

      description: "Facilitate inter-agent communication"

      input_schema:
        type: "object"
        required: ["from_agent", "to_agent", "message"]
        properties:
          from_agent: { type: "string" }
          to_agent: { type: "string" }
          message: { type: "object" }
          message_type: { type: "string" }

      output_schema:
        type: "object"
        properties:
          message_id: { type: "string" }
          delivered: { type: "boolean" }
          response_expected: { type: "boolean" }

      guarantees:
        - "Message delivery tracked"
        - "Communication logged"

# ============================================================================
# Event Contracts | 事件契約
# ============================================================================

events:
  - name: "island_ai.team_created"
    description: "Emitted when agent team is created"

    payload_schema:
      type: "object"
      properties:
        team_id: { type: "string" }
        agent_count: { type: "integer" }
        collaboration_mode: { type: "string" }
        timestamp: { type: "string", format: "date-time" }

    delivery_guarantee: "at-least-once"
    retention: "30 days"

    consumers:
      - "automation.monitoring"

  - name: "island_ai.governance_rule_learned"
    description: "Emitted when new governance rule is learned"

    payload_schema:
      type: "object"
      properties:
        rule_id: { type: "string" }
        rule_type: { type: "string" }
        effectiveness_score: { type: "number" }
        requires_approval: { type: "boolean" }
        timestamp: { type: "string", format: "date-time" }

    delivery_guarantee: "at-least-once"
    retention: "180 days"

    consumers:
      - "services.audit"
      - "ops.ml_ops"

  - name: "island_ai.task_completed"
    description: "Emitted when agent team completes task"

    payload_schema:
      type: "object"
      properties:
        team_id: { type: "string" }
        delegation_id: { type: "string" }
        duration_seconds: { type: "number" }
        success: { type: "boolean" }
        timestamp: { type: "string", format: "date-time" }

    delivery_guarantee: "at-least-once"
    retention: "90 days"

# ============================================================================
# Invariants | 不變條件
# ============================================================================

invariants:
  - name: "Human Oversight Required"
    description: "Critical decisions require human approval"
    rule: "forall critical_decision: requires_human_approval(decision)"
    enforcement: "application-logic"

  - name: "Agent Capability Matching"
    description: "Tasks assigned to capable agents"
    rule: "forall assignment: agent_can_perform(assignment.agent, assignment.task)"
    enforcement: "pre-condition"

  - name: "Learning Boundary"
    description: "Self-learning within defined boundaries"
    rule: "forall learning: within_boundaries(learning, governance_limits)"
    enforcement: "validation"
    notes:
      - "Multi-agent coordination protocols under development"
      - "Self-learning governance rules being validated"

# ============================================================================
# Failure Modes | 失敗模式
# ============================================================================

failure_modes:
  - scenario: "Agent Coordination Failure"
    triggers:
      - "Agent communication breakdown"
      - "Deadlock in collaboration"
    recovery:
      - "Reset team state"
      - "Reassign tasks"
      - "Alert human operator"
    error_code: "ERR_COORDINATION_FAILED"

  - scenario: "Learning Rule Conflict"
    triggers:
      - "New rule conflicts with existing"
      - "Rule effectiveness below threshold"
    recovery:
      - "Reject rule update"
      - "Request human review"
      - "Log for analysis"
    error_code: "ERR_RULE_CONFLICT"
    notes:
      - "Novel failure patterns may emerge during experimentation"
      - "Active monitoring and human oversight required"

# ============================================================================
# Dependencies | 依賴關係
# ============================================================================

dependencies:
  required:
    - module: "core.mind_matrix"
      purpose: "AI decision making"
      failure_mode: "critical"

    - module: "core.safety_mechanisms"
      purpose: "Safety validation"
      failure_mode: "critical"

  optional:
    - module: "automation.intelligent"
      purpose: "Workflow integration"
      failure_mode: "graceful-degradation"

# ============================================================================
# Experimental Features | 實驗功能
# ============================================================================

experimental_features:
  multi_agent_orchestration:
    status: "active_research"
    stability: "unstable"
    breaking_changes_expected: true

  self_learning_governance:
    status: "proof_of_concept"
    stability: "highly_unstable"
    human_oversight_required: true
    breaking_changes_expected: true

# ============================================================================
# Promotion Criteria | 晉升標準
# ============================================================================

promotion_to_active:
  required_metrics:
    test_coverage: "> 80%"
    performance_benchmarks: "met"
    security_audit: "completed"
    documentation: "comprehensive"

  required_validation:
    - "Multi-agent coordination proven stable"
    - "Self-learning governance validated safe"
    - "Production pilot successful"
    - "User acceptance testing passed"

# ============================================================================
# Monitoring & Observability | 監控與可觀測性
# ============================================================================

observability:
  metrics:
    - name: "island_ai_teams_active"
      type: "gauge"
    - name: "island_ai_tasks_total"
      type: "counter"
      labels: ["status", "team_size"]
    - name: "island_ai_coordination_failures"
      type: "counter"
    - name: "island_ai_learning_rules_total"
      type: "counter"
      labels: ["approved", "rejected"]

  alerts:
    - condition: "island_ai_coordination_failures > 10/hour"
      severity: "high"
    - condition: "island_ai_learning_rules_rejected > 50%"
      severity: "warning"

  experimental_monitoring:
    enhanced_logging: true
    full_trace_capture: true
    human_review_dashboard: true

# ============================================================================
# References | 參考
# ============================================================================

references:
  ownership_map: "governance/34-config/ownership-map.yaml#island_ai"
  architecture_governance_matrix: "governance/29-docs/ARCHITECTURE_GOVERNANCE_MATRIX.md"
  experimental_guidelines: "docs/experimental-features.md"
