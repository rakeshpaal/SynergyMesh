# ğŸ›ï¸ MachineNativeOps Root Layer Architecture

## ğŸ“‹ æ¶æ§‹æ¦‚è¿°

æœ¬å°ˆæ¡ˆæ¡ç”¨ **FHS (Filesystem Hierarchy Standard)** æ¨™æº–çš„æ ¹å±¤æ¶æ§‹ï¼Œå°‡æ²»ç†é…ç½®æå‡åˆ°æ ¹å±¤ï¼Œä½¿å…¶æˆç‚ºç³»çµ±çš„**å”¯ä¸€äº‹å¯¦ä¾†æº**ã€‚

---

## ğŸ—‚ï¸ æ ¹å±¤ç›®éŒ„çµæ§‹

### æ²»ç†é…ç½®æª”æ¡ˆï¼ˆæ ¹å±¤ï¼‰

```
MachineNativeOps/
â”œâ”€â”€ root.config.yaml              # å…¨åŸŸåŸºæœ¬é…ç½®
â”œâ”€â”€ root.governance.yaml          # æ²»ç†/æ¬Šé™/ç­–ç•¥é…ç½®
â”œâ”€â”€ root.modules.yaml             # æ¨¡çµ„è¨»å†Šç®¡ç†èˆ‡ç›¸ä¾
â”œâ”€â”€ root.super-execution.yaml     # è¶…ç´šåŸ·è¡Œ/æµç¨‹å®šç¾©
â”œâ”€â”€ root.trust.yaml               # ä¿¡ä»»/æ†‘è­‰/å®‰å…¨é…ç½®
â”œâ”€â”€ root.provenance.yaml          # ä¾†æºè¿½æº¯èˆ‡å…ƒè³‡æ–™
â”œâ”€â”€ root.integrity.yaml           # æ•´é«”æ€§é©—è­‰è¦å‰‡
â”œâ”€â”€ root.bootstrap.yaml           # é–‹æ©Ÿèˆ‡åˆå§‹åŒ–è¨­å®š
â”œâ”€â”€ root.devices.map              # è£ç½®æª”æ¡ˆå°æ‡‰è¡¨
â”œâ”€â”€ root.fs.map                   # ç³»çµ±å±¤ç´šç›®éŒ„æ˜ å°„
â”œâ”€â”€ root.kernel.map               # æ ¸å¿ƒæ¨¡çµ„/å‡½å¼åº«å°æ‡‰
â”œâ”€â”€ root.env.sh                   # Root ä½¿ç”¨è€…æ®¼å±¤ç’°å¢ƒ
â””â”€â”€ root.naming-policy.yaml       # å‘½åè¦ç¯„æ”¿ç­–
```

### æ¨™æº– FHS ç›®éŒ„

```
â”œâ”€â”€ bin/                          # åŸºæœ¬ç”¨æˆ¶å‘½ä»¤äºŒé€²åˆ¶æª”æ¡ˆ
â”œâ”€â”€ sbin/                         # ç³»çµ±ç®¡ç†äºŒé€²åˆ¶æª”æ¡ˆ
â”œâ”€â”€ etc/                          # ç³»çµ±é…ç½®æª”æ¡ˆ
â”œâ”€â”€ lib/                          # å…±äº«å‡½å¼åº«
â”œâ”€â”€ var/                          # è®Šå‹•è³‡æ–™ (log, tmp, cache)
â”œâ”€â”€ usr/                          # ç”¨æˆ¶ç¨‹å¼ (bin, sbin, lib, share)
â”œâ”€â”€ home/                         # ç”¨æˆ¶ä¸»ç›®éŒ„
â”œâ”€â”€ tmp/                          # è‡¨æ™‚æª”æ¡ˆ
â”œâ”€â”€ opt/                          # å¯é¸æ‡‰ç”¨ç¨‹å¼
â”œâ”€â”€ srv/                          # æœå‹™è³‡æ–™
â””â”€â”€ init.d/                       # åˆå§‹åŒ–è…³æœ¬
```

### å°ˆæ¡ˆç‰¹å®šç›®éŒ„ï¼ˆä¿æŒä¸è®Šï¼‰

```
â”œâ”€â”€ src/                          # åŸå§‹ç¢¼
â”œâ”€â”€ tests/                        # æ¸¬è©¦
â”œâ”€â”€ docs/                         # æ–‡æª”
â”œâ”€â”€ config/                       # æ‡‰ç”¨é…ç½®
â”œâ”€â”€ scripts/                      # è…³æœ¬
â”œâ”€â”€ tools/                        # å·¥å…·
â”œâ”€â”€ examples/                     # ç¯„ä¾‹
â”œâ”€â”€ deploy/                       # éƒ¨ç½²
â”œâ”€â”€ ops/                          # é‹ç¶­
â”œâ”€â”€ governance/                   # æ²»ç†
â””â”€â”€ archive/                      # æ­¸æª”
```

---

## ğŸ¯ è¨­è¨ˆåŸå‰‡

### 1. å–®ä¸€äº‹å¯¦ä¾†æºï¼ˆSingle Source of Truthï¼‰

- æ‰€æœ‰æ²»ç†é…ç½®åœ¨æ ¹å±¤ï¼Œä¸åˆ†æ•£åœ¨å­ç›®éŒ„
- `root.*` æª”æ¡ˆæ˜¯ç³»çµ±é…ç½®çš„æ¬Šå¨ä¾†æº
- é¿å…é…ç½®é‡è¤‡å’Œä¸ä¸€è‡´

### 2. FHS æ¨™æº–éµå¾ª

- éµå¾ª Filesystem Hierarchy Standard 3.0
- æ¨™æº–ç›®éŒ„çµæ§‹æ˜“æ–¼ç†è§£å’Œç¶­è­·
- èˆ‡ Unix/Linux ç³»çµ±æ…£ä¾‹ä¸€è‡´

### 3. æ¸…æ™°çš„è·è²¬åˆ†é›¢

- **æ ¹å±¤é…ç½®**: ç³»çµ±ç´šæ²»ç†å’Œé…ç½®
- **FHS ç›®éŒ„**: é‹è¡Œæ™‚è³‡æ–™å’Œç¨‹å¼
- **å°ˆæ¡ˆç›®éŒ„**: æ‡‰ç”¨ç¨‹å¼ç¢¼å’Œè³‡æº

### 4. å¯è¦‹æ€§å„ªå…ˆ

- æ²»ç†é…ç½®åœ¨æ ¹å±¤ç›´æ¥å¯è¦‹
- ä¸ä½¿ç”¨éš±è—æª”æ¡ˆï¼ˆç„¡ `.` å‰ç¶´ï¼‰
- è¡Œå‹•è£ç½®å‹å–„

---

## âš¡ æ ¹å±¤å»ºç½®æ­¥é©Ÿï¼ˆåƒ…è™•ç† Root Layerï¼Œå…¶ä»–ç›®éŒ„å¾ŒçºŒæ•´åˆï¼‰

> ä¾æ“šç¾æœ‰ `root.*` SSOTã€FHS æ˜ å°„èˆ‡æœ€å°åŒ–é–‹æ©Ÿæµç¨‹ï¼Œå…ˆå®Œæˆæ ¹å±¤è½åœ°ï¼Œå†éŠœæ¥å…¶ä»–ç›®éŒ„ã€‚

1) **æ²»ç† SSOT å°±ç·’**  

   - æ ¸å°é ‚å±¤æª”æ¡ˆï¼š`root.config.yaml`ã€`root.governance.yaml`ã€`root.modules.yaml`ã€`root.trust.yaml`ã€`root.provenance.yaml`ã€`root.integrity.yaml`ã€‚  
   - ç¢ºèªç™»éŒ„æª”ï¼š`root.registry.modules.yaml`ã€`root.registry.urns.yaml` èˆ‡ `gates.map.yaml`ã€‚  
   - åŸ·è¡Œé©—è­‰ï¼š`python scripts/validation/validate-root-specs.py`ï¼ˆè¼¸å‡º `root-specs-validation-report.md`ï¼Œç”¨æ–¼ä¿®æ­£å‘½å/éµå/URN æ¼‚ç§»ï¼‰ã€‚

2) **ä½ˆå»º FHS éª¨æ¶**  

   - ä¾ `root.fs.map` å»ºç«‹æ ¸å¿ƒç›®éŒ„çµ„ï¼š`/bin /sbin /etc /lib /var /usr /opt /srv /tmp /home /etc/init.d`ã€‚  
   - éƒ¨ç½²å¹³å°ç›®éŒ„ï¼š`/opt/machinenativenops` ä¸‹çš„ `bin/ sbin/ lib/ modules/ share/`ã€`/etc/machinenativenops`ã€`/var/{log,lib,cache}/machinenativenops`ï¼Œæ¬Šé™éµå¾ª map ä¸­çš„ permissions æ¬„ä½èˆ‡ `[admin_permissions]`ã€`[service_permissions]` ç­‰ç¯„æœ¬ã€‚  
   - å®‰å…¨å„ªå…ˆï¼šå…ˆå»ºç«‹ `mno_trust_root`ã€`mno_trust_certs`ã€`mno_trust_keys`ã€`mno_trust_crl`ã€`mno_trust_ocsp`ã€`mno_trust_bundles`ï¼ˆä¾ `root.fs.map` åˆ—ç¤ºï¼‰ç­‰å—é™ç›®éŒ„ï¼Œä»¥åŠ `mno_security`ã€`mno_secrets`ï¼Œå¥—ç”¨ 700 æ¬Šé™èˆ‡ root æ“æœ‰è€…ã€‚

3) **å•Ÿå‹•æœ€å°åŒ–é–‹æ©Ÿæµç¨‹**  

   - ä½¿ç”¨ `root.bootstrap.minimal.yaml` çš„ 5 æ­¥åºåˆ—ï¼š`validate_root_integrity` â†’ `load_governance_framework` â†’ `load_module_registry` â†’ `initialize_trust_chain` â†’ `finalize_and_emit_provenance`ã€‚  
   - è¼¸å…¥ä¾†æºä¿æŒä¸€è‡´ï¼šæ²»ç†è®€ `root.governance.yaml`ï¼Œæ¨¡çµ„è®€ `root.modules.yaml` + `root.registry.modules.yaml`ï¼Œä¿¡ä»»è®€ `root.trust.yaml`ï¼Œè­‰è·¡è¼¸å‡ºåˆ° `var/audit/`ï¼ˆå¦‚ `root-validate-report.json`ã€`bootstrap-provenance.json`ï¼‰ã€‚  
   - è‹¥éœ€è¦å®Œæ•´æ¨¡å¼ï¼Œåˆ‡æ›è‡³ `root.bootstrap.yaml`ï¼Œä½†ä»æ²¿ç”¨ä¸Šè¿°é©—è­‰èˆ‡ç›®éŒ„éª¨æ¶ã€‚

4) **å®Œæˆæª¢æ ¸èˆ‡å¯è§€æ¸¬æ€§**  

   - ä¾ `root.bootstrap.yaml` çš„ `bootstrap_completion_verification` åŸ·è¡Œå¥åº·æª¢æŸ¥èˆ‡å®‰å…¨æ…‹å‹¢ç¢ºèªã€‚  
   - ç”¢å‡ºå°±ç·’è¨Šè™Ÿï¼ˆå¦‚ `var/run/platform.ready`ï¼‰èˆ‡æ—¥èªŒ/è­‰è·¡ï¼Œå°æ‡‰ `root.provenance.yaml` çš„æ”¶é›†è¦æ±‚ï¼Œç¢ºä¿å¾ŒçºŒå­ç›®éŒ„æ•´åˆæœ‰å¯è¿½æº¯æ†‘è­‰ã€‚

---

## ğŸ“Š ç›®éŒ„ç”¨é€”èªªæ˜

### æ²»ç†å±¤ï¼ˆRoot Layerï¼‰

#### é…ç½®æª”æ¡ˆ

- **root.config.yaml**: å…¨åŸŸç³»çµ±é…ç½®ï¼Œå®šç¾©æ ¸å¿ƒåƒæ•¸
- **root.governance.yaml**: RBAC è§’è‰²ã€ç­–ç•¥ã€å¯©æ ¸è¦å‰‡
- **root.modules.yaml**: æ¨¡çµ„è¨»å†Šã€ä¾è³´é—œä¿‚ã€è¼‰å…¥é †åº
- **root.super-execution.yaml**: ç³»çµ±å¼•å°æµç¨‹ã€å®‰å…¨éŸ¿æ‡‰
- **root.trust.yaml**: ä¿¡ä»»éˆã€è­‰æ›¸ç®¡ç†ã€å®‰å…¨é…ç½®
- **root.provenance.yaml**: å¯©è¨ˆè»Œè·¡ã€ä¾†æºè¿½æº¯ã€å…ƒè³‡æ–™
- **root.integrity.yaml**: é›œæ¹Šé–å®šã€åç§»æª¢æ¸¬ã€å®Œæ•´æ€§é©—è­‰
- **root.bootstrap.yaml**: 5 éšæ®µåˆå§‹åŒ–è¨­å®š

#### æ˜ å°„æª”æ¡ˆ

- **root.devices.map**: 200+ è¨­å‚™æ˜ å°„å®šç¾©
- **root.fs.map**: å®Œæ•´ç›®éŒ„çµæ§‹æ˜ å°„
- **root.kernel.map**: æ ¸å¿ƒæ¨¡çµ„èˆ‡å‡½å¼åº«å°æ‡‰

#### è…³æœ¬èˆ‡æ”¿ç­–

- **root.env.sh**: Shell ç’°å¢ƒè®Šæ•¸ã€åˆ¥åã€å‡½æ•¸
- **root.naming-policy.yaml**: å‘½åè¦ç¯„èˆ‡é©—è­‰è¦å‰‡

### ç³»çµ±å±¤ï¼ˆFHS Directoriesï¼‰

#### /bin - åŸºæœ¬å‘½ä»¤

- æ‰€æœ‰ç”¨æˆ¶å¯ç”¨çš„åŸºæœ¬å‘½ä»¤
- ç³»çµ±å•Ÿå‹•å¿…éœ€çš„ç¨‹å¼
- Shellã€æª”æ¡ˆæ“ä½œã€æ–‡æœ¬è™•ç†

#### /sbin - ç³»çµ±ç®¡ç†

- éœ€è¦ root æ¬Šé™çš„å·¥å…·
- ç³»çµ±åˆå§‹åŒ–ã€ä¿®å¾©ã€æ¢å¾©
- ç¶²è·¯é…ç½®å’Œç®¡ç†

#### /etc - é…ç½®æª”æ¡ˆ

- ç³»çµ±ç¯„åœçš„é…ç½®
- æ‡‰ç”¨ç¨‹å¼é…ç½®
- æœå‹™å•Ÿå‹•è…³æœ¬

#### /lib - å…±äº«å‡½å¼åº«

- ç³»çµ±å•Ÿå‹•æ‰€éœ€çš„å‡½å¼åº«
- æ ¸å¿ƒæ¨¡çµ„
- å‹•æ…‹é€£çµå‡½å¼åº«

#### /var - è®Šå‹•è³‡æ–™

- æ—¥èªŒæª”æ¡ˆ (/var/log)
- è‡¨æ™‚æª”æ¡ˆ (/var/tmp)
- å¿«å–è³‡æ–™ (/var/cache)
- æ‡‰ç”¨ç‹€æ…‹ (/var/lib)

#### /usr - ç”¨æˆ¶ç¨‹å¼

- ç”¨æˆ¶å‘½ä»¤ (/usr/bin)
- ç³»çµ±ç®¡ç†å‘½ä»¤ (/usr/sbin)
- å‡½å¼åº« (/usr/lib)
- å…±äº«è³‡æ–™ (/usr/share)
- æœ¬åœ°è»Ÿé«” (/usr/local)

#### /home - ç”¨æˆ¶ç›®éŒ„

- ç”¨æˆ¶å€‹äººæª”æ¡ˆ
- ç”¨æˆ¶é…ç½®
- ç”¨æˆ¶å°ˆæ¡ˆ

#### /tmp - è‡¨æ™‚æª”æ¡ˆ

- æ‡‰ç”¨ç¨‹å¼è‡¨æ™‚æª”æ¡ˆ
- é‡å•Ÿå¾Œå¯èƒ½æ¸…ç©º
- æ‰€æœ‰ç”¨æˆ¶å¯å¯«

#### /opt - å¯é¸è»Ÿé«”

- ç¬¬ä¸‰æ–¹è»Ÿé«”
- å•†æ¥­è»Ÿé«”
- å¤§å‹æ‡‰ç”¨å¥—ä»¶

#### /srv - æœå‹™è³‡æ–™

- Web ä¼ºæœå™¨è³‡æ–™
- FTP è³‡æ–™
- Git å„²å­˜åº«

#### /init.d - åˆå§‹åŒ–è…³æœ¬

- 15 å€‹ç³»çµ±åˆå§‹åŒ–è…³æœ¬
- æŒ‰é †åºåŸ·è¡Œ (00-99)
- ç³»çµ±å•Ÿå‹•å’Œé…ç½®

---

## ğŸ”„ é·ç§»èªªæ˜

### å¾èˆŠæ¶æ§‹é·ç§»

**Before (èˆŠæ¶æ§‹):**

```
MachineNativeOps/
â”œâ”€â”€ root/
â”‚   â”œâ”€â”€ root.config.yaml
â”‚   â”œâ”€â”€ root.governance.yaml
â”‚   â””â”€â”€ ...
â””â”€â”€ [å…¶ä»–ç›®éŒ„]
```

**After (æ–°æ¶æ§‹):**

```
MachineNativeOps/
â”œâ”€â”€ root.config.yaml          # æå‡åˆ°æ ¹å±¤
â”œâ”€â”€ root.governance.yaml      # æå‡åˆ°æ ¹å±¤
â”œâ”€â”€ bin/                      # æ–°å¢ FHS ç›®éŒ„
â”œâ”€â”€ sbin/                     # æ–°å¢ FHS ç›®éŒ„
â”œâ”€â”€ etc/                      # æ–°å¢ FHS ç›®éŒ„
â””â”€â”€ [å…¶ä»–ç›®éŒ„ä¿æŒä¸è®Š]
```

### è®Šæ›´å…§å®¹

1. âœ… æ‰€æœ‰ `root/*` æª”æ¡ˆæå‡åˆ°æ ¹å±¤
2. âœ… å»ºç«‹æ¨™æº– FHS ç›®éŒ„çµæ§‹
3. âœ… æ²»ç†æ–‡æª”ç§»è‡³ `docs/governance/`
4. âœ… æ­·å²æ–‡æª”æ­¸æª”è‡³ `archive/legacy-root-files/`

---

## ğŸ“± è¡Œå‹•è£ç½®å‹å–„æ€§

### å„ªå‹¢

- âœ… æ²»ç†é…ç½®åœ¨æ ¹å±¤ç›´æ¥å¯è¦‹
- âœ… ç„¡éœ€ `ls -a` æŸ¥çœ‹éš±è—æª”æ¡ˆ
- âœ… ç›®éŒ„çµæ§‹æ¸…æ™°æ˜“æ‡‚
- âœ… å¿«é€Ÿå®šä½é—œéµé…ç½®

### é©—è­‰æµç¨‹

1. æ‰“é–‹ repo æ ¹ç›®éŒ„
2. ç›´æ¥çœ‹åˆ°æ‰€æœ‰ `root.*` é…ç½®
3. é»æ“Šæª”æ¡ˆå³å¯æŸ¥çœ‹å…§å®¹
4. æ¨™æº–ç›®éŒ„çµæ§‹æ˜“æ–¼å°èˆª

---

## ğŸ” é…ç½®æŸ¥æ‰¾æŒ‡å—

### å¿«é€ŸæŸ¥æ‰¾

- **ç³»çµ±é…ç½®**: `root.config.yaml`
- **æ¬Šé™ç®¡ç†**: `root.governance.yaml`
- **æ¨¡çµ„ç®¡ç†**: `root.modules.yaml`
- **å®‰å…¨é…ç½®**: `root.trust.yaml`
- **åˆå§‹åŒ–**: `init.d/` ç›®éŒ„

### æ–‡æª”ä½ç½®

- **æ²»ç†æ–‡æª”**: `docs/governance/`
- **API æ–‡æª”**: `docs/api/`
- **æ¶æ§‹æ–‡æª”**: `docs/architecture/`
- **å¯¦æ–½æŒ‡å—**: `IMPLEMENTATION_GUIDE.md`

---

## ğŸš€ ç³»çµ±å•Ÿå‹•æµç¨‹

### åˆå§‹åŒ–é †åº

1. **00-init.sh**: ç³»çµ±åŸºç¤åˆå§‹åŒ–
2. **01-governance-init.sh**: æ²»ç†ç³»çµ±åˆå§‹åŒ–
3. **02-modules-init.sh**: æ¨¡çµ„ç³»çµ±åˆå§‹åŒ–
4. **03-super-execution-init.sh**: è¶…ç´šåŸ·è¡Œåˆå§‹åŒ–
5. **04-trust-init.sh**: ä¿¡ä»»ç³»çµ±åˆå§‹åŒ–
6. **05-provenance-init.sh**: è¿½æº¯ç³»çµ±åˆå§‹åŒ–
7. **06-database-init.sh**: è³‡æ–™åº«åˆå§‹åŒ–
8. **07-config-init.sh**: é…ç½®ç³»çµ±åˆå§‹åŒ–
9. **08-dependencies-init.sh**: ä¾è³´ç®¡ç†åˆå§‹åŒ–
10. **09-logging-init.sh**: æ—¥èªŒç³»çµ±åˆå§‹åŒ–
11. **10-security-init.sh**: å®‰å…¨ç³»çµ±åˆå§‹åŒ–
12. **11-multiplatform-init.sh**: å¤šå¹³å°æ”¯æ´åˆå§‹åŒ–
13. **12-api-gateway-init.sh**: API é–˜é“åˆå§‹åŒ–
14. **13-services-init.sh**: æœå‹™åˆå§‹åŒ–
15. **99-finalize.sh**: å®ŒæˆåŒ–è…³æœ¬

---

## ğŸ“ ç¶­è­·è³‡è¨Š

**æ¶æ§‹ç‰ˆæœ¬**: v2.0.0  
**æœ€å¾Œæ›´æ–°**: 2025-12-21  
**ç¶­è­·è€…**: MachineNativeOps æ²»ç†å§”å“¡æœƒ  
**FHS ç‰ˆæœ¬**: 3.0

---

## ğŸ”— ç›¸é—œæ–‡æª”

- [æ²»ç†å±¤ README](docs/governance/ROOT_LAYER_README.md)
- [ä»£ç†äººäº¤ä»˜åˆç´„](docs/governance/AGENT_DELIVERY_CONTRACT.md)
- [é©—è­‰æ¸…å–®](docs/governance/VALIDATION_CHECKLIST.md)
- [å¯¦æ–½æŒ‡å—](IMPLEMENTATION_GUIDE.md)
- [FHS æ¨™æº–](https://refspecs.linuxfoundation.org/FHS_3.0/fhs-3.0.html)

---

*æœ¬æ¶æ§‹ç¢ºä¿ MachineNativeOps å°ˆæ¡ˆå…·æœ‰æ¸…æ™°ã€æ¨™æº–ã€å¯ç¶­è­·çš„æ ¹å±¤çµæ§‹ã€‚*
