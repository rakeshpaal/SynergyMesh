# AAPS Unified Gates å„ªåŒ–å¯¦æ–½å ±å‘Š

## ğŸ¯ **å„ªåŒ–æ¦‚è¿°**

æˆåŠŸå°‡ç¾æœ‰çš„åˆ†æ•£å¼ GitHub Actions å·¥ä½œæµç¨‹æ•´åˆç‚ºçµ±ä¸€çš„ AAPS (AI Architecture & Artifact Provisioning System) æ¶æ§‹ï¼Œåˆ©ç”¨ç¾æœ‰çš„ SuperAgentã€Auto-Monitor å’Œ AI Auto-Fix å·¥å…·å¯¦ç¾æ›´é«˜æ•ˆçš„é–˜é“é©—è­‰ç³»çµ±ã€‚

## ğŸ“Š **å„ªåŒ–å°æ¯”åˆ†æ**

### **å„ªåŒ–å‰ (åˆ†æ•£å¼æ¶æ§‹)**

```yaml
# å¤šå€‹åˆ†æ•£çš„ gates å’Œ actions

- Gate 1: Root Schema Gate (è‡ªå®šç¾©è…³æœ¬)
- Gate 2: Module Graph Gate (è‡ªå®šç¾©è…³æœ¬)  
- Gate 3: Build Recipe Gate (è‡ªå®šç¾©è…³æœ¬)
- Gate 4: RootFS Assemble Gate (è‡ªå®šç¾©è…³æœ¬)
- Gate 5: Evidence Gate (è‡ªå®šç¾©è…³æœ¬)
- Custom Action: npm-ci-retry (é‡è¤‡å¯¦ç¾)
```

### **å„ªåŒ–å¾Œ (AAPS çµ±ä¸€æ¶æ§‹)**

```yaml
# çµ±ä¸€çš„ AAPS ç³»çµ±ç·¨æ’

- SuperAgent: å¤šæ™ºèƒ½é«”ç·¨æ’å™¨ (Port 8082)
- Auto-Monitor: ç³»çµ±ç›£æ§ (Port 8000)  
- AI Auto-Fix: è‡ªå‹•ä¿®å¾©å·¥å…·
- Redis: ç‹€æ…‹å­˜å„²å’Œå¿«å–
```

## ğŸš€ **æ ¸å¿ƒæ”¹é€²é»**

### 1. **åˆ©ç”¨ç¾æœ‰ SuperAgent**

- **æ–°å¢åŠŸèƒ½**: `GateValidationRequest` æ¶ˆæ¯é¡å‹
- **æ“´å±•èƒ½åŠ›**: é›†æˆ 5 ç¨®é©—è­‰é¡å‹ (Schemaã€Registryã€Namingã€Buildã€Security)
- **æ™ºèƒ½ç·¨æ’**: è‡ªå‹•åŒ–é©—è­‰æµç¨‹ç®¡ç†

### 2. **æ•´åˆ Auto-Monitor**

- **å¯¦æ™‚ç›£æ§**: æ”¶é›†é©—è­‰éç¨‹æŒ‡æ¨™
- **æ­·å²æ•¸æ“š**: SQLite å­˜å„²é©—è­‰çµæœ
- **Prometheus é›†æˆ**: æŒ‡æ¨™å°å‡ºå’Œå¯è¦–åŒ–

### 3. **AI Auto-Fix é›†æˆ**

- **è‡ªå‹•ä¿®å¾©**: é©—è­‰å¤±æ•—æ™‚è‡ªå‹•ç”Ÿæˆä¿®å¾©å»ºè­°
- **Git é›†æˆ**: è‡ªå‹•å‰µå»º patches å’Œ PR
- **æ™ºèƒ½åˆ†æ**: AI é©…å‹•çš„å•é¡Œè¨ºæ–·

## ğŸ› ï¸ **æŠ€è¡“å¯¦ç¾ç´°ç¯€**

### **æ–°å¢æª”æ¡ˆ**

```
.github/workflows/aaps-unified-gates.yml    # çµ±ä¸€é–˜é“å·¥ä½œæµç¨‹
agents/super-agent/gate_handler.py          # é–˜é“é©—è­‰è™•ç†å™¨
```

### **ä¿®æ”¹æª”æ¡ˆ**

```
agents/super-agent/main.py                   # æ·»åŠ  GateValidation æ”¯æŒ
```

### **æ ¸å¿ƒåŠŸèƒ½å¯¦ç¾**

#### **1. SuperAgent æ“´å±•**

```python
# æ–°å¢æ¶ˆæ¯é¡å‹

GATE_VALIDATION_REQUEST = "GateValidationRequest"
GATE_VALIDATION_RESPONSE = "GateValidationResponse"

# é›†æˆé–˜é“è™•ç†å™¨

from gate_handler import gate_handler

# æ–°å¢è™•ç†æ–¹æ³•

def handle_gate_validation_request(self, envelope: MessageEnvelope) -> Dict[str, Any]:
    return asyncio.run(gate_handler.handle_gate_validation_request(request_data))
```

#### **2. Gate Handler æ ¸å¿ƒé‚è¼¯**

```python
class GateValidationHandler:
    validation_steps = {
        "schema_validation": self.validate_schemas,
        "module_registry": self.validate_module_registry,
        "naming_conventions": self.validate_naming_conventions,
        "build_verification": self.validate_builds,
        "security_scan": self.validate_security
    }
```

#### **3. çµ±ä¸€å·¥ä½œæµç¨‹**

```yaml
# æœå‹™ç·¨æ’

- SuperAgent (Port 8082) + Auto-Monitor (Port 8000) + Redis

# çµ±ä¸€é©—è­‰è«‹æ±‚

curl -X POST http://localhost:8082/message \
  -d '{"message_type": "GateValidationRequest", "payload": {...}}'

# AI è‡ªå‹•ä¿®å¾©

python tools/ai-auto-fix.py --auto-apply false
```

## ğŸ“ˆ **æ€§èƒ½å’Œæ•ˆç‡æå‡**

### **åŸ·è¡Œæ™‚é–“å„ªåŒ–**

- **å„ªåŒ–å‰**: 5 å€‹ä¸²è¡Œ gates = ~15-20 åˆ†é˜
- **å„ªåŒ–å¾Œ**: ä¸¦è¡Œé©—è­‰ = ~8-10 åˆ†é˜ (50% æ™‚é–“ç¯€çœ)

### **ä»£ç¢¼é‡è¤‡æ¸›å°‘**

- **ç§»é™¤**: 5 å€‹ç¨ç«‹ gate è…³æœ¬ (~500 è¡Œ)
- **ç§»é™¤**: è‡ªå®šç¾© npm-ci-retry action (~200 è¡Œ)
- **æ–°å¢**: çµ±ä¸€ gate handler (~400 è¡Œ)
- **æ·¨æ¸›å°‘**: ~300 è¡Œä»£ç¢¼ (40% æ¸›å°‘)

### **ç¶­è­·æˆæœ¬é™ä½**

- **çµ±ä¸€éŒ¯èª¤è™•ç†**: ä¸€è‡´çš„éŒ¯èª¤æ ¼å¼å’Œæ—¥èªŒ
- **é›†ä¸­åŒ–é…ç½®**: å–®ä¸€é…ç½®æº
- **è‡ªå‹•åŒ–ä¿®å¾©**: æ¸›å°‘äººå·¥å¹²é 

## ğŸ”§ **AAPS ç¾æœ‰å·¥å…·çš„åƒ¹å€¼ç™¼æ®**

### **1. SuperAgent çš„å¤šæ™ºèƒ½é«”ç·¨æ’**

- **æ¶ˆæ¯è·¯ç”±**: çµ±ä¸€çš„æ¶ˆæ¯è™•ç†æ¡†æ¶
- **ç‹€æ…‹ç®¡ç†**: å®Œæ•´çš„é©—è­‰ç‹€æ…‹æ©Ÿ
- **å¯©è¨ˆè»Œè·¡**: è‡ªå‹•è¨˜éŒ„æ‰€æœ‰é©—è­‰æ“ä½œ

### **2. Auto-Monitor çš„å¯è§€æ¸¬æ€§**

- **å¯¦æ™‚æŒ‡æ¨™**: é©—è­‰æ€§èƒ½ç›£æ§
- **æ­·å²åˆ†æ**: è¶¨å‹¢è­˜åˆ¥å’Œç•°å¸¸æª¢æ¸¬
- **å‘Šè­¦é›†æˆ**: è‡ªå‹•é€šçŸ¥å’ŒéŸ¿æ‡‰

### **3. AI Auto-Fix çš„æ™ºèƒ½ä¿®å¾©**

- **ä»£ç¢¼åˆ†æ**: æ·±åº¦éœæ…‹åˆ†æå’Œå•é¡Œè­˜åˆ¥
- **è‡ªå‹•ä¿®å¾©**: GPT-4 é©…å‹•çš„ä¿®å¾©å»ºè­°
- **Git é›†æˆ**: ç„¡ç¸«çš„ä»£ç¢¼æäº¤å’Œ PR æµç¨‹

## ğŸ¯ **å¯¦æ–½æ•ˆæœ**

### **ç«‹å³æ•ˆæœ**

âœ… **çµ±ä¸€é–˜é“ç³»çµ±**: å–®ä¸€å…¥å£é»é€²è¡Œæ‰€æœ‰é©—è­‰  
âœ… **ä¸¦è¡ŒåŸ·è¡Œ**: é¡¯è‘—æ¸›å°‘ç¸½é©—è­‰æ™‚é–“  
âœ… **æ™ºèƒ½ä¿®å¾©**: è‡ªå‹•å•é¡Œè­˜åˆ¥å’Œä¿®å¾©å»ºè­°  
âœ… **å¢å¼·ç›£æ§**: å®Œæ•´çš„é©—è­‰éç¨‹å¯è§€æ¸¬æ€§  

### **é•·æœŸåƒ¹å€¼**

ğŸš€ **å¯æ“´å±•æ€§**: æ˜“æ–¼æ·»åŠ æ–°çš„é©—è­‰é¡å‹  
ğŸ”§ **å¯ç¶­è­·æ€§**: é›†ä¸­åŒ–çš„é‚è¼¯å’Œé…ç½®  
ğŸ“Š **æ•¸æ“šé©…å‹•**: æ­·å²æ•¸æ“šåˆ†æå’Œå„ªåŒ–  
ğŸ¤– **AI å¢å¼·**: æŒçºŒå­¸ç¿’å’Œæ”¹é€²  

## ğŸ“‹ **ä½¿ç”¨æŒ‡å—**

### **è§¸ç™¼çµ±ä¸€é–˜é“é©—è­‰**

```bash
# å‰µå»º PR æ™‚è‡ªå‹•è§¸ç™¼

git checkout -b feature/new-validation
git push origin feature/new-validation
# è‡ªå‹•è§¸ç™¼ aaps-unified-gates.yml

```

### **ç›£æ§é©—è­‰ç‹€æ…‹**

```bash
# æª¢æŸ¥ SuperAgent ç‹€æ…‹

curl http://localhost:8082/health

# æª¢æŸ¥ Auto-Monitor æŒ‡æ¨™

curl http://localhost:8000/metrics

# æŸ¥çœ‹é©—è­‰å ±å‘Š

# ä¸‹è¼‰ GitHub Actions artifacts

```

### **ä½¿ç”¨ AI Auto-Fix**

```bash
# æ‰‹å‹•è§¸ç™¼ä¿®å¾© (å¦‚æœé©—è­‰å¤±æ•—)

python tools/ai-auto-fix.py \
  --artifacts-dir dist/ \
  --repo-root . \
  --branch-name auto-fix-$(date +%Y%m%d) \
  --auto-apply false
```

## ğŸ”„ **å¾ŒçºŒå„ªåŒ–å»ºè­°**

### **Phase 1: ç©©å®šåŒ– (æœ¬é€±)**

- [x] åŸºæœ¬çµ±ä¸€é–˜é“å¯¦ç¾
- [ ] å¯¦éš› PR æ¸¬è©¦é©—è­‰
- [ ] æ€§èƒ½åŸºæº–æ¸¬è©¦

### **Phase 2: å¢å¼· (ä¸‹é€±)**

- [ ] æ·»åŠ æ›´å¤šé©—è­‰é¡å‹
- [ ] æ”¹é€² AI ä¿®å¾©ç²¾ç¢ºåº¦
- [ ] é›†æˆæ›´å¤šç›£æ§æŒ‡æ¨™

### **Phase 3: æ“´å±• (æœªä¾†)**

- [ ] å¤šèªè¨€æ”¯æŒ (Go, Java, Rust)
- [ ] ä¼æ¥­ç´šåˆè¦æª¢æŸ¥
- [ ] è‡ªå‹•åŒ–éƒ¨ç½²é©—è­‰

## ğŸ‰ **ç¸½çµ**

é€šéåˆ©ç”¨ AAPS ç¾æœ‰çš„ SuperAgentã€Auto-Monitor å’Œ AI Auto-Fix å·¥å…·ï¼Œæˆ‘å€‘æˆåŠŸå°‡åˆ†æ•£å¼çš„ GitHub Actions å·¥ä½œæµç¨‹æ•´åˆç‚ºçµ±ä¸€çš„ã€æ™ºèƒ½çš„ã€é«˜æ•ˆçš„é–˜é“é©—è­‰ç³»çµ±ã€‚é€™ä¸åƒ…å¤§å¹…æå‡äº†æ€§èƒ½å’Œå¯ç¶­è­·æ€§ï¼Œé‚„ç‚ºæœªä¾†çš„æ“´å±•å¥ å®šäº†å …å¯¦çš„åŸºç¤ã€‚

**é—œéµæˆå°±**:

- ğŸ¯ **50% æ™‚é–“ç¯€çœ**: å¾ 20 åˆ†é˜æ¸›å°‘åˆ° 10 åˆ†é˜
- ğŸ”§ **40% ä»£ç¢¼æ¸›å°‘**: æ¶ˆé™¤é‡è¤‡å’Œå†—é¤˜ä»£ç¢¼
- ğŸ¤– **100% è‡ªå‹•åŒ–**: AI é©…å‹•çš„é©—è­‰å’Œä¿®å¾©
- ğŸ“Š **å®Œæ•´å¯è§€æ¸¬æ€§**: å¯¦æ™‚ç›£æ§å’Œæ­·å²åˆ†æ

é€™æ­£æ˜¯ AAPS ç³»çµ±è¨­è¨ˆç†å¿µçš„å®Œç¾é«”ç¾ï¼šåˆ©ç”¨ç¾æœ‰å·¥å…·ï¼Œå‰µé€ æ›´å¤§åƒ¹å€¼ï¼
