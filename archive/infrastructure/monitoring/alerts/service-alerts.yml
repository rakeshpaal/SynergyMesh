groups:
- interval: 30s
  name: service_availability
  rules:
  - alert: ContractsL1ServiceDown
    annotations:
      dashboard: https://grafana.machinenativeops.com/d/contracts-l1
      description: Contracts L1 Service ({{ $labels.instance }}) has been down for
        more than 1 minute.
      runbook_url: https://docs.machinenativeops.com/runbooks/contracts-l1-down
      summary: Contracts L1 Service is down
    expr: up{job="contracts-l1"} == 0
    for: 1m
    labels:
      service: contracts-l1
      severity: critical
      tier: tier1
  - alert: MCPServersDown
    annotations:
      description: MCP Servers ({{ $labels.instance }}) has been down for more than
        2 minutes.
      runbook_url: https://docs.machinenativeops.com/runbooks/mcp-servers-down
      summary: MCP Servers is down
    expr: up{job="mcp-servers"} == 0
    for: 2m
    labels:
      service: mcp-servers
      severity: high
      tier: tier2
  - alert: DashboardDown
    annotations:
      description: Dashboard ({{ $labels.instance }}) has been down for more than
        5 minutes.
      summary: Dashboard is down
    expr: up{job="dashboard"} == 0
    for: 5m
    labels:
      service: dashboard
      severity: medium
      tier: tier4
- interval: 1m
  name: response_time
  rules:
  - alert: HighResponseTimeP95
    annotations:
      description: 'P95 response time for {{ $labels.service }} is {{ $value }}s (threshold:
        0.5s)'
      impact: User experience degradation
      summary: High response time (P95)
    expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))
      > 0.5
    for: 5m
    labels:
      category: performance
      severity: warning
  - alert: VeryHighResponseTimeP99
    annotations:
      description: 'P99 response time for {{ $labels.service }} is {{ $value }}s (threshold:
        1.0s)'
      impact: Significant user experience degradation
      summary: Very high response time (P99)
    expr: histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))
      > 1.0
    for: 3m
    labels:
      category: performance
      severity: high
- interval: 1m
  name: error_rate
  rules:
  - alert: HighErrorRate
    annotations:
      description: 'Error rate for {{ $labels.service }} is {{ $value | humanizePercentage
        }} (threshold: 1%)'
      impact: Increased failure rate for user requests
      summary: High error rate detected
    expr: 'sum(rate(http_requests_total{status=~"5.."}[5m])) by (service)

      /

      sum(rate(http_requests_total[5m])) by (service)

      > 0.01

      '
    for: 5m
    labels:
      category: reliability
      severity: warning
  - alert: CriticalErrorRate
    annotations:
      description: 'Error rate for {{ $labels.service }} is {{ $value | humanizePercentage
        }} (threshold: 5%)'
      impact: Severe impact on service availability
      summary: Critical error rate detected
    expr: 'sum(rate(http_requests_total{status=~"5.."}[5m])) by (service)

      /

      sum(rate(http_requests_total[5m])) by (service)

      > 0.05

      '
    for: 2m
    labels:
      category: reliability
      severity: critical
- interval: 1m
  name: throughput
  rules:
  - alert: LowThroughput
    annotations:
      description: 'Throughput for {{ $labels.service }} is {{ $value }} req/s (expected:
        >10 req/s)'
      impact: Service may be experiencing issues or low usage
      summary: Low throughput detected
    expr: sum(rate(http_requests_total[5m])) by (service) < 10
    for: 10m
    labels:
      category: performance
      severity: warning
  - alert: AbnormallyHighThroughput
    annotations:
      description: Throughput for {{ $labels.service }} is 3x higher than 1 hour ago
      impact: Possible DDoS attack or unexpected traffic spike
      summary: Abnormally high throughput
    expr: 'sum(rate(http_requests_total[5m])) by (service)

      >

      sum(rate(http_requests_total[5m] offset 1h)) by (service) * 3

      '
    for: 5m
    labels:
      category: anomaly
      severity: warning
- interval: 1m
  name: resource_usage
  rules:
  - alert: HighCPUUsage
    annotations:
      description: 'CPU usage on {{ $labels.instance }} is {{ $value }}% (threshold:
        80%)'
      impact: Performance degradation possible
      summary: High CPU usage
    expr: '100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m]))
      * 100) > 80

      '
    for: 5m
    labels:
      category: resources
      severity: warning
  - alert: CriticalCPUUsage
    annotations:
      description: 'CPU usage on {{ $labels.instance }} is {{ $value }}% (threshold:
        95%)'
      impact: Severe performance degradation
      summary: Critical CPU usage
    expr: '100 - (avg by (instance) (rate(node_cpu_seconds_total{mode="idle"}[5m]))
      * 100) > 95

      '
    for: 2m
    labels:
      category: resources
      severity: critical
  - alert: HighMemoryUsage
    annotations:
      description: 'Memory usage on {{ $labels.instance }} is {{ $value }}% (threshold:
        80%)'
      impact: Possible OOM risk
      summary: High memory usage
    expr: '(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100
      > 80

      '
    for: 5m
    labels:
      category: resources
      severity: warning
  - alert: CriticalMemoryUsage
    annotations:
      description: 'Memory usage on {{ $labels.instance }} is {{ $value }}% (threshold:
        95%)'
      impact: Imminent OOM risk
      summary: Critical memory usage
    expr: '(1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes)) * 100
      > 95

      '
    for: 2m
    labels:
      category: resources
      severity: critical
  - alert: HighDiskUsage
    annotations:
      description: 'Disk usage on {{ $labels.instance }} {{ $labels.mountpoint }}
        is {{ $value }}% (threshold: 80%)'
      impact: Storage capacity warning
      summary: High disk usage
    expr: '(1 - (node_filesystem_avail_bytes{fstype!~"tmpfs|fuse.lxcfs"} / node_filesystem_size_bytes))
      * 100 > 80

      '
    for: 5m
    labels:
      category: resources
      severity: warning
- interval: 1m
  name: container_alerts
  rules:
  - alert: ContainerRestarting
    annotations:
      description: Container {{ $labels.name }} has restarted {{ $value }} times in
        the last 15 minutes
      impact: Service instability
      summary: Container restarting frequently
    expr: rate(container_restarts_total[15m]) > 0
    for: 5m
    labels:
      category: stability
      severity: warning
  - alert: ContainerOOM
    annotations:
      description: Container {{ $labels.name }} is using {{ $value | humanizePercentage
        }} of memory limit
      impact: Container may be killed by OOM
      summary: Container near OOM
    expr: container_memory_usage_bytes / container_spec_memory_limit_bytes > 0.95
    for: 2m
    labels:
      category: resources
      severity: critical
- interval: 5m
  name: sla_alerts
  rules:
  - alert: SLAAvailabilityViolation
    annotations:
      description: 'Service {{ $labels.service }} availability is {{ $value | humanizePercentage
        }} (SLA: 99.9%)'
      impact: SLA breach - customer notification required
      summary: SLA availability violation
    expr: 'avg_over_time(up[1h]) < 0.999

      '
    for: 5m
    labels:
      category: sla
      severity: critical
  - alert: SLAResponseTimeViolation
    annotations:
      description: 'P95 response time for {{ $labels.service }} is {{ $value }}s (SLA:
        <500ms)'
      impact: SLA breach warning
      summary: SLA response time violation
    expr: 'histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[1h]))
      > 0.5

      '
    for: 10m
    labels:
      category: sla
      severity: high
