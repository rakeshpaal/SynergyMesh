# ğŸ”¤ Root Layer Naming Specification
# Version: 1.0.0
# Scope: root.*.yaml governance files
# Enforcement: Strict (GitHub Actions gate-root-specs.yml)

apiVersion: machinenativeops.io/v1
kind: RootNamingSpec
metadata:
  name: root-naming-specification
  namespace: machinenativeops-specs
  labels:
    machinenativeops.io/tier: "specs"
    machinenativeops.io/version: "v1.0.0"
    machinenativeops.io/component: "naming-spec"
  annotations:
    machinenativeops.io/description: "Machine-verifiable naming conventions for root layer"
    machinenativeops.io/enforcement: "strict"
    machinenativeops.io/last-modified: "2025-12-21T02:00:00Z"

spec:
  version: 1
  scope:
    include_paths:
      - "^root\\..*\\.yaml$"
      - "^root\\..*\\.map$"
      - "^root\\..*\\.sh$"
    exclude_paths:
      - "^archive/.*"
      - "^tmp/.*"
  
  # === æ ¸å¿ƒå‘½åè¦å‰‡ ===
  naming_rules:
    # 1. YAML éµåè¦ç¯„
    yaml_keys:
      description: "æ‰€æœ‰ YAML éµå¿…é ˆä½¿ç”¨ snake_case"
      pattern: "^[a-z][a-z0-9_]*$"
      examples:
        valid:
          - "module_name"
          - "api_version"
          - "health_check"
          - "auto_start"
        invalid:
          - "moduleName"  # camelCase ä¸å…è¨±
          - "ModuleName"  # PascalCase ä¸å…è¨±
          - "module-name" # kebab-case ä¸å…è¨±
          - "MODULE_NAME" # UPPER_CASE ä¸å…è¨±
      exceptions:
        - pattern: "^[A-Z][A-Z0-9_]*$"
          context: "environment variables only"
          examples: ["GOVERNANCE_MODE", "API_KEY", "DB_HOST"]
    
    # 2. æ¨¡çµ„åç¨±è¦ç¯„
    module_names:
      description: "æ¨¡çµ„åç¨±å¿…é ˆä½¿ç”¨ kebab-case"
      pattern: "^[a-z][a-z0-9-]*[a-z0-9]$"
      min_length: 3
      max_length: 50
      examples:
        valid:
          - "governance-engine"
          - "trust-manager"
          - "config-manager"
          - "api-gateway"
        invalid:
          - "GovernanceEngine"  # PascalCase
          - "governance_engine" # snake_case
          - "a"                 # å¤ªçŸ­
          - "governance-"       # çµå°¾ä¸å¯ç‚ºé€£å­—è™Ÿ
    
    # 3. ç‰ˆæœ¬è™Ÿè¦ç¯„
    version_format:
      description: "ç‰ˆæœ¬è™Ÿå¿…é ˆç¬¦åˆ Semantic Versioning 2.0.0"
      pattern: "^v?\\d+\\.\\d+\\.\\d+(-[a-z0-9.-]+)?(\\+[a-z0-9.-]+)?$"
      examples:
        valid:
          - "1.0.0"
          - "v1.0.0"
          - "2.1.3-alpha"
          - "1.0.0-beta.1"
          - "1.0.0+20130313144700"
        invalid:
          - "1.0"      # ç¼ºå°‘ patch ç‰ˆæœ¬
          - "v1"       # ä¸å®Œæ•´
          - "1.0.0.0"  # éå¤šæ®µè½
    
    # 4. API ç‰ˆæœ¬è¦ç¯„
    api_version:
      description: "API ç‰ˆæœ¬å¿…é ˆä½¿ç”¨ domain/version æ ¼å¼"
      pattern: "^[a-z0-9.-]+/v\\d+$"
      examples:
        valid:
          - "machinenativeops.io/v1"
          - "machinenativeops.io/v2"
          - "k8s.io/v1"
        invalid:
          - "v1"                    # ç¼ºå°‘ domain
          - "machinenativeops/v1"   # ç¼ºå°‘ .io
          - "machinenativeops.io/1" # ç¼ºå°‘ v å‰ç¶´
    
    # 5. Kind åç¨±è¦ç¯„
    kind_names:
      description: "Kind å¿…é ˆä½¿ç”¨ PascalCase ä¸¦ä»¥ Root é–‹é ­"
      pattern: "^Root[A-Z][a-zA-Z0-9]*$"
      examples:
        valid:
          - "RootModulesConfig"
          - "RootGovernanceConfig"
          - "RootBootstrapConfig"
        invalid:
          - "rootModulesConfig"  # å°å¯«é–‹é ­
          - "ModulesConfig"      # ç¼ºå°‘ Root å‰ç¶´
          - "Root_Config"        # åŒ…å«åº•ç·š
    
    # 6. æ¨™ç±¤éµè¦ç¯„
    label_keys:
      description: "æ¨™ç±¤éµå¿…é ˆä½¿ç”¨ domain/key æ ¼å¼"
      pattern: "^[a-z0-9.-]+/[a-z][a-z0-9-]*$"
      examples:
        valid:
          - "machinenativeops.io/tier"
          - "machinenativeops.io/version"
          - "machinenativeops.io/component"
        invalid:
          - "tier"                      # ç¼ºå°‘ domain
          - "machinenativeops.io/Tier"  # å¤§å¯«
          - "machinenativeops/tier"     # ç¼ºå°‘ .io
    
    # 7. æª”æ¡ˆåç¨±è¦ç¯„
    file_names:
      description: "Root å±¤æª”æ¡ˆå¿…é ˆä½¿ç”¨ root.<category>.<ext> æ ¼å¼"
      pattern: "^root\\.[a-z][a-z0-9-]*\\.(yaml|map|sh)$"
      examples:
        valid:
          - "root.config.yaml"
          - "root.modules.yaml"
          - "root.devices.map"
          - "root.env.sh"
        invalid:
          - "config.yaml"        # ç¼ºå°‘ root. å‰ç¶´
          - "root.Config.yaml"   # å¤§å¯«
          - "root.config.yml"    # ä½¿ç”¨ yml è€Œé yaml
          - "root config.yaml"   # åŒ…å«ç©ºç™½
    
    # 8. ç›®éŒ„åç¨±è¦ç¯„
    directory_names:
      description: "ç›®éŒ„åç¨±å¿…é ˆä½¿ç”¨å°å¯«å­—æ¯å’Œé»è™Ÿ"
      pattern: "^[a-z][a-z0-9.]*[a-z0-9]$"
      examples:
        valid:
          - "init.d"
          - "bin"
          - "etc"
          - "var"
        invalid:
          - "Init.d"    # å¤§å¯«
          - "init-d"    # ä½¿ç”¨é€£å­—è™Ÿ
          - "init_d"    # ä½¿ç”¨åº•ç·š

  # === å€¼æ ¼å¼è¦ç¯„ ===
  value_formats:
    # 1. å‘½åç©ºé–“æ ¼å¼
    namespace:
      pattern: "^[a-z][a-z0-9-]*$"
      examples:
        valid: ["machinenativenops-modules", "machinenativenops-specs"]
        invalid: ["MachineNativeOps-Modules", "machinenativeops_modules"]
    
    # 2. æè¿°æ–‡å­—æ ¼å¼
    description:
      min_length: 10
      max_length: 200
      pattern: "^[A-Z].*[^.]$"  # å¤§å¯«é–‹é ­ï¼Œä¸ä»¥å¥è™Ÿçµå°¾
      examples:
        valid: ["Core governance and policy enforcement engine"]
        invalid: ["core governance", "Core governance."]
    
    # 3. è·¯å¾‘æ ¼å¼
    file_path:
      pattern: "^/[a-z0-9/_-]+$"
      examples:
        valid: ["/opt/machinenativenops/modules/governance-engine/main.py"]
        invalid: ["/Opt/MachineNativeOps/Modules/Main.py"]
    
    # 4. ç«¯é»æ ¼å¼
    endpoint:
      pattern: "^/[a-z0-9/_-]*$"
      examples:
        valid: ["/health", "/api/v1/status", "/metrics"]
        invalid: ["/Health", "/API/V1/Status"]
    
    # 5. æ™‚é–“é–“éš”æ ¼å¼
    duration:
      pattern: "^\\d+[smhd]$"
      examples:
        valid: ["30s", "5m", "1h", "7d"]
        invalid: ["30", "5 minutes", "1hour"]
    
    # 6. è³‡æºé‡æ ¼å¼
    resource_quantity:
      pattern: "^\\d+[mMGT]i?$"
      examples:
        valid: ["200m", "256Mi", "1Gi", "100Mi"]
        invalid: ["200", "256MB", "1G"]

  # === ä¸€è‡´æ€§è¦å‰‡ ===
  consistency_rules:
    - id: "NAMING-001"
      description: "åŒä¸€æª”æ¡ˆå…§çš„ metadata.name å¿…é ˆèˆ‡æª”æ¡ˆç”¨é€”ä¸€è‡´"
      check: "metadata.name æ‡‰åŒ…å«æª”æ¡ˆé¡å‹é—œéµå­—"
      examples:
        - file: "root.modules.yaml"
          valid_names: ["modules-registry-config", "modules-config"]
          invalid_names: ["config", "root-config"]
    
    - id: "NAMING-002"
      description: "æ¨¡çµ„åç¨±åœ¨æ‰€æœ‰æª”æ¡ˆä¸­å¿…é ˆä¸€è‡´"
      check: "åŒä¸€æ¨¡çµ„åœ¨ä¸åŒæª”æ¡ˆä¸­çš„åç¨±å¿…é ˆå®Œå…¨ç›¸åŒ"
      scope: ["root.modules.yaml", "root.bootstrap.yaml", "root.super-execution.yaml"]
    
    - id: "NAMING-003"
      description: "æ¨™ç±¤å€¼å¿…é ˆèˆ‡å°æ‡‰çš„é…ç½®å€¼ä¸€è‡´"
      check: "labels.machinenativeops.io/version å¿…é ˆèˆ‡ spec.version ä¸€è‡´"
      examples:
        valid:
          labels: {"machinenativeops.io/version": "v1.0.0"}
          spec: {"version": "1.0.0"}
        invalid:
          labels: {"machinenativeops.io/version": "v1.0.0"}
          spec: {"version": "2.0.0"}

  # === ç¦æ­¢æ¨¡å¼ ===
  forbidden_patterns:
    - pattern: "[A-Z]"
      context: "file names"
      reason: "æª”æ¡ˆåç¨±ç¦æ­¢å¤§å¯«å­—æ¯"
      severity: "error"
    
    - pattern: "\\s"
      context: "file names, keys"
      reason: "ç¦æ­¢ç©ºç™½å­—å…ƒ"
      severity: "error"
    
    - pattern: "\\.yml$"
      context: "file extensions"
      reason: "çµ±ä¸€ä½¿ç”¨ .yaml è€Œé .yml"
      severity: "error"
    
    - pattern: "^[^a-z]"
      context: "yaml keys"
      reason: "YAML éµå¿…é ˆä»¥å°å¯«å­—æ¯é–‹é ­"
      severity: "error"
    
    - pattern: "[^a-z0-9_-]"
      context: "module names"
      reason: "æ¨¡çµ„åç¨±åªå…è¨±å°å¯«å­—æ¯ã€æ•¸å­—ã€é€£å­—è™Ÿ"
      severity: "error"

  # === é©—è­‰é…ç½® ===
  validation:
    enabled: true
    enforcement_level: "strict"
    auto_fix: false
    report_format: "markdown"
    
    gates:
      - name: "gate-root-specs"
        workflow: ".github/workflows/gate-root-specs.yml"
        trigger: "pull_request"
        paths:
          - "root.*.yaml"
          - "root.*.map"
          - "root.*.sh"
    
    error_handling:
      on_violation:
        - "Block PR merge"
        - "Add comment with specific violations"
        - "Provide fix suggestions"
      
      escalation:
        first_violation: "Warning + fix suggestions"
        second_violation: "Block + require manual review"
        repeated_violations: "Escalate to governance committee"

# === ç‹€æ…‹ ===
status:
  phase: "Active"
  conditions:
    - type: "Validated"
      status: "True"
      lastTransitionTime: "2025-12-21T02:00:00Z"
      reason: "SpecificationComplete"
      message: "Naming specification is complete and validated"
  
  statistics:
    total_rules: 8
    total_patterns: 15
    total_examples: 50
    coverage: "100%"