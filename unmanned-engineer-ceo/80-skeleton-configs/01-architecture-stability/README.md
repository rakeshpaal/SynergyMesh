# éª¨æ¶ 1: Architecture Stability (æ¶æ§‹ç©©å®šæ€§)

**ç›®çš„**: ç¢ºä¿æ•´å€‹ç³»çµ±çš„æ¶æ§‹ç©©å®šæ€§å’Œå¯ç¶­è­·æ€§ï¼Œé€šéæ˜ç¢ºçš„åˆ†å±¤è¦å‰‡ã€ä¾è³´ç®¡ç†å’Œæ¶æ§‹é©—è­‰æ©Ÿåˆ¶ã€‚

## ğŸ“‹ æ¦‚è¿°

æ¶æ§‹ç©©å®šæ€§éª¨æ¶å®šç¾©äº†ä¸€å¥—åš´æ ¼çš„æ¶æ§‹è¦å‰‡å’Œä¸è®Šæ¢ä»¶ï¼Œç¢ºä¿ç³»çµ±éš¨è‘—æ¼”é€²ä»ä¿æŒé«˜åº¦çš„å¯ç¶­è­·æ€§å’Œç©©å®šæ€§ã€‚

### æ ¸å¿ƒåŸå‰‡

- **åˆ†å±¤éš”é›¢**: æ˜ç¢ºçš„äº”å±¤æ¶æ§‹ (core â†’ platform â†’ services â†’ agents â†’ applications)
- **å–®å‘ä¾è³´**: ä¾è³´å¿…é ˆç”±å¤–å‘å…§ï¼Œç¦æ­¢åå‘ä¾è³´
- **åŒå±¤éš”é›¢**: åŒå±¤æ¨¡çµ„ä¹‹é–“ç¦æ­¢ç›´æ¥ä¾è³´ï¼Œå¿…é ˆé€šé API æˆ– Event
- **é›¶ä¿¡ä»»**: æ‰€æœ‰è·¨é‚Šç•Œèª¿ç”¨éœ€é©—è­‰èº«ä»½å’Œæ¬Šé™

## ğŸ“ æ–‡ä»¶çµæ§‹

### æ–‡æª” (docs/)
- **invariants.md** - æ¶æ§‹ä¸è®Šæ¢ä»¶å®šç¾©
  - åˆ†å±¤ä¸è®Šæ¢ä»¶ (INV-001 ~ INV-003)
  - è³‡æ–™å­˜å–ä¸è®Šæ¢ä»¶ (INV-004 ~ INV-005)
  - æ•´åˆä¸è®Šæ¢ä»¶ (INV-006 ~ INV-007)
  - å®‰å…¨ä¸è®Šæ¢ä»¶ (INV-008)

- **layering-rules.md** - åˆ†å±¤è¦å‰‡
  - Layer 1-5 çš„è·è²¬å’Œå…è¨±/ç¦æ­¢çš„ä¾è³´
  - ä¾è³´è¦å‰‡çŸ©é™£

- **dependency-rules.md** - ä¾è³´ç®¡ç†è¦å‰‡
  - Import è·¯å¾‘è¦ç¯„
  - å¾ªç’°ä¾è³´ç¦æ­¢
  - ç¶²è·¯ä¾è³´è²æ˜ (API, Events)
  - å…±äº«åº«ç¯„åœå’Œç‰ˆæœ¬ç®¡ç†

### å·¥å…· (tools/)
- **arch-lint.config.yml** - Architecture Linter é…ç½®
  - åˆ†å±¤æª¢æŸ¥ã€å¾ªç’°ä¾è³´æª¢æŸ¥
  - å‘½åè¦ç¯„ã€æª”æ¡ˆçµ„ç¹”è¦æ±‚
  - è±å…è¦å‰‡é…ç½®

- **arch-lint.ts** - Architecture Linter å¯¦ç¾
  - è‡ªå‹•æª¢æŸ¥æ¶æ§‹é•è¦
  - æ”¯æ´å¤šç¨®æª¢æŸ¥è¦å‰‡
  - ç”Ÿæˆè©³ç´°çš„é•è¦å ±å‘Š

### æ¸¬è©¦ (tests/)
- **arch-lint.test.ts** - Linter å–®å…ƒæ¸¬è©¦
  - è¦å‰‡é©—è­‰æ¸¬è©¦
  - é‚Šç•Œæƒ…æ³æ¸¬è©¦

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. é©—è­‰æ¶æ§‹åˆè¦æ€§

```bash
# å®‰è£ä¾è³´
npm install

# é‹è¡Œ Architecture Linter
npx ts-node tools/arch-lint.ts

# çµåˆé…ç½®æ–‡ä»¶é‹è¡Œ
npx ts-node tools/arch-lint.ts --config tools/arch-lint.config.yml
```

### 2. åœ¨ CI/CD ä¸­é›†æˆ

```yaml
# .github/workflows/architecture-lint.yml
- name: Architecture Lint
  run: npm exec --workspace architecture-stability -- npx ts-node tools/arch-lint.ts
```

### 3. æ–°å¢è±å…è¦å‰‡

ç·¨è¼¯ `tools/arch-lint.config.yml`:

```yaml
exemptions:
  - path: platform/legacy/**
    reason: "Gradual migration plan"
    adr: ADR-2025-001
    expires: 2025-12-31
```

## ğŸ“Š æ¶æ§‹å±¤ç´šé—œä¿‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Layer 5: Applications          â”‚
â”‚   (Web UI, Mobile, CLI, Orchestration) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Layer 4: Agents            â”‚
â”‚     (AI Agents, Workers, Supervisors)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Layer 3: Services             â”‚
â”‚     (API Services, Microservices)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Layer 2: Platform Foundation       â”‚
â”‚  (Arch, Security, Observability, etc)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Layer 1: Core (Domain)          â”‚
â”‚   (Domain Models, Orchestrators, KB)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âœ… æª¢æŸ¥æ¸…å–®

åœ¨ä¿®æ”¹æ¶æ§‹å‰ï¼Œè«‹ç¢ºä¿:

- [ ] ç†è§£äº”å±¤æ¶æ§‹å’Œåˆ†å±¤è¦å‰‡
- [ ] æª¢æŸ¥ä¾è³´æ˜¯å¦ç¬¦åˆè¦å‰‡çŸ©é™£
- [ ] é‹è¡Œ Architecture Linter ç¢ºä¿åˆè¦
- [ ] å¦‚éœ€é•è¦ï¼Œéœ€åœ¨ ADR ä¸­èªªæ˜ç†ç”±
- [ ] æ›´æ–° `dependencies.yaml` å’Œ `event-subscriptions.yaml`
- [ ] é€šé Architecture Lint æ¸¬è©¦

## ğŸ“– ç›¸é—œæ–‡æª”

- [æ¶æ§‹ä¸è®Šæ¢ä»¶](./docs/invariants.md)
- [åˆ†å±¤è¦å‰‡](./docs/layering-rules.md)
- [ä¾è³´ç®¡ç†è¦å‰‡](./docs/dependency-rules.md)
- [ç³»çµ±æ•´é«”è¨­è¨ˆ](../../../00-foundation/02-system-architecture/)

## ğŸ”— å¼•ç”¨

- **ç³»çµ±**: Unmanned Island System (SynergyMesh)
- **ç‰ˆæœ¬**: 1.0.0
- **æœ€å¾Œæ›´æ–°**: 2024-12-05
