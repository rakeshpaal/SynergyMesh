---
apiVersion: v1
kind: Namespace
metadata:
  name: intelligent-hyperautomation-baseline
  labels:
    baseline.level: L-A
    baseline.version: v1.0.0
    baseline.type: namespace-governance
    governance.io/constitutional: "true"
    governance.io/layer: L1
    governance.io/enforcement: mandatory
    topology.kubernetes.io/region: global
    topology.kubernetes.io/zone: constitutional
  annotations:
    baseline.io/description: "命名空間治理基線 / Namespace Governance Foundation"
    baseline.io/purpose: "建立 L1 憲法級命名空間隔離與標籤規範 / Establish L1 constitutional namespace isolation and labeling standards"
    baseline.io/capability-scope: "namespace-lifecycle,label-enforcement,resource-isolation"
    baseline.io/conflict-priority: "1000"
    baseline.io/state-machine: "DECLARED->REGISTERED->COORDINATED->ACTIVE"
    baseline.io/last-validated: "2025-10-25T00:00:00Z"
    baseline.io/validation-hash: "sha256:baseline1-namespace-gov-foundation"
    gitops.io/source-repo: "https://github.com/org/baseline-foundations"
    gitops.io/source-path: "baselines/01-namespace-governance"
    gitops.io/sync-policy: "automated"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: namespace-governance-policy
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.component: policy-definition
    policy.type: namespace-governance
data:
  namespace-naming-convention.yaml: |
    version: v1.0.0
    enforced: true
    patterns:
      production:
        regex: "^[a-z][a-z0-9-]*-(prod|production)$"
        description: "生產環境命名規範 / Production environment naming"
        examples:
          - "service-a-prod"
          - "data-pipeline-production"
      staging:
        regex: "^[a-z][a-z0-9-]*-(stg|staging)$"
        description: "預備環境命名規範 / Staging environment naming"
      development:
        regex: "^[a-z][a-z0-9-]*-(dev|development)$"
        description: "開發環境命名規範 / Development environment naming"
      feature:
        regex: "^[a-z][a-z0-9-]*-feature-[a-z0-9-]+$"
        description: "特性分支命名規範 / Feature branch naming"
      tenant:
        regex: "^tenant-[a-z0-9]+-(dev|stg|prod)$"
        description: "租戶隔離命名規範 / Tenant isolation naming"
    forbidden_prefixes:
      - "kube-"
      - "kubernetes-"
      - "system-"
    max_length: 63
    min_length: 3
  mandatory-labels.yaml: |
    version: v1.0.0
    enforced: true
    required_labels:
      - key: "app.kubernetes.io/name"
        description: "應用程式名稱 / Application name"
        validation: "^[a-z][a-z0-9-]*$"
      - key: "app.kubernetes.io/version"
        description: "應用程式版本 / Application version"
        validation: "^v?[0-9]+\\.[0-9]+\\.[0-9]+(-[a-z0-9-]+)?$"
      - key: "app.kubernetes.io/component"
        description: "元件類型 / Component type"
        allowed_values:
          - "frontend"
          - "backend"
          - "database"
          - "cache"
          - "queue"
          - "worker"
          - "api"
      - key: "app.kubernetes.io/part-of"
        description: "所屬系統 / Part of system"
        validation: "^[a-z][a-z0-9-]*$"
      - key: "app.kubernetes.io/managed-by"
        description: "管理工具 / Managed by tool"
        allowed_values:
          - "argocd"
          - "flux"
          - "helm"
          - "kustomize"
      - key: "environment"
        description: "環境標籤 / Environment label"
        allowed_values:
          - "production"
          - "staging"
          - "development"
          - "feature"
      - key: "owner"
        description: "負責團隊 / Owner team"
        validation: "^[a-z][a-z0-9-]*@[a-z0-9.-]+$"
      - key: "cost-center"
        description: "成本中心 / Cost center"
        validation: "^CC-[0-9]{4,6}$"
      - key: "compliance.level"
        description: "合規等級 / Compliance level"
        allowed_values:
          - "public"
          - "internal"
          - "confidential"
          - "restricted"
      - key: "baseline.level"
        description: "基線層級 / Baseline level"
        validation: "^L-[A-Z]$"
    optional_labels:
      - key: "security.scan.required"
        default: "true"
      - key: "backup.enabled"
        default: "false"
      - key: "monitoring.tier"
        default: "standard"
  lifecycle-states.yaml: |
    version: v1.0.0
    states:
      DECLARED:
        description: "命名空間已宣告，等待註冊 / Namespace declared, awaiting registration"
        allowed_transitions:
          - "REGISTERED"
        annotations_required:
          - "baseline.io/capability-scope"
      REGISTERED:
        description: "已註冊到能力圖譜 / Registered to capability graph"
        allowed_transitions:
          - "COORDINATED"
          - "CONFLICTED"
        validation_required:
          - "label-compliance"
          - "naming-convention"
      COORDINATED:
        description: "完成衝突解析，準備啟動 / Conflict resolved, ready for activation"
        allowed_transitions:
          - "ACTIVE"
          - "DEGRADED"
        prerequisites:
          - "resource-quota-assigned"
          - "network-policy-applied"
      ACTIVE:
        description: "正常運行狀態 / Normal operation state"
        allowed_transitions:
          - "DEGRADED"
          - "CONFLICTED"
          - "RETIRED"
        monitoring_required: true
      CONFLICTED:
        description: "檢測到衝突，暫停服務 / Conflict detected, service suspended"
        allowed_transitions:
          - "COORDINATED"
          - "TERMINATED"
        auto_remediation: true
      DEGRADED:
        description: "降級運行，部分功能受限 / Degraded operation, partial functionality"
        allowed_transitions:
          - "ACTIVE"
          - "CONFLICTED"
          - "TERMINATED"
        alert_severity: warning
      RETIRED:
        description: "已退役，等待清理 / Retired, awaiting cleanup"
        allowed_transitions:
          - "TERMINATED"
        grace_period_days: 30
      TERMINATED:
        description: "終止運行 / Terminated"
        final_state: true
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: capability-registry-schema
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.component: capability-registry
    schema.type: capability-declaration
data:
  capability-declaration.schema.yaml: |
    version: v1.0.0
    schema_type: capability-declaration
    required_fields:
      - capability_id
      - capability_name
      - capability_version
      - namespace
      - scope
      - dependencies
      - conflict_domains
    capability_declaration:
      capability_id:
        type: string
        pattern: "^cap-[a-z0-9-]+$"
        description: "能力唯一識別碼 / Capability unique identifier"
      capability_name:
        type: string
        description: "能力名稱 / Capability name"
      capability_version:
        type: string
        pattern: "^v[0-9]+\\.[0-9]+\\.[0-9]+$"
      namespace:
        type: string
        description: "所屬命名空間 / Owning namespace"
      scope:
        type: object
        required:
          - resource_types
          - operations
          - boundaries
        properties:
          resource_types:
            type: array
            items:
              enum:
                - "compute"
                - "network"
                - "storage"
                - "security"
                - "observability"
                - "quantum"
          operations:
            type: array
            items:
              enum:
                - "create"
                - "read"
                - "update"
                - "delete"
                - "patch"
                - "watch"
          boundaries:
            type: object
            properties:
              namespace_scoped:
                type: boolean
              cluster_scoped:
                type: boolean
              cross_cluster:
                type: boolean
      dependencies:
        type: array
        items:
          type: object
          required:
            - capability_id
            - version_constraint
          properties:
            capability_id:
              type: string
            version_constraint:
              type: string
            optional:
              type: boolean
              default: false
      conflict_domains:
        type: array
        description: "潛在衝突域 / Potential conflict domains"
        items:
          type: string
      priority_weight:
        type: integer
        minimum: 0
        maximum: 1000
        default: 500
      health_check:
        type: object
        properties:
          endpoint:
            type: string
          interval_seconds:
            type: integer
          timeout_seconds:
            type: integer
---
apiVersion: v1
kind: Service
metadata:
  name: capability-registry-service
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.component: capability-registry
    app.kubernetes.io/name: capability-registry
    app.kubernetes.io/version: v1.0.0
spec:
  type: ClusterIP
  selector:
    app.kubernetes.io/name: capability-registry
  ports:
    - name: http-api
      port: 8080
      targetPort: 8080
      protocol: TCP
    - name: grpc-api
      port: 9090
      targetPort: 9090
      protocol: TCP
    - name: metrics
      port: 9091
      targetPort: 9091
      protocol: TCP
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: namespace-governance-controller
  namespace: intelligent-hyperautomation-baseline
  labels:
    baseline.component: governance-controller
automountServiceAccountToken: true
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: namespace-governance-controller
  labels:
    baseline.component: governance-controller
rules:
  - apiGroups:
      - ""
    resources:
      - namespaces
    verbs:
      - get
      - list
      - watch
      - update
      - patch
  - apiGroups:
      - ""
    resources:
      - events
    verbs:
      - create
      - patch
  - apiGroups:
      - "admissionregistration.k8s.io"
    resources:
      - validatingwebhookconfigurations
      - mutatingwebhookconfigurations
    verbs:
      - get
      - list
      - watch
      - create
      - update
      - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: namespace-governance-controller
  labels:
    baseline.component: governance-controller
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: namespace-governance-controller
subjects:
  - kind: ServiceAccount
    name: namespace-governance-controller
    namespace: intelligent-hyperautomation-baseline