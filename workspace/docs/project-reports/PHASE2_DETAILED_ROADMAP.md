# MachineNativeOps ç¬¬äºŒéšæ®µè©³ç´°è·¯ç·šåœ–

# FHS (Filesystem Hierarchy Standard) ç›®éŒ„æ·±åº¦å¯¦æ–½

## ğŸ“‹ éšæ®µæ¦‚è¦½

**éšæ®µåç¨±**: FHS ç›®éŒ„æ·±åº¦å¯¦æ–½  
**é–‹å§‹æ—¥æœŸ**: 2025-12-21  
**é è¨ˆå®Œæˆ**: 2025-12-23  
**å‰ç½®æ¢ä»¶**: âœ… Phase 1 å®Œæˆï¼Œç³»çµ±å¥åº·åº¦ 100%  
**ç›®æ¨™**: å»ºç«‹å®Œæ•´ã€æ¨™æº–åŒ–ã€å¯ç¶­è­·çš„ FHS ç›®éŒ„çµæ§‹å’Œå…§å®¹

## ğŸ¯ æ ¸å¿ƒç›®æ¨™

1. **FHS æ¨™æº–å®Œå…¨å¯¦æ–½**: éµå¾ª Linux æ¨™æº–ç›®éŒ„çµæ§‹
2. **æœå‹™éƒ¨ç½²**: éƒ¨ç½²æ ¸å¿ƒæœå‹™åˆ°å°æ‡‰ç›®éŒ„
3. **é…ç½®ç®¡ç†**: çµ±ä¸€é…ç½®æª”æ¡ˆç®¡ç†
4. **è‡ªå‹•åŒ–é‹ç¶­**: å®Œå–„çš„è‡ªå‹•åŒ–éƒ¨ç½²å’Œç›£æ§
5. **ç”Ÿç”¢å°±ç·’**: é”åˆ°ç”Ÿç”¢ç’°å¢ƒæ¨™æº–

## ğŸ“ FHS ç›®éŒ„æ·±åº¦å¯¦æ–½è¨ˆåŠƒ

### Phase 2.1: åŸºç¤ç›®éŒ„å…§å®¹å¯¦æ–½ (4å°æ™‚)

#### ğŸ“‚ `/usr` - ç”¨æˆ¶ç¨‹å¼å’Œè³‡æ–™

```
usr/
â”œâ”€â”€ bin/                    # ç”¨æˆ¶ç¨‹å¼
â”‚   â”œâ”€â”€ aaps-engine          # AAPS æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ mn-monitor           # ç›£æ§å·¥å…·
â”‚   â”œâ”€â”€ mn-config            # é…ç½®å·¥å…·
â”‚   â””â”€â”€ mn-deploy            # éƒ¨ç½²å·¥å…·
â”œâ”€â”€ sbin/                   # ç³»çµ±ç®¡ç†ç¨‹å¼
â”‚   â”œâ”€â”€ mn-systemctl         # ç³»çµ±æ§åˆ¶å·¥å…·
â”‚   â”œâ”€â”€ mn-service           # æœå‹™ç®¡ç†
â”‚   â””â”€â”€ mn-update            # ç³»çµ±æ›´æ–°
â”œâ”€â”€ lib/                    # å‡½å¼åº«
â”‚   â”œâ”€â”€ libaaps.so           # AAPS æ ¸å¿ƒå‡½å¼åº«
â”‚   â”œâ”€â”€ libmn-common.so      # é€šç”¨å‡½å¼åº«
â”‚   â””â”€â”€ libmn-security.so    # å®‰å…¨å‡½å¼åº«
â”œâ”€â”€ share/                  # å…±äº«è³‡æ–™
â”‚   â”œâ”€â”€ doc/                # æ–‡æª”
â”‚   â”œâ”€â”€ man/                # æ‰‹å†Šé 
â”‚   â””â”€â”€ templates/          # æ¨¡æ¿
â””â”€â”€ local/                 # æœ¬åœ°å®‰è£
    â”œâ”€â”€ bin/
    â”œâ”€â”€ sbin/
    â””â”€â”€ lib/
```

**å¯¦æ–½ä»»å‹™**:

- [x] âœ… åŸºç¤çµæ§‹å·²å­˜åœ¨
- [ ] ğŸ”„ éƒ¨ç½²æ ¸å¿ƒå¯åŸ·è¡Œæª”æ¡ˆ
- [ ] ğŸ“‹ å®‰è£å…±äº«å‡½å¼åº«
- [ ] ğŸ“š å»ºç«‹æ–‡æª”å’Œæ‰‹å†Š
- [ ] âš™ï¸ å‰µå»ºé…ç½®æ¨¡æ¿

#### ğŸ“‚ `/var` - è®Šå‹•è³‡æ–™

```
var/
â”œâ”€â”€ log/                    # æ—¥èªŒæª”æ¡ˆ
â”‚   â”œâ”€â”€ machine-native-ops/  # æ‡‰ç”¨æ—¥èªŒ
â”‚   â”‚   â”œâ”€â”€ engine.log       # å¼•æ“æ—¥èªŒ
â”‚   â”‚   â”œâ”€â”€ monitoring.log   # ç›£æ§æ—¥èªŒ
â”‚   â”‚   â”œâ”€â”€ api-gateway.log  # API ç¶²é—œæ—¥èªŒ
â”‚   â”‚   â””â”€â”€ database.log     # è³‡æ–™åº«æ—¥èªŒ
â”‚   â”œâ”€â”€ auth.log             # èªè­‰æ—¥èªŒ
â”‚   â”œâ”€â”€ audit.log            # å¯©è¨ˆæ—¥èªŒ
â”‚   â””â”€â”€ system.log           # ç³»çµ±æ—¥èªŒ
â”œâ”€â”€ lib/                    # é‹è¡Œæ™‚è³‡æ–™
â”‚   â”œâ”€â”€ machine-native-ops/  # æ‡‰ç”¨æ•¸æ“š
â”‚   â”‚   â”œâ”€â”€ cache/           # å¿«å–
â”‚   â”‚   â”œâ”€â”€ sessions/        # æœƒè©±
â”‚   â”‚   â”œâ”€â”€ temp/            # è‡¨æ™‚æª”æ¡ˆ
â”‚   â”‚   â””â”€â”€ uploads/         # ä¸Šå‚³æª”æ¡ˆ
â”‚   â”œâ”€â”€ databases/          # è³‡æ–™åº«æª”æ¡ˆ
â”‚   â””â”€â”€ locks/              # é–æª”æ¡ˆ
â”œâ”€â”€ run/                    # é‹è¡Œæ™‚è³‡è¨Š
â”‚   â””â”€â”€ machine-native-ops/  # PID æª”æ¡ˆ
â”‚       â”œâ”€â”€ engine.pid
â”‚       â”œâ”€â”€ monitoring.pid
â”‚       â””â”€â”€ api-gateway.pid
â””â”€â”€ spool/                  # æ’éšŠä»»å‹™
    â””â”€â”€ machine-native-ops/
        â”œâ”€â”€ deployments/    # éƒ¨ç½²ä»»å‹™
        â””â”€â”€ notifications/  # é€šçŸ¥ä»»å‹™
```

**å¯¦æ–½ä»»å‹™**:

- [x] âœ… åŸºç¤ç›®éŒ„å·²å‰µå»º
- [ ] ğŸ“Š é…ç½®æ—¥èªŒè¼ªè½‰ç­–ç•¥
- [ ] ğŸ’¾ å»ºç«‹æ•¸æ“šåº«å­˜å„²çµæ§‹
- [ ] ğŸ” è¨­å®šé‹è¡Œæ™‚æ¬Šé™
- [ ] âš¡ é…ç½® PID ç®¡ç†

#### ğŸ“‚ `/etc` - ç³»çµ±é…ç½®

```
etc/
â”œâ”€â”€ machine-native-ops/      # æ‡‰ç”¨é…ç½®
â”‚   â”œâ”€â”€ config.yaml          # ä¸»é…ç½®æª”æ¡ˆ
â”‚   â”œâ”€â”€ logging.yaml         # æ—¥èªŒé…ç½®
â”‚   â”œâ”€â”€ security.yaml        # å®‰å…¨é…ç½®
â”‚   â”œâ”€â”€ database.yaml        # è³‡æ–™åº«é…ç½®
â”‚   â”œâ”€â”€ monitoring.yaml      # ç›£æ§é…ç½®
â”‚   â””â”€â”€ services/            # æœå‹™é…ç½®
â”‚       â”œâ”€â”€ engine.yaml
â”‚       â”œâ”€â”€ api-gateway.yaml
â”‚       â””â”€â”€ monitoring.yaml
â”œâ”€â”€ init.d/                 # åˆå§‹åŒ–è…³æœ¬
â”‚   â”œâ”€â”€ 00-mno-bootstrap     # ç³»çµ±å•Ÿå‹•
â”‚   â”œâ”€â”€ 10-mno-engine        # å¼•æ“å•Ÿå‹•
â”‚   â”œâ”€â”€ 20-mno-monitoring    # ç›£æ§å•Ÿå‹•
â”‚   â””â”€â”€ 99-mno-finalize      # ç³»çµ±å®Œæˆ
â”œâ”€â”€ systemd/               # Systemd æœå‹™
â”‚   â””â”€â”€ system/
â”‚       â”œâ”€â”€ mno-engine.service
â”‚       â”œâ”€â”€ mno-monitoring.service
â”‚       â””â”€â”€ mno-api-gateway.service
â””â”€â”€ cron.d/                # å®šæ™‚ä»»å‹™
    â””â”€â”€ machine-native-ops  # å‚™ä»½å’Œç¶­è­·ä»»å‹™
```

**å¯¦æ–½ä»»å‹™**:

- [x] âœ… åŸºç¤é…ç½®å·²å»ºç«‹
- [ ] âš™ï¸ å®Œå–„æœå‹™é…ç½®
- [ ] ğŸ”§ å‰µå»º Systemd æœå‹™æª”
- [ ] â° è¨­å®šå®šæ™‚ä»»å‹™
- [ ] ğŸ”’ å¼·åŒ–å®‰å…¨é…ç½®

### Phase 2.2: æ ¸å¿ƒæœå‹™éƒ¨ç½² (6å°æ™‚)

#### ğŸš€ AAPS å¼•æ“æœå‹™

```yaml
# æœå‹™é…ç½®
service:
  name: aaps-engine
  version: 1.0.0
  executable: /usr/bin/aaps-engine
  config: /etc/machine-native-ops/services/engine.yaml
  user: machinenativeops
  group: machinenativeops
  working_dir: /var/lib/machine-native-ops
  
éƒ¨ç½²ä»»å‹™:
- [ ] ğŸ“¦ ç·¨è­¯å’Œæ‰“åŒ… AAPS å¼•æ“
- [ ] ğŸ”§ å‰µå»º Systemd æœå‹™æª”
- [ ] âš™ï¸ é…ç½®æœå‹™åƒæ•¸
- [ ] ğŸ” è¨­å®šå®‰å…¨æ¬Šé™
- [ ] ğŸ“Š é…ç½®ç›£æ§å’Œæ—¥èªŒ
- [ ] ğŸ§ª æ¸¬è©¦æœå‹™å•Ÿå‹•å’Œåœæ­¢
```

#### ğŸ“Š ç›£æ§æœå‹™

```yaml
service:
  name: mno-monitoring
  version: 1.0.0
  executable: /usr/bin/mn-monitor
  config: /etc/machine-native-ops/services/monitoring.yaml
  metrics_port: 9090
  health_endpoint: /health
  
éƒ¨ç½²ä»»å‹™:
- [ ] ğŸ“ˆ é…ç½® Prometheus æŒ‡æ¨™
- [ ] ğŸ“Š å»ºç«‹ Grafana å„€è¡¨æ¿
- [ ] ğŸ”” è¨­å®šè­¦å ±è¦å‰‡
- [ ] ğŸ“‹ é…ç½®å¥åº·æª¢æŸ¥
- [ ] ğŸ§ª æ¸¬è©¦ç›£æ§åŠŸèƒ½
```

#### ğŸŒ API ç¶²é—œæœå‹™

```yaml
service:
  name: mno-api-gateway
  version: 1.0.0
  executable: /usr/bin/mn-gateway
  config: /etc/machine-native-ops/services/api-gateway.yaml
  port: 8080
  ssl_port: 8443
  
éƒ¨ç½²ä»»å‹™:
- [ ] ğŸ”Œ é…ç½® API è·¯ç”±
- [ ] ğŸ”’ è¨­å®š SSL/TLS
- [ ] ğŸ›¡ï¸ é…ç½®èªè­‰å’Œæˆæ¬Š
- [ ] ğŸ“Š é…ç½®é€Ÿç‡é™åˆ¶
- [ ] ğŸ§ª æ¸¬è©¦ API åŠŸèƒ½
```

### Phase 2.3: è‡ªå‹•åŒ–é‹ç¶­ç³»çµ± (4å°æ™‚)

#### ğŸ¤– è‡ªå‹•åŒ–éƒ¨ç½²è…³æœ¬

```bash
# éƒ¨ç½²è‡ªå‹•åŒ–
scripts/deploy/
â”œâ”€â”€ deploy-all.sh           # å…¨ç³»çµ±éƒ¨ç½²
â”œâ”€â”€ deploy-services.sh      # æœå‹™éƒ¨ç½²
â”œâ”€â”€ update-config.sh        # é…ç½®æ›´æ–°
â”œâ”€â”€ backup-system.sh        # ç³»çµ±å‚™ä»½
â””â”€â”€ rollback.sh             # å›æ»¾è…³æœ¬

å¯¦æ–½ä»»å‹™:
- [ ] ğŸ“œ å‰µå»ºéƒ¨ç½²è…³æœ¬
- [ ] ğŸ”§ é…ç½®è‡ªå‹•æ›´æ–°
- [ ] ğŸ’¾ å»ºç«‹å‚™ä»½æ©Ÿåˆ¶
- [ ] ğŸ”„ å¯¦ä½œå›æ»¾åŠŸèƒ½
- [ ] ğŸ§ª æ¸¬è©¦è‡ªå‹•åŒ–æµç¨‹
```

#### ğŸ“‹ ç›£æ§å’Œè­¦å ±

```yaml
# ç›£æ§é…ç½®
monitoring:
  prometheus:
    endpoint: http://localhost:9090
    scrape_interval: 15s
  
  grafana:
    endpoint: http://localhost:3000
    dashboards:
      - system-overview
      - service-metrics
      - error-rates
  
  alerts:
    - service-down
    - high-cpu-usage
    - disk-space-low
    - memory-pressure

å¯¦æ–½ä»»å‹™:
- [ ] ğŸ“ˆ éƒ¨ç½² Prometheus
- [ ] ğŸ“Š é…ç½® Grafana
- [ ] ğŸ”” è¨­å®šè­¦å ±é€šé“
- [ ] ğŸ“‹ å»ºç«‹å„€è¡¨æ¿
- [ ] ğŸ§ª æ¸¬è©¦è­¦å ±åŠŸèƒ½
```

### Phase 2.4: å®‰å…¨åŠ å›º (2å°æ™‚)

#### ğŸ” å®‰å…¨é…ç½®

```yaml
security:
  users:
    machinenativeops:
      shell: /bin/bash
      home: /var/lib/machine-native-ops
      groups: [machinenativeops, systemd-journal]
  
  permissions:
    /etc/machine-native-ops: 750
    /var/lib/machine-native-ops: 750
    /var/log/machine-native-ops: 750
  
  selinux:
    enabled: true
    context: system_u:object_r:machinenativeops_t:s0

å¯¦æ–½ä»»å‹™:
- [ ] ğŸ‘¤ å‰µå»ºå°ˆç”¨æœå‹™ç”¨æˆ¶
- [ ] ğŸ”’ è¨­å®šæª”æ¡ˆæ¬Šé™
- [ ] ğŸ›¡ï¸ é…ç½® SELinux
- [ ] ğŸš« è¨­å®šé˜²ç«ç‰†è¦å‰‡
- [ ] ğŸ” å®‰å…¨æƒæå’Œæ¸¬è©¦
```

## ğŸ“Š å¯¦æ–½æ™‚é–“è¡¨

### Day 1: åŸºç¤å¯¦æ–½ (8å°æ™‚)

- **09:00-12:00**: FHS ç›®éŒ„å…§å®¹å¯¦æ–½
  - usr/ ç›®éŒ„ç¨‹å¼éƒ¨ç½²
  - var/ ç›®éŒ„æ•¸æ“šçµæ§‹
  - etc/ ç›®éŒ„é…ç½®å®Œå–„
  
- **13:00-17:00**: æ ¸å¿ƒæœå‹™éƒ¨ç½²
  - AAPS å¼•æ“å®‰è£é…ç½®
  - ç›£æ§æœå‹™éƒ¨ç½²
  - API ç¶²é—œè¨­å®š

### Day 2: è‡ªå‹•åŒ–å’Œå®‰å…¨ (8å°æ™‚)

- **09:00-12:00**: è‡ªå‹•åŒ–é‹ç¶­
  - éƒ¨ç½²è…³æœ¬é–‹ç™¼
  - ç›£æ§ç³»çµ±é…ç½®
  - å„€è¡¨æ¿å»ºç«‹
  
- **13:00-17:00**: å®‰å…¨åŠ å›ºå’Œæ¸¬è©¦
  - å®‰å…¨é…ç½®å¯¦æ–½
  - æ¬Šé™è¨­å®š
  - ç³»çµ±æ¸¬è©¦é©—è­‰

## ğŸ¯ æˆåŠŸæ¨™æº–

### åŠŸèƒ½æ€§æŒ‡æ¨™

- âœ… æ‰€æœ‰ FHS ç›®éŒ„ 100% å¯¦æ–½
- âœ… æ ¸å¿ƒæœå‹™æ­£å¸¸é‹è¡Œ
- âœ… è‡ªå‹•åŒ–éƒ¨ç½²æˆåŠŸ
- âœ… ç›£æ§è­¦å ±æ­£å¸¸
- âœ… å®‰å…¨é…ç½®æœ‰æ•ˆ

### æ€§èƒ½æŒ‡æ¨™

- ğŸ“Š ç³»çµ±å•Ÿå‹•æ™‚é–“ < 30ç§’
- ğŸ“ˆ æœå‹™éŸ¿æ‡‰æ™‚é–“ < 100ms
- ğŸ’¾ ç£ç¢Ÿä½¿ç”¨ç‡ < 80%
- ğŸ–¥ï¸ CPU ä½¿ç”¨ç‡ < 70%
- ğŸ§  è¨˜æ†¶é«”ä½¿ç”¨ç‡ < 80%

### å¯é æ€§æŒ‡æ¨™

- ğŸ”§ æœå‹™å¯ç”¨ç‡ > 99.9%
- ğŸ”„ æ•…éšœæ¢å¾©æ™‚é–“ < 5åˆ†é˜
- ğŸ“‹ é…ç½®å‚™ä»½æˆåŠŸç‡ 100%
- ğŸ”’ å®‰å…¨äº‹ä»¶éŸ¿æ‡‰ < 1åˆ†é˜
- ğŸ§ª æ¸¬è©¦è¦†è“‹ç‡ > 90%

## ğŸš€ éšæ®µäº¤ä»˜ç‰©

### 1. å®Œæ•´ FHS ç›®éŒ„çµæ§‹

- `/usr/` - ç”¨æˆ¶ç¨‹å¼å’Œå‡½å¼åº«
- `/var/` - è®Šå‹•æ•¸æ“šå’Œæ—¥èªŒ
- `/etc/` - ç³»çµ±é…ç½®
- `/lib/` - ç³»çµ±å‡½å¼åº«
- `/sbin/` - ç³»çµ±ç®¡ç†å·¥å…·

### 2. æ ¸å¿ƒæœå‹™éƒ¨ç½²åŒ…

- AAPS å¼•æ“ v1.0.0
- ç›£æ§æœå‹™ v1.0.0
- API ç¶²é—œ v1.0.0
- è‡ªå‹•åŒ–éƒ¨ç½²è…³æœ¬

### 3. ç›£æ§å’Œé‹ç¶­å·¥å…·

- Prometheus ç›£æ§ç³»çµ±
- Grafana å„€è¡¨æ¿
- è‡ªå‹•åŒ–å‘Šè­¦
- å‚™ä»½å’Œæ¢å¾©å·¥å…·

### 4. æ–‡æª”å’ŒæŒ‡å—

- FHS å¯¦æ–½æ‰‹å†Š
- æœå‹™é‹ç¶­æŒ‡å—
- æ•…éšœæ’é™¤æ–‡æª”
- å®‰å…¨é…ç½®æŒ‡å—

## ğŸ‰ Phase 2 å®Œæˆå¾Œç‹€æ…‹

å®Œæˆç¬¬äºŒéšæ®µå¾Œï¼Œç³»çµ±å°‡é”åˆ°ï¼š

- ğŸ—ï¸ **å®Œæ•´ FHS æ¶æ§‹**: æ¨™æº–åŒ–ç›®éŒ„çµæ§‹
- ğŸš€ **ç”Ÿç”¢å°±ç·’**: å¯ç›´æ¥éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ
- ğŸ”§ **è‡ªå‹•åŒ–é‹ç¶­**: ä¸€éµéƒ¨ç½²å’Œç›£æ§
- ğŸ”’ **å®‰å…¨åŠ å›º**: ä¼æ¥­ç´šå®‰å…¨æ¨™æº–
- ğŸ“Š **å…¨é¢ç›£æ§**: å¯¦æ™‚æ€§èƒ½å’Œå¥åº·ç›£æ§

## ğŸ“‹ ä¸‹ä¸€éšæ®µé è¦½

**Phase 3: é›†æˆæ¸¬è©¦å’Œå„ªåŒ–**

- ç«¯åˆ°ç«¯æ¸¬è©¦
- æ€§èƒ½å„ªåŒ–
- å£“åŠ›æ¸¬è©¦
- æ–‡æª”å®Œå–„
- ç”Ÿç”¢éƒ¨ç½²æº–å‚™

---

**è·¯ç·šåœ–ç‰ˆæœ¬**: v2.0.0  
**æœ€å¾Œæ›´æ–°**: 2025-12-21  
**è² è²¬åœ˜éšŠ**: SuperNinja AI Agent  
**å¯©æ ¸ç‹€æ…‹**: âœ… å·²é©—è­‰ï¼Œæº–å‚™å¯¦æ–½
