apiVersion: machinenativeops.io/v1
kind: RootBootstrapConfig
metadata:
  name: minimal-bootstrap
  version: v1.0.0
  urn: urn:machinenativeops:root:bootstrap-minimal:v1
  description: Minimal platform-grade bootstrap pipeline for Root Layer
  lastUpdated: "2025-01-20T22:00:00Z"
  owner: "system-architect"

spec:
  # === Minimal Bootstrap Pipeline (5 Critical Steps) ===
  bootstrap_pipeline:
    name: "platform-minimal-bootstrap"
    description: "Critical 5-step platform bootstrap sequence"
    version: "v1.0.0"
    criticality: "critical"
    steps:
      # Step 1: Validate Root Layer Integrity
      - step: 1
        name: "validate_root_integrity"
        description: "Validate all root files using Root Validator"
        module: "root-validator"
        action: "run_validation"
        timeout: "120s"
        retry_policy:
          max_attempts: 3
          backoff: "exponential"
          initial_delay: "5s"
        success_criteria:
          - "validation_report.summary.overall_status = 'PASSED'"
          - "validation_report.summary.success_rate >= 95%"
        failure_action: "abort_bootstrap"
        outputs:
          - name: "validation_report"
            type: "json_report"
            destination: "var/audit/root-validate-report.json"
          - name: "hash_lock"
            type: "json"
            destination: "root.hashlock.json"
      
      # Step 2: Load Governance Framework
      - step: 2
        name: "load_governance_framework"
        description: "Initialize governance and policy engine"
        module: "governance-engine"
        action: "load_governance_framework"
        timeout: "90s"
        retry_policy:
          max_attempts: 2
          backoff: "fixed"
          delay: "10s"
        dependencies:
          - "validate_root_integrity"
        inputs:
          - name: "governance_config"
            source: "root.governance.yaml"
          - name: "naming_policy"
            source: "root.naming-policy.yaml"
        success_criteria:
          - "governance_engine.status = 'active'"
          - "all_policies_loaded = true"
        failure_action: "abort_bootstrap"
        outputs:
          - name: "governance_status"
            type: "status"
            destination: "var/run/governance-engine.status"
      
      # Step 3: Load Module Registry
      - step: 3
        name: "load_module_registry"
        description: "Register and initialize core modules"
        module: "super-execution-engine"
        action: "register_modules"
        timeout: "180s"
        retry_policy:
          max_attempts: 2
          backoff: "fixed"
          delay: "15s"
        dependencies:
          - "load_governance_framework"
        inputs:
          - name: "modules_config"
            source: "root.modules.yaml"
          - name: "module_registry"
            source: "root.registry.modules.yaml"
        success_criteria:
          - "all_modules_registered = true"
          - "dependency_graph_valid = true"
        failure_action: "abort_bootstrap"
        outputs:
          - name: "module_registry_status"
            type: "json"
            destination: "var/run/module-registry.json"
      
      # Step 4: Initialize Trust Chain
      - step: 4
        name: "initialize_trust_chain"
        description: "Setup trust chain and certificate management"
        module: "trust-manager"
        action: "initialize_trust_chain"
        timeout: "120s"
        retry_policy:
          max_attempts: 3
          backoff: "exponential"
          initial_delay: "10s"
        dependencies:
          - "load_module_registry"
        inputs:
          - name: "trust_config"
            source: "root.trust.yaml"
          - name: "hash_lock"
            source: "root.hashlock.json"
        success_criteria:
          - "trust_chain_established = true"
          - "certificate_authority_ready = true"
        failure_action: "abort_bootstrap"
        outputs:
          - name: "trust_status"
            type: "status"
            destination: "var/run/trust-manager.status"
      
      # Step 5: Finalize + Emit Provenance
      - step: 5
        name: "finalize_and_emit_provenance"
        description: "Finalize bootstrap and create provenance record"
        module: "provenance-tracker"
        action: "create_bootstrap_provenance"
        timeout: "60s"
        retry_policy:
          max_attempts: 2
          backoff: "fixed"
          delay: "5s"
        dependencies:
          - "validate_root_integrity"
          - "load_governance_framework"
          - "load_module_registry"
          - "initialize_trust_chain"
        inputs:
          - name: "bootstrap_steps"
            source: "pipeline_execution_context"
          - name: "validation_report"
            source: "var/audit/root-validate-report.json"
          - name: "hash_lock"
            source: "root.hashlock.json"
        success_criteria:
          - "provenance_record_created = true"
          - "bootstrap_evidence_complete = true"
        failure_action: "create_incident_continue"
        outputs:
          - name: "bootstrap_provenance"
            type: "json"
            destination: "var/audit/bootstrap-provenance.json"
          - name: "platform_ready_signal"
            type: "signal"
            destination: "var/run/platform.ready"

  # === Bootstrap Execution Context ===
  execution_context:
    platform_name: "MachineNativeOps"
    platform_version: "v1.0.0"
    bootstrap_version: "v1.0.0"
    environment: "production"
    
    # Evidence collection requirements
    evidence_requirements:
      - "validation_reports"
      - "hash_locks"
      - "governance_loaded"
      - "modules_registered"
      - "trust_established"
      - "provenance_created"
    
    # Critical success indicators
    success_indicators:
      - "root.validation.passed"
      - "governance.engine.active"
      - "modules.registry.ready"
      - "trust.chain.established"
      - "provenance.record.created"
    
    # Failure escalation paths
    failure_escalation:
      critical_failure:
        - "emergency_stop_all_modules"
        - "create_bootstrap_incident"
        - "notify_system_administrator"
      non_critical_failure:
        - "create_warning_log"
        - "continue_with_degraded_mode"

  # === Platform Ready Signals ===
  platform_ready_signals:
    file_signals:
      - path: "var/run/platform.ready"
        content: "MachineNativeOps Platform v1.0.0 - Bootstrap Completed"
      - path: "var/run/bootstrap.status"
        content: "completed"
    
    process_signals:
      - "governance-engine:ready"
      - "trust-manager:ready"
      - "provenance-tracker:ready"
    
    network_signals:
      - port: 8080
        service: "platform-status"
        endpoint: "/health"
        expected_response: '{"status": "ready", "version": "v1.0.0"}'

status:
  phase: "Active"
  version: "v1.0.0"
  lastBootstrap: "pending"
  bootstrapHistory: []