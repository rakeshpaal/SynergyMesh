# MachineNativeOps 治理閉環系統配置
# 可強制執行、可產生證據、可追溯、可回滾、可重播、可重現

# 基本配置
system:
  name: "MachineNativeOps Governance Closed Loop"
  version: "v1.0"
  environment: "production"
  
# 證據存儲配置
evidence_base_dir: "./governance/evidence"
exceptions_dir: "./governance/exceptions"
rollback_dir: "./governance/rollback"

# Gate 分級配置
gate_thresholds:
  hard:
    threshold: 100
    action: "BLOCK"
    description: "嚴格阻斷，零容忍"
    requires_override: false
    
  soft:
    threshold: 95
    action: "WARN_WITH_OVERRIDE"
    description: "警告但可例外，需要批准"
    override_requires: ["security-lead", "product-owner"]
    
  observe:
    threshold: 80
    action: "LOG_ONLY"
    description: "僅記錄，不阻斷"
    override_requires: []

# 雙 Hash 演算法配置
hash_standards:
  content:
    algorithm: "sha256"
    output_length: 256
    description: "檔案內容完整性驗證"
    
  semantic:
    algorithm: "sha3-512"
    output_length: 512
    description: "規範化內容語意驗證"
    canonicalization: "strict"

# 存儲策略
storage:
  immutable: true
  retention_years: 7
  encryption:
    at_rest: true
    in_transit: true
    algorithm: "AES-256-GCM"
  backup:
    enabled: true
    frequency: "daily"
    retention: "30d"

# 例外管理配置
exception_management:
  approval_matrix:
    CRITICAL:
      requires: ["cto", "security-committee"]
      max_duration: "7d"
      renewal_requires: "re-assessment"
      
    HIGH:
      requires: ["security-lead", "product-owner"]
      max_duration: "30d"
      renewal_requires: "security-review"
      
    MEDIUM:
      requires: ["team-lead"]
      max_duration: "90d"
      renewal_requires: "risk-assessment"
      
  notifications:
    expiry_reminder: ["3d", "1d", "6h"]
    escalation:
      expired: ["security-committee", "audit-team"]
      critical: ["cto", "board"]

# 回滾配置
rollback:
  automatic_creation: true
  max_rollback_points: 10
  retention_days: 30
  validation_timeout: "10m"
  
  rollback_plan:
    stop_timeout: "5m"
    restore_timeout: "15m"
    verify_timeout: "10m"
    scale_timeout: "5m"

# 重播驗證配置
replay_validation:
  consistency_threshold: 95.0
  critical_stage_threshold: 100.0
  security_stage_threshold: 100.0
  max_time_drift: "5m"
  
  replay_schedule:
    automatic: true
    frequency: "weekly"
    random_window: "2h"

# KPI 監控配置
kpi_monitoring:
  collection_interval: "5m"
  retention_days: 90
  
  alerts:
    high_gate_block_rate:
      threshold: 10
      severity: "warning"
      
    low_evidence_completeness:
      threshold: 95
      severity: "critical"
      
    drift_event_detected:
      threshold: 0
      severity: "high"

# GitOps 整合配置
gitops:
  enabled: true
  repository: "https://github.com/MachineNativeOps/manifests"
  branch: "main"
  
  admission_controller:
    type: "kyverno"
    enforcement_mode: "enforce"
    
  namespaces:
    production:
      gate_level: "hard"
      monitoring: "enhanced"
    staging:
      gate_level: "soft"
      monitoring: "standard"
    development:
      gate_level: "observe"
      monitoring: "basic"

# 監控配置
monitoring:
  drift_detection:
    enabled: true
    schedule: "*/5 * * * *"
    
  runtime_monitoring:
    enabled: true
    tool: "falco"
    rules_file: "falco-rules.yaml"
    
  audit_logging:
    enabled: true
    level: "info"
    destination: ["file", "elasticsearch"]