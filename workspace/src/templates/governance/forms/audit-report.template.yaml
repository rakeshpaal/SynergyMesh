apiVersion: governance.machinenativeops.io/v1alpha1
kind: AuditReport
metadata:
  # 审计报告唯一标识符 (格式: AUD-YYYY-MM)
  id: "AUD-YYYY-MM"

  # 报告标题
  title: "YYYY年MM月治理审计报告"

  # 审计周期
  period:
    startDate: "YYYY-MM-DD"
    endDate: "YYYY-MM-DD"

  # 生成时间 (自动填充)
  generatedAt: "YYYY-MM-DDTHH:MM:SSZ"

  # 审计人
  auditor: "governance-team"

spec:
  # 审计范围 (必填)
  scope:
    # 审计的治理模块
    modules:
      - "naming-governance"
      - "change-management"
      - "exception-handling"

    # 审计的环境
    environments:
      - "production"
      - "staging"

    # 审计的团队
    teams:
      - "backend"
      - "frontend"
      - "platform"

  # 合规指标
  complianceMetrics:
    # 命名合规性
    namingCompliance:
      rate: 0.0              # 合规率 (百分比)
      total: 0               # 总资源数
      compliant: 0           # 合规资源数
      nonCompliant: 0        # 不合规资源数

    # 变更管理
    changeManagement:
      totalChanges: 0        # 总变更数
      successRate: 0.0       # 成功率 (百分比)
      averageLeadTime: ""    # 平均交付时间

    # 例外管理
    exceptionManagement:
      activeExceptions: 0    # 活跃例外数
      expiredExceptions: 0   # 过期例外数
      averageDuration: ""    # 平均持续时间

  # 审计发现 (必填)
  findings:
    - id: "F-001"
      severity: "critical"   # critical | high | medium | low | info
      category: "policy-violation"  # policy-violation | process-gap | documentation | training | tooling
      description: |
        详细描述发现的问题。
        例如: "发现 12 个生产环境资源未遵循命名规范"

      # 证据
      evidence:
        - "生产环境资源列表"
        - "违规示例截图"

      # 影响
      impact: |
        描述对组织的影响。
        例如: "可能导致自动化工具无法识别，影响运维效率"

      # 建议
      recommendation: |
        提供解决方案建议。
        例如: "创建变更请求进行重命名，或申请例外"

      # 负责人
      owner: "backend-team"

      # 截止日期
      dueDate: "YYYY-MM-DD"

      # 状态
      status: "open"  # open | in-progress | resolved | accepted-risk

  # 总结 (必填)
  summary:
    # 总体评估
    overallAssessment: "good"  # excellent | good | needs-improvement | poor

    # 关键要点
    keyTakeaways:
      - "要点1"
      - "要点2"
      - "要点3"

    # 优势
    strengths:
      - "优势1"
      - "优势2"

    # 改进领域
    improvements:
      - "需要改进的地方1"
      - "需要改进的地方2"

    # 趋势分析
    trends: |
      描述趋势变化。
      例如: "过去三个月合规率稳步提升 (87% -> 89% -> 92.5%)"

  # 行动计划
  actionPlan:
    - description: "行动项描述"
      owner: "负责人"
      priority: "P1"      # P0 | P1 | P2 | P3
      dueDate: "YYYY-MM-DD"
      relatedFindings:
        - "F-001"

  # 与上次审计的对比 (可选)
  previousAudit:
    id: "AUD-YYYY-MM"
    improvementRate: 0.0     # 改进率 (百分比)
    resolvedFindings: 0      # 已解决的发现数
    newFindings: 0           # 新发现数

---
# 填写指南
#
# 1. 审计周期
#    - 通常为月度或季度
#    - 确保时间范围清晰
#
# 2. 审计范围
#    - 明确审计哪些模块、环境、团队
#    - 范围要可执行和可验证
#
# 3. 合规指标
#    - 使用实际数据
#    - 可以从监控系统自动获取
#    - 提供趋势对比
#
# 4. 审计发现
#    - 按严重性分类
#    - 提供证据和影响分析
#    - 给出可执行的建议
#    - 指定负责人和截止日期
#
# 5. 发现严重性定义
#    - Critical: 严重影响安全或合规，需立即处理
#    - High: 重要问题，需优先处理
#    - Medium: 中等影响，应及时处理
#    - Low: 小问题，可以计划处理
#    - Info: 信息性建议
#
# 6. 总体评估标准
#    - Excellent: 合规率 > 98%，无高严重性发现
#    - Good: 合规率 90-98%，少量高严重性发现
#    - Needs Improvement: 合规率 80-90%，多个高严重性发现
#    - Poor: 合规率 < 80%，严重问题多
#
# 7. 行动计划
#    - 每个发现都应有对应的行动项
#    - 优先级基于严重性和影响
#    - 负责人明确，截止日期合理
#
# 8. 提交前检查清单
#    [ ] 所有合规指标已填写
#    [ ] 发现描述清晰，有证据支持
#    [ ] 每个发现都有建议和负责人
#    [ ] 行动计划完整且可执行
#    [ ] 与上次审计有对比分析
#    [ ] 总结客观，反映实际情况
