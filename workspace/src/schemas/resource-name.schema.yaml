# Resource Name Schema
# 用于验证资源命名是否符合组织标准
$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://machinenativeops.io/schemas/resource-name.schema.yaml"
title: "Resource Name Schema"
description: "Schema for validating resource names across different environments and resource types"
type: object
required:
  - environment
  - app
  - resourceType
  - version
properties:
  environment:
    type: string
    description: "目标环境"
    pattern: "^(dev|staging|prod)$"
    examples:
      - "dev"
      - "staging"
      - "prod"

  app:
    type: string
    description: "应用名称（小写、数字、连字符，3-30字符）"
    pattern: "^[a-z0-9-]{3,30}$"
    minLength: 3
    maxLength: 30
    examples:
      - "payment-service"
      - "user-api"
      - "order-processor"

  resourceType:
    type: string
    description: "资源类型缩写"
    enum:
      - "deploy"      # Deployment
      - "svc"         # Service
      - "ing"         # Ingress
      - "cm"          # ConfigMap
      - "secret"      # Secret
      - "pvc"         # PersistentVolumeClaim
      - "sa"          # ServiceAccount
      - "job"         # Job
      - "cronjob"     # CronJob
      - "hpa"         # HorizontalPodAutoscaler
    examples:
      - "deploy"
      - "svc"

  version:
    type: string
    description: "语义化版本号"
    pattern: "^v\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9]+)?$"
    examples:
      - "v1.0.0"
      - "v2.3.1"
      - "v1.0.0-beta1"
      - "v3.2.0-rc2"

  namespace:
    type: string
    description: "Kubernetes命名空间（可选）"
    pattern: "^[a-z0-9-]{1,63}$"
    examples:
      - "production"
      - "dev-team-a"

  region:
    type: string
    description: "地理区域（可选）"
    pattern: "^[a-z]{2}-[a-z]+-\\d+$"
    examples:
      - "us-west-1"
      - "ap-southeast-1"

# 命名模式示例
examples:
  - environment: "prod"
    app: "payment"
    resourceType: "deploy"
    version: "v1.3.0"
    # 生成: prod-payment-deploy-v1.3.0

  - environment: "staging"
    app: "user-api"
    resourceType: "svc"
    version: "v2.0.0-beta1"
    # 生成: staging-user-api-svc-v2.0.0-beta1

  - environment: "dev"
    app: "order-processor"
    resourceType: "deploy"
    version: "v1.0.0"
    namespace: "dev-team-b"
    # 生成: dev-order-processor-deploy-v1.0.0

# 反例（不符合规范）
counterExamples:
  - environment: "production"      # 错误: 应该是 "prod"
    app: "payment"
    resourceType: "deploy"
    version: "v1.3.0"

  - environment: "prod"
    app: "Payment_Service"         # 错误: 包含大写和下划线
    resourceType: "deploy"
    version: "v1.3.0"

  - environment: "prod"
    app: "payment"
    resourceType: "deployment"     # 错误: 应该是缩写 "deploy"
    version: "v1.3.0"

  - environment: "prod"
    app: "payment"
    resourceType: "deploy"
    version: "1.3.0"              # 错误: 缺少 "v" 前缀
