# Dashboard Widgets Configuration
# Defines the layout and data bindings for dashboard components

version: "1.0"
dashboard:
  name: "System Monitoring Dashboard"
  refreshInterval: 5000  # milliseconds
  layout: "grid"
  columns: 12
  gap: 16  # pixels

# Metric Cards - Top Row
metricCards:
  - id: "total-requests"
    title: "Total Requests"
    type: "counter"
    position:
      column: 0
      span: 3
      row: 0
    dataSource:
      endpoint: "/api/v1/metrics/timeseries"
      params:
        metric: "requests"
        timeRange: "24h"
        aggregation: "sum"
      refreshInterval: 5000
    display:
      format: "number"
      decimals: 0
      prefix: ""
      suffix: ""
      showTrend: true
      trendPeriod: "24h"
    thresholds:
      - value: 1000000
        status: "critical"
        color: "#ef4444"
      - value: 500000
        status: "warning"
        color: "#f59e0b"
      - value: 0
        status: "normal"
        color: "#10b981"

  - id: "active-services"
    title: "Active Services"
    type: "status"
    position:
      column: 3
      span: 3
      row: 0
    dataSource:
      endpoint: "/api/v1/system/health"
      refreshInterval: 10000
    display:
      format: "ratio"
      showStatus: true
      statusText:
        healthy: "All Healthy"
        degraded: "Degraded"
        critical: "Issues Detected"
    thresholds:
      - value: 100
        status: "healthy"
        color: "#10b981"
      - value: 80
        status: "warning"
        color: "#f59e0b"
      - value: 0
        status: "critical"
        color: "#ef4444"

  - id: "cpu-usage"
    title: "CPU Usage"
    type: "gauge"
    position:
      column: 6
      span: 3
      row: 0
    dataSource:
      endpoint: "/api/v1/metrics/timeseries"
      params:
        metric: "cpu"
        timeRange: "1h"
        aggregation: "avg"
      refreshInterval: 5000
    display:
      format: "percentage"
      decimals: 1
      showIndicator: true
      indicatorType: "icon"  # "icon" | "text" | "bar"
    thresholds:
      - value: 85
        status: "critical"
        color: "#ef4444"
        icon: "alert-triangle"
      - value: 70
        status: "warning"
        color: "#f59e0b"
        icon: "alert-circle"
      - value: 0
        status: "normal"
        color: "#10b981"
        icon: "check-circle"

  - id: "response-time"
    title: "Avg Response Time"
    type: "gauge"
    position:
      column: 9
      span: 3
      row: 0
    dataSource:
      endpoint: "/api/v1/metrics/timeseries"
      params:
        metric: "responseTime"
        timeRange: "1h"
        aggregation: "avg"
      refreshInterval: 5000
    display:
      format: "duration"
      unit: "ms"
      decimals: 0
      showTrend: true
    thresholds:
      - value: 1000
        status: "critical"
        color: "#ef4444"
      - value: 500
        status: "warning"
        color: "#f59e0b"
      - value: 0
        status: "normal"
        color: "#10b981"

# Panels - Main Content
panels:
  - id: "system-health"
    title: "System Health"
    type: "service-status"
    position:
      column: 0
      span: 6
      row: 1
    height: 400
    dataSource:
      endpoint: "/api/v1/system/health"
      refreshInterval: 10000
    display:
      showDetails: true
      showUptime: true
      showResponseTime: true
      sortBy: "status"  # "status" | "name" | "responseTime"
      sortOrder: "asc"
    services:
      - name: "api-gateway"
        displayName: "API Gateway"
        icon: "server"
        healthCheck:
          endpoint: "/health"
          timeout: 5000
      - name: "scheduler"
        displayName: "Scheduler Service"
        icon: "clock"
        healthCheck:
          endpoint: "/health"
          timeout: 5000
      - name: "redis"
        displayName: "Redis Cache"
        icon: "database"
        healthCheck:
          endpoint: "/ping"
          timeout: 3000
      - name: "database"
        displayName: "PostgreSQL"
        icon: "database"
        healthCheck:
          endpoint: "/health"
          timeout: 5000
      - name: "auth"
        displayName: "Auth Service"
        icon: "shield"
        healthCheck:
          endpoint: "/health"
          timeout: 5000
      - name: "monitoring"
        displayName: "Monitoring"
        icon: "activity"
        healthCheck:
          endpoint: "/health"
          timeout: 5000

  - id: "resource-usage"
    title: "Resource Usage"
    type: "resource-monitor"
    position:
      column: 6
      span: 6
      row: 1
    height: 400
    dataSource:
      endpoint: "/api/v1/metrics/timeseries"
      refreshInterval: 5000
    display:
      chartType: "progress"  # "progress" | "line" | "area"
      timeRange: "24h"
      showHistory: true
    resources:
      - name: "cpu"
        displayName: "CPU"
        icon: "cpu"
        unit: "%"
        params:
          metric: "cpu"
          aggregation: "avg"
        thresholds:
          critical: 90
          warning: 75
      - name: "memory"
        displayName: "Memory"
        icon: "hard-drive"
        unit: "%"
        params:
          metric: "memory"
          aggregation: "avg"
        thresholds:
          critical: 90
          warning: 80
      - name: "disk"
        displayName: "Disk"
        icon: "hard-drive"
        unit: "%"
        params:
          metric: "disk"
          aggregation: "avg"
        thresholds:
          critical: 95
          warning: 85
      - name: "network"
        displayName: "Network"
        icon: "wifi"
        unit: "Mbps"
        params:
          metric: "network"
          aggregation: "avg"
        thresholds:
          critical: 900
          warning: 750

  - id: "activity-feed"
    title: "Recent Activity"
    type: "activity-feed"
    position:
      column: 0
      span: 6
      row: 2
    height: 400
    dataSource:
      endpoint: "/api/v1/metrics/events"
      params:
        limit: 20
        orderBy: "timestamp"
        order: "desc"
      refreshInterval: 15000
    display:
      showTimestamp: true
      timestampFormat: "relative"  # "relative" | "absolute"
      showIcons: true
      showSeverity: true
      groupBy: "none"  # "none" | "type" | "severity"
      maxItems: 20
    filters:
      - name: "type"
        options: ["all", "job", "alert", "config", "service"]
        default: "all"
      - name: "severity"
        options: ["all", "info", "warning", "error"]
        default: "all"
    eventTypes:
      - type: "job.scheduled"
        icon: "calendar"
        color: "#3b82f6"
        severity: "info"
      - type: "job.completed"
        icon: "check-circle"
        color: "#10b981"
        severity: "info"
      - type: "job.failed"
        icon: "x-circle"
        color: "#ef4444"
        severity: "error"
      - type: "alert.triggered"
        icon: "alert-triangle"
        color: "#f59e0b"
        severity: "warning"
      - type: "config.changed"
        icon: "settings"
        color: "#8b5cf6"
        severity: "info"
      - type: "service.restarted"
        icon: "refresh-cw"
        color: "#06b6d4"
        severity: "warning"

  - id: "log-viewer"
    title: "System Logs"
    type: "log-viewer"
    position:
      column: 6
      span: 6
      row: 2
    height: 400
    dataSource:
      endpoint: "/api/v1/metrics/logs"
      params:
        limit: 100
        orderBy: "timestamp"
        order: "desc"
      refreshInterval: 5000
      streaming: true  # Enable WebSocket streaming
      streamEndpoint: "ws://localhost:8000/api/v1/metrics/logs/stream"
    display:
      showTimestamp: true
      timestampFormat: "HH:mm:ss"
      showService: true
      showLevel: true
      maxLines: 100
      autoScroll: true
      lineWrap: false
      fontSize: "sm"  # "xs" | "sm" | "base"
    filters:
      - name: "level"
        options: ["all", "debug", "info", "warn", "error"]
        default: "all"
      - name: "service"
        options: ["all", "api-gateway", "scheduler", "auth", "monitoring"]
        default: "all"
    search:
      enabled: true
      placeholder: "Search logs..."
      caseSensitive: false
      regex: false
    export:
      enabled: true
      formats: ["txt", "json", "csv"]
      maxLines: 10000
    levelColors:
      debug: "#94a3b8"
      info: "#3b82f6"
      warn: "#f59e0b"
      error: "#ef4444"

# Global Settings
settings:
  theme: "dark"
  animations: true
  notifications:
    enabled: true
    position: "top-right"
    duration: 5000
  autoRefresh:
    enabled: true
    pauseOnHover: true
    pauseOnFocus: true
  errorHandling:
    retryAttempts: 3
    retryDelay: 1000
    showErrors: true
  performance:
    enableVirtualization: true
    batchUpdates: true
    debounceDelay: 300

# Responsive Breakpoints
responsive:
  mobile:
    maxWidth: 767
    columns: 12
    layout:
      metricCards:
        span: 12  # Full width on mobile
      panels:
        span: 12  # Full width on mobile
  tablet:
    minWidth: 768
    maxWidth: 1023
    columns: 12
    layout:
      metricCards:
        span: 6  # 2 cards per row
      panels:
        span: 12  # Full width on tablet
  desktop:
    minWidth: 1024
    columns: 12
    layout:
      metricCards:
        span: 3  # 4 cards per row
      panels:
        span: 6  # 2 panels per row

# Custom Actions
actions:
  - id: "refresh-all"
    label: "Refresh All"
    icon: "refresh-cw"
    shortcut: "Ctrl+R"
    action: "refresh"
  - id: "export-data"
    label: "Export Data"
    icon: "download"
    action: "export"
    formats: ["json", "csv", "pdf"]
  - id: "toggle-fullscreen"
    label: "Fullscreen"
    icon: "maximize"
    shortcut: "F11"
    action: "fullscreen"
  - id: "configure"
    label: "Configure Dashboard"
    icon: "settings"
    action: "configure"
    requiresRole: "admin"

# Alert Rules (optional - for future use)
alerts:
  - id: "high-cpu"
    name: "High CPU Usage"
    condition:
      metric: "cpu"
      operator: ">"
      value: 85
      duration: 300  # seconds
    severity: "warning"
    notification:
      enabled: true
      channels: ["dashboard", "email"]
  - id: "service-down"
    name: "Service Down"
    condition:
      metric: "service.status"
      operator: "=="
      value: "down"
      duration: 60
    severity: "critical"
    notification:
      enabled: true
      channels: ["dashboard", "email", "slack"]
