# =============================================================================
# SynergyMesh Governance - Workflow Package
# Workflow orchestration and state management
# =============================================================================

apiVersion: governance.machinenativeops.io/v2
kind: Package
metadata:
  name: workflow
  version: "1.0.0"
  description: "Workflow orchestration and state machine management"
  owner: governance-bot
  created_at: "2025-12-11T00:00:00Z"

spec:
  type: utility
  language: python

  exports:
    - name: WorkflowEngine
      type: class
      description: "Workflow execution engine"
    - name: StateMachine
      type: class
      description: "State machine implementation"
    - name: TaskQueue
      type: class
      description: "Asynchronous task queue"
    - name: ApprovalWorkflow
      type: class
      description: "Multi-level approval workflow"
    - name: execute_workflow
      type: function
      description: "Execute workflow definition"
    - name: transition_state
      type: function
      description: "Transition state machine"

  dependencies:
    required:
      - name: logging
        type: internal
        version: "1.0.0"
      - name: audit
        type: internal
        version: "1.0.0"
      - name: transitions
        version: ">=0.9.0"
    optional:
      - name: celery
        version: ">=5.3.0"
      - name: temporal-sdk
        version: ">=1.0.0"

  configuration:
    engine:
      type: string
      enum: [local, celery, temporal]
      default: local
    persistence:
      enabled:
        type: boolean
        default: true
      backend:
        type: string
        enum: [memory, redis, database]
        default: database
    timeouts:
      default_task_timeout:
        type: integer
        default: 300
      default_workflow_timeout:
        type: integer
        default: 3600

  interfaces:
    - name: run_workflow
      inputs:
        - name: workflow_id
          type: string
        - name: definition
          type: object
        - name: input
          type: object
      outputs:
        - name: execution_id
          type: string
        - name: status
          type: string
        - name: result
          type: object
        - name: audit_trail
          type: array

  workflow_types:
    - name: approval
      description: "Multi-level approval workflow"
      steps:
        - submit
        - review
        - approve
        - execute
    - name: deployment
      description: "Deployment workflow"
      steps:
        - validate
        - build
        - test
        - deploy
        - verify
    - name: incident
      description: "Incident response workflow"
      steps:
        - detect
        - triage
        - investigate
        - resolve
        - postmortem

  compliance:
    - "All state transitions must be audited"
    - "Timeouts must be enforced"
    - "Failed workflows must trigger alerts"
