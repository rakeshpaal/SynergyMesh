# =============================================================================
# SynergyMesh Governance - Dimension Module
# 40-self-healing: Self-Healing Governance
# =============================================================================
# Machine-First Format: YAML
# Validation: JSON Schema Enforced
# =============================================================================

apiVersion: governance.machinenativeops.io/v2
kind: DimensionModule
metadata:
  id: "40-self-healing"
  name: "自癒治理"
  name_en: "Self-Healing Governance"
  version: "1.0.0"
  created_at: "2025-12-11T15:30:50Z"
  updated_at: "2025-12-11T15:30:50Z"
  owner: governance-bot
  category: execution
  tags: ["self-healing", "recovery", "detection", "prevention"]

spec:
  description: "自動復原、故障偵測與預防性維護"

  # Schema reference
  schema:
    path: "./schema.json"
    format: json-schema
    validation: required

  # Policy reference
  policy:
    path: "./policy.rego"
    engine: opa
    enforcement: required

  # Dependencies
  dependencies:
    required: ["39-automation", "04-risk"]
    optional: []

  # Interface definition
  interface:
    inputs:
      - name: config
        type: object
        required: true
        schema_ref: "#/definitions/config"
      - name: context
        type: object
        required: false
        schema_ref: "#/definitions/context"
    outputs:
      - name: result
        type: object
        schema_ref: "#/definitions/result"
      - name: audit_log
        type: object
        schema_ref: "#/definitions/audit_log"
    errors:
      - code: "E40001"
        name: "ValidationError"
        description: "Input validation failed"
      - code: "E40002"
        name: "PolicyViolation"
        description: "Policy check failed"
      - code: "E40003"
        name: "DependencyError"
        description: "Required dependency unavailable"

  # Behavior contracts
  behavior:
    invariants:
      - "All operations must be auditable"
      - "State changes require validation"
      - "Dependencies must be satisfied"
    preconditions:
      - "Input must conform to schema"
      - "Required dependencies available"
    postconditions:
      - "Output conforms to schema"
      - "Audit log generated"
    side_effects:
      - "Generates audit trail"
      - "May update metrics"

  # Lifecycle management
  lifecycle:
    states:
      - pending
      - initializing
      - active
      - degraded
      - maintenance
      - retiring
      - retired
    transitions:
      - from: pending
        to: initializing
        trigger: initialize
      - from: initializing
        to: active
        trigger: activation_complete
      - from: active
        to: degraded
        trigger: health_check_failed
      - from: degraded
        to: active
        trigger: recovery_complete
      - from: active
        to: maintenance
        trigger: maintenance_start
      - from: maintenance
        to: active
        trigger: maintenance_complete
      - from: active
        to: retiring
        trigger: deprecation_start
      - from: retiring
        to: retired
        trigger: retirement_complete

  # Metrics
  metrics:
    - name: "self-healing_operations_total"
      type: counter
      description: "Total operations executed"
    - name: "self-healing_operation_duration_seconds"
      type: histogram
      description: "Operation duration in seconds"
    - name: "self-healing_errors_total"
      type: counter
      description: "Total errors encountered"
    - name: "self-healing_health_status"
      type: gauge
      description: "Current health status (0=unhealthy, 1=healthy)"

  # Compliance
  compliance:
    frameworks:
      - ISO-42001
      - NIST-AI-RMF
      - COBIT-2019
    controls: []
    audit_frequency: continuous

status: active
