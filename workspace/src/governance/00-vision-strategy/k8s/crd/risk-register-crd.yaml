---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: riskregisters.governance.machinenativeops.io
  labels:
    app: "governance-framework"
    component: "risk-management"
    version: "v1"
  annotations:
    description: "Risk Register CRD for governance risk management"
    governance.machinenativeops.io/category: "strategic"
    governance.machinenativeops.io/layer: "execution"
spec:
  group: governance.machinenativeops.io
  versions:
  - name: v1
    served: true
    storage: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            required:
            - riskId
            - category
            - probability
            - impact
            - riskLevel
            properties:
              riskId:
                type: string
                pattern: '^RISK-[0-9]{4}-[0-9]{3}$'
                description: "Unique risk identifier in format RISK-YYYY-NNN"
                example: "RISK-2025-001"
              title:
                type: string
                maxLength: 200
                description: "Risk title or summary"
                example: "Data breach in customer database"
              description:
                type: string
                maxLength: 2000
                description: "Detailed risk description"
                example: "Potential unauthorized access to sensitive customer data due to inadequate security controls"
              category:
                type: string
                enum: [strategic, operational, financial, security, compliance, reputational, environmental]
                description: "Risk category classification"
                example: "security"
              subcategory:
                type: string
                maxLength: 100
                description: "More specific risk subcategory"
                example: "cybersecurity"
              probability:
                type: number
                minimum: 0
                maximum: 1
                format: float
                description: "Probability of occurrence (0.0 to 1.0)"
                example: 0.3
              impact:
                type: number
                minimum: 0
                maximum: 10
                format: float
                description: "Impact level (0 to 10)"
                example: 8.5
              riskLevel:
                type: string
                enum: [critical, high, medium, low]
                description: "Calculated risk level based on probability and impact"
                example: "high"
              riskScore:
                type: number
                minimum: 0
                maximum: 10
                format: float
                description: "Calculated risk score (probability * impact)"
                example: 2.55
              owner:
                type: string
                maxLength: 100
                description: "Risk owner responsible for mitigation"
                example: "security-team"
              department:
                type: string
                maxLength: 100
                description: "Department responsible for the risk"
                example: "IT Security"
              identifiedDate:
                type: string
                format: date
                description: "Date when risk was identified"
                example: "2025-01-15"
              reviewDate:
                type: string
                format: date
                description: "Next review date"
                example: "2025-04-15"
              mitigationStrategy:
                type: string
                maxLength: 1000
                description: "Strategy to mitigate the risk"
                example: "Implement multi-factor authentication and regular security audits"
              mitigationStatus:
                type: string
                enum: [not_started, in_progress, completed, monitored]
                description: "Status of mitigation efforts"
                example: "in_progress"
              mitigationCost:
                type: number
                minimum: 0
                description: "Estimated cost of mitigation in USD"
                example: 50000
              residualRisk:
                type: number
                minimum: 0
                maximum: 10
                format: float
                description: "Residual risk after mitigation"
                example: 1.5
              relatedRisks:
                type: array
                items:
                  type: string
                description: "List of related risk IDs"
                example: ["RISK-2025-002", "RISK-2025-003"]
              tags:
                type: array
                items:
                  type: string
                description: "Risk tags for categorization"
                example: ["cybersecurity", "data-protection", "compliance"]
              complianceFrameworks:
                type: array
                items:
                  type: string
                  enum: [SOX, ISO-27001, GDPR, HIPAA, PCI-DSS, NIST, SOC2]
                description: "Relevant compliance frameworks"
                example: ["GDPR", "ISO-27001"]
              businessImpact:
                type: object
                properties:
                  financial:
                    type: number
                    description: "Estimated financial impact in USD"
                    example: 1000000
                  operational:
                    type: string
                    enum: [none, minor, moderate, significant, severe]
                    description: "Operational impact level"
                    example: "significant"
                  reputational:
                    type: string
                    enum: [none, low, medium, high, critical]
                    description: "Reputational impact level"
                    example: "high"
                  legal:
                    type: string
                    enum: [none, low, medium, high, critical]
                    description: "Legal/regulatory impact level"
                    example: "medium"
              monitoring:
                type: object
                properties:
                  frequency:
                    type: string
                    enum: [daily, weekly, monthly, quarterly, annually]
                    description: "Monitoring frequency"
                    example: "monthly"
                  metrics:
                    type: array
                    items:
                      type: string
                    description: "Key risk indicators"
                    example: ["failed_login_attempts", "security_incidents"]
                  alerts:
                    type: array
                    items:
                      type: string
                    description: "Alert conditions"
                    example: ["failed_login_attempts > 100", "security_incidents > 0"]
          status:
            type: object
            properties:
              phase:
                type: string
                enum: [identified, assessed, mitigated, accepted, transferred, avoided]
                description: "Current risk lifecycle phase"
                example: "mitigated"
              lastUpdated:
                type: string
                format: date-time
                description: "Last status update timestamp"
                example: "2025-01-15T10:30:00Z"
              updatedBy:
                type: string
                description: "User who last updated the risk"
                example: "risk-manager"
              conditions:
                type: array
                items:
                  type: object
                  properties:
                    type:
                      type: string
                      enum: [mitigation_required, review_overdue, high_risk, compliance_issue]
                    status:
                      type: string
                      enum: [True, False]
                    lastTransitionTime:
                      type: string
                      format: date-time
                    reason:
                      type: string
                    message:
                      type: string
              metrics:
                type: object
                properties:
                  totalRisks:
                    type: integer
                    description: "Total number of risks in this category"
                  criticalRisks:
                    type: integer
                    description: "Number of critical risks"
                  highRisks:
                    type: integer
                    description: "Number of high risks"
                  mitigatedRisks:
                    type: integer
                    description: "Number of mitigated risks"
                  averageRiskScore:
                    type: number
                    format: float
                    description: "Average risk score"
    additionalPrinterColumns:
    - name: Risk Level
      type: string
      description: "Risk level"
      jsonPath: ".spec.riskLevel"
    - name: Category
      type: string
      description: "Risk category"
      jsonPath: ".spec.category"
    - name: Owner
      type: string
      description: "Risk owner"
      jsonPath: ".spec.owner"
    - name: Score
      type: number
      description: "Risk score"
      jsonPath: ".spec.riskScore"
    - name: Status
      type: string
      description: "Mitigation status"
      jsonPath: ".spec.mitigationStatus"
    - name: Age
      type: string
      description: "Days since identification"
      jsonPath: ".metadata.creationTimestamp"
      format: date-time
  scope: Namespaced
  names:
    plural: riskregisters
    singular: riskregister
    kind: RiskRegister
    shortNames:
    - risk
    - rr
  conversion:
    strategy: None
  preserveUnknownFields: false
