# ═══════════════════════════════════════════════════════════════════════════════
#                    Behavior Contract: automation.architect
#                    行為契約：架構分析師
# ═══════════════════════════════════════════════════════════════════════════════
#
# Purpose: Define expected behaviors for architecture analysis and governance
# 用途: 定義架構分析和治理的預期行為
#
# Version: 1.0.0
# Owner: @architecture-team
# Last Updated: 2025-12-07
# ═══════════════════════════════════════════════════════════════════════════════

contract:
  module: "automation.architect"
  version: "1.0.0"
  status: "active"
  owner: "@architecture-team"
  
  description: |
    Architecture Analyst provides automated architecture analysis, dependency mapping,
    technical debt assessment, and governance compliance checking.
    
    架構分析師提供自動化架構分析、依賴映射、技術債務評估和治理合規檢查。

# ============================================================================
# API Contracts | API 契約
# ============================================================================

api:
  base_path: "/api/v1/architect"
  
  endpoints:
    
    # ─────────────────────────────────────────────────────────────────────────
    # Architecture Analysis
    # ─────────────────────────────────────────────────────────────────────────
    - name: "Analyze Architecture"
      method: POST
      path: "/analysis"
      
      description: |
        Perform comprehensive architecture analysis.
        執行全面的架構分析。
      
      input_schema:
        type: "object"
        required: ["scope"]
        properties:
          scope:
            type: "string"
            enum: ["full", "incremental", "module", "layer"]
          target: { type: "string" }
          include_recommendations: { type: "boolean" }
      
      output_schema:
        type: "object"
        properties:
          analysis_id: { type: "string" }
          architecture_score: { type: "number" }
          findings: { type: "array" }
          recommendations: { type: "array" }
          dependency_graph: { type: "object" }
      
      guarantees:
        - "Complete dependency analysis"
        - "Circular dependency detection"
        - "Layer violation detection"
      
      performance:
        response_time_p50: "< 1s"
        response_time_p99: "< 5s"

    # ─────────────────────────────────────────────────────────────────────────
    # Technical Debt Assessment
    # ─────────────────────────────────────────────────────────────────────────
    - name: "Assess Technical Debt"
      method: POST
      path: "/technical-debt"
      
      description: "Calculate technical debt metrics"
      
      input_schema:
        type: "object"
        properties:
          modules: { type: "array" }
          include_trends: { type: "boolean" }
      
      output_schema:
        type: "object"
        properties:
          total_debt_score: { type: "number" }
          debt_by_module: { type: "object" }
          priority_areas: { type: "array" }
          trends: { type: "object" }
      
      guarantees:
        - "Consistent scoring methodology"
        - "Historical comparison available"

    # ─────────────────────────────────────────────────────────────────────────
    # Governance Compliance Check
    # ─────────────────────────────────────────────────────────────────────────
    - name: "Check Compliance"
      method: POST
      path: "/compliance/check"
      
      description: |
        Validate compliance with governance policies.
        驗證治理政策的合規性。
      
      input_schema:
        type: "object"
        properties:
          policies: { type: "array" }
          scope: { type: "string" }
      
      output_schema:
        type: "object"
        properties:
          compliance_id: { type: "string" }
          overall_compliance: { type: "boolean" }
          violations: { type: "array" }
          warnings: { type: "array" }
      
      guarantees:
        - "All policies checked"
        - "Violations documented with location"
        - "Remediation suggestions provided"

# ============================================================================
# Event Contracts | 事件契約
# ============================================================================

events:
  
  - name: "architect.analysis_completed"
    description: "Emitted when architecture analysis completes"
    
    payload_schema:
      type: "object"
      properties:
        analysis_id: { type: "string" }
        architecture_score: { type: "number" }
        findings_count: { type: "integer" }
        timestamp: { type: "string", format: "date-time" }
    
    delivery_guarantee: "at-least-once"
    retention: "90 days"
    
    consumers:
      - "services.audit"
      - "automation.monitoring"

  - name: "architect.governance_violation"
    description: "Emitted when governance violation detected"
    
    payload_schema:
      type: "object"
      properties:
        violation_type: { type: "string" }
        severity: { type: "string" }
        location: { type: "string" }
        policy: { type: "string" }
        timestamp: { type: "string", format: "date-time" }
    
    delivery_guarantee: "at-least-once"
    retention: "180 days"
    
    consumers:
      - "ops.alerting"
      - "services.governance"

# ============================================================================
# Invariants | 不變條件
# ============================================================================

invariants:
  
  - name: "Analysis Determinism"
    description: "Same input produces same analysis"
    rule: "analyze(input) = analyze(input)"
    enforcement: "application-logic"
    
  - name: "Scoring Consistency"
    description: "Architecture scores are comparable over time"
    rule: "forall analysis: score uses consistent methodology"
    enforcement: "validation"

# ============================================================================
# Failure Modes | 失敗模式
# ============================================================================

failure_modes:
  
  - scenario: "Analysis Timeout"
    triggers:
      - "Large codebase analysis"
      - "Resource constraints"
    recovery:
      - "Return partial results"
      - "Schedule full analysis"
    error_code: "WARN_ANALYSIS_TIMEOUT"

# ============================================================================
# Dependencies | 依賴關係
# ============================================================================

dependencies:
  
  required:
    - module: "governance.policies"
      purpose: "Policy definitions"
      failure_mode: "use-cached"

# ============================================================================
# Monitoring & Observability | 監控與可觀測性
# ============================================================================

observability:
  metrics:
    - name: "analyses_total"
      type: "counter"
      labels: ["scope", "status"]
    - name: "analysis_duration_seconds"
      type: "histogram"
    - name: "governance_violations_total"
      type: "counter"
      labels: ["type", "severity"]
    - name: "architecture_score"
      type: "gauge"
  
  alerts:
    - condition: "architecture_score < 70"
      severity: "warning"
    - condition: "governance_violations_total > 50"
      severity: "high"

# ============================================================================
# References | 參考
# ============================================================================

references:
  ownership_map: "governance/34-config/ownership-map.yaml#automation.architect"
  architecture_governance_matrix: "governance/29-docs/ARCHITECTURE_GOVERNANCE_MATRIX.md"
