{
  "$schema": "./schemas/events.schema.json",
  "version": "1.0.0",
  "timestamp": "2025-12-11T00:00:00Z",
  "metadata": {
    "name": "Event-Driven Orchestration Registry",
    "description": "事件驅動配置 - 定義 trigger → event → agent 的對應關係",
    "purpose": "讓系統知道什麼事件會啟動哪個 agent，實現即時執行模式"
  },
  "event_bus": {
    "type": "async",
    "implementation": "kafka",
    "fallback": "redis",
    "config": {
      "max_retry": 3,
      "retry_delay": "1s",
      "dead_letter_queue": true,
      "ordering_guarantee": "partition"
    }
  },
  "event_categories": [
    {
      "category": "policy",
      "description": "策略相關事件",
      "source": "10-policy",
      "events": [
        {
          "id": "policy.created",
          "name": "Policy Created",
          "trigger": "policy_file_added",
          "agents": ["policy-validator", "compliance-checker"],
          "latency": "<=5s",
          "priority": "high",
          "actions": ["validate_syntax", "check_conflicts", "update_index"]
        },
        {
          "id": "policy.validated",
          "name": "Policy Validated",
          "trigger": "validation_complete",
          "agents": ["policy-enforcer", "notification-agent"],
          "latency": "<=2s",
          "priority": "high",
          "actions": ["activate_policy", "notify_stakeholders"]
        },
        {
          "id": "policy.violated",
          "name": "Policy Violation Detected",
          "trigger": "violation_detected",
          "agents": ["incident-handler", "self-healing-agent", "audit-logger"],
          "latency": "<=1s",
          "priority": "critical",
          "actions": ["log_violation", "trigger_remediation", "alert_oncall"]
        },
        {
          "id": "policy.enforced",
          "name": "Policy Enforced",
          "trigger": "enforcement_complete",
          "agents": ["audit-logger", "metrics-collector"],
          "latency": "<=3s",
          "priority": "medium",
          "actions": ["log_enforcement", "update_metrics"]
        }
      ]
    },
    {
      "category": "intent",
      "description": "意圖編排事件",
      "source": "20-intent",
      "events": [
        {
          "id": "intent.received",
          "name": "Intent Received",
          "trigger": "intent_submission",
          "agents": ["intent-parser", "semantic-mapper"],
          "latency": "<=2s",
          "priority": "high",
          "actions": ["parse_intent", "map_to_actions"]
        },
        {
          "id": "intent.mapped",
          "name": "Intent Mapped",
          "trigger": "mapping_complete",
          "agents": ["orchestrator", "dependency-resolver"],
          "latency": "<=3s",
          "priority": "high",
          "actions": ["build_execution_plan", "resolve_dependencies"]
        },
        {
          "id": "intent.executed",
          "name": "Intent Executed",
          "trigger": "execution_complete",
          "agents": ["feedback-collector", "audit-logger"],
          "latency": "<=5s",
          "priority": "medium",
          "actions": ["collect_results", "log_execution"]
        }
      ]
    },
    {
      "category": "agent",
      "description": "Agent 生命週期事件",
      "source": "30-agents",
      "events": [
        {
          "id": "agent.registered",
          "name": "Agent Registered",
          "trigger": "agent_registration",
          "agents": ["registry-manager", "compliance-checker"],
          "latency": "<=5s",
          "priority": "high",
          "actions": ["validate_registration", "check_compliance", "assign_permissions"]
        },
        {
          "id": "agent.deployed",
          "name": "Agent Deployed",
          "trigger": "deployment_complete",
          "agents": ["health-checker", "monitor-agent"],
          "latency": "<=10s",
          "priority": "high",
          "actions": ["health_check", "start_monitoring", "update_registry"]
        },
        {
          "id": "agent.failed",
          "name": "Agent Failed",
          "trigger": "agent_failure",
          "agents": ["self-healing-agent", "incident-handler", "notification-agent"],
          "latency": "<=1s",
          "priority": "critical",
          "actions": ["diagnose_failure", "attempt_recovery", "escalate_if_needed"]
        },
        {
          "id": "agent.retired",
          "name": "Agent Retired",
          "trigger": "retirement_request",
          "agents": ["cleanup-agent", "audit-logger"],
          "latency": "<=30s",
          "priority": "medium",
          "actions": ["revoke_permissions", "archive_data", "cleanup_resources"]
        }
      ]
    },
    {
      "category": "automation",
      "description": "自動化引擎事件",
      "source": "39-automation",
      "events": [
        {
          "id": "automation.started",
          "name": "Automation Started",
          "trigger": "automation_trigger",
          "agents": ["task-scheduler", "monitor-agent"],
          "latency": "<=3s",
          "priority": "high",
          "actions": ["schedule_tasks", "start_monitoring"]
        },
        {
          "id": "automation.completed",
          "name": "Automation Completed",
          "trigger": "automation_finish",
          "agents": ["result-collector", "feedback-agent"],
          "latency": "<=5s",
          "priority": "medium",
          "actions": ["collect_results", "analyze_outcomes", "update_metrics"]
        },
        {
          "id": "automation.failed",
          "name": "Automation Failed",
          "trigger": "automation_error",
          "agents": ["self-healing-agent", "incident-handler"],
          "latency": "<=1s",
          "priority": "critical",
          "actions": ["diagnose_error", "attempt_retry", "escalate"]
        }
      ]
    },
    {
      "category": "self_healing",
      "description": "自我修復事件",
      "source": "40-self-healing",
      "events": [
        {
          "id": "healing.triggered",
          "name": "Healing Triggered",
          "trigger": "anomaly_detected",
          "agents": ["diagnosis-agent", "repair-agent"],
          "latency": "<=2s",
          "priority": "critical",
          "actions": ["analyze_anomaly", "select_repair_strategy"]
        },
        {
          "id": "healing.completed",
          "name": "Healing Completed",
          "trigger": "repair_success",
          "agents": ["verification-agent", "audit-logger"],
          "latency": "<=5s",
          "priority": "high",
          "actions": ["verify_repair", "log_resolution", "update_knowledge_base"]
        },
        {
          "id": "healing.failed",
          "name": "Healing Failed",
          "trigger": "repair_failure",
          "agents": ["escalation-agent", "notification-agent"],
          "latency": "<=1s",
          "priority": "critical",
          "actions": ["escalate_to_human", "notify_oncall", "preserve_state"]
        }
      ]
    },
    {
      "category": "contract",
      "description": "契約相關事件",
      "source": "60-contracts",
      "events": [
        {
          "id": "contract.created",
          "name": "Contract Created",
          "trigger": "contract_submission",
          "agents": ["contract-validator", "version-manager"],
          "latency": "<=5s",
          "priority": "high",
          "actions": ["validate_contract", "check_compatibility", "register_version"]
        },
        {
          "id": "contract.validated",
          "name": "Contract Validated",
          "trigger": "validation_pass",
          "agents": ["registry-manager", "notification-agent"],
          "latency": "<=3s",
          "priority": "medium",
          "actions": ["publish_contract", "notify_consumers"]
        },
        {
          "id": "contract.violated",
          "name": "Contract Violated",
          "trigger": "contract_breach",
          "agents": ["incident-handler", "audit-logger", "notification-agent"],
          "latency": "<=1s",
          "priority": "critical",
          "actions": ["log_violation", "notify_parties", "initiate_resolution"]
        }
      ]
    },
    {
      "category": "audit",
      "description": "審計追蹤事件",
      "source": "70-audit",
      "events": [
        {
          "id": "audit.started",
          "name": "Audit Started",
          "trigger": "audit_initiation",
          "agents": ["audit-collector", "evidence-gatherer"],
          "latency": "<=10s",
          "priority": "high",
          "actions": ["collect_logs", "gather_evidence", "verify_integrity"]
        },
        {
          "id": "audit.completed",
          "name": "Audit Completed",
          "trigger": "audit_finish",
          "agents": ["report-generator", "notification-agent"],
          "latency": "<=30s",
          "priority": "medium",
          "actions": ["generate_report", "archive_evidence", "notify_stakeholders"]
        },
        {
          "id": "audit.finding",
          "name": "Audit Finding",
          "trigger": "finding_detected",
          "agents": ["remediation-planner", "tracking-agent"],
          "latency": "<=5s",
          "priority": "high",
          "actions": ["create_finding", "plan_remediation", "track_resolution"]
        }
      ]
    },
    {
      "category": "feedback",
      "description": "回饋迴路事件",
      "source": "80-feedback",
      "events": [
        {
          "id": "feedback.collected",
          "name": "Feedback Collected",
          "trigger": "feedback_submission",
          "agents": ["feedback-processor", "analytics-agent"],
          "latency": "<=5s",
          "priority": "medium",
          "actions": ["process_feedback", "update_analytics"]
        },
        {
          "id": "feedback.analyzed",
          "name": "Feedback Analyzed",
          "trigger": "analysis_complete",
          "agents": ["recommendation-engine", "optimization-agent"],
          "latency": "<=10s",
          "priority": "medium",
          "actions": ["generate_recommendations", "identify_optimizations"]
        },
        {
          "id": "optimization.recommended",
          "name": "Optimization Recommended",
          "trigger": "recommendation_ready",
          "agents": ["policy-updater", "approval-agent"],
          "latency": "<=5s",
          "priority": "high",
          "actions": ["propose_changes", "request_approval", "close_loop"]
        }
      ]
    }
  ],
  "event_flows": {
    "description": "預定義的事件流 - 常見的事件串聯模式",
    "flows": [
      {
        "id": "policy_lifecycle",
        "name": "Policy Lifecycle Flow",
        "events": ["policy.created", "policy.validated", "policy.enforced"],
        "on_failure": "policy.violated"
      },
      {
        "id": "agent_lifecycle",
        "name": "Agent Lifecycle Flow",
        "events": ["agent.registered", "agent.deployed"],
        "on_failure": "agent.failed"
      },
      {
        "id": "self_healing_flow",
        "name": "Self-Healing Flow",
        "events": ["healing.triggered", "healing.completed"],
        "on_failure": "healing.failed"
      },
      {
        "id": "feedback_loop",
        "name": "Feedback Loop Flow",
        "events": ["feedback.collected", "feedback.analyzed", "optimization.recommended"],
        "closes_to": "policy.created"
      }
    ]
  },
  "latency_bounds": {
    "critical": "<=1s",
    "high": "<=5s",
    "medium": "<=30s",
    "low": "<=60s"
  },
  "dead_letter_handling": {
    "enabled": true,
    "retention": "7d",
    "alert_threshold": 10,
    "reprocess_policy": "manual"
  }
}
