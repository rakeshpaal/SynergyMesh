---
# Architecture Security Policies
# 架構安全策略

metadata:
  policy_id: "POL-SEC-001"
  name: "Architecture Security Policies"
  version: "1.0.0"
  category: "security"
  enforcement_level: "blocking"
  owner: "Security Team"
  created_at: "2025-12-11"
  updated_at: "2025-12-11"

# Authentication & Authorization
authentication:
  policy_id: "SEC-AUTH-001"
  description: "All services must implement authentication"
  
  rules:
    - rule: "api_authentication_required"
      description: "All API endpoints must require authentication"
      enforcement: "blocking"
      exceptions: ["health_check", "metrics"]
    
    - rule: "strong_authentication"
      description: "Use strong authentication methods (JWT, OAuth2, mTLS)"
      enforcement: "blocking"
      allowed_methods: ["jwt", "oauth2", "mtls"]
    
    - rule: "token_expiration"
      description: "Authentication tokens must have expiration"
      enforcement: "blocking"
      max_lifetime_hours: 24

authorization:
  policy_id: "SEC-AUTHZ-001"
  description: "Implement least-privilege access control"
  
  rules:
    - rule: "rbac_required"
      description: "All services must implement RBAC"
      enforcement: "blocking"
    
    - rule: "default_deny"
      description: "Default deny all access, explicitly allow"
      enforcement: "blocking"
    
    - rule: "permission_audit"
      description: "All permission checks must be audited"
      enforcement: "blocking"

# Encryption
encryption:
  policy_id: "SEC-ENC-001"
  description: "Data encryption requirements"
  
  rules:
    - rule: "data_at_rest_encryption"
      description: "All sensitive data must be encrypted at rest"
      enforcement: "blocking"
      algorithms: ["AES-256", "ChaCha20-Poly1305"]
    
    - rule: "data_in_transit_encryption"
      description: "All data in transit must use TLS 1.3+"
      enforcement: "blocking"
      min_tls_version: "1.3"
    
    - rule: "key_rotation"
      description: "Encryption keys must be rotated regularly"
      enforcement: "warning"
      rotation_period_days: 90

# Secrets Management
secrets:
  policy_id: "SEC-SEC-001"
  description: "Secrets management policies"
  
  rules:
    - rule: "no_hardcoded_secrets"
      description: "No hardcoded secrets in code or config"
      enforcement: "blocking"
    
    - rule: "use_vault"
      description: "Use HashiCorp Vault or equivalent for secrets"
      enforcement: "blocking"
      allowed_tools: ["vault", "aws_secrets_manager", "azure_key_vault"]
    
    - rule: "secret_rotation"
      description: "Secrets must be rotated regularly"
      enforcement: "warning"
      rotation_period_days: 90

# Network Security
network:
  policy_id: "SEC-NET-001"
  description: "Network security policies"
  
  rules:
    - rule: "private_network_only"
      description: "Internal services must use private network"
      enforcement: "blocking"
    
    - rule: "firewall_rules"
      description: "All services must have firewall rules"
      enforcement: "blocking"
    
    - rule: "ddos_protection"
      description: "Public endpoints must have DDoS protection"
      enforcement: "blocking"

# Vulnerability Management
vulnerabilities:
  policy_id: "SEC-VUL-001"
  description: "Vulnerability management policies"
  
  rules:
    - rule: "no_critical_vulnerabilities"
      description: "No critical vulnerabilities allowed in production"
      enforcement: "blocking"
      severity_threshold: "high"
    
    - rule: "vulnerability_scanning"
      description: "All images and dependencies must be scanned"
      enforcement: "blocking"
      scan_frequency: "on_build"
    
    - rule: "patch_sla"
      description: "Patches must be applied within SLA"
      enforcement: "warning"
      sla_days:
        critical: 7
        high: 14
        medium: 30

# Path Traversal Prevention (New - Based on PR #351 Security Fixes)
path_security:
  policy_id: "SEC-PATH-001"
  description: "Path traversal and file access security policies"
  
  rules:
    - rule: "safe_root_validation"
      description: "All file operations must validate paths against SAFE_ROOT"
      enforcement: "blocking"
      requirements:
        - "Use realpath() to resolve symlinks"
        - "Use relative() to check path containment"
        - "Reject paths containing '..' components"
        - "Use environment-based SAFE_ROOT configuration"
      implementation_reference: "core/contract_service/contracts-L1/contracts/src/services/provenance.ts"
    
    - rule: "no_user_controlled_paths"
      description: "User input must not directly control file paths"
      enforcement: "blocking"
      mitigation: "Whitelist allowed files or use path normalization with SAFE_ROOT"
    
    - rule: "path_validation_logging"
      description: "Log path validation failures for security monitoring"
      enforcement: "warning"
      log_level: "warn"

# Sensitive Data Logging Prevention (New - Based on PR #351 Security Fixes)
logging_security:
  policy_id: "SEC-LOG-001"
  description: "Secure logging practices to prevent data leakage"
  
  rules:
    - rule: "no_cleartext_sensitive_data"
      description: "Never log sensitive data in clear text"
      enforcement: "blocking"
      sensitive_fields:
        - "password"
        - "token"
        - "api_key"
        - "secret"
        - "private_key"
        - "credit_card"
        - "ssn"
      redaction_strategy: "[REDACTED]"
    
    - rule: "structured_logging_only"
      description: "Use structured logging with field-level control"
      enforcement: "warning"
      allowed_formats: ["json", "structured"]
    
    - rule: "log_sanitization"
      description: "Sanitize user input before logging"
      enforcement: "blocking"
      sanitization_required: true

# Cryptographic Security (Enhanced - Based on PR #351 Security Fixes)
cryptography:
  policy_id: "SEC-CRYPTO-001"
  description: "Cryptographic algorithm and implementation policies"
  
  rules:
    - rule: "strong_hash_algorithms"
      description: "Use strong cryptographic hash algorithms only"
      enforcement: "blocking"
      allowed_algorithms:
        hashing: ["SHA-256", "SHA-384", "SHA-512", "SHA3-256", "SHA3-512", "BLAKE2b", "BLAKE3"]
        forbidden: ["MD5", "SHA-1"]
      use_case_mapping:
        password_hashing: ["bcrypt", "argon2id", "scrypt"]
        data_integrity: ["SHA-256", "SHA3-256", "BLAKE3"]
        hmac: ["SHA-256", "SHA-512"]
    
    - rule: "no_deprecated_crypto"
      description: "Deprecated cryptographic algorithms must not be used"
      enforcement: "blocking"
      deprecated_list: ["DES", "3DES", "RC4", "MD5", "SHA-1"]
    
    - rule: "secure_random_generation"
      description: "Use cryptographically secure random number generators"
      enforcement: "blocking"
      required_sources: ["crypto.randomBytes", "/dev/urandom", "crypto.randomUUID"]

# Compliance
compliance:
  standards:
    - ISO_27001
    - SOC_2
    - GDPR
<<<<<<< HEAD
<<<<<<< HEAD
=======
    - SLSA_Level_3
  
  audit_frequency: "quarterly"
  
  # Security fix tracking from PR #351
  recent_enhancements:
    pr_351_security_fixes:
      date: "2025-12-15"
      fixes:
        - "Path traversal prevention in provenance service"
        - "Clear-text logging of sensitive data eliminated"
        - "Weak cryptographic algorithms replaced with SHA-256"
      impact: "Critical security vulnerabilities addressed"
      governance_updates:
        - "Added SEC-PATH-001 policy"
        - "Added SEC-LOG-001 policy"
        - "Enhanced SEC-CRYPTO-001 policy"
>>>>>>> origin/alert-autofix-37

=======
  
>>>>>>> origin/copilot/sub-pr-402
  audit_frequency: "quarterly"

