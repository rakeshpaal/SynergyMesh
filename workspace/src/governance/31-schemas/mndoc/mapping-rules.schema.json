{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schema.superroot.kn/mndoc/mapping-rules/v1",
  "title": "MN-DOC Mapping Rules Schema v1",
  "description": "定義 Markdown 到機器原生知識層的映射規則結構。Schema for defining Markdown to MN-DOC transformation rules.",
  "type": "object",
  "required": ["$schema", "version", "id", "title"],
  "properties": {
    "$schema": {
      "type": "string",
      "const": "https://schema.superroot.kn/mndoc/mapping-rules/v1",
      "description": "Schema namespace identifier"
    },
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Rules version"
    },
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9]+([a-z0-9-]*[a-z0-9])?$",
      "description": "Rules identifier"
    },
    "title": {
      "type": "string",
      "description": "Human-readable title"
    },
    "description": {
      "type": "string",
      "description": "Description of the mapping rules"
    },
    "rule_categories": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "name"],
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" },
          "description": { "type": "string" }
        }
      },
      "description": "Categories of rules"
    },
    "section_to_entity_rules": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/mappingRule"
      },
      "description": "Rules for section to entity transformation"
    },
    "path_to_component_rules": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/mappingRule"
      },
      "description": "Rules for path to component transformation"
    },
    "list_to_capabilities_rules": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/mappingRule"
      },
      "description": "Rules for list to capabilities transformation"
    },
    "reference_to_provenance_rules": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/mappingRule"
      },
      "description": "Rules for reference to provenance transformation"
    },
    "entity_type_mappings": {
      "type": "object",
      "additionalProperties": {
        "type": "object"
      },
      "description": "Entity type mapping configurations"
    },
    "transformation_functions": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["name"],
        "properties": {
          "name": { "type": "string" },
          "description": { "type": "string" },
          "example": { "type": "string" }
        }
      },
      "description": "Available transformation functions"
    },
    "validation": {
      "type": "object",
      "properties": {
        "required_mappings": {
          "type": "array",
          "items": { "type": "string" }
        },
        "consistency_checks": {
          "type": "array",
          "items": { "type": "string" }
        },
        "provenance_requirements": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "description": "Validation rules"
    },
    "output_formats": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["format"],
        "properties": {
          "format": { "type": "string" },
          "schema": { "type": "string" },
          "extension": { "type": "string" }
        }
      },
      "description": "Supported output formats"
    }
  },
  "additionalProperties": false,
  "$defs": {
    "mappingRule": {
      "type": "object",
      "required": ["id", "name"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^rule-[a-z0-9-]+$",
          "description": "Rule identifier"
        },
        "name": {
          "type": "string",
          "description": "Rule name"
        },
        "description": {
          "type": "string",
          "description": "Rule description"
        },
        "trigger": {
          "type": "object",
          "description": "Trigger conditions"
        },
        "transform": {
          "type": "object",
          "description": "Transformation specification"
        },
        "example": {
          "type": "object",
          "description": "Example input/output"
        }
      }
    }
  }
}
