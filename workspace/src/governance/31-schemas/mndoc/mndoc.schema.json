{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schema.superroot.kn/mndoc/v1",
  "title": "Machine-Native Documentation Model Schema v1 (MN-DOC)",
  "description": "定義機器原生文檔模型結構，支援 Markdown → 機器可消費知識層的轉換。Schema for transforming narrative documentation into machine-consumable knowledge entities.",
  "type": "object",
  "required": ["$schema", "id", "path", "title", "domain", "layer", "type", "owner", "status", "sections"],
  "properties": {
    "$schema": {
      "type": "string",
      "const": "https://schema.superroot.kn/mndoc/v1",
      "description": "Schema namespace identifier"
    },
    "id": {
      "type": "string",
      "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$",
      "description": "UUID - 機器唯一鍵 (Machine unique identifier)"
    },
    "path": {
      "type": "string",
      "description": "Source file path relative to repository root"
    },
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 200,
      "description": "Document title"
    },
    "domain": {
      "type": "string",
      "description": "Business/technical domain identifier"
    },
    "layer": {
      "type": "string",
      "enum": [
        "documentation",
        "control-plane",
        "data-plane",
        "governance",
        "automation",
        "infrastructure",
        "observability"
      ],
      "description": "System architecture layer"
    },
    "type": {
      "type": "string",
      "enum": [
        "overview",
        "subsystem",
        "component",
        "concept",
        "guide",
        "api-reference",
        "configuration",
        "governance-pipeline"
      ],
      "description": "Document/entity type"
    },
    "owner": {
      "type": "string",
      "description": "Responsible owner (team or individual)"
    },
    "status": {
      "type": "string",
      "enum": ["draft", "active", "deprecated", "archived"],
      "description": "Lifecycle status"
    },
    "version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Semantic version (optional)"
    },
    "tags": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[a-z0-9]+([a-z0-9-]*[a-z0-9])?$"
      },
      "description": "Classification tags for indexing and discovery"
    },
    "sections": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/section"
      },
      "description": "Document sections converted to machine entities"
    },
    "evidence_ref": {
      "$ref": "#/$defs/evidenceRef",
      "description": "Supply chain provenance references (optional)"
    },
    "meta": {
      "type": "object",
      "description": "Free-form metadata for platform-specific extensions"
    }
  },
  "additionalProperties": false,
  "$defs": {
    "section": {
      "type": "object",
      "required": ["id", "type", "title"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$",
          "description": "Section UUID"
        },
        "type": {
          "type": "string",
          "enum": ["subsystem", "component", "capability", "concept", "configuration", "governance-stage"],
          "description": "Section entity type"
        },
        "title": {
          "type": "string",
          "description": "Section title"
        },
        "component_ref": {
          "type": "string",
          "pattern": "^[a-z0-9]+([a-z0-9-]*[a-z0-9])?$",
          "description": "Reference to component identifier"
        },
        "description": {
          "type": "string",
          "description": "Section description"
        },
        "capabilities": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Capabilities provided by this section"
        },
        "interfaces": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Interfaces exposed by this section"
        },
        "dependencies": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Dependencies of this section"
        },
        "evidence_ref": {
          "$ref": "#/$defs/evidenceRef"
        },
        "meta": {
          "type": "object",
          "properties": {
            "order": { "type": "integer" },
            "criticality": { "type": "string", "enum": ["low", "medium", "high", "critical"] },
            "source_line_start": { "type": "integer" },
            "source_line_end": { "type": "integer" }
          }
        }
      },
      "additionalProperties": false
    },
    "evidenceRef": {
      "type": "object",
      "properties": {
        "sbom": {
          "type": "string",
          "description": "Path to SBOM file"
        },
        "signature": {
          "type": "string",
          "description": "Path to signature file"
        },
        "slsa_ref": {
          "type": "string",
          "description": "SLSA provenance reference"
        },
        "merkle_index": {
          "type": "string",
          "description": "Merkle tree index reference"
        }
      },
      "additionalProperties": false
    }
  }
}
