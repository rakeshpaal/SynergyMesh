# Review Meeting Schema
# 治理评审会议的标准结构
$schema: "http://json-schema.org/draft-07/schema#"
$id: "https://machinenativeops.io/schemas/review-meeting.schema.yaml"
title: "Review Meeting Schema"
description: "Schema for governance review meetings"
type: object
required:
  - apiVersion
  - kind
  - metadata
  - spec
properties:
  apiVersion:
    type: string
    const: "governance.machinenativeops.io/v1alpha1"

  kind:
    type: string
    const: "ReviewMeeting"

  metadata:
    type: object
    required:
      - id
      - title
    properties:
      id:
        type: string
        pattern: "^REV-\\d{4}-\\d{3}$"
        examples:
          - "REV-2025-001"

      title:
        type: string

      scheduledAt:
        type: string
        format: "date-time"

      labels:
        type: object
        additionalProperties:
          type: string

  spec:
    type: object
    required:
      - type
      - agenda
      - participants
    properties:
      type:
        type: string
        enum:
          - "CAB"              # Change Advisory Board
          - "Architecture"     # 架构评审
          - "Security"         # 安全评审
          - "Governance"       # 治理委员会
          - "Exception"        # 例外评审

      frequency:
        type: string
        description: "会议频率"
        examples:
          - "weekly"
          - "bi-weekly"
          - "monthly"

      agenda:
        type: array
        description: "议程"
        items:
          type: object
          required:
            - order
            - topic
          properties:
            order:
              type: integer
            topic:
              type: string
            duration:
              type: string
              examples:
                - "10 min"
                - "30 min"
            presenter:
              type: string
            materials:
              type: array
              items:
                type: string
              description: "相关材料链接"

      participants:
        type: object
        required:
          - required
        properties:
          required:
            type: array
            items:
              type: object
              properties:
                name:
                  type: string
                role:
                  type: string
                email:
                  type: string
                  format: "email"
          optional:
            type: array
            items:
              type: object
              properties:
                name:
                  type: string
                role:
                  type: string

      reviewItems:
        type: array
        description: "评审项目"
        items:
          type: object
          required:
            - id
            - type
            - title
          properties:
            id:
              type: string
              description: "关联的 CHG/EXC ID"
            type:
              type: string
              enum: ["change", "exception", "policy", "metric"]
            title:
              type: string
            status:
              type: string
              enum: ["pending", "approved", "rejected", "deferred"]
            decision:
              type: string
            actionItems:
              type: array
              items:
                type: string

      decisions:
        type: array
        description: "会议决议"
        items:
          type: object
          properties:
            item:
              type: string
            decision:
              type: string
            rationale:
              type: string
            votingResult:
              type: object
              properties:
                approve:
                  type: integer
                reject:
                  type: integer
                abstain:
                  type: integer

      actionItems:
        type: array
        description: "行动项"
        items:
          type: object
          required:
            - description
            - owner
            - dueDate
          properties:
            description:
              type: string
            owner:
              type: string
            dueDate:
              type: string
              format: "date"
            priority:
              type: string
              enum: ["high", "medium", "low"]
            status:
              type: string
              enum: ["open", "in-progress", "completed"]

      notes:
        type: string
        description: "会议记录"

      recording:
        type: object
        description: "会议录音/视频"
        properties:
          url:
            type: string
            format: "uri"
          transcript:
            type: string
            format: "uri"

  status:
    type: object
    properties:
      meetingStatus:
        type: string
        enum: ["scheduled", "in-progress", "completed", "cancelled"]
      completedAt:
        type: string
        format: "date-time"
      attendees:
        type: array
        items:
          type: string
        description: "实际参会人员"

# 示例
example:
  apiVersion: "governance.machinenativeops.io/v1alpha1"
  kind: "ReviewMeeting"
  metadata:
    id: "REV-2025-001"
    title: "每周变更咨询委员会会议"
    scheduledAt: "2025-12-20T10:00:00Z"
    labels:
      type: "CAB"
      frequency: "weekly"
  spec:
    type: "CAB"
    frequency: "weekly"
    agenda:
      - order: 1
        topic: "上周变更回顾"
        duration: "15 min"
        presenter: "change-manager"
      - order: 2
        topic: "本周变更申请评审"
        duration: "30 min"
        presenter: "各申请人"
      - order: 3
        topic: "指标回顾"
        duration: "10 min"
        presenter: "metrics-team"
      - order: 4
        topic: "行动项追踪"
        duration: "5 min"
        presenter: "change-manager"
    participants:
      required:
        - name: "Alice Chen"
          role: "Change Manager"
          email: "alice@example.com"
        - name: "Bob Smith"
          role: "Tech Lead"
          email: "bob@example.com"
        - name: "Carol Wang"
          role: "Security Lead"
          email: "carol@example.com"
      optional:
        - name: "David Lee"
          role: "Platform Engineer"
    reviewItems:
      - id: "CHG-2025-042"
        type: "change"
        title: "升级数据库版本"
        status: "approved"
        decision: "批准，需在周末维护窗口执行"
        actionItems:
          - "准备详细回滚方案"
          - "通知相关团队"
      - id: "EXC-2025-001"
        type: "exception"
        title: "遗留系统命名例外"
        status: "approved"
        decision: "批准6个月例外，需每季度复审"
    decisions:
      - item: "CHG-2025-042"
        decision: "Approved"
        rationale: "测试充分，风险可控"
        votingResult:
          approve: 5
          reject: 0
          abstain: 1
    actionItems:
      - description: "更新变更管理流程文档"
        owner: "alice@example.com"
        dueDate: "2025-12-27"
        priority: "medium"
        status: "open"
      - description: "设置新的指标监控"
        owner: "bob@example.com"
        dueDate: "2025-12-25"
        priority: "high"
        status: "in-progress"
    notes: |
      本周共评审 5 个变更请求，批准 4 个，延期 1 个。
      整体变更成功率 98%，符合目标。
      需要关注数据库升级的风险缓解措施。
  status:
    meetingStatus: "completed"
    completedAt: "2025-12-20T11:00:00Z"
    attendees:
      - "alice@example.com"
      - "bob@example.com"
      - "carol@example.com"
      - "david@example.com"
