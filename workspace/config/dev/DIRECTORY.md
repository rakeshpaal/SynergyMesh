# config/dev

## 目錄職責

此目錄包含 MachineNativeOps Enterprise 的開發環境配置文件和開發工具設置。它為開發人員提供完整的本地開發環境配置，包括 Docker 容器、開發服務器、數據庫、監控和調試工具。此目錄是 `config/` 配置體系的一部分，專門針對開發環境進行優化，與 `config/prod/` 生產環境配置形成對比，確保開發和生產環境的配置分離管理。

## 檔案說明

### README.md

- **職責**：開發環境的主要說明文檔和快速入門指南
- **功能**：
  - 提供開發環境設置的完整說明
  - 包含常見問題解答和故障排除指南
  - 說明開發工作流和最佳實踐
- **依賴**：各種配置文件和腳本文件

### docker-compose.dev.yml

- **職責**：開發環境的 Docker 容器編排配置
- **功能**：
  - 定義開發所需的服務容器（數據庫、緩存、消息隊列等）
  - 配置容器間的網絡和存儲卷
  - 設置環境變量和服務依賴關係
- **依賴**：docker-compose.yml, 各種 Docker 鏡像

### docker-compose.yml

- **職責**：開發環境的主要 Docker 編排文件
- **功能**：
  - 定義核心開發服務的容器配置
  - 配置端口映射和數據持久化
  - 設置日誌級別和監控配置
- **依賴**：Dockerfile, .env.dev, 各種服務配置

### devcontainer.json / devcontainer-v2.json

- **職責**：VS Code Dev Container 開發環境配置
- **功能**：
  - 定義遠程容器開發環境
  - 配置開發工具和擴展插件
  - 設置容器內的用戶權限和工作目錄
- **依賴**：Docker, VS Code Remote Development 擴展

### kind-cluster-config.yaml

- **職責**：本地 Kubernetes 集群（Kind）配置文件
- **功能**：
  - 定義本地 K8s 集群的節點配置
  - 配置網絡插件和存儲類
  - 設置 Ingress 控制器和負載均衡
- **依賴**：Kind CLI, Kubernetes

### post-create.sh

- **職責**：Dev Container 創建後的初始化腳本
- **功能**：
  - 安裝開發依賴和工具
  - 配置開發環境變量
  - 初始化數據庫和緩存服務
- **依賴**：devcontainer.json, 包管理器

### post-start.sh / post-start-v2.sh

- **職責**：Dev Container 啟動後的配置腳本
- **功能**：
  - 啟動開發服務和守護進程
  - 配置熱重載和監控
  - 設置開發者的工作環境
- **依賴**：post-create.sh, 開發服務

### setup.sh

- **職責**：開發環境一鍵設置腳本
- **功能**：
  - 自動配置開發環境
  - 安裝必要的系統依賴
  - 創建配置文件和符號鏈接
- **依賴**：install-optional-tools.sh, 系統包管理器

### start-dev-server.sh

- **職責**：啟動開發服務器的便捷腳本
- **功能**：
  - 一鍵啟動所有開發服務
  - 設置環境變量和配置文件
  - 監控服務狀態和日誌輸出
- **依賴**：docker-compose.dev.yml, 各種服務配置

### prometheus.yml

- **職責**：Prometheus 監控配置文件
- **功能**：
  - 定義監控指標收集規則
  - 配置目標服務和抓取間隔
  - 設置告警規則和通知渠道
- **依賴**：Prometheus 服務, 各種服務的 metrics 端點

### requirements.txt

- **職責**：Python 開發依賴包列表
- **功能**：
  - 定義 Python 開發環境的依賴包
  - 包含調試工具和開發庫
  - 指定版本範圍和兼容性要求
- **依賴**：Python 包管理器（pip, poetry）

### automation/

- **職責**：開發自動化腳本和工具目錄
- **功能**：
  - 包含代碼生成和格式化腳本
  - 提供測試自動化和部署腳本
  - 存儲開發工作流自動化工具
- **依賴**：各種開發工具和外部服務

### environments/

- **職責**：環境配置文件目錄
- **功能**：
  - 存儲不同場景的環境變量配置
  - 包含測數據和模擬配置
  - 提供環境切換和管理腳本
- **依賴**：環境管理工具, 配置加載器

### grafana/

- **職責**：Grafana 監控面板配置目錄
- **功能**：
  - 包含監控面板定義和圖表配置
  - 存儲數據源配置和查詢腳本
  - 提供監控模板和儀表板設置
- **依賴**：Grafana 服務, Prometheus 數據源

### init-db/

- **職責**：數據庫初始化腳目錄
- **功能**：
  - 包含數據庫架構創建腳本
  - 存儲初始數據和種子數據
  - 提供數據庫遷移和清理腳本
- **依賴**：數據庫服務, 數據庫管理工具

### scripts/

- **職責**：開發輔助腳本目錄
- **功能**：
  - 包含各種開發輔助工具腳本
  - 提供代碼檢查和格式化工具
  - 存儲部署和測試相關腳本
- **依賴**：開發工具鏈, 系統工具

### templates/

- **職責**：配置模板和示例文件目錄
- **功能**：
  - 包含各種配置文件模板
  - 存儲示例代碼和配置文件
  - 提供快速啟動模板和腳手架
- **依賴**：模板引擎, 配置生成工具

## 職責分離說明

此目錄實現了開發環境配置的職責分離：

1. **容器化配置層**：`docker-compose.*.yml` 專注於容器編排，不包含具體應用配置
2. **開發工具層**：`devcontainer.json` 專注於 IDE 集成，不干擾服務配置
3. **初始化腳本層**：`post-*.sh` 腳本專注於環境設置，不包含業務邏輯
4. **監控配置層**：`prometheus.yml` 和 `grafana/` 專注於監控設置，獨立於應用配置
5. **數據庫層**：`init-db/` 專注於數據管理，與應用配置分離
6. **工具腳本層**：`scripts/` 和 `automation/` 專注於開發工具，不影響運行時配置
7. **模板配置層**：`templates/` 專注於配置模板，與實際配置分離

每個部分都有明確的職責邊界，確保開發環境的模組化和可維護性。

## 設計原則

### 單一職責原則 (SRP) 遵循

1. **配置文件職責單一化**：
   - 每個配置文件專注於特定的配置領域（容器、IDE、監控等）
   - 避免在一個文件中混合多種不同類型的配置
   - 確保配置文件的專注性和可讀性

2. **腳本職責專一化**：
   - 初始化腳本只負責環境設置，不包含應用邏輯
   - 啟動腳本只負責服務啟動，不包含配置管理
   - 工具腳本只負責開發輔助，不干擾運行時行為

3. **目錄職責專一化**：
   - 每個子目錄專注於特定類型的配置或工具
   - 避免在配置目錄中混合腳本和模板
   - 確保目錄結構的清晰性和邏輯性

### 未來維護注意事項

1. **添加新配置時**：
   - 確定配置屬於哪個現有文件或需要創建新文件
   - 保持配置文件的專注性，不要混合不相關配置
   - 確保新配置與現有配置的兼容性

2. **修改現有配置時**：
   - 維持配置文件的結構穩定性
   - 不要修改配置文件的核心職責定義
   - 確保修改不會破壞開發環境的穩定性

3. **環境擴展策略**：
   - 優先通過環境變量進行配置擴展
   - 新增服務時考慮與現有容器編排的兼容性
   - 保持開發環境配置的簡潔性和可重現性
   - 定期更新依賴版本和工具鏈配置
