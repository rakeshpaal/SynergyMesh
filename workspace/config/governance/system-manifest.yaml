# ═══════════════════════════════════════════════════════════════════════════════
#                    SynergyMesh System Manifest Configuration
#                    系統宣告清單（整合心智矩陣 + 執行長系統）
# ═══════════════════════════════════════════════════════════════════════════════
#
# 唯一入口 manifest，無重複定義
# Single entry point manifest, no duplicate definitions
#
# This is the root configuration that references all other configs.
# ═══════════════════════════════════════════════════════════════════════════════

version: "2.1.0"
id: "machinenativeops.system"
description: |
  SynergyMesh 系統宣告清單 - 次世代雲原生智能自動化平台
  整合心智矩陣 + 執行長系統 + 增強統一整合 + Phase 2 配置整合 + 治理框架對齊
  
  Strategic Vision: 實現「無人值守」的智能運維，讓企業專注於創新而非維運
  Governance: 遵循 23 維度治理矩陣，確保全局優化與架構合規

# ============================================================================
# Governance Framework (治理框架)
# ============================================================================
governance:
  vision_strategy:
    dimension: "00-vision-strategy"
    charter: "governance/00-vision-strategy/governance-charter.yaml"
    objectives: "governance/00-vision-strategy/strategic-objectives.yaml"
    vision: "governance/00-vision-strategy/vision-statement.yaml"
    status: "PRODUCTION_READY"
    compliance_rate: "100%"
  
  executive_team:
    - role: "CEO"
      responsibility: "最終決策權威、戰略方向制定"
    - role: "CTO"
      responsibility: "技術戰略制定、架構方向把關"
    - role: "VP Engineering"
      responsibility: "工程實踐標準、交付質量保證"
    - role: "VP Product"
      responsibility: "產品方向定義、功能路線圖"
    - role: "VP Architecture"
      responsibility: "架構治理執行、23維度矩陣維護"
  
  architecture_review_board:
    chair: "VP Architecture"
    members:
      - "Principal Architect"
      - "Lead Platform Engineer"
      - "Lead Security Engineer"
    meeting_frequency: "Weekly"
    decision_authority: "Architectural & Technical"

# ============================================================================
# Configuration Hierarchy (配置層級) - Phase 2 Consolidated
# ============================================================================
configs:
  # Phase 2: Unified Configuration Index - 統一配置索引
  - id: "unified_index"
    kind: "index"
    file: "config/unified-config-index.yaml"
    description: "統一配置索引 - 所有配置的單一真實來源"
    is_primary: true
  - id: "module_map"
    kind: "module-map"
    file: "config/system-module-map.yaml"
    description: "系統模組映射 - 統一目錄結構與元件整合"
  - id: "environment"
    kind: "environment"
    file: "config/environment.yaml"
  - id: "dependencies"
    kind: "dependencies"
    file: "config/dependencies.yaml"
  - id: "constitution"
    kind: "governance"
    file: "config/ai-constitution.yaml"
  - id: "virtual_experts"
    kind: "experts"
    file: "config/agents/team/virtual-experts.yaml"
  - id: "safety"
    kind: "safety"
    file: "config/safety-mechanisms.yaml"
  - id: "mind_matrix"
    kind: "topology"
    file: "config/topology-mind-matrix.yaml"
    description: "核心拓撲自稠密演化心智矩陣（含 Executive 層）"
    depends_on: ["environment", "dependencies", "constitution", "virtual_experts", "safety"]
    provides:
      - "MindMatrixTopology"
      - "ExecutiveSystem"
      - "MultiAgentHypergraph"
      - "ToolPipeline"
      - "YAMLValidationPipeline"

# Enhanced Integration Components (新增增強整合元件)
enhanced_integration:
  service_registry:
    id: "service_registry"
    module: "core.unified_integration.service_registry"
    class: "ServiceRegistry"
    description: "統一服務註冊表 - 服務發現與管理"
    provides:
      - "ServiceDiscovery"
      - "HealthMonitoring"
      - "DependencyResolution"
  
  cognitive_processor:
    id: "cognitive_processor"
    module: "core.unified_integration.cognitive_processor"
    class: "EnhancedCognitiveProcessor"
    description: "增強認知處理器 - 四層認知架構"
    provides:
      - "PerceptionLayer"
      - "ReasoningLayer"
      - "ExecutionLayer"
      - "ProofLayer"
    layers:
      - "L1-Perception: 感知層（遙測收集、異常偵測、時序漂移識別）"
      - "L2-Reasoning: 推理層（因果圖構建、風險評分、策略選擇）"
      - "L3-Execution: 執行層（多代理協作、同步屏障、回滾點生成）"
      - "L4-Proof: 證明層（審計鏈固化、SLSA 證據、行為可驗證性）"
  
  configuration_optimizer:
    id: "configuration_optimizer"
    module: "core.unified_integration.configuration_optimizer"
    class: "ConfigurationOptimizer"
    description: "配置優化器 - 智能配置管理與調優"
    provides:
      - "ConfigValidation"
      - "DriftDetection"
      - "OptimizationRecommendations"
      - "AutoTuning"

  # NEW: Work Configuration Manager
  work_configuration_manager:
    id: "work_configuration_manager"
    module: "core.unified_integration.work_configuration_manager"
    class: "WorkConfigurationManager"
    description: "工作配置管理器 - 統一工作流程與策略整合"
    provides:
      - "ModuleMappingIntegration"
      - "StrategyPolicyManagement"
      - "CrossReferenceValidation"
      - "CapabilityRegistryAlignment"
      - "WorkConfigurationLifecycle"

boot_sequence: ["environment", "dependencies", "constitution", "virtual_experts", "safety", "mind_matrix"]

# Enhanced Boot Sequence for Full System Integration
enhanced_boot_sequence:
  - phase: "core_configs"
    components: ["environment", "dependencies", "constitution", "virtual_experts", "safety"]
  - phase: "mind_matrix"
    components: ["mind_matrix"]
  - phase: "enhanced_integration"
    components: ["service_registry", "cognitive_processor", "configuration_optimizer", "work_configuration_manager"]
  - phase: "services"
    components: ["contracts-l1", "mcp-servers", "slsa-provenance"]

entrypoint:
  module: "runtime.mind_matrix.main"
  class: "MindMatrix"
  method: "bootstrap"

# Integration Mappings (整合映射)
integration_mappings:
  # Service to Registry Mappings
  services:
    - name: "mind-matrix"
      registry_category: "core"
      provides: ["cognitive-processing", "governance-validation"]
    - name: "execution-engine"
      registry_category: "execution"
      provides: ["action-execution", "rollback"]
      depends_on: ["mind-matrix"]
    - name: "system-orchestrator"
      registry_category: "orchestration"
      provides: ["workflow-management", "task-scheduling"]
      depends_on: ["execution-engine"]
    - name: "integration-hub"
      registry_category: "integration"
      provides: ["message-routing", "event-pub-sub"]
    - name: "configuration-manager"
      registry_category: "core"
      provides: ["config-management", "secret-management"]
    - name: "slsa-provenance"
      registry_category: "security"
      provides: ["attestation", "signature-verification"]
    - name: "contracts-l1"
      registry_category: "core"
      provides: ["contract-management", "provenance-attestation"]
      depends_on: ["slsa-provenance"]

# Strategy Policies (策略配置)
strategy_policies:
  auto_optimization:
    enabled: false
    categories: ["performance", "reliability"]
    approval_required: true
  drift_detection:
    enabled: true
    check_interval_seconds: 300
    alert_threshold: 0.1
  cognitive_processing:
    auto_execute_threshold: 0.85
    require_approval_threshold: 0.6
    layers_enabled:
      perception: true
      reasoning: true
      execution: true
      proof: true
  pipeline_memory:
    path: "ops/policies/pipeline.memory.policy.v1.0.0.yaml.txt"
    ssot_binding: true
    integrity_placeholders:
      sha3_512: "<TO_BE_FILLED_BY_PIPELINE>"
      blake3: "<TO_BE_FILLED_BY_PIPELINE>"
    lazy_attestation: true

# ============================================================================
# Workflow System Configuration (工作流程系統配置)
# ============================================================================
# Integrated from config/main-configuration.yaml
workflow_system:
  version: "2.0.0"
  enabled: true
  
  # Core Engine Configuration
  core_engine:
    contract_engine:
      enabled: true
      version: "2.0.0"
      execution_mode: "strict"  # strict | permissive | audit
      module: "core.contract_engine"
      registry:
        type: "distributed"
        storage_backend: "postgresql"
        cache_enabled: true
        cache_ttl_seconds: 300
      validation:
        pre_execution: true
        post_execution: true
        async_validation: true
        validation_timeout_seconds: 30
      lifecycle:
        auto_upgrade: false
        deprecation_period_days: 90
        rollback_enabled: true
        rollback_max_versions: 5
    
    plugin_system:
      enabled: true
      auto_discovery: true
      module: "core.plugin_system"
      plugin_directories:
        - "/app/plugins"
        - "/app/core/plugins"
        - "/app/custom_plugins"
      security:
        sandbox_enabled: true
        signature_verification: true
        allowed_capabilities:
          - "network.http"
          - "storage.read"
          - "storage.write"
          - "compute.execute"
      registry:
        type: "local"
        remote_url: "https://plugins.machinenativeops.io"
        sync_interval_seconds: 3600
  
  # AI Governance Configuration
  ai_governance:
    analysis_engine:
      enabled: true
      pattern_recognition:
        confidence_threshold: 0.85
        enabled: true
      conflict_detection:
        enabled: true
        auto_resolve: false
        suggest_resolution: true
        priority_rules:
          - "security_first"
          - "performance_second"
          - "maintainability_third"
      risk_assessment:
        enabled: true
        decision_tree:
          root: "risk_level_assessment"
    
    policies:
      code_quality:
        min_test_coverage: 80
        max_complexity: 15
        max_function_lines: 50
        max_file_lines: 500
      security:
        scan_enabled: true
        block_on_critical: true
        block_on_high: false
        vulnerability_db: "nvd"
      performance:
        max_execution_time_ms: 5000
        max_memory_mb: 512
        max_cpu_percent: 80
  
  # Validation System Configuration
  validation_system:
    multi_layer:
      enabled: true
      fail_fast: false
      parallel_execution: true
      max_parallel_validators: 5
      module: "core.validators.multi_layer_validator"
      layers:
        - name: "syntax"
          order: 1
          enabled: true
          severity: "critical"
          timeout_seconds: 10
        - name: "semantic"
          order: 2
          enabled: true
          severity: "high"
          timeout_seconds: 30
        - name: "security"
          order: 3
          enabled: true
          severity: "critical"
          timeout_seconds: 60
        - name: "performance"
          order: 4
          enabled: true
          severity: "medium"
          timeout_seconds: 45
        - name: "compliance"
          order: 5
          enabled: true
          severity: "high"
          timeout_seconds: 20
  
  # Pipeline Configuration
  pipeline:
    execution:
      mode: "orchestrated"  # orchestrated | distributed | serverless
      concurrency: 10
      timeout_seconds: 3600
      retry_policy:
        enabled: true
        max_retries: 3
        backoff_strategy: "exponential"
        initial_delay_seconds: 5
    
    quality_gates:
      - name: "code_quality"
        stage: "validation"
        criteria:
          test_coverage: ">= 80%"
          complexity: "<= 15"
          duplication: "<= 3%"
        blocking: true
      - name: "security"
        stage: "validation"
        criteria:
          critical_vulnerabilities: "== 0"
          high_vulnerabilities: "<= 2"
        blocking: true
      - name: "performance"
        stage: "deployment"
        criteria:
          response_time_p95: "<= 200ms"
          error_rate: "<= 0.1%"
        blocking: false
  
  # Deployment Configuration
  deployment:
    strategy:
      type: "blue_green"  # blue_green | canary | rolling | recreate
      blue_green:
        enabled: true
        switch_mode: "automated"
        verification_period_seconds: 300
        rollback_on_failure: true
    health_checks:
      liveness:
        enabled: true
        path: "/health/live"
        interval_seconds: 30
        timeout_seconds: 5
        failure_threshold: 3
      readiness:
        enabled: true
        path: "/health/ready"
        interval_seconds: 10
        timeout_seconds: 3
        failure_threshold: 3
  
  # Observability Configuration
  observability:
    logging:
      enabled: true
      level: "info"
      format: "json"
      structured:
        enabled: true
      aggregation:
        enabled: true
        backend: "elasticsearch"
        retention_days: 30
    tracing:
      enabled: true
      sampler: "probabilistic"
      sampling_rate: 0.1
      backend: "jaeger"
    metrics:
      enabled: true
      backend: "prometheus"
      scrape_interval_seconds: 15
      retention_days: 15
  
  # Security Configuration
  security:
    authentication:
      enabled: true
      provider: "oauth2"
      token_expiry_seconds: 3600
    authorization:
      enabled: true
      model: "rbac"
      rbac:
        roles:
          - name: "admin"
            permissions: ["*"]
          - name: "developer"
            permissions:
              - "deploy:dev"
              - "deploy:staging"
              - "view:*"
          - name: "viewer"
            permissions:
              - "view:*"
    encryption:
      enabled: true
      algorithm: "AES-256-GCM"
      key_rotation_days: 90
    network:
      tls_enabled: true
      tls_version: "1.3"
      mtls_enabled: true
    secrets:
      backend: "vault"
      rotation_enabled: true
      rotation_interval_days: 30
  
  # Self-Improvement Configuration
  self_improvement:
    enabled: true
    learning:
      enabled: true
      pattern_learning:
        enabled: true
        min_samples: 100
        confidence_threshold: 0.90
        update_frequency: "daily"
      feedback_loop:
        enabled: true
        sources:
          - "deployment_outcomes"
          - "validation_results"
          - "user_feedback"
          - "incident_reports"
    model_updates:
      enabled: true
      strategy: "shadow_mode"
      validation_period_days: 14
      auto_promotion: false
  
  # Integration Configuration
  integrations:
    vcs:
      provider: "github"
      webhook_enabled: true
    cicd:
      provider: "github_actions"
      auto_trigger: true
    issue_tracking:
      provider: "github_issues"
      auto_create: true
    communication:
      channels:
        - type: "slack"
          enabled: true
          webhook_url: "${SLACK_WEBHOOK_URL}"
        - type: "email"
          enabled: true
          smtp_host: "${SMTP_HOST}"
  
  # Feature Flags
  feature_flags:
    ai_governance: true
    multi_layer_validation: true
    blue_green_deployment: true
    canary_deployment: false
    self_improvement: true
    advanced_security: true
    distributed_tracing: true
    automated_rollback: true
  
  # Policy References
  behavior_contracts: "governance/policies/workflow/behavior-contracts.yaml"
  validation_rules: "governance/policies/workflow/validation-rules.yaml"
