# ğŸšª Gates Map - Unified Gate Registry
# Version: 1.0.0
# Purpose: Central registry for all GitHub Actions gates

apiVersion: machinenativeops.io/v1
kind: GatesMap
metadata:
  name: gates-map
  namespace: machinenativenops-gates
  labels:
    machinenativeops.io/tier: "gates"
    machinenativeops.io/version: "v1.0.0"
    machinenativeops.io/component: "gates-map"
  annotations:
    machinenativeops.io/description: "Central registry for all validation gates"
    machinenativeops.io/last-modified: "2025-12-21T02:00:00Z"

spec:
  version: 1
  
  # === æ²»ç†é–˜é–€ (Governance Gates) ===
  governance_gates:
    - id: "gate-pr-evidence"
      name: "PR Evidence Validation"
      workflow: ".github/workflows/gate-pr-evidence.yml"
      description: "Validates 4 core evidence fields in PR"
      trigger: "pull_request"
      enforcement: "strict"
      status: "active"
      evidence_required:
        - "repo"
        - "branch"
        - "commit"
        - "PR"
      
    - id: "gate-root-naming"
      name: "Root Layer Naming Validation"
      workflow: ".github/workflows/gate-root-naming.yml"
      description: "Validates root layer file naming conventions"
      trigger: "pull_request"
      enforcement: "strict"
      status: "active"
      scope:
        - "root.*"
        - "init.d/*"
        - "bin/*"
        - "sbin/*"
        - "etc/*"
  
  # === è¦ç¯„é–˜é–€ (Specification Gates) ===
  specification_gates:
    - id: "gate-root-specs"
      name: "Root Specifications Validation"
      workflow: ".github/workflows/gate-root-specs.yml"
      description: "Validates all root layer specifications"
      trigger: "pull_request"
      enforcement: "strict"
      status: "active"
      scope:
        - "root.*.yaml"
        - "root.*.map"
        - "root.*.sh"
        - "root.specs.*.yaml"
        - "root.registry.*.yaml"
      validations:
        - "naming_spec"
        - "reference_spec"
        - "mapping_spec"
        - "logic_spec"
        - "context_spec"
      
  # === CI/CD é–˜é–€ (CI/CD Gates) ===
  cicd_gates:
    - id: "gate-ci"
      name: "Continuous Integration"
      workflow: ".github/workflows/ci.yml"
      description: "Code quality and testing pipeline"
      trigger: "pull_request"
      enforcement: "strict"
      status: "active"
      checks:
        - "code_quality"
        - "security_scan"
        - "unit_tests"
        - "integration_tests"
      
    - id: "gate-security"
      name: "Security Scanning"
      workflow: ".github/workflows/security.yml"
      description: "Security vulnerability scanning"
      trigger: "pull_request"
      enforcement: "strict"
      status: "active"
      checks:
        - "codeql"
        - "dependency_scan"
        - "container_scan"
        - "secret_detection"
  
  # === é–˜é–€åŸ·è¡Œé †åº (Gate Execution Order) ===
  execution_order:
    - phase: "pre-validation"
      gates:
        - "gate-pr-evidence"
        - "gate-root-naming"
      parallel: false
      
    - phase: "specification-validation"
      gates:
        - "gate-root-specs"
      parallel: false
      
    - phase: "code-validation"
      gates:
        - "gate-ci"
        - "gate-security"
      parallel: true
  
  # === é–˜é–€ä¾è³´é—œä¿‚ (Gate Dependencies) ===
  dependencies:
    gate-root-specs:
      requires:
        - "gate-root-naming"
      description: "Specs validation requires naming validation to pass first"
      
    gate-ci:
      requires:
        - "gate-pr-evidence"
      description: "CI requires PR evidence validation"
  
  # === é–˜é–€é…ç½® (Gate Configuration) ===
  configuration:
    # å¤±æ•—è™•ç†
    failure_handling:
      on_gate_failure:
        - "Block PR merge"
        - "Add comment with details"
        - "Notify PR author"
      
      escalation:
        first_failure: "Warning + fix suggestions"
        second_failure: "Block + require review"
        repeated_failures: "Escalate to governance committee"
    
    # é€šçŸ¥è¨­å®š
    notifications:
      channels:
        - "github_comments"
        - "pr_status_checks"
      
      recipients:
        on_failure:
          - "pr_author"
          - "reviewers"
        on_success:
          - "pr_author"
    
    # å ±å‘Šè¨­å®š
    reporting:
      format: "markdown"
      include_details: true
      include_suggestions: true
      retention_days: 30
  
  # === é–˜é–€çµ±è¨ˆ (Gate Statistics) ===
  statistics:
    total_gates: 5
    active_gates: 5
    governance_gates: 2
    specification_gates: 1
    cicd_gates: 2
    
    enforcement_levels:
      strict: 5
      moderate: 0
      advisory: 0

# === ç‹€æ…‹ ===
status:
  phase: "Active"
  conditions:
    - type: "Operational"
      status: "True"
      lastTransitionTime: "2025-12-21T02:00:00Z"
      reason: "AllGatesActive"
      message: "All gates are operational and enforcing"
  
  last_execution:
    timestamp: "2025-12-21T02:00:00Z"
    total_runs: 0
    successful_runs: 0
    failed_runs: 0