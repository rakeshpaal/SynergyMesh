# ═══════════════════════════════════════════════════════════════════════════════
#           Refactor & Evolution Automation Configuration
#           重構與演化自動化配置
# ═══════════════════════════════════════════════════════════════════════════════
#
# Purpose: Configuration for automated refactoring and evolution workflows
# Version: 1.0.0
# Integration: automation_launcher.py + refactor_engine.py + self_evolution_engine.py
#
# ═══════════════════════════════════════════════════════════════════════════════

version: "1.0.0"
name: "refactor-evolution-automation"
description: "Automated project refactoring and evolution using SynergyMesh engines"

# ============================================================================
# Workflow Configuration (工作流配置)
# ============================================================================
workflow:
  mode: "autonomous" # autonomous | supervised | interactive
  max_iterations: 3 # Maximum evolution cycles
  confidence_threshold: 0.7 # Minimum confidence for auto-apply changes

  # Execution phases
  phases:
    - id: "analysis"
      name: "Analysis Phase"
      description: "Analyze codebase structure and identify issues"
      engine: "refactor_engine"
      operations:
        - "analyze_structure"
        - "identify_problems"
        - "assess_impact"

    - id: "planning"
      name: "Planning Phase"
      description: "Create refactoring execution plan"
      engine: "refactor_engine"
      operations:
        - "generate_plan"
        - "prioritize_actions"
        - "validate_plan"

    - id: "execution"
      name: "Execution Phase"
      description: "Execute refactoring actions"
      engine: "refactor_engine"
      operations:
        - "apply_changes"
        - "track_progress"
        - "handle_errors"

    - id: "learning"
      name: "Learning Phase"
      description: "Learn from execution results"
      engine: "evolution_engine"
      operations:
        - "collect_metrics"
        - "identify_patterns"
        - "extract_insights"

    - id: "evolution"
      name: "Evolution Phase"
      description: "Identify and apply improvements"
      engine: "evolution_engine"
      operations:
        - "find_opportunities"
        - "prioritize_improvements"
        - "apply_optimizations"

    - id: "validation"
      name: "Validation Phase"
      description: "Validate changes and ensure stability"
      engine: "both"
      operations:
        - "run_tests"
        - "check_integrity"
        - "verify_improvements"

# ============================================================================
# Engine Configuration (引擎配置)
# ============================================================================
engines:
  refactor_engine:
    path: "tools/refactor/refactor_engine.py"
    enabled: true
    config:
      target_paths:
        - "core/"
        - "automation/"
        - "services/"
        - "mcp-servers/"
      exclude_paths:
        - "**/node_modules/**"
        - "**/.git/**"
        - "**/dist/**"
        - "**/build/**"
      analysis_depth: "deep" # surface | normal | deep
      validation_strict: true
      backup_enabled: true
      dry_run_first: true

  evolution_engine:
    path: "automation/intelligent/synergymesh_core/self_evolution_engine.py"
    enabled: true
    config:
      learning_enabled: true
      # auto_optimize controls whether evolution opportunities are applied automatically
      # during the evolution phase (different from workflow.mode which controls overall automation)
      auto_optimize: false # Set to true to auto-apply evolution opportunities
      confidence_threshold: 0.7
      max_evolution_cycles: 3
      safety_checks: true
      rollback_on_failure: true

  island_ai_agents:
    path: "island-ai/dist/index.js"
    enabled: true
    agents:
      - "architect" # System analysis and patterns
      - "security" # Security validation
      - "qa" # Quality assurance
    integration_mode: "advisory" # advisory | active

# ============================================================================
# Target Configuration (目標配置)
# ============================================================================
targets:
  primary:
    - path: "core/"
      priority: "high"
      focus: ["structure", "organization", "integration"]

    - path: "automation/"
      priority: "high"
      focus: ["efficiency", "reliability", "scalability"]

    - path: "services/"
      priority: "medium"
      focus: ["consistency", "maintainability"]

    - path: "mcp-servers/"
      priority: "medium"
      focus: ["standardization", "integration"]

  exclude:
    - "node_modules/"
    - ".git/"
    - "dist/"
    - "build/"
    - "__pycache__/"
    - "*.egg-info/"
    - ".venv/"
    - "legacy/"

# ============================================================================
# Safety & Validation (安全與驗證)
# ============================================================================
safety:
  # Pre-execution checks
  pre_checks:
    - "git_status_clean"
    - "no_uncommitted_changes"
    - "backup_created"
    - "tests_passing"

  # Post-execution validation
  post_checks:
    - "no_syntax_errors"
    - "tests_still_passing"
    - "no_new_vulnerabilities"
    - "performance_acceptable"

  # Validation timeouts
  validation_timeout: 300 # seconds for validation checks (e.g., test runs)

  # Rollback conditions
  rollback_on:
    - "tests_failing"
    - "critical_errors"
    - "security_vulnerabilities"
    - "performance_degradation"

  # Human approval required for
  require_approval:
    - "breaking_changes"
    - "production_impact"
    - "large_scale_refactor"

# ============================================================================
# Metrics & Monitoring (指標與監控)
# ============================================================================
metrics:
  track:
    - name: "code_quality"
      metrics: ["complexity", "duplication", "maintainability"]

    - name: "structure"
      metrics: ["organization", "consistency", "modularity"]

    - name: "performance"
      metrics: ["execution_time", "resource_usage", "efficiency"]

    - name: "evolution"
      metrics: ["improvements_applied", "issues_resolved", "optimizations"]

  reporting:
    format: "yaml"
    output_dir: "reports/refactor-evolution/"
    include_details: true
    timestamp: true

# ============================================================================
# Output Configuration (輸出配置)
# ============================================================================
output:
  reports_dir: "reports/refactor-evolution/"
  plans_dir: "reports/refactor-evolution/plans/"
  logs_dir: "reports/refactor-evolution/logs/"
  backup_dir: ".refactor-backups/"

  report_format: "yaml" # yaml | json | markdown
  verbosity: "detailed" # minimal | normal | detailed

  # Notification settings
  notifications:
    enabled: true
    on_completion: true
    on_errors: true
    include_summary: true

# ============================================================================
# Integration Points (整合點)
# ============================================================================
integration:
  automation_launcher:
    enabled: true
    pipeline_id: "refactor_evolution_pipeline"

  ci_cd:
    enabled: false # Enable when ready for CI integration
    trigger_on: ["push", "pull_request"]
    branch_filter: ["develop", "feature/*"]

  knowledge_graph:
    update_on_completion: true
    sync_documentation: true

# ============================================================================
# Execution Modes (執行模式)
# ============================================================================
modes:
  autonomous:
    description: "Fully automated with minimal human intervention"
    auto_apply: false # Still requires review for safety
    confidence_required: 0.8

  supervised:
    description: "Automated with human approval at key points"
    auto_apply: false
    require_approval_per_phase: true

  interactive:
    description: "Step-by-step with human guidance"
    auto_apply: false
    require_approval_per_action: true

# ============================================================================
# Playbooks (劇本)
# ============================================================================
playbooks:
  default:
    - "analyze_structure"
    - "identify_issues"
    - "create_plan"
    - "execute_refactor"
    - "learn_and_evolve"
    - "validate_results"

  quick_fix:
    - "analyze_structure"
    - "apply_quick_fixes"
    - "validate_results"

  deep_evolution:
    - "comprehensive_analysis"
    - "identify_opportunities"
    - "multi_cycle_evolution"
    - "full_validation"
