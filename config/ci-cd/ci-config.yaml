ci_configuration:
  build:
    go:
      command: go build
      output_dir: bin
    npm:
      command: npm run build
      output_dir: dist
    python:
      command: python -m build
      output_dir: dist
    rust:
      command: cargo build --release
      output_dir: target/release
  cache:
    cargo:
      key: cargo-${{ runner.os }}-${{ hashFiles('**/Cargo.lock') }}
      paths:
      - ~/.cargo/registry
      - ~/.cargo/git
      - target
    enabled: true
    go:
      key: go-${{ runner.os }}-${{ hashFiles('**/go.sum') }}
      paths:
      - ~/go/pkg/mod
      - ~/.cache/go-build
    npm:
      key: npm-${{ runner.os }}-${{ hashFiles('**/package-lock.json') }}
      paths:
      - ~/.npm
      - node_modules
    pip:
      key: pip-${{ runner.os }}-${{ hashFiles('**/requirements*.txt', '**/pyproject.toml')
        }}
      paths:
      - ~/.cache/pip
      - .venv
  checkout:
    default_action: actions/checkout@v4
    fetch_depth: 0
    submodules: false
  concurrency:
    cancel_in_progress: true
    group_pattern: ${{ github.workflow }}-${{ github.ref }}
  cost_optimization:
    enabled: true
    max_concurrent_jobs: 10
    prefer_cache: true
    rules:
    - action: skip_expensive_checks
      condition: github.event_name == 'pull_request' && github.event.pull_request.draft
        == true
    - action: skip_all
      condition: contains(github.event.head_commit.message, '[skip ci]')
    - action: docs_only
      condition: github.event_name == 'push' && startsWith(github.ref, 'refs/heads/docs/')
    skip_redundant_builds: true
  deployment:
    docker:
      image_prefix: machinenativeops-admin
      registry: ghcr.io
      tag_strategy: git-sha
    environments:
    - approval_required: false
      auto_deploy: true
      name: development
    - approval_required: true
      approvers:
      - SynergyMesh-admin
      auto_deploy: true
      name: staging
    - approval_required: true
      approvers:
      - SynergyMesh-admin
      auto_deploy: false
      name: production
      requires_tests: true
    kubernetes:
      enabled: true
      namespace_pattern: unmanned-island-${{ environment }}
  monitoring:
    dashboards:
    - name: CI Cost Dashboard
      url: https://github.com/${{ github.repository }}/actions/workflows/ci-cost-dashboard.yml
    - name: Security Dashboard
      url: https://github.com/${{ github.repository }}/security
    enabled: true
    metrics:
    - workflow_duration
    - job_duration
    - cache_hit_rate
    - test_success_rate
    - deployment_frequency
  notifications:
    github:
      auto_assign: true
      create_issue_on_failure: true
      enabled: true
    slack:
      channels:
        failure: '#ci-failures'
        security: '#security-alerts'
        success: '#ci-success'
      enabled: false
      webhook_secret: SLACK_WEBHOOK_URL
  reusable_workflows:
    build:
      description: Build artifacts
      path: .github/workflows/reusable-build.yml
    docker:
      description: Docker image build and push
      path: .github/workflows/reusable-docker-build.yml
    setup:
      description: Common setup steps (checkout, cache, install)
      path: .github/workflows/reusable-setup.yml
    test:
      description: Test execution with coverage
      path: .github/workflows/reusable-test.yml
    validation:
      description: Validation steps (YAML, JSON, Markdown)
      path: .github/workflows/reusable-validation.yml
  runtimes:
    go:
      default: '1.21'
      setup_action: actions/setup-go@v5
      supported:
      - '1.20'
      - '1.21'
      - '1.22'
    java:
      default: '17'
      distribution: temurin
      setup_action: actions/setup-java@v4
      supported:
      - '11'
      - '17'
      - '21'
    node:
      default: '20'
      setup_action: actions/setup-node@v6
      supported:
      - '18'
      - '20'
      - '21'
    python:
      default: '3.11'
      setup_action: actions/setup-python@v5
      supported:
      - '3.10'
      - '3.11'
      - '3.12'
    rust:
      default: stable
      setup_action: actions-rust-lang/setup-rust-toolchain@v1
      supported:
      - stable
      - nightly
  security:
    codeql:
      enabled: true
      languages:
      - python
      - javascript-typescript
      - go
      queries: security-and-quality
    container_scan:
      enabled: true
      severity_threshold: HIGH
      tool: trivy
    dependency_scan:
      auto_fix: true
      enabled: true
      tools:
      - dependabot
      - snyk
    secret_scan:
      enabled: true
      tool: gitleaks
  testing:
    e2e:
      coverage_threshold: 60
      timeout: 30
    frameworks:
      go: go test
      python: pytest
      rust: cargo test
      typescript: jest
    integration:
      coverage_threshold: 70
      timeout: 20
    unit:
      coverage_threshold: 80
      timeout: 10
  timeouts:
    build: 20
    default: 10
    deployment: 60
    integration: 30
    security_scan: 30
    test: 15
    validation: 5
  validation:
    json:
      enabled: true
      extensions:
      - .json
      tool: python3 -c 'import json; json.load(open("$file"))'
    markdown:
      config: .markdownlint.json
      enabled: true
      tool: markdownlint
    python:
      enabled: true
      formatter: black
      linter: ruff
      type_checker: mypy
    typescript:
      enabled: true
      formatter: prettier
      linter: eslint
      type_checker: tsc
    yaml:
      enabled: true
      extensions:
      - .yaml
      - .yml
      tool: python3 -c 'import yaml; yaml.safe_load(open("$file"))'
  version: 1.0.0
