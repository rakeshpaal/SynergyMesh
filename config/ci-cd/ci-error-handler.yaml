auto_fix:
  create_pr: true
  enabled: true
  pr_template:
    body: '## Automated Fix


      This PR was automatically generated to fix CI errors.


      **Original Issue:** #{issue_number}

      **Error Category:** {error_category}


      ### Changes Made

      {changes_description}


      ### Verification

      - [ ] Tests pass

      - [ ] Lint passes

      - [ ] Build succeeds

      '
    title: '[Auto-Fix] {error_category} in {workflow_name}'
  safe_fixes:
  - lint_errors
  - formatting
  - dependency_audit
  - import_sorting
ci_error_handler:
  comprehensive_solution: config/ci-comprehensive-solution.yaml
  enabled: true
  version: 1.1.0
error_categories:
- BUILD_ERROR
- TEST_FAILURE
- LINT_ERROR
- TYPE_ERROR
- DEPENDENCY_ERROR
- SECURITY_SCAN
- DEPLOYMENT_ERROR
- STARTUP_FAILURE
- PERMISSION_ERROR
- NETWORK_ERROR
error_patterns:
  action_not_found:
    auto_fixable: true
    category: DEPENDENCY_ERROR
    fix_description: 更新 Action 到最新穩定版本
    pattern: Unable to resolve action|Could not find action
  docker_error:
    auto_fixable: true
    category: BUILD_ERROR
    fix_command: docker system prune -a --volumes
    pattern: docker.*failed|Error response from daemon
  eslint:
    auto_fixable: true
    category: LINT_ERROR
    fix_command: npm run lint -- --fix
    pattern: error\s+.*eslint
  jest:
    auto_fixable: false
    category: TEST_FAILURE
    pattern: FAIL.*\.test\.
  network_timeout:
    auto_fixable: false
    category: NETWORK_ERROR
    pattern: ETIMEDOUT|ECONNREFUSED|network timeout
  npm_audit:
    auto_fixable: true
    category: SECURITY_SCAN
    fix_command: npm audit fix
    pattern: npm audit.*vulnerabilities
  npm_ci_failure:
    auto_fixable: true
    category: DEPENDENCY_ERROR
    fix_command: rm -rf node_modules package-lock.json && npm install
    pattern: npm ERR!|Exit handler never called
  permission_error:
    auto_fixable: false
    category: PERMISSION_ERROR
    pattern: Resource not accessible by integration|Permission denied
  prettier:
    auto_fixable: true
    category: LINT_ERROR
    fix_command: npm run format
    pattern: Prettier.*check failed
  startup_failure:
    auto_fixable: true
    category: STARTUP_FAILURE
    fix_command: null
    fix_description: 移除 job-level permissions 區塊（用於 reusable workflows 時）
    pattern: startup_failure|Workflow failed to start
  typescript:
    auto_fixable: false
    category: TYPE_ERROR
    pattern: error TS\d+
issue_management:
  assignees:
    enabled: true
    use_codeowners: true
  auto_create: true
  duplicate_detection: true
  labels:
    BUILD_ERROR:
    - ci-failure
    - build
    DEPENDENCY_ERROR:
    - ci-failure
    - dependencies
    DEPLOYMENT_ERROR:
    - ci-failure
    - deployment
    LINT_ERROR:
    - ci-failure
    - lint
    - auto-fixable
    SECURITY_SCAN:
    - ci-failure
    - security
    TEST_FAILURE:
    - ci-failure
    - test
    TYPE_ERROR:
    - ci-failure
    - typescript
  templates:
    body: '## CI Failure Report


      **Workflow:** {workflow_name}

      **Run ID:** {run_id}

      **Branch:** {branch}

      **Commit:** {commit_sha}


      ### Error Details

      ```

      {error_details}

      ```


      ### Suggested Fix

      {suggested_fix}


      ### Links

      - [Workflow Run]({run_url})

      - [Commit]({commit_url})

      '
    title: '[CI Failure] {workflow_name}: {error_category}'
status_tracking:
  metrics:
    track_auto_vs_manual: true
    track_fix_rate: true
    track_time_to_fix: true
  statuses:
  - PENDING
  - IN_PROGRESS
  - PR_CREATED
  - VERIFIED
  - CLOSED
