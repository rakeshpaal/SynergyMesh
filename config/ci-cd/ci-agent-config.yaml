agent_role:
  analysis_framework:
    layers:
    - checks:
      - workflow YAML 語法驗證
      - action 版本與可用性
      - runner 配置正確性
      - 權限設置合規性
      name: GitHub Actions 基礎設施層
    - checks:
      - job 依賴關係
      - 並發控制設置
      - 超時配置
      - 重試策略
      name: 工作流程設計層
    - checks:
      - build 腳本正確性
      - test 執行結果
      - lint 錯誤
      - 依賴項問題
      name: 應用程式邏輯層
  name: CI/Workflow 根因分析與專業維修工程師
  name_en: CI/Workflow Root Cause Analysis & Repair Engineer
  primary_responsibilities:
  - 監控所有 CI 工作流程執行狀態
  - 自動分析失敗原因並分類
  - 生成維修計畫與優先級排序
  - 執行自動化修復（安全範圍內）
  - 生成詳細的診斷報告
analysis_workflow:
  steps:
  - actions:
    - 獲取工作流程執行日誌
    - 提取錯誤訊息與堆疊追蹤
    - 記錄受影響的檔案與 commit
    id: collect
    name: 收集錯誤資訊 / Collect Error Information
  - actions:
    - 匹配已知錯誤模式
    - 判定錯誤類別與嚴重度
    - 識別根因 vs 連鎖反應
    id: classify
    name: 錯誤分類 / Error Classification
    reference: config/ci-error-handler.yaml
  - actions:
    - 追蹤錯誤到源頭
    - 建立因果關係鏈
    - 評估影響範圍
    id: analyze
    name: 根因分析 / Root Cause Analysis
  - actions:
    - 制定修復步驟
    - 排列優先級 (P0/P1/P2)
    - 評估自動修復可行性
    id: plan
    name: 維修計畫 / Repair Planning
    reference: config/ci-error-handler.yaml#auto_fix
  - actions:
    - 執行安全的自動修復
    - 生成 PR 或 Issue
    - 觸發驗證流程
    id: execute
    name: 執行修復 / Execute Repair
  - actions:
    - 產出 Markdown 診斷報告
    - 更新錯誤追蹤狀態
    - 通知相關人員
    id: report
    name: 生成報告 / Generate Report
anti_patterns:
- description: 直接停用失敗的 job 而非修復根因
  id: disable_job
  name: 關閉 Job
  reason: 只是隱藏問題，不會真正解決
- description: 使用 skip 或 exclude 跳過失敗的測試
  id: skip_tests
  name: 跳過測試
  reason: 可能導致生產環境出現已知 bug
- description: 只更新版本號而不修改架構
  id: force_version
  name: 強改版本
  reason: 版本號應反映真實的代碼狀態
- description: 使用 continue-on-error 跳過安全掃描
  id: ignore_security
  name: 忽略安全警告
  reason: 可能引入安全漏洞
- description: 移除 timeout-minutes 設置
  id: remove_timeout
  name: 移除超時
  reason: 可能導致無限執行與成本失控
integrations:
  comprehensive_solution: config/ci-comprehensive-solution.yaml
  error_handler: config/ci-error-handler.yaml
  skeleton_index: unmanned-engineer-ceo/60-machine-guides/70-architecture-skeletons/skeletons-index.yaml
  stage0_checklist: island.bootstrap.stage0.yaml
metadata:
  created: '2025-12-06'
  description: "CI Copilot 智能代理，自動監控工作流程事件並執行根因分析與專業維修。\nCI Copilot intelligent agent\
    \ that monitors workflow events and performs \nroot cause analysis and professional\
    \ repairs.\n"
  name: ci-copilot-agent
  updated: '2025-12-06'
  version: 1.0.0
notifications:
  channels:
  - enabled: true
    template: ci-failure-issue
    type: github_issue
  - auto_create_pr: true
    enabled: true
    type: pr_comment
report_templates:
  diagnostic_report:
    format: markdown
    sections:
    - '## 1. CI 問題總覽表'
    - '## 2. 根因分群與因果鏈'
    - '## 3. 與 Stage 0 / skeleton / workflows 的對齊檢查'
    - '## 4. 維修計畫 (P0 → P1 → P2)'
    - '## 5. Anti-pattern 清單'
  repair_plan:
    priority_levels:
      P0:
        description: 緊急：阻塞所有 CI 流程
        sla: 24 小時內修復
      P1:
        description: 重要：影響主要功能
        sla: 48 小時內修復
      P2:
        description: 一般：影響次要功能
        sla: 1 週內修復
skeleton_integration:
  index_path: unmanned-engineer-ceo/60-machine-guides/70-architecture-skeletons/skeletons-index.yaml
  skeleton_validations:
  - ci_checks:
    - 服務邊界驗證
    - 模組依賴檢查
    - 循環依賴檢測
    skeleton_id: architecture-stability
  - ci_checks:
    - 安全掃描 (SAST/DAST)
    - 漏洞掃描 (Snyk/OSV)
    - SLSA 合規檢查
    - 日誌格式驗證
    skeleton_id: security-observability
  - ci_checks:
    - 認證機制測試
    - 授權策略驗證
    - 租戶隔離測試
    skeleton_id: identity-tenancy
  - ci_checks:
    - API 合約驗證
    - 向後相容性檢查
    - OpenAPI 規範驗證
    skeleton_id: api-governance
  - ci_checks:
    - 資料模式驗證
    - 敏感資料掃描
    - GDPR 合規檢查
    skeleton_id: data-governance
  - ci_checks:
    - 測試覆蓋率門檻
    - 品質門檢
    - 性能回歸測試
    skeleton_id: testing-governance
trigger_rules:
  events:
  - push
  - pull_request
  - workflow_run
  - check_run
  on_status:
  - failure
  - startup_failure
  - cancelled
  - timed_out
  paths:
  - .github/workflows/**
  - config/ci-*.yaml
  - governance/policies/**
