# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#           Unified Sync & Refactor Configuration
#           çµ±ä¸€åŒæ­¥èˆ‡é‡æ§‹é…ç½®
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# Version: 1.0.0
# Purpose: Single source of truth for project synchronization and refactoring
# 
# This configuration file is referenced by:
# - .github/workflows/08-sync-subdirs.yml
# - .github/workflows/update-refactor-playbooks.yml
# - scripts/sync/watch-and-sync.sh
# - tools/generate-refactor-playbook.py
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

version: "1.0.0"
name: "sync-refactor-config"
description: "Unified configuration for project synchronization and refactoring systems"

# ============================================================================
# Synchronization Configuration (åŒæ­¥é…ç½®)
# ============================================================================
sync:
  # Directories to monitor for changes (ç›£æ§ç›®éŒ„)
  # These directories are watched by the sync script and GitHub Actions
  monitored_directories:
    - "core/"
    - "services/"
    - "automation/"
    - "autonomous/"
    - "governance/"
    - "apps/"
    - "tools/"
    - "infrastructure/"
    - "docs/"
    - "scripts/"
    - "tests/"
    - "config/"
    - "mcp-servers/"

  # Files to exclude from monitoring (æ’é™¤æ–‡ä»¶)
  exclude_patterns:
    - ".git"
    - "node_modules"
    - "__pycache__"
    - ".venv"
    - "venv"
    - "dist"
    - "build"
    - ".next"
    - "coverage"
    - "target"
    - "*.pyc"
    - "*.log"
    - ".DS_Store"

  # Trigger files that should immediately sync (è§¸ç™¼æ–‡ä»¶)
  trigger_files:
    - "templates/**"
    - "island.bootstrap.stage0.yaml"
    - "synergymesh.yaml"
    - "config/system-manifest.yaml"
    - "config/unified-config-index.yaml"

  # Debounce settings (é˜²æŠ–è¨­ç½®)
  debounce:
    enabled: true
    time_seconds: 5
    max_wait_seconds: 30

  # Git settings (Git è¨­ç½®)
  git:
    auto_commit: true
    auto_push: true
    commit_message_template: "ğŸ”„ è‡ªå‹•åŒæ­¥: {timestamp}\n\nè®Šæ›´ç›®éŒ„:\n{directories}\n\nè®Šæ›´æ–‡ä»¶:\n{files}"
    pull_before_push: true
    rebase: true
    max_retries: 3

  # Validation before commit (æäº¤å‰é©—è­‰)
  validation:
    enabled: true
    checks:
      - type: "yaml"
        description: "Validate YAML syntax"
        command: "python -c 'import yaml; yaml.safe_load(open(\"{file}\"))'"
        file_patterns: ["*.yaml", "*.yml"]
      - type: "json"
        description: "Validate JSON syntax"
        command: "python -c 'import json; json.load(open(\"{file}\"))'"
        file_patterns: ["*.json"]
      - type: "markdown"
        description: "Check markdown links"
        command: "npm run docs:lint -- {file}"
        file_patterns: ["*.md"]
        optional: true

# ============================================================================
# Refactoring Configuration (é‡æ§‹é…ç½®)
# ============================================================================
refactor:
  # Playbook generation settings (Playbook ç”Ÿæˆè¨­ç½®)
  playbooks:
    output_directory: "docs/refactor_playbooks"
    phases:
      - "01_deconstruction"
      - "02_integration"
      - "03_refactor"
    
    # Clusters to generate playbooks for (è¦ç”Ÿæˆ playbook çš„é›†ç¾¤)
    clusters:
      - id: "core"
        path: "core/"
        priority: "P0"
        description: "æ ¸å¿ƒå¹³å°æ¨¡çµ„"
      - id: "services"
        path: "services/"
        priority: "P1"
        description: "çµ±ä¸€æœå‹™å…¥å£"
      - id: "automation"
        path: "automation/"
        priority: "P1"
        description: "è‡ªå‹•åŒ–æ¨¡çµ„"
      - id: "autonomous"
        path: "autonomous/"
        priority: "P1"
        description: "è‡ªä¸»ç³»çµ±"
      - id: "governance"
        path: "governance/"
        priority: "P0"
        description: "æ²»ç†èˆ‡æ”¿ç­–"
      - id: "apps"
        path: "apps/"
        priority: "P2"
        description: "æ‡‰ç”¨ç¨‹å¼"
      - id: "infrastructure"
        path: "infrastructure/"
        priority: "P1"
        description: "åŸºç¤è¨­æ–½"
      - id: "tools"
        path: "tools/"
        priority: "P2"
        description: "å·¥å…·èˆ‡è…³æœ¬"

  # Data sources for playbook generation (æ•¸æ“šæº)
  data_sources:
    governance_report: "governance/language-governance-report.md"
    semgrep_report: "governance/semgrep-report.json"
    hotspot_data: "apps/web/public/data/hotspot.json"
    cluster_heatmap: "apps/web/public/data/cluster-heatmap.json"
    migration_flow: "apps/web/public/data/migration-flow.json"
    ai_suggestions: "governance/ai-refactor-suggestions.md"

  # Caching settings (ç·©å­˜è¨­ç½®)
  cache:
    enabled: true
    directory: ".cache/refactor"
    ttl_hours: 24
    invalidate_on:
      - "governance/language-governance-report.md"
      - "governance/semgrep-report.json"
      - "apps/web/public/data/*.json"

  # Generation triggers (ç”Ÿæˆè§¸ç™¼å™¨)
  triggers:
    auto_generate_on_sync: true
    governance_file_patterns:
      - "governance/language-governance-report.md"
      - "governance/semgrep-report.json"
      - "governance/ai-refactor-suggestions.md"
      - "apps/web/public/data/hotspot.json"
      - "apps/web/public/data/cluster-heatmap.json"
      - "apps/web/public/data/migration-flow.json"

# ============================================================================
# Integration Settings (æ•´åˆè¨­ç½®)
# ============================================================================
integration:
  # Sync-to-refactor integration (åŒæ­¥åˆ°é‡æ§‹æ•´åˆ)
  sync_triggers_refactor: true
  
  # Workflows to trigger (è¦è§¸ç™¼çš„å·¥ä½œæµç¨‹)
  workflows:
    refactor_playbooks:
      workflow_file: ".github/workflows/update-refactor-playbooks.yml"
      trigger_on_paths:
        - "governance/**"
        - "apps/web/public/data/**"
        - "tools/generate-refactor-playbook.py"

  # Notification settings (é€šçŸ¥è¨­ç½®)
  notifications:
    enabled: true
    channels:
      - type: "github_step_summary"
        enabled: true
      - type: "commit_message"
        enabled: true
      - type: "slack"
        enabled: false
        webhook_url: "${SLACK_WEBHOOK_URL}"

# ============================================================================
# Monitoring & Metrics (ç›£æ§èˆ‡æŒ‡æ¨™)
# ============================================================================
monitoring:
  # Performance metrics (æ€§èƒ½æŒ‡æ¨™)
  metrics:
    enabled: true
    collect:
      - "sync_duration"
      - "sync_file_count"
      - "sync_directory_count"
      - "playbook_generation_duration"
      - "playbook_count"
      - "validation_errors"
      - "cache_hit_rate"

  # Health checks (å¥åº·æª¢æŸ¥)
  health_checks:
    sync_workflow:
      max_duration_minutes: 10
      alert_on_failure: true
    refactor_workflow:
      max_duration_minutes: 15
      alert_on_failure: true

  # Alerting (è­¦å ±)
  alerts:
    enabled: true
    conditions:
      - type: "sync_failure"
        threshold: 3
        window_minutes: 60
      - type: "refactor_failure"
        threshold: 2
        window_minutes: 120
      - type: "validation_errors"
        threshold: 10
        window_minutes: 30

# ============================================================================
# Feature Flags (åŠŸèƒ½æ¨™èªŒ)
# ============================================================================
features:
  # Sync features
  auto_sync_enabled: true
  watch_script_enabled: true
  post_commit_hook_enabled: false  # Disabled to avoid conflicts with watch script
  
  # Refactor features
  ai_powered_suggestions: false  # Requires OpenAI API key
  incremental_generation: true
  cache_enabled: true
  
  # Integration features
  cross_workflow_triggers: true
  unified_validation: true

# ============================================================================
# Troubleshooting (æ•…éšœæ’é™¤)
# ============================================================================
troubleshooting:
  debug_mode: false
  log_level: "info"  # debug, info, warn, error
  log_directory: ".git/logs"
  preserve_temp_files: false

# ============================================================================
# References (åƒè€ƒ)
# ============================================================================
references:
  documentation:
    - "docs/refactor_playbooks/README.md"
    - "DOCUMENTATION_INDEX.md"
  workflows:
    - ".github/workflows/08-sync-subdirs.yml"
    - ".github/workflows/update-refactor-playbooks.yml"
  scripts:
    - "scripts/sync/watch-and-sync.sh"
    - "tools/generate-refactor-playbook.py"
    - "tools/validate-refactor-index.py"
