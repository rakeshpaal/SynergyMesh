networks:
  life-system-network:
    driver: bridge
    ipam:
      config:
      - subnet: 172.30.0.0/16
services:
  brain-engine:
    command: tail -f /dev/null
    depends_on:
    - postgres
    - redis
    - fixops-slageist
    environment:
    - NODE_ENV=development
    - BRAIN_PORT=3015
    - POSTGRES_HOST=postgres
    - REDIS_HOST=redis
    - CONSCIOUSNESS_URL=http://fixops-slageist:3010
    image: node:18-alpine
    networks:
    - life-system-network
    ports:
    - 3015:3015
    - 3016:3016
    - 3017:3017
    volumes:
    - ..:/workspace:cached
    working_dir: /workspace/01-core/brain/brain-L1
  devcontainer:
    build:
      context: ..
      dockerfile: config/dev/Dockerfile
    command: sleep infinity
    depends_on:
    - postgres
    - redis
    - prometheus
    environment:
    - NODE_ENV=development
    - LOG_LEVEL=debug
    - POSTGRES_HOST=postgres
    - REDIS_HOST=redis
    - BRAIN_PORT=3015
    - HEART_PORT=3018
    - HEARTBEAT_PORT=3020
    - FIXOPS_SLAGEIST_PORT=3010
    networks:
    - life-system-network
    volumes:
    - ..:/workspace:cached
    - /var/run/docker.sock:/var/run/docker-host.sock
  fixops-slageist:
    command: tail -f /dev/null
    depends_on:
    - redis
    environment:
    - NODE_ENV=development
    - REDIS_URL=redis://redis:6379
    - PORT=3010
    image: node:18-alpine
    networks:
    - life-system-network
    ports:
    - 3010:3010
    volumes:
    - ..:/workspace:cached
    working_dir: /workspace/01-core/lifecycle/fixops-slageist/fixops-slageist-L1
  grafana:
    depends_on:
    - prometheus
    environment:
    - GF_SECURITY_ADMIN_PASSWORD=consciousness_2024
    image: grafana/grafana:latest
    networks:
    - life-system-network
    ports:
    - 3000:3000
    restart: unless-stopped
    volumes:
    - grafana_data:/var/lib/grafana
    - ./grafana/dashboards:/var/lib/grafana/dashboards
    - ./grafana/provisioning:/etc/grafana/provisioning
  heart-engine:
    command: tail -f /dev/null
    depends_on:
    - postgres
    - redis
    - brain-engine
    environment:
    - NODE_ENV=development
    - HEART_PORT=3018
    - POSTGRES_HOST=postgres
    - REDIS_HOST=redis
    - BRAIN_URL=http://brain-engine:3015
    image: node:18-alpine
    networks:
    - life-system-network
    ports:
    - 3018:3018
    - 3019:3019
    volumes:
    - ..:/workspace:cached
    - /var/run/docker.sock:/var/run/docker.sock
    working_dir: /workspace/01-core/heart/heart-L1
  heartbeat-engine:
    command: tail -f /dev/null
    depends_on:
    - prometheus
    - brain-engine
    - heart-engine
    - fixops-slageist
    environment:
    - NODE_ENV=development
    - HEARTBEAT_PORT=3020
    - PROMETHEUS_URL=http://prometheus:9090
    - BRAIN_URL=http://brain-engine:3015
    - HEART_URL=http://heart-engine:3018
    - CONSCIOUSNESS_URL=http://fixops-slageist:3010
    image: node:18-alpine
    networks:
    - life-system-network
    ports:
    - 3020:3020
    - 3021:3021
    - 9091:9091
    volumes:
    - ..:/workspace:cached
    working_dir: /workspace/01-core/heartbeat/heartbeat-L1
  postgres:
    environment:
      POSTGRES_DB: life_system
      POSTGRES_PASSWORD: consciousness_2024
      POSTGRES_USER: life_admin
    healthcheck:
      interval: 10s
      retries: 5
      test:
      - CMD-SHELL
      - pg_isready -U life_admin -d life_system
      timeout: 5s
    image: postgres:15-alpine
    networks:
    - life-system-network
    ports:
    - 5432:5432
    restart: unless-stopped
    volumes:
    - postgres_data:/var/lib/postgresql/data
    - ./init-db:/docker-entrypoint-initdb.d
  prometheus:
    command:
    - --config.file=/etc/prometheus/prometheus.yml
    - --storage.tsdb.path=/prometheus
    - --web.console.libraries=/etc/prometheus/console_libraries
    - --web.console.templates=/etc/prometheus/consoles
    - --storage.tsdb.retention.time=200h
    - --web.enable-lifecycle
    image: prom/prometheus:latest
    networks:
    - life-system-network
    ports:
    - 9090:9090
    restart: unless-stopped
    volumes:
    - ./prometheus.yml:/etc/prometheus/prometheus.yml
    - prometheus_data:/prometheus
  redis:
    healthcheck:
      interval: 10s
      retries: 5
      test:
      - CMD
      - redis-cli
      - ping
      timeout: 3s
    image: redis:7-alpine
    networks:
    - life-system-network
    ports:
    - 6379:6379
    restart: unless-stopped
    volumes:
    - redis_data:/data
version: '3.8'
volumes:
  grafana_data:
    driver: local
  postgres_data:
    driver: local
  prometheus_data:
    driver: local
  redis_data:
    driver: local
