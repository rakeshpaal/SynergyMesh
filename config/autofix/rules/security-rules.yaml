category: security
fix_config:
  auto_apply: false
  create_backup: true
  generate_report: true
  require_review: true
  review_requirements:
    min_approvers: 2
    required_roles:
    - security-reviewer
    - tech-lead
  rollback_conditions:
  - test_failure: true
  - security_scan_failure: true
  - performance_degradation: true
  run_tests: true
priority: critical
rules:
- description: 檢測並移除硬編碼的密鑰和敏感信息
  enabled: true
  fix_strategy:
    action: '# 替換硬編碼值為環境變量

      original: {variable_name} = "{hardcoded_value}"

      replacement: {variable_name} = os.getenv("{VARIABLE_NAME}")

      '
    template: security-env-var
    type: environment_variable
  id: SEC-001
  name: hardcoded-secrets
  patterns:
  - message: 檢測到硬編碼密碼
    regex: password\s*=\s*["'][\w\W]+["']
  - message: 檢測到硬編碼 API 密鑰
    regex: api_key\s*=\s*["'][\w\W]+["']
  - message: 檢測到硬編碼密鑰
    regex: secret\s*=\s*["'][\w\W]+["']
  - message: 檢測到硬編碼令牌
    regex: token\s*=\s*["'][\w\W]+["']
  severity: CRITICAL
  verification:
  - run_tests: true
  - security_scan: true
  - manual_review: true
- description: 修復 SQL 注入漏洞
  enabled: true
  fix_strategy:
    action: '# 使用參數化查詢

      original: execute("SELECT * FROM users WHERE id = " + user_id)

      replacement: execute("SELECT * FROM users WHERE id = ?", (user_id,))

      '
    template: security-parameterized-query
    type: parameterized_query
  id: SEC-002
  name: sql-injection
  patterns:
  - message: 檢測到 SQL 字符串拼接
    regex: execute\(["'].*\+.*["']
  - message: 檢測到不安全的查詢構建
    regex: query\s*=\s*["'].*\+.*["']
  severity: CRITICAL
  verification:
  - run_tests: true
  - security_scan: true
  - penetration_test: true
- description: 修復跨站腳本漏洞
  enabled: true
  fix_strategy:
    action: '# 使用安全的 HTML 注入方法

      original: element.innerHTML = userInput

      replacement: element.textContent = DOMPurify.sanitize(userInput)

      '
    template: security-xss-sanitize
    type: sanitization
  id: SEC-003
  name: xss-vulnerability
  patterns:
  - message: 檢測到不安全的 innerHTML 使用
    regex: innerHTML\s*=\s*[^(]
  - message: 檢測到不安全的 document.write
    regex: document\.write\(
  severity: HIGH
  verification:
  - run_tests: true
  - security_scan: true
- description: 更新存在已知漏洞的依賴項
  enabled: true
  fix_strategy:
    action: '# 更新到安全版本

      - 檢查可用的安全版本

      - 更新 package.json / requirements.txt

      - 運行測試確保兼容性

      '
    template: security-dependency-update
    type: dependency_update
  id: SEC-004
  name: insecure-dependencies
  patterns:
  - sources:
    - snyk
    - npm audit
    - pip audit
    type: dependency_check
  severity: HIGH
  verification:
  - run_tests: true
  - security_scan: true
  - compatibility_check: true
- description: 添加 CSRF 防護
  enabled: true
  fix_strategy:
    action: '# 添加 CSRF 令牌驗證

      - 在表單中添加 CSRF 令牌

      - 在服務器端驗證令牌

      '
    template: security-csrf-token
    type: add_csrf_protection
  id: SEC-005
  name: csrf-vulnerability
  patterns:
  - check: form_without_csrf
    type: missing_csrf_token
  severity: HIGH
  verification:
  - run_tests: true
  - security_scan: true
- description: 防止路徑遍歷攻擊
  enabled: true
  fix_strategy:
    action: '# 使用安全的路徑處理

      original: open(base_path + user_input)

      replacement: open(os.path.join(base_path, os.path.basename(user_input)))

      '
    template: security-path-sanitize
    type: path_sanitization
  id: SEC-006
  name: path-traversal
  patterns:
  - message: 檢測到不安全的文件路徑拼接
    regex: open\([^)]*\+.*[^)]*\)
  severity: HIGH
  verification:
  - run_tests: true
  - security_scan: true
version: 1.0.0
