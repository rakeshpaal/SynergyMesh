driftDetection:
  auto_remediation:
    allowed_fixes:
    - label-drift
    approval_required:
    - resource-config-drift
    - policy-file-drift
    - security-context-drift
    dry_run: false
    enabled: true
    max_auto_fixes_per_hour: 10
  enabled: true
  notifications:
    channels:
    - channels:
      - name: '#platform-alerts'
        severity_filter:
        - critical
        - high
      - name: '#drift-monitoring'
        severity_filter:
        - medium
        - low
      type: slack
      webhook_url_secret: slack-webhook
    - recipients:
      - platform-team@example.com
      severity_filter:
      - critical
      type: email
    - integration_key_secret: pagerduty-key
      severity_filter:
      - critical
      type: pagerduty
    enabled: true
  reporting:
    enabled: true
    format: json
    retention_days: 90
    storage:
      path: drift-reports/
      type: artifact
    summary:
      enabled: true
      interval: daily
      recipients:
      - platform-team@example.com
  rules:
  - checks:
    - action: alert
      field: spec.replicas
      severity: low
    - action: block
      field: spec.template.spec.containers[*].image
      severity: critical
    - action: alert
      field: spec.template.spec.containers[*].resources
      severity: medium
    description: 檢測實際部署與 Git 配置的差異
    enabled: true
    id: resource-config-drift
    name: 資源配置差異
    remediation:
      action: create_pr
      auto_fix: false
      notification: true
    severity: medium
    targets:
    - kind: Deployment
    - kind: Service
    - kind: ConfigMap
    type: configuration
  - checks:
    - action: block
      breaking_changes:
      - removed_field
      - changed_type
      - removed_endpoint
      check_type: schema_compatibility
      severity: critical
    - action: alert
      check_type: response_shape
      severity: medium
      validation: strict
    - action: warn
      check_type: error_codes
      severity: low
      validation: permissive
    description: 檢測 API schema 與回應格式的語意變更
    enabled: true
    id: api-contract-drift
    name: API 契約語意變更
    remediation:
      action: notify_owner
      auto_fix: false
      require_approval: true
    severity: high
    type: contract
  - checks:
    - action: block
      check_type: sha256_digest
      severity: critical
      validation: strict
    - action: alert
      check_type: sbom_diff
      severity: medium
      validation: compare
    - action: alert
      check_type: vulnerabilities
      scan_on_drift: true
      severity: high
    description: 檢測映像運行時行為的改變
    enabled: true
    id: image-behavior-drift
    name: 映像行為變更
    remediation:
      action: security_review
      auto_fix: false
      notification: true
    severity: high
    type: image
  - checks:
    - action: block
      check_type: syntax_validation
      severity: critical
    - action: alert
      check_type: policy_impact
      severity: high
      simulation_required: true
    - action: warn
      check_type: policy_coverage
      severity: medium
      validation: increase_only
    description: 檢測 OPA/Gatekeeper 策略的改變
    enabled: true
    id: policy-file-drift
    name: 策略檔案變更
    remediation:
      action: policy_review
      auto_fix: false
      require_approval: true
    severity: critical
    type: policy
  - checks:
    - action: alert
      check_type: required_labels
      severity: medium
    - action: warn
      check_type: label_format
      severity: low
    description: 檢測必要標籤的缺失或變更
    enabled: true
    id: label-drift
    name: 資源標籤差異
    remediation:
      action: apply_labels
      auto_fix: true
      notification: false
    required_labels:
    - namespace.io/managed-by
    - namespace.io/domain
    - namespace.io/environment
    - app
    - version
    severity: medium
    type: labels
  - checks:
    - action: block
      expected: true
      field: runAsNonRoot
      severity: critical
    - action: alert
      expected: true
      field: readOnlyRootFilesystem
      severity: high
    - action: block
      expected: false
      field: allowPrivilegeEscalation
      severity: critical
    description: 檢測 securityContext 的弱化
    enabled: true
    id: security-context-drift
    name: 安全上下文變更
    remediation:
      action: security_review
      auto_fix: false
      notification: true
    severity: critical
    type: security
  scan_interval: 15m
  scan_targets:
  - kubernetes_manifests
  - api_contracts
  - image_signatures
  - policy_files
