alerting:
  alertmanagers:
  - static_configs:
    - targets:
      - alertmanager:9093
global:
  evaluation_interval: 15s
  external_labels:
    cluster: machinenativeops-production
    environment: production
  scrape_interval: 15s
rule_files:
- alerts/*.yml
scrape_configs:
- job_name: contracts-l1
  metrics_path: /metrics
  relabel_configs:
  - source_labels:
    - __address__
    target_label: instance
  - replacement: tier1
    target_label: tier
  - replacement: contracts-l1
    target_label: service
  scrape_interval: 10s
  static_configs:
  - targets:
    - contracts-l1:3000
- job_name: contracts-l1-health
  metric_relabel_configs:
  - regex: up
    replacement: contracts-l1
    source_labels:
    - __name__
    target_label: health_check
  metrics_path: /healthz
  scrape_interval: 5s
  static_configs:
  - targets:
    - contracts-l1:3000
- job_name: mcp-servers
  metrics_path: /metrics
  relabel_configs:
  - source_labels:
    - __address__
    target_label: instance
  - replacement: tier2
    target_label: tier
  - replacement: mcp-servers
    target_label: service
  scrape_interval: 10s
  static_configs:
  - targets:
    - mcp-servers:3001
- job_name: mcp-tools
  metrics_path: /tools/metrics
  relabel_configs:
  - replacement: mcp-tools
    target_label: component
  scrape_interval: 15s
  static_configs:
  - targets:
    - mcp-servers:3001
- job_name: dashboard
  metrics_path: /metrics
  relabel_configs:
  - replacement: tier4
    target_label: tier
  - replacement: dashboard
    target_label: service
  scrape_interval: 30s
  static_configs:
  - targets:
    - dashboard:80
- job_name: node-exporter
  relabel_configs:
  - source_labels:
    - __address__
    target_label: node
  - replacement: system
    target_label: component
  static_configs:
  - targets:
    - node-exporter:9100
- job_name: cadvisor
  relabel_configs:
  - source_labels:
    - __address__
    target_label: instance
  - replacement: container
    target_label: component
  static_configs:
  - targets:
    - cadvisor:8080
- job_name: docker
  relabel_configs:
  - replacement: docker
    target_label: component
  static_configs:
  - targets:
    - docker-exporter:9323
- job_name: postgres
  relabel_configs:
  - replacement: database
    target_label: component
  - replacement: postgresql
    target_label: db_type
  static_configs:
  - targets:
    - postgres-exporter:9187
- job_name: redis
  relabel_configs:
  - replacement: cache
    target_label: component
  - replacement: redis
    target_label: cache_type
  static_configs:
  - targets:
    - redis-exporter:9121
- job_name: blackbox
  metrics_path: /probe
  params:
    module:
    - http_2xx
  relabel_configs:
  - source_labels:
    - __address__
    target_label: __param_target
  - source_labels:
    - __param_target
    target_label: instance
  - replacement: blackbox-exporter:9115
    target_label: __address__
  static_configs:
  - targets:
    - http://contracts-l1:3000/healthz
    - http://mcp-servers:3001/health
    - http://dashboard:80/health
- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
  job_name: kubernetes-apiservers
  kubernetes_sd_configs:
  - role: endpoints
  relabel_configs:
  - action: keep
    regex: default;kubernetes;https
    source_labels:
    - __meta_kubernetes_namespace
    - __meta_kubernetes_service_name
    - __meta_kubernetes_endpoint_port_name
  scheme: https
  tls_config:
    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
- bearer_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
  job_name: kubernetes-nodes
  kubernetes_sd_configs:
  - role: node
  relabel_configs:
  - action: labelmap
    regex: __meta_kubernetes_node_label_(.+)
  scheme: https
  tls_config:
    ca_file: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt
- job_name: kubernetes-pods
  kubernetes_sd_configs:
  - role: pod
  relabel_configs:
  - action: keep
    regex: true
    source_labels:
    - __meta_kubernetes_pod_annotation_prometheus_io_scrape
  - action: replace
    regex: (.+)
    source_labels:
    - __meta_kubernetes_pod_annotation_prometheus_io_path
    target_label: __metrics_path__
  - action: replace
    regex: ([^:]+)(?::\d+)?;(\d+)
    replacement: $1:$2
    source_labels:
    - __address__
    - __meta_kubernetes_pod_annotation_prometheus_io_port
    target_label: __address__
  - action: labelmap
    regex: __meta_kubernetes_pod_label_(.+)
  - action: replace
    source_labels:
    - __meta_kubernetes_namespace
    target_label: kubernetes_namespace
  - action: replace
    source_labels:
    - __meta_kubernetes_pod_name
    target_label: kubernetes_pod_name
