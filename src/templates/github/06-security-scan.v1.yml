name: 06-security-scan
true:
  schedule:
  - cron: 0 3 * * *
  workflow_dispatch: null
jobs:
  sast-and-audit:
    permissions:
      contents: read
      security-events: write
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - if: ${{ hashFiles('package-lock.json') != '' || hashFiles('pnpm-lock.yaml')
        != '' }}
      name: Node audit
      run: 'npm install

        npm audit --audit-level=high || true

        '
    - name: Run Trivy filesystem scan
      uses: aquasecurity/trivy-action@master
      with:
        format: sarif
        ignore-unfixed: true
        output: trivy.sarif
        scan-type: fs
    - name: Upload Trivy results
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: trivy.sarif
    - name: OSV scanner
      uses: google/osv-scanner-action@v1
      with:
        scan-args: --lockfile=pnpm-lock.yaml --lockfile=poetry.lock
