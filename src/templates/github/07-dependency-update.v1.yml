name: 07-dependency-update
true:
  schedule:
  - cron: 0 6 * * 1
  workflow_dispatch: null
jobs:
  update-dependencies:
    permissions:
      contents: write
      pull-requests: write
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.DEPENDENCY_BOT_TOKEN || secrets.GITHUB_TOKEN }}
    - name: Setup Node
      uses: actions/setup-node@v4
      with:
        node-version: 18
    - name: Update npm workspaces
      run: 'npm install

        npm update --workspaces --if-present

        '
    - if: ${{ hashFiles('services/**/*.go') != '' }}
      name: Go tidy
      uses: actions/setup-go@v5
      with:
        go-version: 1.21
    - if: ${{ hashFiles('services/**/*.go') != '' }}
      name: Run go mod tidy
      run: 'find services -name "go.mod" -print0 | xargs -0 -I{} sh -c ''cd "$(dirname
        {})" && go mod tidy''

        '
    - if: ${{ hashFiles('core/**') != '' }}
      name: Cargo update
      uses: dtolnay/rust-toolchain@stable
    - if: ${{ hashFiles('core/**') != '' }}
      name: Refresh Cargo.lock
      run: cargo update
    - if: ${{ hashFiles('pom.xml') != '' }}
      name: Maven versions plugin
      run: mvn versions:use-latest-releases -Dincludes=io.island:*
    - name: Create dependency PR
      uses: peter-evans/create-pull-request@v6
      with:
        body: '## Summary

          - Updated workspace dependencies across supported languages.

          - Please review language-specific changelogs before merging.

          '
        branch: chore/auto-dependency-updates
        commit-message: 'chore: automated dependency updates'
        reviewers: ${{ vars.DEFAULT_REVIEWERS || '' }}
        title: 'chore: automated dependency updates'
