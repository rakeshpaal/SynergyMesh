name: 02-test
true:
  pull_request:
    branches:
    - main
  push:
    branches:
    - main
jobs:
  go-tests:
    if: ${{ hashFiles('services/**') != '' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-go@v5
      with:
        go-version: 1.21
    - run: go test ./...
      working-directory: services
  java-tests:
    if: ${{ hashFiles('integrations/**/*.java') != '' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Set up JDK
      uses: actions/setup-java@v4
      with:
        cache: maven
        distribution: temurin
        java-version: '21'
    - run: mvn test
  python-tests:
    if: ${{ hashFiles('**/*.py') != '' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    - name: Install pytest
      run: pip install -r requirements.txt || pip install pytest
    - name: Run pytest
      run: pytest || true
  rust-tests:
    if: ${{ hashFiles('core/**') != '' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: dtolnay/rust-toolchain@stable
    - run: cargo test --workspace --all-features
  typescript-tests:
    if: ${{ hashFiles('package.json') != '' }}
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-node@v4
      with:
        cache: npm
        node-version: 18
    - run: npm install
    - run: npm run test --workspaces --if-present
