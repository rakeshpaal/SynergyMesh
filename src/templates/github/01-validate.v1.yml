name: 01-validate
true:
  pull_request:
    branches:
    - main
  push:
    branches:
    - main
jobs:
  lint-and-validate:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        cache: npm
        node-version: 18
    - name: Install dependencies
      run: npm install
    - name: Run workspace lint
      run: npm run lint --workspaces --if-present
    - name: Run docs lint
      run: npm run docs:lint
    - if: ${{ hashFiles('core/**') != '' }}
      name: Setup Rust toolchain
      uses: dtolnay/rust-toolchain@stable
      with:
        components: rustfmt,clippy
    - if: ${{ hashFiles('core/**') != '' }}
      name: Rust formatting check
      run: 'cargo fmt --all -- --check

        cargo clippy --workspace --all-targets -- -D warnings

        '
    - if: ${{ hashFiles('services/**') != '' }}
      name: Setup Go
      uses: actions/setup-go@v5
      with:
        go-version: 1.21
    - if: ${{ hashFiles('services/**') != '' }}
      name: Go formatting check
      run: test -z "$(gofmt -l ./services)"
    - name: Validate manifest
      run: 'python3 tools/bootstrap_from_manifest.py island.bootstrap.stage0.yaml
        --steps scaffold.directories materialize.templates

        '
      shell: bash
