groups:
- interval: 30s
  name: naming-compliance-alerts
  rules:
  - alert: NamingPolicyViolation
    annotations:
      description: '在环境 {{ $labels.env }}, 应用 {{ $labels.app }} 检测到命名规范违反，

        请于 5 分钟内检查并修正。


        违规资源类型: {{ $labels.resource_type }}

        违规数量: {{ $value }}


        查看详情: http://grafana.example.com/d/naming-compliance

        '
      runbook_url: https://wiki.example.com/runbooks/naming-violation
      summary: 命名规范违反 (critical)
    expr: count(naming_compliance_violation_total{severity="critical"}) by (app, env)
      > 0
    for: 5m
    labels:
      category: governance
      component: naming
      severity: critical
  - alert: NamingComplianceRateLow
    annotations:
      description: '当前命名合规率为 {{ $value | humanizePercentage }}，

        低于 95% 的目标阈值。


        请检查并修复不合规资源。


        查看仪表板: http://grafana.example.com/d/naming-compliance

        '
      runbook_url: https://wiki.example.com/runbooks/low-compliance-rate
      summary: 命名合规率低于阈值
    expr: "(\n  sum(naming_compliance_good) /\n  (sum(naming_compliance_good) + sum(naming_compliance_bad))\n\
      ) * 100 < 95\n"
    for: 15m
    labels:
      category: governance
      component: naming
      severity: warning
  - alert: NamingComplianceRateCritical
    annotations:
      description: '当前命名合规率为 {{ $value | humanizePercentage }}，

        低于 85% 的严重阈值，需要立即处理！


        这可能表明存在系统性问题。

        '
      runbook_url: https://wiki.example.com/runbooks/critical-compliance-rate
      summary: 命名合规率严重低于阈值
    expr: "(\n  sum(naming_compliance_good) /\n  (sum(naming_compliance_good) + sum(naming_compliance_bad))\n\
      ) * 100 < 85\n"
    for: 5m
    labels:
      category: governance
      component: naming
      severity: critical
  - alert: ProductionNamingViolation
    annotations:
      description: '检测到 {{ $value }} 个生产环境命名违规资源。


        资源类型: {{ $labels.resource_type }}

        命名空间: {{ $labels.namespace }}


        生产环境不允许命名违规，请立即修复！

        '
      summary: 生产环境命名违规
    expr: 'naming_compliance_bad{environment="production"} > 0

      '
    for: 1m
    labels:
      category: governance
      component: naming
      environment: production
      severity: critical
  - alert: HighNamingViolationRate
    annotations:
      description: '过去 1 小时内检测到 {{ $value }} 个高严重性命名违规，

        超过正常水平。


        可能存在：

        - 批量配置错误

        - 自动化脚本问题

        - 新部署未遵循规范


        请检查最近的变更。

        '
      summary: 命名违规率异常升高
    expr: 'rate(naming_violation_total{severity=~"critical|high"}[1h]) > 10

      '
    for: 10m
    labels:
      category: governance
      component: naming
      severity: warning
  - alert: RemediationFailureRateHigh
    annotations:
      description: '自动修复失败率为 {{ $value | humanizePercentage }}，

        超过 20% 阈值。


        失败类型: {{ $labels.error_type }}


        需要检查自动化修复流程和脚本。

        '
      summary: 自动修复失败率过高
    expr: "(\n  rate(naming_remediation_failure[1h]) /\n  (rate(naming_remediation_success[1h])\
      \ + rate(naming_remediation_failure[1h]))\n) > 0.2\n"
    for: 30m
    labels:
      category: governance
      component: remediation
      severity: warning
  - alert: NewNamingViolationDetected
    annotations:
      description: '检测到 {{ $value }} 个新的命名违规。


        违规类型: {{ $labels.violation_type }}

        资源类型: {{ $labels.resource_type }}

        '
      summary: 检测到新的命名违规
    expr: 'increase(naming_violation_total[5m]) > 0

      '
    for: 1m
    labels:
      category: governance
      component: naming
      severity: info
  - alert: NamingViolationByEnvironment
    annotations:
      description: '环境 {{ $labels.environment }} 有 {{ $value }} 个命名违规资源。


        建议进行集中清理。

        '
      summary: '{{ $labels.environment }} 环境命名违规过多'
    expr: 'sum(naming_compliance_bad) by (environment) > 5

      '
    for: 10m
    labels:
      category: governance
      component: naming
      severity: warning
  - alert: NamingViolationByTeam
    annotations:
      description: '团队 {{ $labels.team }} 有 {{ $value }} 个命名违规资源。


        建议：

        1. 进行团队培训

        2. 审查团队的资源创建流程

        3. 启用自动化验证

        '
      summary: 团队 {{ $labels.team }} 命名违规过多
    expr: 'sum(naming_compliance_bad) by (team) > 10

      '
    for: 30m
    labels:
      category: governance
      component: naming
      severity: warning
  - alert: MigrationFailureRateHigh
    annotations:
      description: '迁移失败率为 {{ $value | humanizePercentage }}，超过 10% 阈值。


        可能原因：

        - 迁移脚本问题

        - 依赖关系错误

        - 资源冲突


        建议暂停迁移并进行调查。

        '
      summary: 命名迁移失败率过高
    expr: "(\n  rate(naming_migration_failure[1h]) /\n  (rate(naming_migration_success[1h])\
      \ + rate(naming_migration_failure[1h]))\n) > 0.1\n"
    for: 15m
    labels:
      category: governance
      component: migration
      severity: warning
  - alert: ValidationFailureCountHigh
    annotations:
      description: '过去 1 小时内有 {{ $value }} 次验证失败。


        可能原因：

        - PR 质量下降

        - 规则变更未充分沟通

        - 自动化工具问题


        建议检查最近的验证失败并分析根因。

        '
      summary: 命名验证失败数量过多
    expr: 'increase(naming_validation_failure_total[1h]) > 50

      '
    for: 10m
    labels:
      category: governance
      component: validation
      severity: warning
  - alert: NamingComplianceRateDeclining
    annotations:
      description: '预测 24 小时后命名合规率将低于 90%。


        当前趋势显示合规率持续下降，

        建议主动介入改善。

        '
      summary: 命名合规率呈下降趋势
    expr: "predict_linear(\n  sum(naming_compliance_good) /\n  (sum(naming_compliance_good)\
      \ + sum(naming_compliance_bad))[1h:],\n  24 * 3600\n) < 0.9\n"
    for: 30m
    labels:
      category: governance
      component: naming
      severity: warning
- interval: 1m
  name: naming-sla-alerts
  rules:
  - alert: NamingComplianceSLAViolation
    annotations:
      description: '命名合规率为 {{ $value | humanizePercentage }}，

        低于 99.9% 的 SLA 目标，持续超过 1 小时。


        这是 SLA 违反，需要升级处理。

        '
      summary: 命名合规率 SLA 违反
    expr: "(\n  sum(naming_compliance_good) /\n  (sum(naming_compliance_good) + sum(naming_compliance_bad))\n\
      ) * 100 < 99.9\n"
    for: 1h
    labels:
      category: sla
      component: naming
      severity: critical
  - alert: AutoRemediationSLAViolation
    annotations:
      description: '自动修复成功率为 {{ $value | humanizePercentage }}，

        低于 95% 的 SLA 目标。


        需要检查和改进自动修复流程。

        '
      summary: 自动修复成功率 SLA 违反
    expr: "(\n  sum(rate(naming_remediation_success[1h])) /\n  (sum(rate(naming_remediation_success[1h]))\
      \ + sum(rate(naming_remediation_failure[1h])))\n) * 100 < 95\n"
    for: 2h
    labels:
      category: sla
      component: remediation
      severity: warning
