description: 事件驅動規則 - Event-Driven Rules for DAR Automation
event_handlers:
- description: New artifact added to governance index
  event: artifact.created
  triggers:
  - delay: immediate
    parameters:
      scope: new_artifact
    priority: high
    task: diagnose
  - delay: immediate
    priority: critical
    task: update_governance_index
  - delay: 5m
    parameters:
      dimensions:
      - content
      - structure
      - governance
    priority: medium
    task: update_vectors
- description: Existing artifact modified
  event: artifact.updated
  triggers:
  - delay: 2m
    parameters:
      compare_with_previous: true
      scope: updated_artifact
    priority: high
    task: diagnose
  - delay: 5m
    priority: medium
    task: check_alignment
  - condition: dependencies_changed == true
    delay: 10m
    priority: medium
    task: update_dag
- description: Artifact removed from system
  event: artifact.deleted
  triggers:
  - delay: immediate
    description: Check for artifacts that now depend on deleted artifact
    priority: high
    task: check_orphans
  - delay: immediate
    priority: critical
    task: update_governance_index
  - delay: immediate
    priority: critical
    task: log_to_trust_chain
- description: Policy violation detected
  event: policy.violated
  triggers:
  - delay: immediate
    parameters:
      method: github_issue
      severity_threshold: high
    priority: critical
    task: notify_owner
  - condition: auto_fix_enabled == true && severity <= 'high'
    delay: 5m
    parameters:
      auto_create_pr: true
    priority: high
    task: repair
  - delay: immediate
    priority: critical
    task: log_to_trust_chain
- description: Policy definition changed
  event: policy.updated
  triggers:
  - delay: 30m
    parameters:
      policy: '{{ event.policy_id }}'
      scope: all_artifacts
    priority: medium
    task: align
  - delay: immediate
    priority: high
    task: notify_stakeholders
- description: Circular dependency found in governance DAG
  event: dag.cycle_detected
  triggers:
  - delay: immediate
    parameters:
      label: circular-dependency
      method: github_issue
    priority: critical
    task: notify_owner
  - delay: 5m
    priority: high
    task: generate_resolution_plan
- description: Orphaned artifact found
  event: dag.orphan_detected
  triggers:
  - delay: 10m
    parameters:
      focus: orphan_analysis
    priority: medium
    task: diagnose
  - condition: auto_fix_orphans == true
    delay: 30m
    priority: low
    task: repair
- description: Daily governance audit
  event: scheduled.daily_audit
  schedule: 0 2 * * *
  triggers:
  - parameters:
      depth: comprehensive
      scope: all
    priority: medium
    task: diagnose
  - parameters:
      recipients:
      - governance-team
    priority: medium
    task: generate_health_report
- description: Weekly policy alignment check
  event: scheduled.weekly_alignment
  schedule: 0 3 * * 0
  triggers:
  - parameters:
      scope: all_artifacts
    priority: medium
    task: align
  - priority: medium
    task: generate_compliance_report
- description: Pull request created
  event: ci.pr_created
  triggers:
  - delay: immediate
    parameters:
      scope: pr_changes
    priority: high
    task: diagnose
  - delay: immediate
    parameters:
      checks:
      - no_breaking_changes
      - all_policies_compliant
    priority: critical
    task: guardian_check
- description: Pull request merged
  event: ci.pr_merged
  triggers:
  - delay: immediate
    priority: critical
    task: update_governance_index
  - delay: immediate
    priority: critical
    task: log_to_trust_chain
- description: Manually triggered full system audit
  event: manual.full_audit
  triggers:
  - parameters:
      depth: deep
      scope: all
    priority: high
    task: diagnose
  - priority: high
    task: align
  - condition: major_issues_found == true
    priority: medium
    task: refactor
logging:
  destination: ../traces/audit-logs/
  format: json
  include_context: true
  level: info
  retention_days: 90
routing:
  default_queue: dar-tasks
  priority_queues:
    critical: dar-critical
    high: dar-high
    low: dar-low
    medium: dar-medium
  retry_policy:
    backoff: exponential
    initial_delay: 5s
    max_retries: 3
version: 1.0.0
