apiVersion: machinenativeops.io/v2
kind: MetadataCollectionConfig
metadata:
  name: metadata-collection-config
  version: 1.0.0
spec:
  collection:
    batch_size: 1000
    enabled: true
    schedule: 0 */6 * * *
    sources:
    - enabled: true
      labels:
      - app
      - component
      - version
      namespaces:
      - default
      - production
      - staging
      resources:
      - pods
      - services
      - configmaps
      - deployments
      - statefulsets
      type: kubernetes
    - connection: postgresql://localhost:5432
      databases:
      - name: production_db
        schemas:
        - public
        - audit
        - analytics
        tables:
          exclude:
          - temp_*
          - staging_*
          include:
          - customers
          - orders
          - products
      enabled: true
      type: database
    - enabled: true
      paths:
      - exclude:
        - node_modules
        - .git
        - dist
        include:
        - '*.yaml'
        - '*.yml'
        - '*.json'
        path: /src
        recursive: true
      - path: /config
        recursive: true
      - include:
        - '*.md'
        path: /docs
        recursive: true
      type: filesystem
  export:
    destinations:
    - path: /var/metadata/exports
      type: filesystem
    - bucket: metadata-exports
      prefix: synergymesh/
      type: s3
    enabled: true
    formats:
    - yaml
    - json
  lineage:
    auto_discovery: true
    depth: 5
    enabled: true
    tracking:
    - frequency: daily
      source: data-ingestion
      target: data-warehouse
      transformation: etl-process
    - frequency: on-demand
      source: ml-training
      target: model-registry
      transformation: model-build
    - frequency: real-time
      source: api-gateway
      target: service-mesh
      transformation: request-routing
  living_knowledge:
    diagnosis:
      checks:
      - enabled: true
        name: orphan_components
        severity: warning
      - enabled: true
        name: dead_configs
        severity: warning
      - enabled: true
        name: overlapping_workflows
        severity: info
      - enabled: true
        name: broken_links
        severity: warning
      output:
        path: docs/knowledge-health-report.yaml
    enabled: true
    feedback:
      actions:
      - dashboard_path: docs/KNOWLEDGE_HEALTH.md
        enabled: true
        type: update_dashboard
      - enabled: true
        method: github_issue
        threshold: warning
        type: notify_maintainers
      - enabled: false
        type: auto_remediation
    modeling:
      outputs:
      - name: generated-mndoc.yaml
        path: docs/generated-mndoc.yaml
      - name: knowledge-graph.yaml
        path: docs/knowledge-graph.yaml
      - name: superroot-entities.yaml
        path: docs/superroot-entities.yaml
    perception:
      triggers:
      - enabled: true
        type: git_push
      - enabled: true
        filter:
        - success
        - failure
        type: workflow_completion
      - cron: 0 2 * * *
        enabled: true
        type: schedule
  provenance:
    enabled: true
    sources:
    - repositories:
      - branch: main
        track_branches: true
        track_commits: true
        track_tags: true
        url: https://github.com/MachineNativeOps/MachineNativeOps
      type: git
    - pipelines:
      - name: ci-cd-pipeline
        track_artifacts: true
        track_attestations: true
        track_runs: true
      type: build
    - events:
      - deployment
      - scaling
      - failure
      - recovery
      type: runtime
  quality:
    enabled: true
    rules:
    - action: warn
      description: Check metadata completeness
      name: completeness_check
      threshold: 0.8
    - action: warn
      description: Check metadata accuracy
      name: accuracy_check
      threshold: 0.9
    - action: fail
      description: Check metadata consistency
      name: consistency_check
      threshold: 0.95
