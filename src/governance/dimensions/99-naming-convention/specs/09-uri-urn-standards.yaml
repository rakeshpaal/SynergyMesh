apiVersion: machinenativeops.io/v2
kind: NamingSpec
metadata:
  id: uri-urn-standards
  name: URI/URN 規範
  name_en: URI/URN Standards
  parent: 99-naming-convention
  urn: urn:machinenativeops:governance:naming-spec:uri-urn:v1
  version: 1.0.0
spec:
  annotation_format:
    namespace: machinenativeops.io
    pattern: ^machinenativeops\.io/[a-z0-9-]+$
    standard_annotations:
    - description: 資源的標準 URN
      example: urn:machinenativeops:governance:naming-convention:v1
      key: machinenativeops.io/canonical-urn
    - allowed_values:
      - team-domain-env
      - tenant-workload-env-region
      - env-app-version
      description: 使用的命名模式
      key: machinenativeops.io/naming-mode
    - description: 資源描述
      key: machinenativeops.io/description
    - description: 資源擁有者
      key: machinenativeops.io/owner
    - description: 資源版本
      key: machinenativeops.io/version
  description: '此規範定義 MachineNativeOps 系統中所有資源的 URI 和 URN 標準。

    URN（統一資源名稱）用於唯一識別資源，URI（統一資源識別符）用於定位資源。

    '
  examples:
    uris:
      correct:
      - explanation: 標準 REST API 路徑
        value: /api/v1/dimensions/99-naming-convention
      - explanation: 版本化 API 端點
        value: /api/v2/governance/policies
      - explanation: WebSocket 通道
        value: /ws/metrics-stream
      incorrect:
      - correction: /api/v1/dimensions
        issue: 使用大寫
        value: /API/V1/Dimensions
      - correction: /api/v1/dimensions/naming
        issue: 缺少版本號
        value: /api/dimensions/naming
    urns:
      correct:
      - explanation: 標準治理資源 URN
        value: urn:machinenativeops:governance:naming-convention:v1
      - explanation: AI 引擎資源 URN
        value: urn:machinenativeops:ai:cognitive-engine:v2
      - explanation: 生產環境核心引擎 URN
        value: urn:machinenativeops:prod:core:execution-engine:v1
      - explanation: 帶校驗碼的 URN
        value: urn:machinenativeops:governance:naming-convention:v1:sha256-a1b2c3d4
      incorrect:
      - correction: urn:machinenativeops:governance:naming-convention:v1
        issue: 命名空間和域名使用了大寫
        value: urn:MachineNativeOps:Governance:NamingConvention
      - correction: urn:machinenativeops:governance:naming:v1
        issue: '缺少 urn: 前綴'
        value: machinenativeops:governance:naming
      - correction: 使用已註冊域名：governance, ai, core, autonomous, config, dimension
        issue: 使用未註冊的域名 'unknown'
        value: urn:machinenativeops:unknown:resource:v1
  uri_standards:
    api_patterns:
      graphql:
        description: GraphQL 端點（固定路徑）
        pattern: ^/graphql$
        template: /graphql
      rest_api:
        examples:
          correct:
          - /api/v1/dimensions
          - /api/v1/dimensions/99-naming-convention
          - /api/v2/governance/policies/naming-policy
          incorrect:
          - /API/V1/Dimensions
          - /api/dimensions
          - /api/v1/Dimensions/NamingConvention
        pattern: ^/api/v[0-9]+/[a-z0-9-]+(/[a-z0-9-]+)*$
        template: /api/v{version}/{resource}/{id?}
      websocket:
        examples:
        - /ws/events
        - /ws/metrics-stream
        pattern: ^/ws/[a-z0-9-]+$
        template: /ws/{channel}
    resource_patterns:
      file_reference:
        pattern: ^file://[a-z0-9-]+(/[a-z0-9-]+)*\.[a-z]+$
        template: file://{path}
      general:
        description: 通用資源路徑格式
        pattern: ^/[a-z0-9]+(/[a-z0-9-]+)*$
      internal_reference:
        pattern: ^internal://[a-z0-9-]+/[a-z0-9-]+$
        template: internal://{module}/{resource}
  urn_standards:
    canonical_format:
      components:
      - description: URN 方案標識符（固定）
        name: urn
        position: 0
        value: urn
      - description: 命名空間（固定）
        name: namespace
        position: 1
        value: machinenativeops
      - description: 域名（必須已註冊）
        name: domain
        pattern: '[a-z0-9-]+'
        position: 2
      - description: 資源名稱（kebab-case）
        name: resource
        pattern: '[a-z0-9-]+'
        position: 3
      - description: 版本號（可選）
        name: version
        optional: true
        pattern: v[0-9]+
        position: 4
      pattern: ^urn:machinenativeops:[a-z0-9-]+:[a-z0-9-]+(:v[0-9]+)?$
      template: urn:machinenativeops:{domain}:{resource}:{version}
    environment_scoped_format:
      environments:
      - description: 開發環境
        value: dev
      - description: 測試環境
        value: staging
      - description: 生產環境
        value: prod
      example: urn:machinenativeops:prod:governance:naming-convention:v1
      pattern: ^urn:machinenativeops:(dev|staging|prod):[a-z0-9-]+:[a-z0-9-]+:v[0-9]+$
      template: urn:machinenativeops:{env}:{domain}:{resource}:{version}
      use_case: 用於區分不同環境的資源實例
    extended_format_with_checksum:
      checksum:
        algorithm: sha256
        description: 資源內容的 SHA256 校驗碼前 8 位
        length: 8
      example: urn:machinenativeops:governance:naming-convention:v1:sha256-a1b2c3d4
      pattern: ^urn:machinenativeops:[a-z0-9-]+:[a-z0-9-]+:v[0-9]+:sha256-[a-f0-9]{8}$
      template: urn:machinenativeops:{domain}:{resource}:{version}:{checksum}
      use_case: 用於資源完整性驗證和版本鎖定
    registered_domains:
    - description: 治理框架資源
      domain: governance
      examples:
      - urn:machinenativeops:governance:naming-convention:v1
      - urn:machinenativeops:governance:policy-engine:v2
      owner: governance-team
      sub_domains:
      - dimension
      - policy
      - schema
    - description: AI 相關資源
      domain: ai
      examples:
      - urn:machinenativeops:ai:cognitive-engine:v1
      - urn:machinenativeops:ai:decision-maker:v1
      owner: ai-team
      sub_domains:
      - model
      - agent
      - pipeline
    - description: 核心引擎資源
      domain: core
      examples:
      - urn:machinenativeops:core:execution-engine:v1
      - urn:machinenativeops:core:service-registry:v1
      owner: core-team
      sub_domains:
      - engine
      - registry
      - bridge
    - description: 自主系統資源
      domain: autonomous
      examples:
      - urn:machinenativeops:autonomous:drone-controller:v1
      - urn:machinenativeops:autonomous:vehicle-agent:v1
      owner: autonomous-team
      sub_domains:
      - drone
      - vehicle
      - sensor
    - description: 配置資源
      domain: config
      examples:
      - urn:machinenativeops:config:database:v1
      - urn:machinenativeops:config:monitoring:v1
      owner: platform-team
    - description: 治理維度資源
      domain: dimension
      examples:
      - urn:machinenativeops:dimension:99-naming-convention:v1
      - urn:machinenativeops:dimension:27-templates:v1
      owner: governance-team
  urn_uri_mapping:
    description: URN 與 URI 之間的標準映射規則
    rules:
    - example:
        uri: /api/v1/governance/naming-convention
        urn: urn:machinenativeops:governance:naming-convention:v1
      uri_pattern: /api/v{version}/governance/{resource}
      urn_pattern: urn:machinenativeops:governance:{resource}:v{version}
    - example:
        uri: /api/v1/dimensions/99-naming-convention
        urn: urn:machinenativeops:dimension:99-naming-convention:v1
      uri_pattern: /api/v{version}/dimensions/{id}
      urn_pattern: urn:machinenativeops:dimension:{id}:v{version}
  validation_rules:
  - description: URN 必須符合標準格式
    name: canonical-urn-format
    rule_id: URN-001
    severity: error
  - description: URN 域名必須已註冊
    name: registered-domain
    rule_id: URN-002
    severity: error
  - description: 校驗碼格式（可選）
    name: checksum-format
    rule_id: URN-003
    severity: info
  - description: 環境範圍 URN 格式
    name: environment-scope
    rule_id: URN-004
    severity: warning
  - description: API URI 必須符合模式
    name: api-uri-pattern
    rule_id: URI-001
    severity: error
  - description: 資源 URI 必須符合模式
    name: resource-uri-pattern
    rule_id: URI-002
    severity: error
