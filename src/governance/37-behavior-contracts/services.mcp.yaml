api:
  base_path: /api/v1/mcp
  endpoints:
  - description: 'Initialize MCP server with capabilities and configuration.

      使用能力和配置初始化 MCP 伺服器。

      '
    guarantees:
    - MCP protocol version validated
    - Capabilities registered
    - Server ID is unique
    input_schema:
      properties:
        capabilities:
          type: object
        protocol_version:
          type: string
        server_name:
          type: string
      required:
      - server_name
      - protocol_version
      type: object
    method: POST
    name: Initialize MCP Server
    output_schema:
      properties:
        server_id:
          type: string
        server_info:
          type: object
        supported_resources:
          type: array
        supported_tools:
          type: array
      type: object
    path: /servers/initialize
    performance:
      response_time_p50: < 100ms
      response_time_p99: < 300ms
  - description: 'Execute MCP tool with provided arguments.

      使用提供的參數執行 MCP 工具。

      '
    guarantees:
    - Tool execution is sandboxed
    - Errors are structured
    - Context is preserved
    input_schema:
      properties:
        arguments:
          type: object
        context:
          type: object
        tool_name:
          type: string
      required:
      - tool_name
      - arguments
      type: object
    method: POST
    name: Invoke Tool
    output_schema:
      properties:
        content:
          type: array
        is_error:
          type: boolean
        result:
          type: object
      type: object
    path: /tools/invoke
    performance:
      response_time_p50: < 200ms
      response_time_p99: < 1s
  - description: Access MCP resource by URI
    guarantees:
    - Resource permissions checked
    - Content type validated
    - URI format validated
    method: GET
    name: Read Resource
    output_schema:
      properties:
        content:
          type: string
        metadata:
          type: object
        mime_type:
          type: string
        uri:
          type: string
      type: object
    path: /resources/{resource_uri}
    performance:
      response_time_p50: < 50ms
      response_time_p99: < 200ms
  - description: 'Update AI model context.

      更新 AI 模型上下文。

      '
    guarantees:
    - Context size limits enforced
    - Version tracking
    - Atomic updates
    input_schema:
      properties:
        context_id:
          type: string
        merge_strategy:
          enum:
          - replace
          - merge
          - append
          type: string
        updates:
          type: object
      required:
      - context_id
      - updates
      type: object
    method: PUT
    name: Update Context
    output_schema:
      properties:
        context_id:
          type: string
        size_bytes:
          type: integer
        version:
          type: string
      type: object
    path: /context
  - description: Retrieve MCP prompt template
    guarantees:
    - Prompt templates are validated
    - Arguments schema provided
    method: GET
    name: Get Prompt
    output_schema:
      properties:
        arguments:
          type: array
        description:
          type: string
        messages:
          type: array
        name:
          type: string
      type: object
    path: /prompts/{prompt_name}
  - description: 'List all available MCP tools and their capabilities.

      列出所有可用的 MCP 工具及其功能。

      '
    guarantees:
    - All registered tools listed
    - Schema information complete
    - Deprecated tools filtered by default
    input_schema:
      properties:
        category:
          type: string
        include_deprecated:
          default: false
          type: boolean
        search:
          type: string
      type: object
    method: GET
    name: List Tools
    output_schema:
      properties:
        tools:
          items:
            properties:
              category:
                type: string
              deprecated:
                type: boolean
              description:
                type: string
              input_schema:
                type: object
              name:
                type: string
              output_schema:
                type: object
              version:
                type: string
            type: object
          type: array
        total_count:
          type: integer
      type: object
    path: /tools
    performance:
      response_time_p50: < 30ms
      response_time_p99: < 100ms
contract:
  description: 'MCP Services provide Model Context Protocol implementation for AI
    model integration,

    context management, and tool/resource exposure to AI systems.


    MCP 服務提供模型上下文協議實現，用於 AI 模型整合、上下文管理和向 AI 系統公開工具/資源。

    '
  module: services.mcp
  owner: '@services-platform'
  status: active
  version: 1.0.0
dependencies:
  required:
  - failure_mode: critical
    module: core.safety_mechanisms
    purpose: Tool execution safety
  - failure_mode: log-and-continue
    module: infrastructure.message_queue
    purpose: Event publishing
events:
- consumers:
  - automation.monitoring
  - services.audit
  delivery_guarantee: at-least-once
  description: Emitted when MCP server initializes
  name: mcp.server_initialized
  payload_schema:
    properties:
      capabilities:
        type: object
      server_id:
        type: string
      server_name:
        type: string
      timestamp:
        format: date-time
        type: string
    type: object
  retention: 30 days
- consumers:
  - automation.monitoring
  delivery_guarantee: at-least-once
  description: Emitted when MCP tool is invoked
  name: mcp.tool_invoked
  payload_schema:
    properties:
      duration_ms:
        type: number
      server_id:
        type: string
      success:
        type: boolean
      timestamp:
        format: date-time
        type: string
      tool_name:
        type: string
    type: object
  retention: 30 days
- consumers:
  - services.audit
  - services.security
  delivery_guarantee: at-least-once
  description: Emitted when MCP resource is accessed
  name: mcp.resource_accessed
  payload_schema:
    properties:
      access_granted:
        type: boolean
      resource_uri:
        type: string
      server_id:
        type: string
      timestamp:
        format: date-time
        type: string
    type: object
  retention: 90 days
failure_modes:
- error_code: ERR_TOOL_FAILED
  recovery:
  - Return structured error
  - Log for debugging
  - Maintain server state
  scenario: Tool Execution Failure
  triggers:
  - Tool timeout
  - Tool error
- error_code: ERR_RESOURCE_NOT_FOUND
  recovery:
  - Return 404 with suggestions
  - Log access attempt
  scenario: Resource Not Found
  triggers:
  - Invalid URI
  - Resource deleted
- error_code: ERR_CONTEXT_OVERFLOW
  recovery:
  - Reject update
  - Suggest context pruning
  scenario: Context Overflow
  triggers:
  - Context size exceeds limit
invariants:
- description: All interactions follow MCP specification
  enforcement: pre-condition
  name: Protocol Compliance
  rule: 'forall interaction: complies_with(interaction, MCP_spec)'
- description: Tool executions are isolated
  enforcement: runtime
  name: Tool Sandboxing
  rule: 'forall tool_exec: isolated(tool_exec)'
- description: Context size within limits
  enforcement: pre-condition
  name: Context Size Limit
  rule: 'forall context: context.size <= max_context_size'
- description: Resource access requires permission
  enforcement: pre-condition
  name: Resource Permission
  rule: 'forall access: has_permission(access.user, access.resource)'
mcp_compliance:
  limits:
    max_concurrent_requests: 1000
    max_context_size: 1MB
    max_tool_execution_time: 30s
  protocol_version: '2024-11-05'
  supported_features:
  - tools
  - resources
  - prompts
  - context
observability:
  alerts:
  - condition: mcp_tool_failure_rate > 10%
    severity: high
  - condition: mcp_tool_duration_seconds.p99 > 5s
    severity: warning
  - condition: mcp_context_overflow_total > 100/hour
    severity: warning
  metrics:
  - name: mcp_servers_active
    type: gauge
  - labels:
    - tool_name
    - server_id
    - status
    name: mcp_tool_invocations_total
    type: counter
  - name: mcp_tool_duration_seconds
    type: histogram
  - labels:
    - resource_type
    - status
    name: mcp_resource_accesses_total
    type: counter
  - name: mcp_context_size_bytes
    type: histogram
references:
  architecture_governance_matrix: governance/29-docs/ARCHITECTURE_GOVERNANCE_MATRIX.md
  mcp_specification: https://spec.modelcontextprotocol.io/
  ownership_map: governance/34-config/ownership-map.yaml#services.mcp
