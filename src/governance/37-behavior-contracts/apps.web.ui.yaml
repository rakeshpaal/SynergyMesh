api:
  base_path: /api/v1/ui
  endpoints:
  - description: 'Create authenticated user session.

      創建已驗證的使用者會話。

      '
    guarantees:
    - Session ID is secure and unique
    - Credentials validated
    - Permissions loaded
    input_schema:
      properties:
        credentials:
          type: object
        remember_me:
          type: boolean
      required:
      - credentials
      type: object
    method: POST
    name: Create Session
    output_schema:
      properties:
        expires_at:
          format: date-time
          type: string
        permissions:
          type: array
        session_id:
          type: string
        user:
          type: object
      type: object
    path: /sessions
    performance:
      response_time_p50: < 100ms
      response_time_p99: < 500ms
  - description: Retrieve dashboard metrics and status
    guarantees:
    - Data is fresh (< 5s old)
    - Aggregated from all modules
    - User permissions respected
    method: GET
    name: Get Dashboard Data
    output_schema:
      properties:
        alerts:
          type: array
        last_updated:
          format: date-time
          type: string
        metrics:
          type: object
        system_status:
          type: string
      type: object
    path: /dashboard
    performance:
      response_time_p50: < 150ms
      response_time_p99: < 500ms
    query_parameters:
      modules:
        type: array
      time_range:
        type: string
  - description: 'Update module configuration through UI.

      透過 UI 更新模組配置。

      '
    guarantees:
    - Schema validation before apply
    - Backup of previous config
    - Rollback available
    - Audit log entry created
    input_schema:
      properties:
        config_changes:
          type: object
        validate_only:
          type: boolean
      required:
      - config_changes
      type: object
    method: PUT
    name: Update Configuration
    output_schema:
      properties:
        applied:
          type: boolean
        requires_restart:
          type: boolean
        validation_result:
          type: object
      type: object
    path: /config/{module}
  - description: Subscribe to real-time notifications via WebSocket
    guarantees:
    - WebSocket connection authenticated
    - Topic permissions validated
    - Heartbeat mechanism active
    input_schema:
      properties:
        severity_levels:
          type: array
        topics:
          type: array
      type: object
    method: POST
    name: Subscribe to Notifications
    output_schema:
      properties:
        subscription_id:
          type: string
        websocket_url:
          type: string
      type: object
    path: /notifications/subscribe
  - description: Update user UI preferences
    guarantees:
    - Preferences persisted
    - Applied immediately
    input_schema:
      properties:
        dashboard_layout:
          type: object
        language:
          type: string
        notification_settings:
          type: object
        theme:
          type: string
      type: object
    method: PUT
    name: Update User Preferences
    output_schema:
      properties:
        preferences:
          type: object
        updated:
          type: boolean
      type: object
    path: /preferences
  - description: 'Export dashboard data and reports in various formats.

      以各種格式導出儀表板數據和報告。

      '
    error_responses:
    - code: 400
      condition: Invalid date range or filters
      message: ERR_INVALID_EXPORT_PARAMS
    - code: 413
      condition: Export size exceeds limit
      message: ERR_EXPORT_TOO_LARGE
    guarantees:
    - Export includes all requested data
    - Format conversion accurate
    - Download URL valid for 24 hours
    - Large exports handled efficiently
    input_schema:
      properties:
        date_range:
          properties:
            end:
              format: date-time
              type: string
            start:
              format: date-time
              type: string
          type: object
        export_type:
          enum:
          - dashboard
          - report
          - logs
          - metrics
          - configuration
          type: string
        filters:
          type: object
        format:
          enum:
          - json
          - csv
          - pdf
          - xlsx
          type: string
        include_metadata:
          default: true
          type: boolean
      required:
      - export_type
      - format
      type: object
    method: POST
    name: Export Data
    output_schema:
      properties:
        download_url:
          format: uri
          type: string
        expires_at:
          format: date-time
          type: string
        export_id:
          type: string
        file_size_bytes:
          type: integer
        format:
          type: string
        generated_at:
          format: date-time
          type: string
      type: object
    path: /export
    performance:
      response_time_p50: < 1s
      response_time_p99: < 10s
contract:
  description: 'Web UI provides user-facing interface for SynergyMesh platform,

    including dashboards, monitoring, configuration, and administration.


    Web UI 為 SynergyMesh 平台提供面向使用者的介面，包括儀表板、監控、配置和管理。

    '
  module: apps.web.ui
  owner: '@frontend-team'
  status: active
  version: 1.0.0
dependencies:
  optional:
  - failure_mode: log-and-continue
    module: services.analytics
    purpose: User behavior tracking
  required:
  - failure_mode: critical
    module: services.auth
    purpose: Authentication and authorization
  - failure_mode: critical
    module: services.api_gateway
    purpose: Backend API access
events:
- consumers:
  - services.audit
  - services.security
  delivery_guarantee: at-least-once
  description: Emitted when user session is created
  name: ui.session_created
  payload_schema:
    properties:
      ip_address:
        type: string
      session_id:
        type: string
      timestamp:
        format: date-time
        type: string
      user_id:
        type: string
    type: object
  retention: 90 days
- consumers:
  - services.audit
  - core.unified_integration
  delivery_guarantee: at-least-once
  description: Emitted when configuration is changed through UI
  name: ui.config_changed
  payload_schema:
    properties:
      changed_by:
        type: string
      changes:
        type: object
      module:
        type: string
      timestamp:
        format: date-time
        type: string
    type: object
  retention: 180 days
- consumers:
  - services.audit
  - ops.alerting
  delivery_guarantee: at-least-once
  description: Emitted when user performs critical action
  name: ui.critical_action
  payload_schema:
    properties:
      action_type:
        type: string
      resource:
        type: string
      timestamp:
        format: date-time
        type: string
      user_id:
        type: string
    type: object
  retention: 180 days
failure_modes:
- error_code: SESSION_EXPIRED
  recovery:
  - Redirect to login
  - Preserve unsaved work in local storage
  - Show session expired message
  scenario: Session Expired
  triggers:
  - Session timeout reached
  - User inactive
  user_facing: true
- error_code: SERVICE_UNAVAILABLE
  recovery:
  - Show offline mode message
  - Retry with exponential backoff
  - Cache last known state
  scenario: API Service Unavailable
  triggers:
  - Backend service down
  - Network error
  user_facing: true
- error_code: PERMISSION_DENIED
  recovery:
  - Show permission denied message
  - Suggest contacting administrator
  - Log unauthorized access attempt
  scenario: Permission Denied
  triggers:
  - User lacks required permission
  user_facing: true
invariants:
- description: All UI operations require valid session
  enforcement: middleware
  name: Authentication Required
  rule: 'forall operation: has_valid_session(operation.user)'
- description: Users can only perform permitted actions
  enforcement: authorization-layer
  name: Permission Enforcement
  rule: 'forall action: has_permission(action.user, action.resource, action.operation)'
- description: All user input is validated
  enforcement: pre-condition
  name: Input Validation
  rule: 'forall input: validated(input)'
- description: All critical actions are logged
  enforcement: post-condition
  name: Audit Trail
  rule: 'forall critical_action: exists audit_entry where audit_entry.action = critical_action'
observability:
  alerts:
  - condition: ui_api_errors_total > 100/hour
    severity: high
  - condition: ui_page_load_duration_seconds.p95 > 3s
    severity: warning
  - condition: ui_sessions_active = 0 AND expected > 0
    severity: critical
  logs:
    errors: ERROR
    level: INFO
    structured: true
    user_actions: INFO
  metrics:
  - name: ui_sessions_active
    type: gauge
  - labels:
    - page
    - user_type
    name: ui_page_views_total
    type: counter
  - name: ui_page_load_duration_seconds
    type: histogram
  - labels:
    - endpoint
    - error_type
    name: ui_api_errors_total
    type: counter
  - labels:
    - module
    - user
    name: ui_config_changes_total
    type: counter
references:
  architecture_governance_matrix: governance/29-docs/ARCHITECTURE_GOVERNANCE_MATRIX.md
  design_system: docs/design-system.md
  ownership_map: governance/34-config/ownership-map.yaml#apps.web.ui
security:
  content_security_policy:
    directives:
    - default-src 'self'
    - script-src 'self'
    - style-src 'self' 'unsafe-inline'
    enabled: true
  csrf_protection: true
  session_management:
    httponly: true
    samesite: strict
    secure_cookies: true
    session_timeout: 30 minutes
  xss_protection: true
testing:
  accessibility_tests:
    automated: true
    manual_review: true
  e2e_tests:
    framework: Playwright/Cypress
    required:
    - User login and logout
    - Dashboard navigation
    - Critical user workflows
  integration_tests:
    required:
    - Authentication flow
    - Dashboard data loading
    - Configuration updates
  unit_tests:
    coverage_min: 70
    framework: Jest/Vitest
user_experience:
  accessibility:
    keyboard_navigation: true
    screen_reader_support: true
    wcag_level: AA
  internationalization:
    rtl_support: false
    supported_languages:
    - en
    - zh-TW
  performance:
    api_response_feedback: < 100ms
    initial_load: < 2s
    page_transition: < 200ms
  responsiveness:
    desktop_optimized: true
    mobile_support: true
    tablet_support: true
