api:
  base_path: /api/v1/integration
  endpoints:
  - description: 'Initialize and bootstrap the entire SynergyMesh system.

      初始化並啟動整個 SynergyMesh 系統。

      '
    error_responses:
    - code: 409
      condition: System already bootstrapped
      message: ERR_ALREADY_BOOTSTRAPPED
    - code: 500
      condition: Critical phase failed
      message: ERR_BOOTSTRAP_FAILED
    guarantees:
    - Bootstrap is idempotent
    - Phases execute in defined order
    - Failed phases are reported
    - System state is consistent after bootstrap
    input_schema:
      properties:
        environment:
          enum:
          - development
          - staging
          - production
          type: string
        skip_phases:
          items:
            type: string
          type: array
      type: object
    method: POST
    name: Bootstrap System
    output_schema:
      properties:
        bootstrap_id:
          type: string
        bootstrap_time_seconds:
          type: number
        phases_completed:
          type: array
        services_started:
          type: integer
        status:
          enum:
          - success
          - partial
          - failed
          type: string
      type: object
    path: /bootstrap
    performance:
      bootstrap_time_target: < 10s
      response_time_p99: < 5s
  - description: 'Register a service in the service registry.

      在服務註冊表中註冊服務。

      '
    guarantees:
    - Service ID is unique within registry
    - Health check is validated before registration
    - Dependencies are verified
    input_schema:
      properties:
        dependencies:
          items:
            type: string
          type: array
        endpoint:
          format: uri
          type: string
        health_check:
          format: uri
          type: string
        metadata:
          type: object
        service_id:
          type: string
        service_name:
          type: string
      required:
      - service_id
      - endpoint
      - health_check
      type: object
    method: POST
    name: Register Service
    output_schema:
      properties:
        registered_at:
          format: date-time
          type: string
        registration_id:
          type: string
        status:
          type: string
      type: object
    path: /services
    performance:
      response_time_p50: < 50ms
      response_time_p99: < 200ms
  - description: Discover service endpoint and metadata
    guarantees:
    - Returns most recent health status
    - Cache coherence < 5 seconds
    - Health status is validated
    method: GET
    name: Discover Service
    output_schema:
      properties:
        endpoint:
          type: string
        health_status:
          enum:
          - healthy
          - degraded
          - unhealthy
          type: string
        last_health_check:
          format: date-time
          type: string
        metadata:
          type: object
        service_id:
          type: string
      type: object
    path: /services/{service_id}
    performance:
      cache_ttl: 5 seconds
      response_time_p50: < 10ms
      response_time_p99: < 50ms
  - description: Retrieve configuration value
    guarantees:
    - Configuration is validated against schema
    - Version tracking for all changes
    - Audit trail maintained
    method: GET
    name: Get Configuration
    output_schema:
      properties:
        key:
          type: string
        last_updated:
          format: date-time
          type: string
        value: {}
        version:
          type: string
      type: object
    path: /config/{key}
    performance:
      response_time_p50: < 20ms
      response_time_p99: < 100ms
  - description: Update configuration value
    guarantees:
    - Schema validation before update
    - Atomic update (all-or-nothing)
    - Previous value preserved in history
    - Drift detection triggered
    input_schema:
      properties:
        validate_only:
          type: boolean
        value: {}
      required:
      - value
      type: object
    method: PUT
    name: Set Configuration
    output_schema:
      properties:
        key:
          type: string
        updated_at:
          format: date-time
          type: string
        version:
          type: string
      type: object
    path: /config/{key}
  - description: Publish event to integration bus
    guarantees:
    - At-least-once delivery
    - Event ordering per routing key
    - Publish confirmation
    input_schema:
      properties:
        event_type:
          type: string
        payload:
          type: object
        routing_key:
          type: string
      required:
      - event_type
      - payload
      type: object
    method: POST
    name: Publish Event
    output_schema:
      properties:
        event_id:
          type: string
        published_at:
          format: date-time
          type: string
        subscribers_notified:
          type: integer
      type: object
    path: /events
  - description: 'Execute coordinated workflow across multiple services.

      跨多個服務執行協調的工作流。

      '
    guarantees:
    - Steps execute in defined order
    - Dependency resolution automatic
    - Rollback on failure if configured
    - Progress trackable via execution_id
    input_schema:
      properties:
        async:
          default: false
          type: boolean
        parameters:
          type: object
        timeout_seconds:
          default: 300
          type: integer
        workflow_definition:
          properties:
            error_handling:
              enum:
              - fail-fast
              - continue
              - retry
              type: string
            steps:
              type: array
            workflow_id:
              type: string
          type: object
      required:
      - workflow_definition
      - parameters
      type: object
    method: POST
    name: Execute Workflow
    output_schema:
      properties:
        duration_seconds:
          type: number
        execution_id:
          type: string
        results:
          type: object
        status:
          enum:
          - running
          - completed
          - failed
          - timeout
          type: string
        steps_completed:
          type: integer
      type: object
    path: /workflows/execute
    performance:
      response_time_p50: < 500ms
      response_time_p99: < 2s
  - description: 'Resolve service dependencies and determine startup order.

      解析服務依賴並確定啟動順序。

      '
    error_responses:
    - code: 400
      condition: Invalid service graph
      message: ERR_INVALID_GRAPH
    - code: 409
      condition: Circular dependency detected
      message: ERR_CIRCULAR_DEPENDENCY
    guarantees:
    - Circular dependencies detected
    - Missing dependencies reported
    - Topological sort applied
    - Resolution is deterministic
    input_schema:
      properties:
        check_health:
          default: true
          type: boolean
        service_graph:
          description: Service dependency graph
          type: object
      required:
      - service_graph
      type: object
    method: POST
    name: Resolve Dependencies
    output_schema:
      properties:
        circular_dependencies:
          type: array
        missing_dependencies:
          type: array
        resolution_id:
          type: string
        resolution_time_ms:
          type: number
        startup_order:
          description: Ordered list of services
          items:
            type: string
          type: array
      type: object
    path: /dependencies/resolve
    performance:
      response_time_p50: < 100ms
      response_time_p99: < 500ms
  - description: 'Comprehensive system health check across all services.

      跨所有服務的全面系統健康檢查。

      '
    guarantees:
    - All registered services checked
    - Health status cached appropriately
    - Timeout prevents hanging
    - Metrics updated atomically
    input_schema:
      properties:
        include_metrics:
          default: false
          type: boolean
        timeout_seconds:
          default: 10
          type: integer
      type: object
    method: GET
    name: Check System Health
    output_schema:
      properties:
        checked_at:
          format: date-time
          type: string
        metrics:
          properties:
            degraded_count:
              type: integer
            healthy_count:
              type: integer
            total_services:
              type: integer
            unhealthy_count:
              type: integer
          type: object
        overall_status:
          enum:
          - healthy
          - degraded
          - unhealthy
          type: string
        services:
          items:
            properties:
              last_check:
                format: date-time
                type: string
              response_time_ms:
                type: number
              service_id:
                type: string
              status:
                type: string
            type: object
          type: array
      type: object
    path: /health/system
    performance:
      cache_ttl: 10 seconds
      response_time_p50: < 200ms
      response_time_p99: < 1s
contract:
  description: 'Unified integration layer orchestrates system bootstrap, service discovery,

    configuration management, and cognitive processing.


    統一整合層編排系統啟動、服務發現、配置管理和認知處理。

    '
  module: core.unified_integration
  owner: '@core-platform-team'
  status: active
  version: 1.0.0
dependencies:
  optional:
  - failure_mode: log-and-continue
    module: core.monitoring_system
    purpose: Health monitoring
  required:
  - failure_mode: critical
    module: infrastructure.redis
    purpose: Service registry cache
  - failure_mode: use-cached
    module: governance.policies
    purpose: Configuration schemas
events:
- consumers:
  - automation.monitoring
  - services.audit
  delivery_guarantee: at-least-once
  description: Emitted when system bootstrap completes
  name: integration.system_bootstrapped
  ordering: global
  payload_schema:
    properties:
      bootstrap_id:
        type: string
      environment:
        type: string
      phases_completed:
        type: array
      services_count:
        type: integer
      timestamp:
        format: date-time
        type: string
    type: object
  retention: 30 days
- consumers:
  - automation.monitoring
  - services.gateway
  delivery_guarantee: at-least-once
  description: Emitted when new service registers
  name: integration.service_registered
  payload_schema:
    properties:
      endpoint:
        type: string
      service_id:
        type: string
      service_name:
        type: string
      timestamp:
        format: date-time
        type: string
    type: object
  retention: 30 days
- consumers:
  - services.audit
  - automation.monitoring
  - affected_services
  delivery_guarantee: at-least-once
  description: Emitted when configuration changes
  name: integration.config_changed
  payload_schema:
    properties:
      changed_by:
        type: string
      key:
        type: string
      new_version:
        type: string
      old_version:
        type: string
      timestamp:
        format: date-time
        type: string
    type: object
  retention: 90 days
- consumers:
  - ops.alerting
  - automation.monitoring
  delivery_guarantee: at-least-once
  description: Emitted when service health degrades
  name: integration.health_degraded
  payload_schema:
    properties:
      current_status:
        type: string
      previous_status:
        type: string
      reason:
        type: string
      service_id:
        type: string
      timestamp:
        format: date-time
        type: string
    type: object
  retention: 30 days
failure_modes:
- error_code: ERR_BOOTSTRAP_PHASE_FAILED
  recovery:
  - Roll back completed phases
  - Report failed phase
  - Maintain system in safe state
  scenario: Bootstrap Phase Failure
  triggers:
  - Critical phase times out
  - Dependency not available
- degraded_mode: true
  error_code: ERR_REGISTRY_UNAVAILABLE
  recovery:
  - Use last-known-good cache
  - Alert operations team
  - Attempt reconnection
  scenario: Service Registry Unavailable
  triggers:
  - Redis connection lost
  - Cache corruption
- error_code: WARN_CONFIG_DRIFT
  recovery:
  - Alert configuration team
  - Log drift details
  - Optionally auto-correct
  scenario: Configuration Drift Detected
  triggers:
  - Config differs from expected
  - Schema validation fails
invariants:
- description: Multiple bootstrap calls have same effect as one
  enforcement: application-logic
  name: Bootstrap Idempotency
  rule: bootstrap(s) = bootstrap(bootstrap(s))
- description: Service IDs are unique in registry
  enforcement: database-constraint
  name: Service Uniqueness
  rule: 'forall s1, s2 in services: s1.id = s2.id implies s1 = s2'
- description: Service dependencies must be satisfied
  enforcement: pre-condition
  name: Dependency Resolution
  rule: 'registered(s) implies forall d in s.dependencies: registered(d)'
- description: All config values match their schema
  enforcement: pre-condition
  name: Configuration Schema Compliance
  rule: 'forall c in configs: validates(c.value, c.schema)'
- description: Events with same routing key are ordered
  enforcement: messaging-layer
  name: Event Ordering Per Key
  rule: 'forall e1, e2 where e1.key = e2.key and e1.time < e2.time: delivered(e1)
    before delivered(e2)'
observability:
  alerts:
  - condition: bootstrap_duration_seconds > 30
    severity: high
  - condition: service_discovery_latency_seconds.p99 > 100ms
    severity: warning
  metrics:
  - name: bootstrap_duration_seconds
    type: histogram
  - name: services_registered_total
    type: gauge
  - name: service_discovery_latency_seconds
    type: histogram
  - name: config_reads_total
    type: counter
  - name: config_writes_total
    type: counter
  - labels:
    - event_type
    name: events_published_total
    type: counter
performance:
  bootstrap:
    max_time: < 30s
    target_time: < 10s
  configuration_access:
    cache_hit_rate: '> 95%'
    p50: < 20ms
    p99: < 100ms
  service_discovery:
    p50: < 10ms
    p99: < 50ms
    throughput: '> 10000 req/s'
references:
  module_spec: governance/36-modules/core.unified_integration.yaml
  ownership_map: governance/34-config/ownership-map.yaml#core.unified_integration
