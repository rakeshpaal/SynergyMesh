api:
  base_path: /api/v1/autonomous
  endpoints:
  - description: 'Create and validate a new autonomous mission.

      創建並驗證新的自主任務。

      '
    error_responses:
    - code: 400
      condition: Invalid waypoints or constraints
      message: ERR_INVALID_MISSION
    - code: 403
      condition: Mission violates safety constraints
      message: ERR_SAFETY_VIOLATION
    - code: 409
      condition: Airspace conflict detected
      message: ERR_AIRSPACE_CONFLICT
    guarantees:
    - All waypoints validated for safety
    - No-fly zones checked
    - Battery capacity verified
    - Regulatory compliance validated
    - Mission ID is unique
    input_schema:
      properties:
        constraints:
          properties:
            battery_reserve:
              type: number
            max_altitude:
              type: number
            no_fly_zones:
              type: array
            weather_limits:
              type: object
          type: object
        metadata:
          type: object
        mission_type:
          enum:
          - surveillance
          - delivery
          - inspection
          - mapping
          type: string
        waypoints:
          items:
            properties:
              action:
                type: string
              altitude:
                type: number
              latitude:
                type: number
              longitude:
                type: number
            type: object
          type: array
      required:
      - mission_type
      - waypoints
      - constraints
      type: object
    method: POST
    name: Create Mission
    output_schema:
      properties:
        created_at:
          format: date-time
          type: string
        estimated_duration_seconds:
          type: number
        mission_id:
          type: string
        status:
          enum:
          - validated
          - invalid
          - pending_approval
          type: string
        validation_result:
          properties:
            path_feasible:
              type: boolean
            regulatory_compliant:
              type: boolean
            safety_check:
              type: boolean
          type: object
      type: object
    path: /missions
    performance:
      response_time_p50: < 200ms
      response_time_p99: < 1s
  - description: 'Start execution of an approved mission.

      開始執行已批准的任務。

      '
    error_responses:
    - code: 404
      condition: Mission not found
      message: ERR_MISSION_NOT_FOUND
    - code: 409
      condition: Mission already executing
      message: ERR_MISSION_ACTIVE
    - code: 503
      condition: No available drones
      message: ERR_NO_DRONES_AVAILABLE
    guarantees:
    - Pre-flight safety checks completed
    - Drone availability verified
    - Emergency abort capability enabled
    - Real-time telemetry started
    input_schema:
      properties:
        drone_id:
          type: string
        pre_flight_check:
          type: boolean
      type: object
    method: POST
    name: Execute Mission
    output_schema:
      properties:
        drone_assigned:
          type: string
        execution_id:
          type: string
        started_at:
          format: date-time
          type: string
        status:
          enum:
          - started
          - rejected
          type: string
      type: object
    path: /missions/{mission_id}/execute
  - description: 'Emergency abort of active mission with safe landing.

      緊急中止活動任務並安全降落。

      '
    guarantees:
    - Abort command sent immediately
    - Safe landing procedure initiated
    - All systems notified
    - Incident logged for review
    input_schema:
      properties:
        reason:
          type: string
        return_to_home:
          default: true
          type: boolean
      required:
      - reason
      type: object
    method: POST
    name: Emergency Abort
    output_schema:
      properties:
        abort_id:
          type: string
        abort_initiated_at:
          format: date-time
          type: string
        landing_site:
          properties:
            latitude:
              type: number
            longitude:
              type: number
          type: object
        status:
          type: string
      type: object
    path: /missions/{mission_id}/abort
    performance:
      critical_path: true
      response_time_p50: < 50ms
      response_time_p99: < 100ms
  - description: Get real-time telemetry for active mission
    guarantees:
    - Telemetry freshness < 1 second
    - Position accuracy within GPS limits
    - Battery level accurate
    method: GET
    name: Get Telemetry
    output_schema:
      properties:
        battery_level:
          type: number
        drone_id:
          type: string
        heading:
          type: number
        mission_id:
          type: string
        position:
          properties:
            altitude:
              type: number
            latitude:
              type: number
            longitude:
              type: number
          type: object
        signal_strength:
          type: number
        speed:
          type: number
        status:
          type: string
        timestamp:
          format: date-time
          type: string
      type: object
    path: /missions/{mission_id}/telemetry
    performance:
      response_time_p50: < 30ms
      response_time_p99: < 100ms
      update_frequency: 1 Hz minimum
  - description: 'Update no-fly zones and safety boundaries.

      更新禁飛區和安全邊界。

      '
    guarantees:
    - Active missions checked against new zones
    - Conflicts trigger alerts
    - Zone updates atomic
    input_schema:
      properties:
        no_fly_zones:
          items:
            properties:
              active_from:
                format: date-time
                type: string
              active_until:
                format: date-time
                type: string
              geometry:
                type: object
              zone_id:
                type: string
            type: object
          type: array
      type: object
    method: PUT
    name: Update Safety Zones
    output_schema:
      properties:
        active_missions_affected:
          type: integer
        updated:
          type: boolean
        zones_count:
          type: integer
      type: object
    path: /safety-zones
  - description: 'Generate optimal path for autonomous mission with obstacle avoidance.

      為自主任務生成避障的最優路徑。

      '
    error_responses:
    - code: 400
      condition: No valid path exists
      message: ERR_NO_VALID_PATH
    - code: 404
      condition: Mission not found
      message: ERR_MISSION_NOT_FOUND
    guarantees:
    - Path avoids all no-fly zones
    - Path is collision-free
    - Optimization goal respected
    - Path is executable within vehicle constraints
    input_schema:
      properties:
        avoid_zones:
          type: array
        end_point:
          properties:
            altitude:
              type: number
            latitude:
              type: number
            longitude:
              type: number
          type: object
        mission_id:
          type: string
        optimization_goal:
          default: safest
          enum:
          - shortest
          - fastest
          - safest
          - energy-efficient
          type: string
        start_point:
          properties:
            altitude:
              type: number
            latitude:
              type: number
            longitude:
              type: number
          type: object
        waypoints:
          type: array
      required:
      - start_point
      - end_point
      type: object
    method: POST
    name: Plan Path
    output_schema:
      properties:
        energy_consumption_estimate:
          type: number
        estimated_duration_seconds:
          type: number
        path_id:
          type: string
        safety_score:
          maximum: 100
          minimum: 0
          type: number
        total_distance_km:
          type: number
        waypoints:
          items:
            properties:
              altitude:
                type: number
              eta:
                format: date-time
                type: string
              latitude:
                type: number
              longitude:
                type: number
            type: object
          type: array
      type: object
    path: /missions/{mission_id}/path
    performance:
      response_time_p50: < 500ms
      response_time_p99: < 2s
  - description: 'Get detailed status and progress of autonomous mission.

      獲取自主任務的詳細狀態和進度。

      '
    guarantees:
    - Status reflects real-time state
    - Progress calculation accurate
    - Events ordered chronologically
    input_schema:
      properties:
        include_logs:
          default: false
          type: boolean
        include_telemetry:
          default: true
          type: boolean
        mission_id:
          type: string
      type: object
    method: GET
    name: Get Mission Status
    output_schema:
      properties:
        current_waypoint:
          type: integer
        elapsed_time_seconds:
          type: number
        estimated_remaining_seconds:
          type: number
        events:
          items:
            properties:
              description:
                type: string
              event_type:
                type: string
              timestamp:
                format: date-time
                type: string
            type: object
          type: array
        logs:
          type: array
        mission_id:
          type: string
        progress_percent:
          maximum: 100
          minimum: 0
          type: number
        status:
          enum:
          - planned
          - in_progress
          - paused
          - completed
          - aborted
          - failed
          type: string
        telemetry:
          type: object
        total_waypoints:
          type: integer
      type: object
    path: /missions/{mission_id}/status
    performance:
      response_time_p50: < 50ms
      response_time_p99: < 200ms
contract:
  description: 'Autonomous systems module provides UAV/drone control, mission planning,

    path navigation, and safety monitoring for autonomous operations.


    自主系統模組提供無人機控制、任務規劃、路徑導航和自主操作的安全監控。

    '
  module: automation.autonomous
  owner: '@automation-team'
  status: active
  version: 1.0.0
dependencies:
  optional:
  - failure_mode: log-and-continue
    module: services.audit
    purpose: Mission logging
  required:
  - failure_mode: critical
    module: core.safety_mechanisms
    purpose: Runtime safety validation
  - failure_mode: use-cached
    module: services.weather
    purpose: Weather data for mission planning
  - failure_mode: critical
    module: services.airspace
    purpose: No-fly zone data
events:
- consumers:
  - services.audit
  - automation.monitoring
  - ops.mission_control
  delivery_guarantee: at-least-once
  description: Emitted when mission execution starts
  name: autonomous.mission_started
  ordering: per-mission
  payload_schema:
    properties:
      drone_id:
        type: string
      execution_id:
        type: string
      mission_id:
        type: string
      mission_type:
        type: string
      started_at:
        format: date-time
        type: string
      waypoint_count:
        type: integer
    required:
    - mission_id
    - execution_id
    - drone_id
    type: object
  retention: 90 days
- consumers:
  - services.audit
  - ops.mission_control
  delivery_guarantee: at-least-once
  description: Emitted when mission completes successfully
  name: autonomous.mission_completed
  payload_schema:
    properties:
      completed_at:
        format: date-time
        type: string
      duration_seconds:
        type: number
      execution_id:
        type: string
      mission_id:
        type: string
      waypoints_achieved:
        type: integer
    type: object
  retention: 90 days
- consumers:
  - ops.alerting
  - services.incident_management
  - services.audit
  delivery_guarantee: at-least-once
  description: Emitted when mission is emergency aborted
  name: autonomous.emergency_abort
  payload_schema:
    properties:
      abort_reason:
        type: string
      drone_id:
        type: string
      mission_id:
        type: string
      position_at_abort:
        properties:
          latitude:
            type: number
          longitude:
            type: number
        type: object
      timestamp:
        format: date-time
        type: string
    type: object
  retention: 180 days
- consumers:
  - core.safety_mechanisms
  - ops.alerting
  - services.incident_management
  delivery_guarantee: at-least-once
  description: Emitted when safety constraint is violated
  name: autonomous.safety_violation
  payload_schema:
    properties:
      description:
        type: string
      mission_id:
        type: string
      severity:
        enum:
        - low
        - medium
        - high
        - critical
        type: string
      timestamp:
        format: date-time
        type: string
      violation_type:
        type: string
    type: object
  retention: 180 days
- consumers:
  - ops.alerting
  - core.safety_mechanisms
  - services.regulatory_compliance
  delivery_guarantee: at-least-once
  description: Emitted when drone breaches geofence
  name: autonomous.geofence_breach
  payload_schema:
    properties:
      drone_id:
        type: string
      mission_id:
        type: string
      position:
        properties:
          latitude:
            type: number
          longitude:
            type: number
        type: object
      timestamp:
        format: date-time
        type: string
      zone_violated:
        type: string
    type: object
  retention: 180 days
failure_modes:
- error_code: ERR_COMM_LOSS
  fail_safe: return-to-home
  recovery:
  - Activate autonomous return-to-home
  - Alert mission control
  - Log last known position
  - Continue monitoring for reconnection
  scenario: Communication Loss
  triggers:
  - Telemetry timeout > 5 seconds
  - Command acknowledgment failure
- error_code: ERR_BATTERY_CRITICAL
  fail_safe: emergency-landing
  recovery:
  - Immediate emergency landing at nearest safe site
  - Alert mission control
  - Broadcast emergency beacon
  scenario: Low Battery Emergency
  triggers:
  - Battery < critical threshold
  - Insufficient power for return
- error_code: ERR_GEOFENCE_BREACH
  fail_safe: course-correction-or-abort
  recovery:
  - Immediate course correction
  - Alert mission control
  - Log incident
  - If correction fails, abort mission
  scenario: Geofence Breach
  triggers:
  - Drone position outside allowed area
  - Approaching no-fly zone
- error_code: ERR_WEATHER_UNSAFE
  fail_safe: abort-and-return
  recovery:
  - Assess mission continuation
  - If unsafe, initiate abort
  - Return to home or emergency landing
  scenario: Weather Deterioration
  triggers:
  - Wind speed exceeds limits
  - Visibility drops below minimum
- error_code: ERR_SENSOR_FAILURE
  fail_safe: emergency-landing
  recovery:
  - Switch to backup sensors
  - Reduce speed and altitude
  - If critical sensor fails, emergency landing
  scenario: Sensor Failure
  triggers:
  - GPS signal loss
  - Altimeter malfunction
  - IMU drift
- error_code: WARN_OBSTACLE_DETECTED
  fail_safe: hover-and-assess
  recovery:
  - Immediate hover
  - Calculate alternate path
  - If no safe path, abort mission
  scenario: Obstacle Detected
  triggers:
  - Collision avoidance system alert
  - Unexpected obstacle in path
invariants:
- description: Safety constraints always enforced
  enforcement: pre-condition
  name: Safety-First Operation
  rule: 'forall mission: validated(mission.safety_constraints)'
- description: Drones never enter no-fly zones
  enforcement: runtime-check
  name: No-Fly Zone Compliance
  rule: 'forall position: not intersects(position, no_fly_zones)'
- description: Minimum battery reserve maintained for return
  enforcement: pre-condition + runtime-check
  name: Battery Reserve Required
  rule: 'forall mission: battery_level >= return_to_home_reserve + safety_margin'
- description: Abort capability never disabled during flight
  enforcement: application-logic
  name: Emergency Abort Always Available
  rule: 'forall active_mission: abort_available(mission)'
- description: Telemetry data must be recent (with 1s safety margin beyond guarantee)
  enforcement: runtime-check
  name: Telemetry Freshness
  note: Guarantee is < 1s freshness; 2s threshold includes safety margin for alerts
  rule: 'forall telemetry: now() - telemetry.timestamp < 2 seconds'
- description: One drone cannot execute multiple missions simultaneously
  enforcement: database-constraint
  name: Single Active Mission Per Drone
  rule: 'forall drone: count(active_missions(drone)) <= 1'
- description: Mission parameters cannot change during flight
  enforcement: application-logic
  name: Mission Immutability During Execution
  rule: 'forall executing_mission: mission.params is immutable'
observability:
  alerts:
  - condition: missions_active = 0 AND expected > 0
    severity: warning
  - condition: emergency_aborts_total > 2/hour
    severity: critical
  - condition: safety_violations_total > 10/hour
    severity: high
  - condition: geofence_breaches_total > 0
    severity: critical
  - condition: telemetry_latency_seconds.p99 > 2s
    severity: warning
  logs:
    all_aborts: ERROR
    level: INFO
    retention: 180 days
    safety_events: WARN
    structured: true
  metrics:
  - name: missions_active
    type: gauge
  - labels:
    - status
    - mission_type
    name: missions_total
    type: counter
  - name: mission_duration_seconds
    type: histogram
  - labels:
    - reason
    name: emergency_aborts_total
    type: counter
  - labels:
    - type
    - severity
    name: safety_violations_total
    type: counter
  - name: geofence_breaches_total
    type: counter
  - name: telemetry_latency_seconds
    type: histogram
  traces:
    critical_operation_sample_rate: 1.0
    enabled: true
    sample_rate: 0.1
operations:
  incident_response:
  - 'Immediate: Secure drone and area'
  - Document incident details
  - Notify relevant authorities
  - Conduct root cause analysis
  - Update safety procedures
  post_flight_review:
  - Download flight logs
  - Review safety incidents
  - Check drone condition
  - Update maintenance records
  pre_flight_checklist:
  - Verify drone battery level
  - Check weather conditions
  - Validate no-fly zones
  - Test communication link
  - Confirm emergency procedures
references:
  architecture_governance_matrix: governance/29-docs/ARCHITECTURE_GOVERNANCE_MATRIX.md
  ownership_map: governance/34-config/ownership-map.yaml#automation.autonomous
  regulatory_docs: docs/autonomous/regulatory-compliance.md
  safety_mechanisms: governance/37-behavior-contracts/core.safety_mechanisms.yaml
safety:
  certification: ISO 21384 (UAV Safety)
  compliance:
  - FAA Part 107 (US)
  - EASA regulations (EU)
  - Local aviation authority rules
  risk_mitigation:
  - Pre-flight safety checks mandatory
  - Weather conditions validated
  - No-fly zones checked continuously
  - Operator override capability
  - Kill switch available
  safety_controls:
  - Geofence enforcement with 10m buffer
  - Battery reserve calculation with 20% margin
  - Redundant communication channels
  - Automatic return-to-home on failure
  - Emergency abort capability
  - Real-time collision avoidance
  safety_critical: true
testing:
  hardware_tests:
    required:
    - Real drone communication
    - GPS accuracy validation
    - Sensor integration
  integration_tests:
    required:
    - End-to-end mission execution
    - Emergency abort scenarios
    - Geofence breach handling
    - Communication loss recovery
  simulation_tests:
    required:
    - Mission planning validation
    - Path optimization
    - Obstacle avoidance
    - Weather impact scenarios
  unit_tests:
    coverage_min: 85
    critical_paths:
    - Emergency abort logic
    - Geofence validation
    - Battery reserve calculation
    - Safety constraint checking
