$schema: https://schema.machinenativeops.io/policy/v1
audit:
  enabled: true
  events:
  - validation.started
  - validation.passed
  - validation.failed
  - policy.evaluated
  - autofix.triggered
  - autofix.completed
  - sbom.generated
  - provenance.injected
  - signature.verified
  integrity:
    algorithm: sha256
    chainEvents: true
  output:
    format: jsonl
    path: governance/audit/events.jsonl
    rotation:
      compress: true
      maxAge: 90d
      maxSize: 10MB
autofix:
  behavior:
    assignReviewers:
    - platform-governance
    branchPrefix: autofix/
    commitMessagePrefix: 'fix(governance): '
    createBranch: true
    labels:
    - autofix
    - governance
    openPullRequest: true
  enabled: true
  limits:
    cooldownMinutes: 30
    maxFilesPerPR: 10
    maxPRsPerDay: 5
  triggers:
  - schema_validation_failed
  - policy_gate_violation
  - sbom_missing
  - naming_rule_mismatch
exceptions:
  allowAdditionalFields:
  - test-vectors/**
  - examples/**
  disabledRules: []
  skipValidation:
  - node_modules/**
  - dist/**
  - .git/**
  - __pycache__/**
  - '*.lock'
  - '*.log'
metadata:
  created: '2025-11-30'
  description: 全域策略閘配置（七階段驗證、SLSA、SBOM、簽名）
  lastUpdated: '2025-11-30'
  name: base-policy
  owner: platform-governance
rules:
  controlled_vocabulary:
    domain:
    - automation
    - core
    - frontend
    - infrastructure
    - tests
    - governance
    - tools
    - ops
    - operations
    - config
    - docs
    - mcp-servers
    - agent
    - shared
    - bridges
    - contracts
    - runtime
    - github
    - architecture
    - security
    - guides
    layer:
    - coordination
    - execution
    - monitoring
    - supplyChain
    - audit
    - policy
    - schema
    - workflow
    - ui
    - service
    - runtime
    - docs
    - experience-interfaces
    - platform-core
    - ai-automation
    - enablement
    - governance-ops
    status:
    - draft
    - stable
    - deprecated
    - archived
    - experimental
    type:
    - markdown
    - yaml
    - json
    - ts-module
    - py-module
    - go-module
    - service-config
    - policy
    - schema
    - workflow
    - audit-entry
    - sbom
    - provenance
    - diagram
    - readme
    - reference
    - design
    - index
    - guide
    - api-reference
  naming:
    id:
      description: ID 必須為小寫字母數字，允許中線和底線
      maxLength: 64
      pattern: ^[a-z0-9]+([a-z0-9-_]*[a-z0-9])?$
    path:
      description: 路徑不可包含空白或特殊字元
      noSpaces: true
      noSpecialChars: true
      pattern: ^(?:[A-Za-z0-9._\-/]+)$
  required_fields:
    docs_index:
    - id
    - path
    - title
    - domain
    - layer
    - type
    - tags
    - owner
    - status
    - description
supplyChain:
  provenance:
    enabled: true
    generateOn:
    - release
    - merge_to_main
    include:
    - buildDefinition
    - runDetails
    - metadata
  sbom:
    format: spdx-json
    generateOn:
    - release
    - merge_to_main
    include:
    - packages
    - relationships
    - checksums
    version: '2.3'
  slsa:
    builder:
      id: https://github.com/Unmanned-Island-admin/SynergyMesh
      version: v1.0
    level: 3
    requirements:
    - hermetic_build
    - source_available
    - build_service
    - non_falsifiable
validation:
  stages:
  - description: YAML/JSON 語法正確性
    enabled: true
    failOn: error
    name: lint
    tools:
    - yamllint
    - jsonlint
  - description: 格式規範（縮排、引號、排序）
    enabled: true
    failOn: warning
    name: format
    rules:
      indent: 2
      lineWidth: 120
      quotingType: single
  - description: JSON Schema 結構驗證
    enabled: true
    failOn: error
    name: schema
    schemas:
    - applies_to:
      - docs/knowledge_index.yaml
      - docs/docs-index.json
      path: governance/31-schemas/docs-index.schema.json
    - applies_to:
      - governance/23-policies/*.yaml
      path: governance/31-schemas/policy.schema.json
  - description: 測試向量驗證
    enabled: true
    failOn: error
    includePatterns:
    - '*.valid.yaml'
    - '*.invalid.yaml'
    name: vector-test
    testVectorsPath: test-vectors/
  - description: OPA/Conftest 策略驗證
    enabled: true
    failOn: deny
    name: policy-gate
    policyPath: governance/23-policies/
    rules:
    - manifest-policies.rego
  - description: SBOM 完整性檢查
    enabled: true
    failOn: missing
    formats:
    - spdx-json
    - cyclonedx-json
    name: sbom
    requiredFields:
    - packages
    - relationships
  - description: 簽名驗證（可選）
    enabled: false
    failOn: invalid
    name: signature
    publicKeyPath: governance/keys/public.pem
    verifier: cosign
version: 1.0.0
