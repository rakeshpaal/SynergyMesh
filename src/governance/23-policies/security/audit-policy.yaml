apiVersion: machinenativeops.io/v2
kind: Policy
metadata:
  category: security-audit
  description: Kubernetes 審計日誌策略 / Kubernetes audit logging policy
  enforcement: mandatory
  name: audit-policy
  priority: 950
  version: v1.0.0
spec:
  alerting:
    anomalous_behavior:
      conditions:
      - 'request_rate: >100/minute'
      - 'failed_auth_attempts: >10/hour'
      - 'unusual_api_access_pattern: true'
      notification:
      - email
      severity: medium
    privileged_escalation:
      conditions:
      - 'verb: create,update'
      - 'resource: clusterrolebindings'
      - 'requesting_user: !cluster-admin'
      notification:
      - slack
      - email
      severity: high
    rbac_changes:
      conditions:
      - 'resource: roles,rolebindings,clusterroles,clusterrolebindings'
      - 'verb: create,update,delete'
      notification:
      - slack
      - email
      severity: high
    secret_access:
      conditions:
      - 'resource: secrets'
      - 'verb: get,list'
      - 'user: !service-account'
      notification:
      - slack
      severity: high
    unauthorized_access:
      conditions:
      - 'status_code: 403'
      - 'verb: create,update,delete'
      - 'resource: secrets,rbac'
      notification:
      - pagerduty
      - slack
      severity: critical
  audit_levels:
    metadata:
      description: 記錄請求元數據 / Log request metadata
      level: Metadata
      operations:
      - get
      - list
      - watch
      resources:
      - apiGroups:
        - ''
        resources:
        - configmaps
        - endpoints
        - persistentvolumeclaims
        - pods
        - replicationcontrollers
        - services
      - apiGroups:
        - apps
        resources:
        - daemonsets
        - replicasets
    request:
      description: 記錄請求主體 / Log request body
      level: Request
      operations:
      - create
      - update
      - patch
      - delete
      resources:
      - apiGroups:
        - ''
        resources:
        - secrets
        - serviceaccounts
      - apiGroups:
        - apps
        resources:
        - deployments
        - statefulsets
      - apiGroups:
        - batch
        resources:
        - jobs
        - cronjobs
      - apiGroups:
        - networking.k8s.io
        resources:
        - networkpolicies
        - ingresses
    request_response:
      description: 記錄請求與回應 / Log request and response
      level: RequestResponse
      operations:
      - create
      - update
      - patch
      - delete
      resources:
      - apiGroups:
        - rbac.authorization.k8s.io
        resources:
        - roles
        - rolebindings
        - clusterroles
        - clusterrolebindings
      - apiGroups:
        - certificates.k8s.io
        resources:
        - certificatesigningrequests
      - apiGroups:
        - authentication.k8s.io
        resources:
        - tokenreviews
      - apiGroups:
        - authorization.k8s.io
        resources:
        - subjectaccessreviews
        - selfsubjectaccessreviews
  exemptions:
    resources:
    - apiGroups:
      - ''
      resources:
      - events
      verbs:
      - create
      - patch
    users:
    - system:kube-controller-manager
    - system:kube-scheduler
    - system:node-problem-detector
  integration:
    compliance_platforms:
    - enabled: true
      export_schedule: daily
      name: SOC2
    - enabled: true
      export_schedule: weekly
      name: ISO27001
    siem:
      batch_size: 100
      enabled: true
      endpoint: https://siem.example.com/api/v1/logs
      flush_interval_seconds: 30
      format: json
  omit_stages:
  - RequestReceived
  performance:
    async_processing: true
    buffer_size_mb: 100
    max_batch_size: 1000
    max_batch_wait_seconds: 30
  references:
  - description: Kubernetes Audit Policy
    url: https://kubernetes.io/docs/tasks/debug/debug-cluster/audit/
  - description: SOC 2 Audit Requirements
    url: https://www.aicpa.org/interestareas/frc/assuranceadvisoryservices/aicpasoc2report
  related_policies:
  - rbac-role-matrix
  - zero-trust-principles
  - compliance-standards
  retention:
    archive_retention_years: 7
    archive_storage: s3-compliant
    compression: true
    encryption_algorithm: AES-256-GCM
    encryption_at_rest: true
    immutable_storage: true
    log_rotation_days: 90
  special_handling:
    alert_all_changes: true
    log_level: RequestResponse
    sensitive_namespaces:
    - kube-system
    - istio-system
    - cert-manager
    - vault
    - security
  version: v1.0.0
