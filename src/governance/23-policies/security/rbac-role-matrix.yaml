apiVersion: machinenativeops.io/v2
kind: Policy
metadata:
  category: security-rbac
  description: 基於角色的存取控制矩陣 / Role-based access control matrix
  enforcement: mandatory
  name: rbac-role-matrix
  priority: 950
  version: v1.0.0
spec:
  enforcement:
    admission_webhook: true
    deny_by_default: true
    explicit_allow_only: true
    webhook_endpoint: /validate/rbac/assignment
  permission_definitions:
    all:
      verbs:
      - '*'
    create:
      verbs:
      - create
    delete:
      verbs:
      - delete
      - deletecollection
    exec:
      subresources:
      - exec
      verbs:
      - create
      - get
    logs:
      subresources:
      - log
      verbs:
      - get
    read:
      verbs:
      - get
      - list
      - watch
    rollback:
      annotations:
      - deployment.kubernetes.io/revision
      verbs:
      - patch
    update:
      verbs:
      - patch
      - update
  references:
  - description: Kubernetes RBAC Documentation
    url: https://kubernetes.io/docs/reference/access-authn-authz/rbac/
  - description: NIST RBAC Model
    url: https://csrc.nist.gov/projects/role-based-access-control
  related_policies:
  - zero-trust-principles
  - audit-policy
  - pod-security-standards
  review_process:
    access_review_frequency: quarterly
    automated_deprovisioning:
      enabled: true
      inactive_days: 90
      notify_before_days: 14
    emergency_access:
      auto_expire_hours: 4
      break_glass_enabled: true
      notification: pagerduty
      requires_approval: true
  roles:
    ci-cd-automation:
      automation:
        max_deployments_per_hour: 50
        rollback_on_failure: true
      description: CI/CD 自動化服務帳戶 / CI/CD automation service account
      level: L2-AUTOMATION
      namespaces:
      - assigned-workload-namespaces
      permissions:
      - deployments:create,update,delete
      - services:create,update,delete
      - configmaps:create,update,delete
      - secrets:create,update
      - pods:read,delete
      - jobs:create,update,delete
      - cronjobs:create,update,delete
      restrictions:
        audit_all_actions: true
        ip_allowlist: ci-server-ips
        rate_limiting: true
        token_rotation_days: 30
    cluster-admin:
      approval:
        approval_count: 2
        approvers:
        - security-team-lead
        - cto
      assignment_process: manual-approval-required
      audit_retention_days: 2555
      description: 叢集管理員（僅限 L1 層）/ Cluster administrator (L1 only)
      level: L0-CONSTITUTIONAL
      max_users: 3
      permissions:
      - all:all:all
      restrictions:
        ip_allowlist_required: true
        mfa_required: true
        session_recording: true
    developer:
      description: 應用程式開發者 / Application developer
      level: L2-APPLICATION
      namespaces:
      - assigned-only
      permissions:
      - deployments:read
      - pods:read,logs
      - services:read
      - configmaps:read
      - secrets:read-metadata-only
      - events:read
      resource_limits:
        max_cpu: 4000m
        max_memory: 8Gi
      restrictions:
        approval_required: false
        exec_disabled: true
        port_forward_disabled: true
    platform-operator:
      audit:
        alert_on_sensitive_operations: true
        log_all_actions: true
      description: 平台操作員 / Platform operator
      level: L1-GOVERNANCE
      namespaces:
      - all-except-kube-system
      permissions:
      - namespaces:read,update
      - deployments:read,update,rollback
      - services:read,update
      - configmaps:read,update
      - secrets:read
      - pods:read,logs,exec
      - nodes:read
      - persistentvolumes:read
      restrictions:
        allowed_operations_window: business-hours
        break_glass_procedure: true
        mfa_required: true
    security-auditor:
      audit:
        log_all_queries: true
        retention_years: 7
      description: 安全審計員 / Security auditor
      level: L1-GOVERNANCE
      namespaces:
      - all
      permissions:
      - all:read
      - audit-logs:read
      - secrets:read-metadata-only
      - rbac:read
      - networkpolicies:read
      - podsecuritypolicies:read
      restrictions:
        mfa_required: true
        no_write_access: true
        session_timeout_minutes: 30
    viewer:
      default_role: true
      description: 唯讀檢視者 / Read-only viewer
      level: L3-READONLY
      namespaces:
      - assigned-only
      permissions:
      - all:read
      restrictions:
        no_exec: true
        no_port_forward: true
        no_secret_access: true
  version: v1.0.0
