description: CI Policy Gate rules for SynergyMesh
id: machinenativeops.ci.policy_gate
integration:
  argo_events: true
  github_actions: true
  gitlab_ci: false
rules:
- allowlist:
  - config/topology-mind-matrix.yaml
  deny_if:
    any:
    - filename_matches: config/**executive**.yaml
    - filename_matches: config/**mind-matrix**.yaml
  description: 禁止新增第二份拓撲或 executive 檔案
  id: no-duplicate-topology
  match:
    added_files:
    - config/**
  severity: error
- check:
    file: config/system-manifest.yaml
    must_include:
    - 'id: "mind_matrix"'
    - 'file: "config/topology-mind-matrix.yaml"'
    must_not_include:
    - executive
    - mind_matrix_2
    - topology2
  description: system-manifest.yaml 必須僅掛 mind_matrix 作為拓撲
  id: manifest-single-entry
  severity: error
- check:
    file: config/topology-mind-matrix.yaml
    must_include:
    - 'tool_pipeline:'
    - 'yaml_validation_pipeline:'
    - '- "interface_metadata"'
    - '- "signature_verification"'
  description: 八階段工具、七階段驗證
  id: pipeline-lengths
  severity: error
- check:
    file: config/topology-mind-matrix.yaml
    must_include:
    - depth_first
    - verifiability_first
    - security_first
    - automation_first
    - traceability_first
  description: 治理原則必須包含核心五原則
  id: governance-principles-required
  severity: warning
- check:
    file: config/topology-mind-matrix.yaml
    must_include:
    - 'id: "machinenativeops.ceo"'
    - 'id: "machinenativeops.ciso"'
  description: 必須定義 CEO 和 CISO 角色
  id: executive-roles-required
  severity: error
- check:
    file: config/topology-mind-matrix.yaml
    must_include:
    - 'slsa:'
    - 'level:'
  description: 必須指定 SLSA 等級
  id: slsa-level-required
  severity: warning
validation:
  fail_on_error: true
  fail_on_warning: false
  report_format: json
version: 1.0.0
