apiVersion: machinenativeops.io/v2
kind: ConstraintTemplate
metadata:
  annotations:
    machinenativeops.io/description: Validates VisionStatement resources
    machinenativeops.io/gac-phase: 3-enforcement
  name: governancevisionstatement
spec:
  crd:
    spec:
      names:
        kind: GovernanceVisionStatement
      validation:
        openAPIV3Schema:
          properties:
            requireEnglishTranslation:
              description: Require English translation for all text fields
              type: boolean
          type: object
  targets:
  - rego: "package governancevisionstatement\n\nviolation[{\"msg\": msg}] {\n  input.review.kind.kind\
      \ == \"VisionStatement\"\n  not input.review.object.spec.vision\n  msg := \"\
      VisionStatement must define spec.vision\"\n}\n\nviolation[{\"msg\": msg}] {\n\
      \  input.review.kind.kind == \"VisionStatement\"\n  not input.review.object.spec.mission\n\
      \  msg := \"VisionStatement must define spec.mission\"\n}\n\nviolation[{\"msg\"\
      : msg}] {\n  input.review.kind.kind == \"VisionStatement\"\n  count(input.review.object.spec.core_values)\
      \ < 3\n  msg := sprintf(\"Insufficient core values: %d (require at least 3)\"\
      , [count(input.review.object.spec.core_values)])\n}\n\nviolation[{\"msg\": msg}]\
      \ {\n  input.review.kind.kind == \"VisionStatement\"\n  not input.review.object.metadata.annotations[\"\
      strategic-doc-path\"]\n  msg := \"VisionStatement must have 'strategic-doc-path'\
      \ annotation for traceability\"\n}\n"
    target: admission.k8s.gatekeeper.sh
