apiVersion: machinenativeops.io/v2
kind: PrometheusRule
metadata:
  annotations:
    machinenativeops.io/feature: anomaly-detection
    machinenativeops.io/phase: '5'
  name: ai-anomaly-detection
  namespace: machinenativenops
spec:
  groups:
  - interval: 30s
    name: ai_anomaly_detection
    rules:
    - alert: AnomalousGovernancePattern
      annotations:
        action: AUTO_INVESTIGATE
        description: 'ML model detected score {{ $value }} (threshold: 0.8)'
        responsibility: AI_AUTONOMOUS
        summary: AI detected anomalous governance pattern
      expr: ai_ml_anomaly_score{type="governance"} > 0.8
      for: 0s
      labels:
        ai_detected: 'true'
        auto_action: investigate
        severity: warning
    - alert: UnexpectedResourceSpike
      annotations:
        action: AUTO_ANALYZE
        summary: Unexpected resource creation spike
      expr: rate(governance_resources_total[5m]) > 2 * rate(governance_resources_total[1h])
      for: 0s
      labels:
        ai_detected: 'true'
        severity: warning
    - alert: ComplianceDriftAnomaly
      annotations:
        action: AUTO_REMEDIATE
        summary: Abnormal compliance score change detected
      expr: abs(deriv(governance_compliance_score[10m])) > 0.1
      for: 0s
      labels:
        ai_detected: 'true'
        severity: critical
