apiVersion: machinenativeops.io/v2
backup:
  enabled: true
  retention_days: 30
  schedule: 0 */6 * * *
  targets:
  - logs
  - configuration
  - telemetry_data
compliance:
  audit_logging:
    enabled: true
    log_types:
    - api_requests
    - configuration_changes
    - authentication_events
    - authorization_decisions
    retention_days: 365
  security_scanning:
  - sast: required
  - dast: required
  - dependency_check: required
  - container_scan: required
  slsa:
    level: 3
    requirements:
    - source_integrity
    - build_service
    - provenance
    - non_falsifiable
documentation:
  api_spec: core/contract_service/contracts-L1/ai-chat-service/openapi.yml
  architecture: docs/architecture/ai-chat-service.md
  readme: core/contract_service/contracts-L1/ai-chat-service/README.md
  runbook: docs/runbooks/ai-chat-service-operations.md
integrations:
- authentication: api-key
  endpoint: https://api.openai.com/v1
  name: openai-api
  rate_limits:
    requests_per_minute: 60
    tokens_per_minute: 150000
  type: external
- authentication: jwt
  endpoint: http://drone-control:8000
  name: drone-control-system
  type: internal
- authentication: mutual-tls
  endpoint: http://telemetry:8080
  name: telemetry-collector
  type: internal
kind: DeploymentManifest
metadata:
  description: AI chat services for drone and autonomous vehicle operations
  governance:
    approval_required: true
    security_scan: required
    slsa_level: 3
  name: matechat-drone-services
  tags:
  - ai
  - chat
  - drone
  - autonomous
  version: 1.0.0
monitoring:
  alerts:
  - condition: request_duration_ms > 2000
    name: HighLatency
    notification:
    - slack
    - email
    severity: warning
  - condition: health_check_failures > 3
    name: ServiceDown
    notification:
    - pagerduty
    - slack
    severity: critical
  - condition: error_rate > 0.05
    name: HighErrorRate
    notification:
    - slack
    severity: warning
  enabled: true
  metrics:
  - labels:
    - method
    - endpoint
    - status
    name: request_duration_ms
    type: histogram
  - labels:
    - service
    name: active_connections
    type: gauge
  - labels:
    - model
    - user
    name: ai_tokens_used
    type: counter
  - labels:
    - error_type
    - service
    name: error_rate
    type: counter
recovery:
  procedures:
  - actions:
    - restart_pod
    - notify_oncall
    name: service-restart
    trigger: health_check_failure
  - actions:
    - revert_to_previous_version
    - notify_team
    - create_incident
    name: rollback
    trigger: high_error_rate
  rpo: 1h
  rto: 15m
rollout:
  phases:
  - duration: 1h
    name: canary
    percentage: 10
    success_criteria:
    - error_rate < 0.01
    - latency_p95 < 2000ms
  - duration: 2h
    name: staged
    percentage: 50
    success_criteria:
    - error_rate < 0.01
    - latency_p95 < 2000ms
  - duration: ongoing
    name: full
    percentage: 100
services:
- deployment:
    max_surge: 1
    max_unavailable: 0
    replicas: 3
    strategy: rolling-update
  environment:
  - name: NODE_ENV
    value: production
  - name: PORT
    value: '8100'
  - name: LOG_LEVEL
    value: info
  - name: OPENAI_API_KEY
    valueFrom:
      secretRef:
        key: api-key
        name: openai-credentials
  - name: AI_MODEL
    value: gpt-4-turbo-preview
  - name: MAX_TOKENS
    value: '4096'
  - name: TEMPERATURE
    value: '0.7'
  framework: express
  health_checks:
    liveness:
      failure_threshold: 3
      interval: 30s
      path: /health/live
      timeout: 5s
    readiness:
      failure_threshold: 3
      interval: 10s
      path: /health/ready
      timeout: 5s
    startup:
      failure_threshold: 30
      interval: 10s
      path: /health
      timeout: 5s
  language: typescript
  name: ai-chat-service
  path: core/contract_service/contracts-L1/ai-chat-service
  ports:
  - name: http
    port: 8100
    protocol: TCP
  - name: metrics
    port: 9090
    protocol: TCP
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 500m
      memory: 1Gi
  security:
    allow_privilege_escalation: false
    capabilities:
      drop:
      - ALL
    network_policies:
    - ingress:
      - from:
        - podSelector:
            matchLabels:
              app: drone-control
        ports:
        - port: 8100
          protocol: TCP
      name: allow-ingress
    - egress:
      - ports:
        - port: 443
          protocol: TCP
        to:
        - podSelector:
            matchLabels:
              app: openai-api
      name: allow-egress
    read_only_root_filesystem: true
    run_as_non_root: true
  type: microservice
- dependencies:
  - ai-chat-service
  name: input-service
  path: core/contract_service/contracts-L1/input-service
  status: planned
  type: microservice
- dependencies:
  - ai-chat-service
  name: file-service
  path: core/contract_service/contracts-L1/file-service
  status: planned
  type: microservice
- name: markdown-renderer
  path: advanced-system-src/markdown-renderer
  status: planned
  type: library
- name: ai-model-integration
  path: mcp-servers/ai-model-integration
  status: planned
  type: mcp-server
