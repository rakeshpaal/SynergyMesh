annotations:
  canonical_urn: axiom.io/canonical-urn
  qualifiers: axiom.io/qualifiers
kind: CanonicalNamingSpec
metadata:
  description: Single-source machine spec for naming governance with URN/URI mapping
  name: canonical-naming-governance
  owner: platform-governance
migration:
  dry_run_report: reports/canonical-naming-mapping.csv
  risk_tags:
  - high
  - medium
  - low
  strategy: warn-and-plan
naming:
  allowed_chars: '[a-z0-9-]'
  canonical_regex: ^(?!.*--)(team|tenant|dev|test|staging|prod|learn|sandbox)-[a-z0-9]+(?:-[a-z0-9]+)*$
  canonical_regex_source: derived from organizational prefixes (team/tenant) + environments
    list with -- guard
  case: lower
  environments:
  - dev
  - test
  - staging
  - prod
  - learn
  - sandbox
  max_length: 63
  prefix_alignment:
    allow_environment_prefix: true
    require_label_match: true
  qualifier_rules:
    key_pattern: ^[a-z0-9][a-z0-9-]{0,29}$
    max_qualifiers: 12
    value_pattern: ^[a-zA-Z0-9.:@/+%-]{0,127}$
  reserved_tokens:
  - core
  - internal
  - system
  - legacy
  - experimental
  segments:
  - domain
  - component
  - environment
<<<<<<< HEAD
  - region
  - version
  - suffix
  suffix_map:
    configmap: config
    deployment: deploy
    job: job
    namespace: ns
    pvc: pvc
    secret: secret
    service: svc
required_labels:
- environment
- tenant
- app.kubernetes.io/managed-by
=======
  - tenant
  - app.kubernetes.io/managed-by

urn_template: "urn:machinenativeops:{domain}:{component}:env:{environment}:{version}"
>>>>>>> main
segment_mapping:
  component: '{component}'
  domain: '{domain}'
  environment: '{environment}'
  region: qualifier:region
  suffix: suffix_map.*
  version: '{version}'
segment_mapping_notes:
<<<<<<< HEAD
  region: region values are stored under annotations key axiom.io/qualifiers as region=<value>
  suffix: suffix resolution uses suffix_map entries when present
urn_template: urn:axiom:{domain}:{component}:env:{environment}:{version}
=======
  region: "region values are stored under annotations key machinenativeops.io/qualifiers as region=<value>"
  suffix: "suffix resolution uses suffix_map entries when present"
annotations:
  canonical_urn: "machinenativeops.io/canonical-urn"
  qualifiers: "machinenativeops.io/qualifiers"

>>>>>>> main
validation:
  ci:
    conftest_policy: governance/23-policies/conftest/naming_policy.rego
    kubeval: true
    yamllint: true
  gatekeeper:
    constraint_templates:
    - name: K8sRequiredLabels
      required_labels_ref: required_labels
    - max_length_ref: naming.max_length
      name: K8sNamingPattern
      pattern_ref: naming.canonical_regex
    failure_policy: Fail
version: v1.0
