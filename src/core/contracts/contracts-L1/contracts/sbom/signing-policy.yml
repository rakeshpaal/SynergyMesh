apiVersion: machinenativeops.io/v2
automation:
  ci_trigger:
  - on_image_push
  - on_release_tag
  retention:
    days: 90
    versions_to_keep: 10
  upload:
    destinations:
    - asset_name: sbom-${VERSION}.tar.gz
      type: github_release
    - path: sbom/${VERSION}/
      type: artifact_registry
    enabled: true
kind: SBOMSigningPolicy
metadata:
  created_at: '2025-01-17T12:00:00Z'
  language: zh-TW
  name: contracts-l1-sbom-policy
  version: 1.0.0
sbom_generation:
  enabled: true
  formats:
  - name: spdx-json
    output: sbom/contracts-l1-sbom.spdx.json
    version: '2.3'
  - name: cyclonedx-json
    output: sbom/contracts-l1-sbom.cyclonedx.json
    version: '1.5'
  options:
    catalogers:
    - npm-package-json
    - node-modules
    exclude:
    - /tmp/**
    - /var/cache/**
  targets:
  - ref: ghcr.io/we-can-fix/contracts-l1:${VERSION}
    type: image
  - path: ./dist
    type: directory
  tool: syft
  version: '>=0.100.0'
signing:
  attestation:
    enabled: true
    predicate_type: https://in-toto.io/Statement/v0.1
  enabled: true
  mode: keyless
  oidc:
    identity_regexp: .*@imachinenativeops\.com
    issuer: https://token.actions.githubusercontent.com
  targets:
  - path: sbom/contracts-l1-sbom.spdx.json
    signature_file: sbom/contracts-l1-sbom.spdx.json.sig
  - path: sbom/contracts-l1-sbom.cyclonedx.json
    signature_file: sbom/contracts-l1-sbom.cyclonedx.json.sig
  tool: cosign
verification:
  checks:
  - description: 驗證 SBOM 簽章有效性
    name: signature_valid
    required: true
  - description: 驗證簽章者身份
    name: identity_match
    required: true
  - description: 驗證簽章時間在 24 小時內
    name: timestamp_recent
    required: false
  enabled: true
  on_failure:
    action: block
    notify:
    - security@imachinenativeops.com
