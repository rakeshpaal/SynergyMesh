apiVersion: machinenativeops.io/v2
kind: PrometheusRule
metadata:
  labels:
    machinenativeops.io/app: contracts-l1
    machinenativeops.io/prometheus: kube-prometheus
    machinenativeops.io/tier: core
  name: contracts-l1-alerts
  namespace: machinenativenops
spec:
  groups:
  - interval: 30s
    name: contracts-l1
    rules:
    - alert: ContractsL1HighErrorRate
      annotations:
        description: 'Error rate is {{ $value | humanizePercentage }} (threshold:
          5%)'
        summary: High error rate detected in Contracts L1 Service
      expr: 'rate(http_requests_total{app="contracts-l1",status=~"5.."}[5m]) > 0.05

        '
      for: 5m
      labels:
        service: contracts-l1
        severity: critical
    - alert: ContractsL1SlowResponseTime
      annotations:
        description: '95th percentile response time is {{ $value }}s (threshold: 0.1s)'
        summary: Slow response time in Contracts L1 Service
      expr: 'histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{app="contracts-l1"}[5m]))
        > 0.1

        '
      for: 5m
      labels:
        service: contracts-l1
        severity: warning
    - alert: ContractsL1ServiceDown
      annotations:
        description: Service has been unavailable for more than 1 minute
        summary: Contracts L1 Service is down
      expr: up{job="contracts-l1"} == 0
      for: 1m
      labels:
        service: contracts-l1
        severity: critical
