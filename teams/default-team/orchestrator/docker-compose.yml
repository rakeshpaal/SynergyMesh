networks:
  aaps-network:
    driver: bridge
    name: aaps-network
services:
  super-agent:
    build:
      context: .
      target: production
    container_name: super-agent
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 128M
    environment:
    - SUPERAGENT_AGENT_ID=super-agent-001
    - SUPERAGENT_ENV=production
    - SUPERAGENT_LOG_LEVEL=INFO
    - SUPERAGENT_LOG_FORMAT=json
    - SUPERAGENT_EVENT_STORE_BACKEND=sqlite
    - SUPERAGENT_EVENT_STORE_PATH=/app/data/events.db
    - SUPERAGENT_AUDIT_PATH=/app/data/audit.db
    - SUPERAGENT_ENABLE_TRACING=true
    healthcheck:
      interval: 30s
      retries: 3
      start_period: 10s
      test:
      - CMD
      - python3
      - -c
      - import urllib.request; urllib.request.urlopen('http://localhost:8080/health',
        timeout=5)
      timeout: 10s
    image: aaps/super-agent:latest
    networks:
    - aaps-network
    ports:
    - 8080:8080
    restart: unless-stopped
    volumes:
    - super-agent-data:/app/data
    - super-agent-logs:/app/logs
  super-agent-dev:
    build:
      context: .
      target: development
    container_name: super-agent-dev
    environment:
    - SUPERAGENT_ENV=development
    - SUPERAGENT_LOG_LEVEL=DEBUG
    - SUPERAGENT_LOG_FORMAT=text
    - SUPERAGENT_EVENT_STORE_BACKEND=memory
    image: aaps/super-agent:dev
    networks:
    - aaps-network
    ports:
    - 8080:8080
    profiles:
    - dev
    volumes:
    - .:/app:ro
    - super-agent-dev-data:/app/data
  test-runner:
    build:
      context: .
      target: development
    command:
    - pytest
    - -v
    - --cov=.
    - --cov-report=term-missing
    container_name: super-agent-test
    environment:
    - SUPERAGENT_ENV=test
    - SUPERAGENT_EVENT_STORE_BACKEND=memory
    image: aaps/super-agent:test
    networks:
    - aaps-network
    profiles:
    - test
    volumes:
    - .:/app
version: '3.9'
volumes:
  super-agent-data:
    name: super-agent-data
  super-agent-dev-data:
    name: super-agent-dev-data
  super-agent-logs:
    name: super-agent-logs
