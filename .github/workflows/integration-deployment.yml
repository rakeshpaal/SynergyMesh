# ==============================================================================
# ğŸš€ æŒçºŒæ•´åˆèˆ‡éƒ¨ç½² (Integration & Deployment)
# MachineNativeOps Integration & Deployment Pipeline
# ==============================================================================
# âš ï¸ DISABLED: This workflow references non-existent paths:
#   - src/core/contract_service/contracts-L1/contracts
# Re-enable when the contract service is implemented.
# ==============================================================================
name: "ğŸš€ æŒçºŒæ•´åˆèˆ‡éƒ¨ç½² (Integration & Deployment)"

on:
  # DISABLED: Automatic triggers removed to prevent 100% failure rate
  # push:
  #   branches: [main, develop]
  # pull_request:
  #   types: [opened, synchronize, reopened]
  #   branches: [main, develop]
  workflow_dispatch:
    inputs:
      confirm_run:
        description: 'Type "confirm" to run (requires contract service paths to exist)'
        required: true
        type: string

# ä¸¦ç™¼æ§åˆ¶
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: ${{ github.event_name == 'pull_request' }}

permissions:
  contents: read
  packages: write
  checks: write
  pull-requests: write

env:
  NODE_VERSION: "20"
  PYTHON_VERSION: "3.11"

jobs:
  # =============================================================================
  # Tier 1 - Contracts L1 Service
  # =============================================================================
  tier1-contracts-l1-service:
    name: "ğŸ—ï¸ Tier 1 - Contracts L1 Service"
    runs-on: ubuntu-latest
    timeout-minutes: 30
    # Gate: Only run if manually confirmed
    if: ${{ github.event.inputs.confirm_run == 'confirm' }}

    defaults:
      run:
        working-directory: src/core/contract_service/contracts-L1/contracts

    steps:
      - name: "ğŸ“¥ æª¢å‡ºä»£ç¢¼"
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.2.2
        uses: actions/checkout@0ad4b8f3a27c304e21892351cbf9860471245599
        with:
          fetch-depth: 0

      - name: "ğŸ” é©—è­‰è·¯å¾‘å­˜åœ¨"
        run: |
          if [ ! -d "$GITHUB_WORKSPACE/src/core/contract_service/contracts-L1/contracts" ]; then
            echo "::error::Required path does not exist: src/core/contract_service/contracts-L1/contracts"
            echo "This workflow requires the contract service to be implemented first."
            exit 1
          fi
        working-directory: ${{ github.workspace }}

      - name: "âš™ï¸ è¨­ç½® Node.js ç’°å¢ƒ"
        uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4.4.0
        uses: actions/setup-node@1e60f620b9541d16bece96c5465dc8ee9832be0b
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: 'src/core/contract_service/contracts-L1/contracts/package-lock.json'

      - name: "ğŸ“¦ Install dependencies"
        run: |
          echo "ğŸ”§ Installing dependencies for Contracts L1 Service..."
          max_retries=3
          delay_seconds=5
          attempt=1
          while [ "$attempt" -le "$max_retries" ]; do
            echo "ğŸ“¦ npm ci attempt $attempt of $max_retries..."
            if npm ci --prefer-offline --no-audit; then
              echo "âœ… npm ci succeeded on attempt $attempt."
              break
            fi
            if [ "$attempt" -lt "$max_retries" ]; then
              echo "âš ï¸ npm ci failed on attempt $attempt. Retrying in ${delay_seconds}s..."
              sleep "$delay_seconds"
            else
              echo "âŒ npm ci failed after $max_retries attempts."
              exit 1
            fi
            attempt=$((attempt + 1))
          done
          
      - name: "ğŸ” é©—è­‰ä¾è³´å®‰è£"
        run: |
          echo "âœ… é©—è­‰å·²å®‰è£çš„å¥—ä»¶..."
          npm list --depth=0 || true
          
      - name: "ğŸ¨ æ ¼å¼æª¢æŸ¥"
        run: |
          echo "ğŸ¨ æª¢æŸ¥ä»£ç¢¼æ ¼å¼..."
          npm run format:check || echo "âš ï¸ æ ¼å¼æª¢æŸ¥ç™¼ç¾å•é¡Œï¼ˆéé˜»å¡ï¼‰"
          
      - name: "ğŸ” Lint æª¢æŸ¥"
        run: |
          echo "ğŸ” åŸ·è¡Œ ESLint æª¢æŸ¥..."
          npm run lint || echo "âš ï¸ Lint æª¢æŸ¥ç™¼ç¾å•é¡Œï¼ˆéé˜»å¡ï¼‰"
          
      - name: "ğŸ“ é¡å‹æª¢æŸ¥"
        run: |
          echo "ğŸ“ åŸ·è¡Œ TypeScript é¡å‹æª¢æŸ¥..."
          npm run typecheck
          
      - name: "ğŸ§ª åŸ·è¡Œæ¸¬è©¦"
        run: |
          echo "ğŸ§ª åŸ·è¡Œå–®å…ƒæ¸¬è©¦..."
          npm run test
          
      - name: "ğŸ—ï¸ æ§‹å»ºé …ç›®"
        run: |
          echo "ğŸ—ï¸ æ§‹å»º Contracts L1 Service..."
          npm run build
          
      - name: "ğŸ“Š ç”Ÿæˆ SBOM"
        run: |
          echo "ğŸ“Š ç”Ÿæˆè»Ÿé«”ç‰©æ–™æ¸…å–®..."
          npm run sbom || echo "âš ï¸ SBOM ç”Ÿæˆå¯é¸"
          
      - name: "ğŸ”’ å®‰å…¨æƒæ"
        run: |
          echo "ğŸ”’ åŸ·è¡Œå®‰å…¨æƒæ..."
          npm audit --audit-level=moderate || echo "âš ï¸ ç™¼ç¾ä¸­ç­‰é¢¨éšªï¼ˆéé˜»å¡ï¼‰"
          
      - name: "ğŸ“¦ ä¸Šå‚³æ§‹å»ºç”¢ç‰©"
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
        uses: actions/upload-artifact@65462800fd760344b1a7b4382951275a0abb4808
        with:
          name: contracts-l1-dist
          path: src/core/contract_service/contracts-L1/contracts/dist/
          retention-days: 7
          
      - name: "ğŸ“Š ç”Ÿæˆæœå‹™å ±å‘Š"
        if: always()
        run: |
          echo "# ğŸ—ï¸ Tier 1 - Contracts L1 Service Report" > contracts-l1-report.md
          echo "" >> contracts-l1-report.md
          echo "**æ§‹å»ºæ™‚é–“**: $(date)" >> contracts-l1-report.md
          echo "**æäº¤**: ${{ github.sha }}" >> contracts-l1-report.md
          echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> contracts-l1-report.md
          echo "" >> contracts-l1-report.md
          
          if [ -d "dist" ]; then
            echo "## âœ… æ§‹å»ºæˆåŠŸ" >> contracts-l1-report.md
            echo "- ç”¢ç‰©å·²ç”Ÿæˆåœ¨ dist/ ç›®éŒ„" >> contracts-l1-report.md
            echo "- æ–‡ä»¶æ•¸é‡: $(find dist -type f | wc -l)" >> contracts-l1-report.md
          else
            echo "## âŒ æ§‹å»ºå¤±æ•—" >> contracts-l1-report.md
            echo "- dist/ ç›®éŒ„æœªç”Ÿæˆ" >> contracts-l1-report.md
          fi
          
          cat contracts-l1-report.md
          
      - name: "ğŸ“¤ ä¸Šå‚³æœå‹™å ±å‘Š"
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
        uses: actions/upload-artifact@65462800fd760344b1a7b4382951275a0abb4808
        if: always()
        with:
          name: contracts-l1-report
          path: src/core/contract_service/contracts-L1/contracts/contracts-l1-report.md
          retention-days: 7

  # =============================================================================
  # Tier 2 - å…¶ä»–å·¥ä½œå€æœå‹™
  # =============================================================================
  tier2-workspace-services:
    name: "ğŸ”§ Tier 2 - Workspace Services"
    runs-on: ubuntu-latest
    timeout-minutes: 30
    needs: tier1-contracts-l1-service
    
    strategy:
      matrix:
        workspace:
          - src/mcp-servers
          - src/core/advisory-database
      fail-fast: false
    
    steps:
      - name: "ğŸ“¥ æª¢å‡ºä»£ç¢¼"
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.2.2

      - name: "âš™ï¸ è¨­ç½® Node.js ç’°å¢ƒ"
        uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4.4.0
        uses: actions/checkout@0ad4b8f3a27c304e21892351cbf9860471245599

      - name: "âš™ï¸ è¨­ç½® Node.js ç’°å¢ƒ"
        uses: actions/setup-node@1e60f620b9541d16bece96c5465dc8ee9832be0b
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: ${{ matrix.workspace }}/package-lock.json

      - name: "ğŸ“¦ å®‰è£å·¥ä½œå€ä¾è³´"
        working-directory: ${{ matrix.workspace }}
        run: |
          echo "ğŸ”§ Installing dependencies for ${{ matrix.workspace }}..."
          if [ -f "package.json" ]; then
            # Retry npm ci up to 3 times before failing
            for i in 1 2 3; do
              if npm ci --prefer-offline --no-audit; then
                break
              else
                echo "âš ï¸ npm ci failed (attempt $i/3)"
                if [ $i -eq 3 ]; then
                  echo "âŒ All retry attempts failed"
                  exit 1
                fi
                sleep 5
              fi
            done
          else
            echo "âš ï¸ æ²’æœ‰ package.jsonï¼Œè·³éå®‰è£"
          fi
          
      - name: "ğŸ” Lint æª¢æŸ¥"
        working-directory: ${{ matrix.workspace }}
        run: |
          if [ -f "package.json" ] && npm run lint --if-present; then
            echo "âœ… Lint æª¢æŸ¥é€šé"
          else
            echo "âš ï¸ Lint æª¢æŸ¥è·³éæˆ–å¤±æ•—ï¼ˆéé˜»å¡ï¼‰"
          fi
          
      - name: "ğŸ§ª åŸ·è¡Œæ¸¬è©¦"
        working-directory: ${{ matrix.workspace }}
        run: |
          if [ -f "package.json" ] && npm run test --if-present; then
            echo "âœ… æ¸¬è©¦é€šé"
          else
            echo "âš ï¸ æ¸¬è©¦è·³éæˆ–å¤±æ•—ï¼ˆéé˜»å¡ï¼‰"
          fi
          
      - name: "ğŸ—ï¸ æ§‹å»ºé …ç›®"
        working-directory: ${{ matrix.workspace }}
        run: |
          if [ -f "package.json" ] && npm run build --if-present; then
            echo "âœ… æ§‹å»ºæˆåŠŸ"
          else
            echo "âš ï¸ æ§‹å»ºè·³é"
          fi

  # =============================================================================
  # æ•´åˆæ¸¬è©¦
  # =============================================================================
  integration-tests:
    name: "ğŸ”— Integration Tests"
    runs-on: ubuntu-latest
    timeout-minutes: 30
    needs: [tier1-contracts-l1-service, tier2-workspace-services]
    if: always() && needs.tier1-contracts-l1-service.result == 'success'
    
    steps:
      - name: "ğŸ“¥ æª¢å‡ºä»£ç¢¼"
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.2.2

      - name: "âš™ï¸ è¨­ç½® Node.js ç’°å¢ƒ"
        uses: actions/setup-node@49933ea5288caeca8642d1e84afbd3f7d6820020 # v4.4.0
        uses: actions/checkout@0ad4b8f3a27c304e21892351cbf9860471245599

      - name: "âš™ï¸ è¨­ç½® Node.js ç’°å¢ƒ"
        uses: actions/setup-node@1e60f620b9541d16bece96c5465dc8ee9832be0b
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: "âš™ï¸ è¨­ç½® Python ç’°å¢ƒ"
        uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065 # v5
        uses: actions/setup-python@82c7e631bb3cdc910f68e0081d534527d238d7a7
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: "ğŸ“¦ å®‰è£æ ¹ä¾è³´"
        run: |
          echo "ğŸ”§ Installing root dependencies (using npm ci with retries)..."
          attempt=1
          max_attempts=3
          until [ "$attempt" -gt "$max_attempts" ]
          do
            echo "â¡ï¸  npm ci attempt $attempt/$max_attempts..."
            if npm ci --prefer-offline; then
              echo "âœ… npm ci completed successfully on attempt $attempt."
              break
            fi
            if [ "$attempt" -eq "$max_attempts" ]; then
              echo "âŒ npm ci failed after $max_attempts attempts."
              exit 1
            fi
            attempt=$((attempt + 1))
            echo "ğŸ” npm ci failed, retrying in 5 seconds..."
            sleep 5
          done
          
      - name: "ğŸ“¦ å®‰è£æ‰€æœ‰å·¥ä½œå€"
        run: |
          echo "ğŸ”§ Installing all workspaces..."
          npm run install:all || echo "âš ï¸ éƒ¨åˆ†å·¥ä½œå€å®‰è£å¤±æ•—"
          
      - name: "ğŸ”— åŸ·è¡Œæ•´åˆæ¸¬è©¦"
        run: |
          echo "ğŸ”— åŸ·è¡Œæ•´åˆæ¸¬è©¦..."
          
          # æª¢æŸ¥æ˜¯å¦æœ‰æ•´åˆæ¸¬è©¦
          if [ -d "tests/integration" ]; then
            npm run test:integration --if-present || echo "âš ï¸ æ•´åˆæ¸¬è©¦æœªé…ç½®"
          else
            echo "â„¹ï¸ æœªæ‰¾åˆ°æ•´åˆæ¸¬è©¦ç›®éŒ„"
          fi
          
      - name: "ğŸ¥ å¥åº·æª¢æŸ¥"
        run: |
          echo "ğŸ¥ åŸ·è¡Œæœå‹™å¥åº·æª¢æŸ¥..."
          
          # æª¢æŸ¥æ‰€æœ‰å·¥ä½œå€æ˜¯å¦æ­£ç¢ºå®‰è£
          npm list --workspaces --depth=0 || echo "âš ï¸ éƒ¨åˆ†å·¥ä½œå€ä¾è³´å•é¡Œ"
          
      - name: "ğŸ“Š ç”Ÿæˆæ•´åˆå ±å‘Š"
        if: always()
        run: |
          echo "# ğŸ”— Integration Test Report" > integration-report.md
          echo "" >> integration-report.md
          echo "**æ¸¬è©¦æ™‚é–“**: $(date)" >> integration-report.md
          echo "**æäº¤**: ${{ github.sha }}" >> integration-report.md
          echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> integration-report.md
          echo "" >> integration-report.md
          
          echo "## ğŸ“Š å·¥ä½œå€ç‹€æ…‹" >> integration-report.md
          echo "- Tier 1 Contracts L1: ${{ needs.tier1-contracts-l1-service.result }}" >> integration-report.md
          echo "- Tier 2 Workspaces: ${{ needs.tier2-workspace-services.result }}" >> integration-report.md
          echo "" >> integration-report.md
          
          if [ "${{ needs.tier1-contracts-l1-service.result }}" = "success" ]; then
            echo "## âœ… æ•´åˆç‹€æ…‹: é€šé" >> integration-report.md
          else
            echo "## âŒ æ•´åˆç‹€æ…‹: å¤±æ•—" >> integration-report.md
          fi
          
          cat integration-report.md
          
      - name: "ğŸ“¤ ä¸Šå‚³æ•´åˆå ±å‘Š"
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
        uses: actions/upload-artifact@65462800fd760344b1a7b4382951275a0abb4808
        if: always()
        with:
          name: integration-report
          path: integration-report.md
          retention-days: 7

  # =============================================================================
  # éƒ¨ç½²æº–å‚™
  # =============================================================================
  deployment-preparation:
    name: "ğŸš€ Deployment Preparation"
    runs-on: ubuntu-latest
    timeout-minutes: 20
    needs: integration-tests
    if: github.event_name == 'push' && contains(fromJSON('["refs/heads/main", "refs/heads/develop"]'), github.ref)
    
    steps:
      - name: "ğŸ“¥ æª¢å‡ºä»£ç¢¼"
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.2.2

      - name: "ğŸ“¥ ä¸‹è¼‰æ‰€æœ‰æ§‹å»ºç”¢ç‰©"
        uses: actions/download-artifact@fa0a91b85d4f404e444e00e005971372dc801d16 # v4
        uses: actions/checkout@0ad4b8f3a27c304e21892351cbf9860471245599

      - name: "ğŸ“¥ ä¸‹è¼‰æ‰€æœ‰æ§‹å»ºç”¢ç‰©"
        uses: actions/download-artifact@6b208ae046db98c579e8a328f74b955651f427c0
        with:
          pattern: contracts-l1-*
          merge-multiple: true

      - name: "ğŸ” é©—è­‰éƒ¨ç½²æº–å‚™"
        run: |
          echo "ğŸ” é©—è­‰éƒ¨ç½²æº–å‚™ç‹€æ…‹..."
          
          # æª¢æŸ¥å¿…è¦çš„æ§‹å»ºç”¢ç‰©
          if [ -d "dist" ]; then
            echo "âœ… æ§‹å»ºç”¢ç‰©å·²å°±ç·’"
            echo "ğŸ“Š æ–‡ä»¶æ¸…å–®:"
            find dist -type f || true
          else
            echo "âŒ ç¼ºå°‘æ§‹å»ºç”¢ç‰©"
            exit 1
          fi
          
      - name: "ğŸ“Š ç”Ÿæˆéƒ¨ç½²å ±å‘Š"
        run: |
          echo "# ğŸš€ Deployment Preparation Report" > deployment-prep-report.md
          echo "" >> deployment-prep-report.md
          echo "**æº–å‚™æ™‚é–“**: $(date)" >> deployment-prep-report.md
          echo "**æäº¤**: ${{ github.sha }}" >> deployment-prep-report.md
          echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> deployment-prep-report.md
          echo "" >> deployment-prep-report.md
          
          echo "## âœ… éƒ¨ç½²æº–å‚™å®Œæˆ" >> deployment-prep-report.md
          echo "- æ‰€æœ‰æ§‹å»ºç”¢ç‰©å·²æº–å‚™" >> deployment-prep-report.md
          echo "- æ•´åˆæ¸¬è©¦å·²é€šé" >> deployment-prep-report.md
          echo "" >> deployment-prep-report.md
          
          echo "### ğŸ“¦ æ§‹å»ºç”¢ç‰©" >> deployment-prep-report.md
          if [ -d "dist" ]; then
            echo "\`\`\`" >> deployment-prep-report.md
            find dist -type f | head -20 >> deployment-prep-report.md
            echo "\`\`\`" >> deployment-prep-report.md
          fi
          
          cat deployment-prep-report.md
          
      - name: "ğŸ“¤ ä¸Šå‚³éƒ¨ç½²æº–å‚™å ±å‘Š"
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
        uses: actions/upload-artifact@65462800fd760344b1a7b4382951275a0abb4808
        with:
          name: deployment-preparation-report
          path: deployment-prep-report.md
          retention-days: 30

  # =============================================================================
  # æµæ°´ç·šç¸½çµ
  # =============================================================================
  pipeline-summary:
    name: "ğŸ“‹ Pipeline Summary"
    runs-on: ubuntu-latest
    needs: [tier1-contracts-l1-service, tier2-workspace-services, integration-tests]
    if: always()
    
    steps:
      - name: "ğŸ“¥ ä¸‹è¼‰æ‰€æœ‰å ±å‘Š"
        uses: actions/download-artifact@fa0a91b85d4f404e444e00e005971372dc801d16 # v4
        uses: actions/download-artifact@6b208ae046db98c579e8a328f74b955651f427c0
        with:
          pattern: "*-report"
          merge-multiple: true

      - name: "ğŸ“Š ç”Ÿæˆç¸½çµå ±å‘Š"
        run: |
          echo "# ğŸš€ Integration & Deployment Pipeline Summary" > pipeline-summary.md
          echo "" >> pipeline-summary.md
          echo "**åŸ·è¡Œæ™‚é–“**: $(date)" >> pipeline-summary.md
          echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> pipeline-summary.md
          echo "**æäº¤**: ${{ github.sha }}" >> pipeline-summary.md
          echo "**è§¸ç™¼è€…**: ${{ github.actor }}" >> pipeline-summary.md
          echo "" >> pipeline-summary.md
          
          echo "## ğŸ“Š æµæ°´ç·šç‹€æ…‹" >> pipeline-summary.md
          echo "- ğŸ—ï¸ Tier 1 Contracts L1 Service: ${{ needs.tier1-contracts-l1-service.result }}" >> pipeline-summary.md
          echo "- ğŸ”§ Tier 2 Workspace Services: ${{ needs.tier2-workspace-services.result }}" >> pipeline-summary.md
          echo "- ğŸ”— Integration Tests: ${{ needs.integration-tests.result }}" >> pipeline-summary.md
          echo "- ğŸš€ Deployment Preparation: ${{ needs.deployment-preparation.result }}" >> pipeline-summary.md
          echo "" >> pipeline-summary.md
          
          # åˆ¤æ–·æ•´é«”ç‹€æ…‹
          if [ "${{ needs.tier1-contracts-l1-service.result }}" = "success" ] && \
             [ "${{ needs.integration-tests.result }}" = "success" ]; then
            echo "## âœ… æ•´é«”ç‹€æ…‹: é€šé" >> pipeline-summary.md
            echo "ğŸ‰ æ‰€æœ‰é—œéµéšæ®µéƒ½å·²æˆåŠŸå®Œæˆï¼" >> pipeline-summary.md
          else
            echo "## âŒ æ•´é«”ç‹€æ…‹: å¤±æ•—" >> pipeline-summary.md
            echo "âš ï¸ éƒ¨åˆ†éšæ®µå¤±æ•—ï¼Œè«‹æŸ¥çœ‹è©³ç´°å ±å‘Šã€‚" >> pipeline-summary.md
          fi
          
          echo "" >> pipeline-summary.md
          echo "## ğŸ“‹ è©³ç´°å ±å‘Š" >> pipeline-summary.md
          
          # åˆ—å‡ºæ‰€æœ‰å¯ç”¨å ±å‘Š
          if [ -f "contracts-l1-report.md" ]; then
            echo "- [Contracts L1 Service Report](contracts-l1-report.md)" >> pipeline-summary.md
          fi
          
          if [ -f "integration-report.md" ]; then
            echo "- [Integration Test Report](integration-report.md)" >> pipeline-summary.md
          fi
          
          if [ -f "deployment-prep-report.md" ]; then
            echo "- [Deployment Preparation Report](deployment-prep-report.md)" >> pipeline-summary.md
          fi
          
          cat pipeline-summary.md
          
      - name: "ğŸ“¢ è©•è«– PRï¼ˆå¦‚æœå¤±æ•—ï¼‰"
        if: ${{ github.event_name == 'pull_request' && (contains(needs.*.result, 'failure') || contains(needs.*.result, 'cancelled')) }}
        uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v7.0.2
        uses: actions/github-script@60a0d83039c74a4aee543508d2ffcb1c3799cdea
        with:
          script: |
            const fs = require('fs');
            
            if (fs.existsSync('pipeline-summary.md')) {
              const summary = fs.readFileSync('pipeline-summary.md', 'utf8');
              
              await github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: summary
              });
            }
            
      - name: "ğŸ“¤ ä¸Šå‚³ç¸½çµå ±å‘Š"
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4.6.2
        uses: actions/upload-artifact@65462800fd760344b1a7b4382951275a0abb4808
        with:
          name: pipeline-summary
          path: pipeline-summary.md
          retention-days: 30
