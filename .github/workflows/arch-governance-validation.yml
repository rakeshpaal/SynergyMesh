name: Architecture & Governance Validation

on:
  pull_request:
    branches: [main, staging]
    paths:
      - "core/**"
      - "services/**"
      - "apps/**"
      - "automation/**"
      - "governance/**"
      - "config/**"
      - ".github/workflows/**"
  push:
    branches: [main]
    paths:
      - "governance/schemas/**"
      - "unmanned-engineer-ceo/**"
  workflow_dispatch:

# Restrict GITHUB_TOKEN permissions for security
permissions:
  contents: read

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  #                    Êû∂ÊßãÁ©©ÂÆöÊÄßÈ©óË≠â / Architecture Stability Validation
  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  arch-lint:
    name: "üèóÔ∏è Architecture Lint"
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4

      - name: üîß Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: "20"
          cache: "npm"

      - name: üì¶ Install dependencies
        run: npm ci --ignore-scripts || npm install

      - name: üîç Validate module dependencies
        run: |
          echo "üìä Checking module dependency structure..."

          # Check for circular dependencies in TypeScript
          if command -v npx &> /dev/null; then
            npx madge --circular --extensions ts,tsx . || echo "‚ö†Ô∏è madge not available, skipping TS circular check"
          fi

          # Validate workspace structure
          if [ -f "package.json" ]; then
            echo "‚úÖ package.json exists"
            node -e "
              const pkg = require('./package.json');
              if (pkg.workspaces) {
                console.log('üì¶ Workspaces found:', pkg.workspaces);
              }
            "
          fi

      - name: üèõÔ∏è Validate skeleton alignment
        run: |
          echo "üîç Checking architecture skeleton alignment..."

          SKELETON_INDEX="unmanned-engineer-ceo/60-machine-guides/70-architecture-skeletons/skeletons-index.yaml"
          if [ -f "$SKELETON_INDEX" ]; then
            echo "‚úÖ Skeleton index found at $SKELETON_INDEX"
            python3 -c "import yaml; yaml.safe_load(open('$SKELETON_INDEX'))" && echo "‚úÖ Valid YAML"
          else
            echo "‚ö†Ô∏è Skeleton index not found"
          fi

  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  #                    Schema È©óË≠â / Schema Validation
  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  schema-validation:
    name: "üìã Schema Validation"
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4

      - name: üêç Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: üì¶ Install validation tools
        run: |
          pip install pyyaml jsonschema

      - name: üîç Validate YAML files
        run: |
          echo "üìä Validating all YAML configuration files..."

          ERRORS=0
          for file in $(find config -name "*.yaml" -o -name "*.yml" 2>/dev/null); do
            if python3 -c "import yaml; yaml.safe_load(open('$file'))" 2>/dev/null; then
              echo "‚úÖ $file"
            else
              echo "‚ùå $file - Invalid YAML"
              ERRORS=$((ERRORS + 1))
            fi
          done

          if [ $ERRORS -gt 0 ]; then
            echo "‚ùå Found $ERRORS invalid YAML files"
            exit 1
          fi

      - name: üîç Validate governance schemas
        run: |
          echo "üìä Validating governance schema files..."

          for schema in governance/schemas/*.json; do
            if [ -f "$schema" ]; then
              python3 -c "import json; json.load(open('$schema'))" && echo "‚úÖ $schema"
            fi
          done

  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  #                    ÂÆâÂÖ®ËàáÂèØËßÄÊ∏¨ÊÄßÊ∏¨Ë©¶ / Security & Observability Tests
  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  security-observability:
    name: "üîê Security & Observability"
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4

      - name: üîç SLSA Provenance Check
        run: |
          echo "üìä Checking SLSA provenance requirements..."

          if [ -d "core/slsa_provenance" ]; then
            echo "‚úÖ SLSA provenance directory exists"
          else
            echo "‚ö†Ô∏è SLSA provenance directory not found"
          fi

      - name: üîç Security configuration check
        run: |
          echo "üìä Checking security configurations..."

          # Check for hardcoded secrets patterns
          if grep -rn "password\s*=\s*['\"]" --include="*.yaml" --include="*.yml" config/ 2>/dev/null; then
            echo "‚ö†Ô∏è Potential hardcoded password found"
          else
            echo "‚úÖ No hardcoded passwords detected in config"
          fi

          # Check safety mechanisms config
          if [ -f "config/safety-mechanisms.yaml" ]; then
            echo "‚úÖ Safety mechanisms configuration exists"
          fi

      - name: üîç Observability configuration check
        run: |
          echo "üìä Checking observability configurations..."

          # Check monitoring config
          [ -f "config/monitoring.yaml" ] && echo "‚úÖ Monitoring config exists"
          [ -f "config/prometheus-config.yml" ] && echo "‚úÖ Prometheus config exists"
          [ -f "config/grafana-dashboard.json" ] && echo "‚úÖ Grafana dashboard exists"

  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  #                    Ë∫´‰ªΩËàáÁßüÊà∂Ê∏¨Ë©¶ / Identity & Tenancy Tests
  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  identity-tenancy:
    name: "üîë Identity & Tenancy"
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4

      - name: üîç Auth configuration check
        run: |
          echo "üìä Checking identity & tenancy configurations..."

          # Check for auth service
          if [ -d "services/auth-service" ]; then
            echo "‚úÖ Auth service directory exists"
          fi

          # Check AI constitution for identity rules
          if [ -f "config/ai-constitution.yaml" ]; then
            echo "‚úÖ AI Constitution exists"
            python3 -c "import yaml; yaml.safe_load(open('config/ai-constitution.yaml')); print('üìã AI Constitution loaded successfully')"
          fi

  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  #                    Ë≥áÊñôÊ≤ªÁêÜÊ∏¨Ë©¶ / Data Governance Tests
  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  data-governance:
    name: "üìä Data Governance"
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4

      - name: üîç Data schema validation
        run: |
          echo "üìä Checking data governance configurations..."

          # Check for data governance in autonomous module
          if [ -d "automation/autonomous/data-governance" ]; then
            echo "‚úÖ Data governance module exists"
          fi

          # Check for SBOM configurations
          if [ -d "governance/sbom" ]; then
            echo "‚úÖ SBOM governance directory exists"
          fi

      - name: üîç Sensitive data pattern check
        run: |
          echo "üìä Scanning for sensitive data patterns..."

          # Check for PII patterns in code (simplified check)
          SENSITIVE_PATTERNS="ssn|social.?security|credit.?card|api.?key|secret.?key"

          if grep -rniE "$SENSITIVE_PATTERNS" --include="*.ts" --include="*.py" --include="*.go" src/ services/ 2>/dev/null | head -5; then
            echo "‚ö†Ô∏è Potential sensitive data patterns found - please review"
          else
            echo "‚úÖ No obvious sensitive data patterns in source code"
          fi

  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  #                    Êû∂ÊßãÊ≤ªÁêÜÁü©Èô£È©óË≠â / Architecture Governance Matrix Validation
  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  governance-matrix:
    name: "üéØ Governance Matrix Validation"
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v4

      - name: üêç Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: üì¶ Install dependencies
        run: |
          pip install PyYAML

      - name: üîç Validate Architecture Governance Matrix
        run: |
          echo "üéØ Validating Architecture Governance Matrix..."
          make validate-governance-ci

      - name: üìä Check governance completeness
        run: |
          echo "üìä Checking governance matrix completeness..."

          # Count governance dimensions
          LAYERS_COUNT=$(python3 -c "import yaml; d=yaml.safe_load(open('governance/architecture/layers-domains.yaml')); print(len(d.get('layers', {})))" 2>/dev/null || echo "0")
          DOMAINS_COUNT=$(python3 -c "import yaml; d=yaml.safe_load(open('governance/architecture/layers-domains.yaml')); print(len(d.get('domains', {})))" 2>/dev/null || echo "0")
          MODULES_COUNT=$(python3 -c "import yaml; d=yaml.safe_load(open('governance/ownership-map.yaml')); print(len(d.get('modules', {})))" 2>/dev/null || echo "0")
          CONTRACTS_COUNT=$(find governance/behavior-contracts -name "*.yaml" -type f | wc -l)

          echo "üìã Governance Matrix Metrics:"
          echo "  - Layers defined: $LAYERS_COUNT"
          echo "  - Domains defined: $DOMAINS_COUNT"
          echo "  - Modules with ownership: $MODULES_COUNT"
          echo "  - Behavior contracts: $CONTRACTS_COUNT"

          # Check minimum thresholds
          if [ "$LAYERS_COUNT" -lt 5 ]; then
            echo "‚ö†Ô∏è Warning: Less than 5 layers defined"
          fi

          if [ "$MODULES_COUNT" -lt 5 ]; then
            echo "‚ö†Ô∏è Warning: Less than 5 modules have ownership defined"
          fi

  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  #                    Á∂úÂêàÂ†±Âëä / Summary Report
  # ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  summary:
    name: "üìù Governance Summary"
    runs-on: ubuntu-latest
    timeout-minutes: 5
    needs:
      [
        arch-lint,
        schema-validation,
        security-observability,
        identity-tenancy,
        data-governance,
        governance-matrix,
      ]
    if: always()
    steps:
      - name: üìä Generate Summary Report
        run: |
          echo "## üèõÔ∏è Architecture & Governance Validation Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Check | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| üèóÔ∏è Architecture Lint | ${{ needs.arch-lint.result == 'success' && '‚úÖ Passed' || '‚ùå Failed' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| üìã Schema Validation | ${{ needs.schema-validation.result == 'success' && '‚úÖ Passed' || '‚ùå Failed' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| üîê Security & Observability | ${{ needs.security-observability.result == 'success' && '‚úÖ Passed' || '‚ùå Failed' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| üîë Identity & Tenancy | ${{ needs.identity-tenancy.result == 'success' && '‚úÖ Passed' || '‚ùå Failed' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| üìä Data Governance | ${{ needs.data-governance.result == 'success' && '‚úÖ Passed' || '‚ùå Failed' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| üéØ Governance Matrix | ${{ needs.governance-matrix.result == 'success' && '‚úÖ Passed' || '‚ùå Failed' }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "üìö Reference: \`governance/ARCHITECTURE_GOVERNANCE_MATRIX.md\`" >> $GITHUB_STEP_SUMMARY

      - name: ‚úÖ Check overall status
        run: |
          if [[ "${{ needs.arch-lint.result }}" != "success" ]] || \
             [[ "${{ needs.schema-validation.result }}" != "success" ]] || \
             [[ "${{ needs.security-observability.result }}" != "success" ]] || \
             [[ "${{ needs.identity-tenancy.result }}" != "success" ]] || \
             [[ "${{ needs.data-governance.result }}" != "success" ]] || \
             [[ "${{ needs.governance-matrix.result }}" != "success" ]]; then
            echo "‚ùå One or more governance checks failed"
            exit 1
          fi
          echo "‚úÖ All governance checks passed"
