name: aaps-phase1-gates
on:
  pull_request:
    branches: [main, develop]
  push:
    branches: [main, develop]
jobs:
  phase1:
    permissions:
      contents: read
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@0ad4b8f3a27c304e21892351cbf9860471245599
    - name: Setup Python
      uses: actions/setup-python@82c7e631bb3cdc910f68e0081d534527d238d7a7
      with:
        python-version: '3.11'
    - name: Install deps (jsonschema, pyyaml, build)
      run: 'python -m pip install --upgrade pip

        pip install pyyaml jsonschema build

        '
    - name: Gate 1 - Root Schema Gate
      run: 'python tools/root_schema_gate.py

        '
    - name: Gate 2 - Module Graph Gate
      run: 'python tools/module_graph_gate.py

        '
    - name: Gate 3 - Build Recipe Gate (config-manager)
      run: 'python tools/build_module.py config-manager

        '
    - name: Gate 4 - RootFS Assemble Gate
      run: 'python tools/rootfs_assembler.py

        '
    - name: Gate 5 - Evidence Gate (sha3-512 authoritative + sha256 compatibility)
      run: 'python tools/evidence_generator.py

        '
    - name: Upload dist as artifact
      uses: actions/upload-artifact@b7c566a772e6b6bfb58ed0dc250532a479d7789f
      with:
        name: dist
        path: dist/
