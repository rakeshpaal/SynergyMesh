name: ğŸ”’ Security Pipeline
true:
  pull_request:
    branches:
    - main
    - develop
    paths:
    - '**/*.py'
    - '**/*.js'
    - '**/*.ts'
    - '**/*.go'
    - '**/*.java'
    - '**/Dockerfile*'
    - '**/requirements.txt'
    - '**/package.json'
    - '**/go.mod'
    - '**/pom.xml'
  push:
    branches:
    - main
  schedule:
  - cron: 0 2 * * *
  workflow_dispatch: null
permissions:
  actions: read
  contents: read
  pull-requests: write
  security-events: write
env:
  NODE_VERSION: '20'
  PYTHON_VERSION: '3.11'
jobs:
  code-security-analysis:
    name: ğŸ” Code Security Analysis
    runs-on: ubuntu-latest
    steps:
    - name: æª¢å‡ºä»£ç¢¼
      uses: 0ad4b8f3a27c304e21892351cbf9860471245599
      with:
        fetch-depth: 0
    - name: è¨­ç½® ${{ matrix.language }} ç’°å¢ƒ
      uses: ./.github/actions/setup-language
      with:
        language: ${{ matrix.language }}
    - name: é‹è¡Œ CodeQL åˆå§‹åŒ–
      uses: github/codeql-action/init@v3
      with:
        languages: ${{ matrix.language }}
    - name: è‡ªå‹•æ§‹å»º ${{ matrix.language }}
      uses: ./.github/actions/build-language
      with:
        language: ${{ matrix.language }}
    - name: åŸ·è¡Œ CodeQL åˆ†æ
      uses: github/codeql-action/analyze@v3
      with:
        category: /language:${{matrix.language}}
    - name: é‹è¡Œ Semgrep
      uses: semgrep/semgrep-action@v1
      with:
        config: p/security-audit p/owasp-top-ten p/cwe-top-25 p/secrets p/docker-security
        generate-sarif: true
        publish: true
    strategy:
      matrix:
        language: [python, javascript, typescript, go]
    
    steps:
      - name: "æª¢å‡ºä»£ç¢¼"
        uses: 0ad4b8f3a27c304e21892351cbf9860471245599
        with:
          fetch-depth: 0

      - name: "è¨­ç½® ${{ matrix.language }} ç’°å¢ƒ"
        uses: ./.github/actions/setup-language
        with:
          language: ${{ matrix.language }}

      - name: "é‹è¡Œ CodeQL åˆå§‹åŒ–"
        uses: github/codeql-action/init@v3
        with:
          languages: ${{ matrix.language }}

      - name: "è‡ªå‹•æ§‹å»º ${{ matrix.language }}"
        uses: ./.github/actions/build-language
        with:
          language: ${{ matrix.language }}

      - name: "åŸ·è¡Œ CodeQL åˆ†æ"
        uses: github/codeql-action/analyze@v3
        with:
          category: "/language:${{matrix.language}}"

      - name: "é‹è¡Œ Semgrep"
        uses: semgrep/semgrep-action@v1
        with:
          config: >-
            p/security-audit
            p/owasp-top-ten
            p/cwe-top-25
            p/secrets
            p/docker-security
          publish: true
          generate-sarif: true

  # =============================================================================
  # ä¾è³´æ¼æ´æƒæ
  # =============================================================================
  dependency-scan:
    name: "ğŸ“¦ Dependency Vulnerability Scan"
        language:
        - python
        - javascript
        - typescript
        - go
    timeout-minutes: 30
  compliance-check:
    name: ğŸ“‹ Security Compliance Check
    runs-on: ubuntu-latest
    steps:
      - name: "æª¢å‡ºä»£ç¢¼"
        uses: 0ad4b8f3a27c304e21892351cbf9860471245599

      - name: "è¨­ç½® Python ç’°å¢ƒ"
        uses: 82c7e631bb3cdc910f68e0081d534527d238d7a7
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: "è¨­ç½® Node.js ç’°å¢ƒ"
        uses: 1e60f620b9541d16bece96c5465dc8ee9832be0b
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: "å®‰è£æƒæå·¥å…·"
        run: |
          pip install --user safety requirements-parser pip-audit
          npm install -g audit-ci npm-audit-resolver

      - name: "Python ä¾è³´å®‰å…¨æƒæ"
        run: |
          echo "ğŸ” æƒæ Python ä¾è³´æ¼æ´..."
          
          # æŸ¥æ‰¾æ‰€æœ‰ä¾è³´æ–‡ä»¶
          find . -name "requirements*.txt" -o -name "setup.py" -o -name "pyproject.toml" | grep -v node_modules > python-deps.txt
          
          if [ -s python-deps.txt ]; then
            echo "ğŸ“‹ ç™¼ç¾ Python ä¾è³´æ–‡ä»¶:"
            cat python-deps.txt
            
            # ä½¿ç”¨ safety æƒæ
            while IFS= read -r dep_file; do
              if [ -f "$dep_file" ]; then
                echo "ğŸ” æƒææ–‡ä»¶: $dep_file"
                safety check -r "$dep_file" --json --output "safety-$(basename $dep_file).json" || echo "âš ï¸ Safety ç™¼ç¾æ¼æ´"
              fi
            done < python-deps.txt
            
            # ä½¿ç”¨ pip-audit æƒæ
            pip-audit --requirement $(head -1 python-deps.txt) --format json --output pip-audit-results.json || echo "âš ï¸ pip-audit ç™¼ç¾æ¼æ´"
          else
            echo "â„¹ï¸ æœªç™¼ç¾ Python ä¾è³´æ–‡ä»¶"
          fi

      - name: "Node.js ä¾è³´å®‰å…¨æƒæ"
        run: |
          echo "ğŸ” æƒæ Node.js ä¾è³´æ¼æ´..."
          
          # æŸ¥æ‰¾æ‰€æœ‰ package.json
          find . -name "package.json" | grep -v node_modules > nodejs-deps.txt
          
          if [ -s nodejs-deps.txt ]; then
            echo "ğŸ“‹ ç™¼ç¾ Node.js ä¾è³´æ–‡ä»¶:"
            cat nodejs-deps.txt
            
            # æƒææ¯å€‹ package.json
            while IFS= read -r pkg_file; do
              pkg_dir=$(dirname "$pkg_file")
              echo "ğŸ” æƒæç›®éŒ„: $pkg_dir"
              
              cd "$pkg_dir"
              npm audit --audit-level moderate --json > "../npm-audit-$(basename $pkg_dir).json" || echo "âš ï¸ npm audit ç™¼ç¾æ¼æ´"
              cd - > /dev/null
            done < nodejs-deps.txt
          else
            echo "â„¹ï¸ æœªç™¼ç¾ Node.js ä¾è³´æ–‡ä»¶"
          fi

      - name: "Go ä¾è³´å®‰å…¨æƒæ"
        run: |
          echo "ğŸ” æƒæ Go ä¾è³´æ¼æ´..."
          
          # æŸ¥æ‰¾ go.mod æ–‡ä»¶
          find . -name "go.mod" | grep -v vendor > go-deps.txt
          
          if [ -s go-deps.txt ]; then
            echo "ğŸ“‹ ç™¼ç¾ Go ä¾è³´æ–‡ä»¶:"
            cat go-deps.txt
            
            # å®‰è£ govulncheck
            go install golang.org/x/vuln/cmd/govulncheck@latest
            
            while IFS= read -r go_mod; do
              mod_dir=$(dirname "$go_mod")
              echo "ğŸ” æƒææ¨¡å¡Š: $mod_dir"
              
              cd "$mod_dir"
              ~/go/bin/govulncheck ./... > "../go-vuln-$(basename $mod_dir).txt" || echo "âš ï¸ govulncheck ç™¼ç¾æ¼æ´"
              cd - > /dev/null
            done < go-deps.txt
          else
            echo "â„¹ï¸ æœªç™¼ç¾ Go ä¾è³´æ–‡ä»¶"
          fi

      - name: "ç”Ÿæˆä¾è³´æƒæå ±å‘Š"
        run: |
          echo "# ğŸ“¦ Dependency Security Scan Report" > dependency-security-report.md
          echo "" >> dependency-security-report.md
          echo "**æƒææ™‚é–“**: $(date)" >> dependency-security-report.md
          echo "**æäº¤**: ${{ github.sha }}" >> dependency-security-report.md
          echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> dependency-security-report.md
          echo "" >> dependency-security-report.md
          
          echo "## ğŸ” æƒæçµæœæ‘˜è¦" >> dependency-security-report.md
          
          # çµ±è¨ˆå„èªè¨€ä¾è³´æ–‡ä»¶
          PYTHON_DEPS=$(find . -name "requirements*.txt" -o -name "setup.py" -o -name "pyproject.toml" | grep -v node_modules | wc -l)
          NODEJS_DEPS=$(find . -name "package.json" | grep -v node_modules | wc -l)
          GO_DEPS=$(find . -name "go.mod" | grep -v vendor | wc -l)
          
          echo "- Python ä¾è³´æ–‡ä»¶: $PYTHON_DEPS" >> dependency-security-report.md
          echo "- Node.js ä¾è³´æ–‡ä»¶: $NODEJS_DEPS" >> dependency-security-report.md
          echo "- Go ä¾è³´æ–‡ä»¶: $GO_DEPS" >> dependency-security-report.md
          echo "" >> dependency-security-report.md
          
          echo "### ğŸ”’ å®‰å…¨å·¥å…·" >> dependency-security-report.md
          echo "- Python: Safety, pip-audit" >> dependency-security-report.md
          echo "- Node.js: npm audit" >> dependency-security-report.md
          echo "- Go: govulncheck" >> dependency-security-report.md
          
          cat dependency-security-report.md

      - name: "ä¸Šå‚³ä¾è³´æƒæå ±å‘Š"
        uses: 65462800fd760344b1a7b4382951275a0abb4808
        with:
          name: dependency-security-report
          path: |
            dependency-security-report.md
            safety-*.json
            npm-audit-*.json
            pip-audit-results.json
            go-vuln-*.txt
          retention-days: 30

  # =============================================================================
  # å®¹å™¨å®‰å…¨æƒæ
  # =============================================================================
    - name: æª¢å‡ºä»£ç¢¼
      uses: 0ad4b8f3a27c304e21892351cbf9860471245599
    - name: è¨­ç½® Python ç’°å¢ƒ
      uses: 82c7e631bb3cdc910f68e0081d534527d238d7a7
      with:
        python-version: ${{ env.PYTHON_VERSION }}
    - name: å®‰è£åˆè¦æ€§æª¢æŸ¥å·¥å…·
      run: 'pip install --user checkov compliance-as-code

        '
    - name: Checkov IaC å®‰å…¨æƒæ
      run: "echo \"\U0001F50D åŸ·è¡Œ Checkov IaC å®‰å…¨æƒæ...\"\n\n# æƒæ Terraform æ–‡ä»¶\nfind\
        \ . -name \"*.tf\" -type f > terraform-files.txt\nif [ -s terraform-files.txt\
        \ ]; then\n  checkov -d $(dirname $(head -1 terraform-files.txt)) -f $(cat\
        \ terraform-files.txt | tr '\\n' ',') --output json --output-file-path checkov-terraform-results.json\
        \ || echo \"âš ï¸ Checkov ç™¼ç¾ IaC å®‰å…¨å•é¡Œ\"\nfi\n\n# æƒæ Kubernetes æ–‡ä»¶\nfind . -name\
        \ \"*.yaml\" -o -name \"*.yml\" | grep -E \"(k8s|kubernetes)\" > k8s-files.txt\n\
        if [ -s k8s-files.txt ]; then\n  checkov -d $(dirname $(head -1 k8s-files.txt))\
        \ -f $(cat k8s-files.txt | tr '\\n' ',') --framework kubernetes --output json\
        \ --output-file-path checkov-k8s-results.json || echo \"âš ï¸ Checkov ç™¼ç¾ Kubernetes\
        \ å®‰å…¨å•é¡Œ\"\nfi\n\n# æƒæ CloudFormation æ–‡ä»¶\nfind . -name \"*.yaml\" -o -name \"\
        *.yml\" | grep -E \"(cloudformation|cfn)\" > cfn-files.txt\nif [ -s cfn-files.txt\
        \ ]; then\n  checkov -d $(dirname $(head -1 cfn-files.txt)) -f $(cat cfn-files.txt\
        \ | tr '\\n' ',') --framework cloudformation --output json --output-file-path\
        \ checkov-cfn-results.json || echo \"âš ï¸ Checkov ç™¼ç¾ CloudFormation å®‰å…¨å•é¡Œ\"\n\
        fi\n"
    - name: OSCAL åˆè¦æ€§æª¢æŸ¥
      run: "echo \"\U0001F50D åŸ·è¡Œ OSCAL åˆè¦æ€§æª¢æŸ¥...\"\n\n# æª¢æŸ¥æ˜¯å¦æœ‰åˆè¦æ€§é…ç½®æ–‡ä»¶\nif [ -f \"compliance/oscal-catalog.json\"\
        \ ]; then\n  echo \"\U0001F4CB ç™¼ç¾ OSCAL ç›®éŒ„æ–‡ä»¶\"\n  # é€™è£¡å¯ä»¥æ·»åŠ  OSCAL é©—è­‰é‚è¼¯\nelse\n\
        \  echo \"â„¹ï¸ æœªç™¼ç¾ OSCAL åˆè¦æ€§é…ç½®æ–‡ä»¶\"\nfi\n"
    - name: ç”Ÿæˆåˆè¦æ€§å ±å‘Š
      run: 'echo "# ğŸ“‹ Security Compliance Report" > compliance-report.md

        echo "" >> compliance-report.md

        echo "**æª¢æŸ¥æ™‚é–“**: $(date)" >> compliance-report.md

        echo "**æäº¤**: ${{ github.sha }}" >> compliance-commit.md

        echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> compliance-report.md

        echo "" >> compliance-report.md


        echo "## ğŸ” åˆè¦æ€§æª¢æŸ¥çµæœ" >> compliance-report.md

        echo "âœ… åˆè¦æ€§æª¢æŸ¥å·²å®Œæˆ" >> compliance-report.md

        echo "" >> compliance-report.md


        echo "### ğŸ›¡ï¸ æª¢æŸ¥é …ç›®" >> compliance-report.md

        echo "- IaC å®‰å…¨æƒæ (Checkov)" >> compliance-report.md

        echo "- OSCAL åˆè¦æ€§æª¢æŸ¥" >> compliance-report.md

        echo "- å®‰å…¨é…ç½®é©—è­‰" >> compliance-report.md


        # çµ±è¨ˆæª¢æŸ¥çš„æ–‡ä»¶é¡å‹

        TF_FILES=$(find . -name "*.tf" -type f | wc -l)

        K8S_FILES=$(find . -name "*.yaml" -o -name "*.yml" | grep -E "(k8s|kubernetes)"
        | wc -l)

        CFN_FILES=$(find . -name "*.yaml" -o -name "*.yml" | grep -E "(cloudformation|cfn)"
        | wc -l)


        echo "" >> compliance-report.md

        echo "### ğŸ“Š æ–‡ä»¶çµ±è¨ˆ" >> compliance-report.md

        echo "- Terraform æ–‡ä»¶: $TF_FILES" >> compliance-report.md

        echo "- Kubernetes æ–‡ä»¶: $K8S_FILES" >> compliance-report.md

        echo "- CloudFormation æ–‡ä»¶: $CFN_FILES" >> compliance-report.md


        cat compliance-report.md

        '
    - name: ä¸Šå‚³åˆè¦æ€§å ±å‘Š
      uses: 65462800fd760344b1a7b4382951275a0abb4808
      with:
        name: compliance-report
        path: 'compliance-report.md

          checkov-*.json

          '
        retention-days: 30
    timeout-minutes: 20
  container-security:
    if: contains(github.event.head_commit.modified, 'Dockerfile') || github.event_name
      == 'schedule'
    name: ğŸ³ Container Security Scan
    runs-on: ubuntu-latest
    steps:
      - name: "æª¢å‡ºä»£ç¢¼"
        uses: 0ad4b8f3a27c304e21892351cbf9860471245599

      - name: "è¨­ç½® Docker Buildx"
        uses: docker/setup-buildx-action@v3

      - name: "ç™»éŒ„å®¹å™¨è¨»å†Šè¡¨"
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}

      - name: "æ§‹å»ºæ¸¬è©¦é¡åƒ"
        run: |
          echo "ğŸ³ æ§‹å»ºæ¸¬è©¦é¡åƒ..."
          docker build -t test-image:${{ github.sha }} .
          
          # å¦‚æœæœ‰å¤šå€‹ Dockerfileï¼Œæ§‹å»ºæ‰€æœ‰
          for dockerfile in $(find . -name "Dockerfile*" -type f); do
            context_dir=$(dirname "$dockerfile")
            dockerfile_name=$(basename "$dockerfile")
            tag_suffix=$(echo "$dockerfile_name" | sed 's/Dockerfile//' | tr '[:upper:]' '[:lower:]' | sed 's/^/-/')
            
            if [ "$dockerfile_name" = "Dockerfile" ]; then
              docker build -t test-image${tag_suffix}:${{ github.sha }} -f "$dockerfile" "$context_dir"
            else
              docker build -t test-image${tag_suffix}:${{ github.sha }} -f "$dockerfile" "$context_dir"
            fi
          done

      - name: "é‹è¡Œ Trivy æ¼æ´æƒæ"
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: test-image:${{ github.sha }}
          format: 'sarif'
          output: 'trivy-container-results.sarif'
          scan-type: 'image'
          scan-ref: 'test-image:${{ github.sha }}'

      - name: "é‹è¡Œ Grype æ¼æ´æƒæ"
        uses: anchore/scan-action@v4
        with:
          image: test-image:${{ github.sha }}
          format: sarif
          output: grype-container-results.sarif

      - name: "Docker Bench Security æª¢æŸ¥"
        run: |
          echo "ğŸ” åŸ·è¡Œ Docker Bench Security æª¢æŸ¥..."
          
          # å®‰è£ docker-bench-security
          git clone https://github.com/docker/docker-bench-security.git
          cd docker-bench-security
          
          # é‹è¡Œå®‰å…¨æª¢æŸ¥
          sh docker-bench-security.sh -l json > ../docker-bench-results.json || echo "âš ï¸ Docker Bench ç™¼ç¾å®‰å…¨å•é¡Œ"
          
          cd ..
          
          # ç”Ÿæˆå¯è®€å ±å‘Š
          echo "# ğŸ³ Docker Bench Security Report" > docker-bench-report.md
          echo "" >> docker-bench-report.md
          echo "**æª¢æŸ¥æ™‚é–“**: $(date)" >> docker-bench-report.md
          echo "**é¡åƒ**: test-image:${{ github.sha }}" >> docker-bench-report.md
          echo "" >> docker-bench-report.md
          
          if [ -f "docker-bench-results.json" ]; then
            echo "âœ… Docker Bench å®‰å…¨æª¢æŸ¥å®Œæˆ" >> docker-bench-report.md
            echo "ğŸ“‹ è©³ç´°çµæœè«‹æŸ¥çœ‹ JSON æ–‡ä»¶" >> docker-bench-report.md
          else
            echo "âŒ Docker Bench å®‰å…¨æª¢æŸ¥å¤±æ•—" >> docker-bench-report.md
          fi

      - name: "ä¸Šå‚³å®¹å™¨æƒæçµæœ"
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: 'trivy-container-results.sarif'

      - name: "ç”Ÿæˆå®¹å™¨å®‰å…¨å ±å‘Š"
        run: |
          echo "# ğŸ³ Container Security Scan Report" > container-security-report.md
          echo "" >> container-security-report.md
          echo "**æƒææ™‚é–“**: $(date)" >> container-security-report.md
          echo "**é¡åƒ**: test-image:${{ github.sha }}" >> container-security-report.md
          echo "**æäº¤**: ${{ github.sha }}" >> container-security-report.md
          echo "" >> container-security-report.md
          
          echo "## ğŸ” å®¹å™¨å®‰å…¨æƒæçµæœ" >> container-security-report.md
          echo "âœ… å®¹å™¨å®‰å…¨æƒæå·²å®Œæˆ" >> container-security-report.md
          echo "" >> container-security-report.md
          
          echo "### ğŸ›¡ï¸ æƒæå·¥å…·" >> container-security-report.md
          echo "- Trivy: æ¼æ´æƒæ" >> container-security-report.md
          echo "- Grype: æ¼æ´æƒæ" >> container-security-report.md
          echo "- Docker Bench Security: å®‰å…¨é…ç½®æª¢æŸ¥" >> container-security-report.md
          
          cat container-security-report.md

      - name: "ä¸Šå‚³å®¹å™¨å®‰å…¨å ±å‘Š"
        uses: 65462800fd760344b1a7b4382951275a0abb4808
        with:
          name: container-security-report
          path: |
            container-security-report.md
            trivy-container-results.sarif
            grype-container-results.sarif
            docker-bench-results.json
            docker-bench-report.md
          retention-days: 30

  # =============================================================================
  # å¯†é‘°èˆ‡æ•æ„Ÿä¿¡æ¯æƒæ
  # =============================================================================
  secrets-scan:
    name: "ğŸ”‘ Secrets Detection"
    - name: æª¢å‡ºä»£ç¢¼
      uses: 0ad4b8f3a27c304e21892351cbf9860471245599
    - name: è¨­ç½® Docker Buildx
      uses: docker/setup-buildx-action@v3
    - name: ç™»éŒ„å®¹å™¨è¨»å†Šè¡¨
      uses: docker/login-action@v3
      with:
        password: ${{ secrets.GITHUB_TOKEN }}
        registry: ghcr.io
        username: ${{ github.actor }}
    - name: æ§‹å»ºæ¸¬è©¦é¡åƒ
      run: "echo \"\U0001F433 æ§‹å»ºæ¸¬è©¦é¡åƒ...\"\ndocker build -t test-image:${{ github.sha\
        \ }} .\n\n# å¦‚æœæœ‰å¤šå€‹ Dockerfileï¼Œæ§‹å»ºæ‰€æœ‰\nfor dockerfile in $(find . -name \"Dockerfile*\"\
        \ -type f); do\n  context_dir=$(dirname \"$dockerfile\")\n  dockerfile_name=$(basename\
        \ \"$dockerfile\")\n  tag_suffix=$(echo \"$dockerfile_name\" | sed 's/Dockerfile//'\
        \ | tr '[:upper:]' '[:lower:]' | sed 's/^/-/')\n  \n  if [ \"$dockerfile_name\"\
        \ = \"Dockerfile\" ]; then\n    docker build -t test-image${tag_suffix}:${{\
        \ github.sha }} -f \"$dockerfile\" \"$context_dir\"\n  else\n    docker build\
        \ -t test-image${tag_suffix}:${{ github.sha }} -f \"$dockerfile\" \"$context_dir\"\
        \n  fi\ndone\n"
    - name: é‹è¡Œ Trivy æ¼æ´æƒæ
      uses: aquasecurity/trivy-action@master
      with:
        format: sarif
        image-ref: test-image:${{ github.sha }}
        output: trivy-container-results.sarif
        scan-ref: test-image:${{ github.sha }}
        scan-type: image
    - name: é‹è¡Œ Grype æ¼æ´æƒæ
      uses: anchore/scan-action@v4
      with:
        format: sarif
        image: test-image:${{ github.sha }}
        output: grype-container-results.sarif
    - name: Docker Bench Security æª¢æŸ¥
      run: "echo \"\U0001F50D åŸ·è¡Œ Docker Bench Security æª¢æŸ¥...\"\n\n# å®‰è£ docker-bench-security\n\
        git clone https://github.com/docker/docker-bench-security.git\ncd docker-bench-security\n\
        \n# é‹è¡Œå®‰å…¨æª¢æŸ¥\nsh docker-bench-security.sh -l json > ../docker-bench-results.json\
        \ || echo \"âš ï¸ Docker Bench ç™¼ç¾å®‰å…¨å•é¡Œ\"\n\ncd ..\n\n# ç”Ÿæˆå¯è®€å ±å‘Š\necho \"# \U0001F433\
        \ Docker Bench Security Report\" > docker-bench-report.md\necho \"\" >> docker-bench-report.md\n\
        echo \"**æª¢æŸ¥æ™‚é–“**: $(date)\" >> docker-bench-report.md\necho \"**é¡åƒ**: test-image:${{\
        \ github.sha }}\" >> docker-bench-report.md\necho \"\" >> docker-bench-report.md\n\
        \nif [ -f \"docker-bench-results.json\" ]; then\n  echo \"âœ… Docker Bench å®‰å…¨æª¢æŸ¥å®Œæˆ\"\
        \ >> docker-bench-report.md\n  echo \"\U0001F4CB è©³ç´°çµæœè«‹æŸ¥çœ‹ JSON æ–‡ä»¶\" >> docker-bench-report.md\n\
        else\n  echo \"âŒ Docker Bench å®‰å…¨æª¢æŸ¥å¤±æ•—\" >> docker-bench-report.md\nfi\n"
    - name: ä¸Šå‚³å®¹å™¨æƒæçµæœ
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: trivy-container-results.sarif
    - name: ç”Ÿæˆå®¹å™¨å®‰å…¨å ±å‘Š
      run: 'echo "# ğŸ³ Container Security Scan Report" > container-security-report.md

        echo "" >> container-security-report.md

        echo "**æƒææ™‚é–“**: $(date)" >> container-security-report.md

        echo "**é¡åƒ**: test-image:${{ github.sha }}" >> container-security-report.md

        echo "**æäº¤**: ${{ github.sha }}" >> container-security-report.md

        echo "" >> container-security-report.md


        echo "## ğŸ” å®¹å™¨å®‰å…¨æƒæçµæœ" >> container-security-report.md

        echo "âœ… å®¹å™¨å®‰å…¨æƒæå·²å®Œæˆ" >> container-security-report.md

        echo "" >> container-security-report.md


        echo "### ğŸ›¡ï¸ æƒæå·¥å…·" >> container-security-report.md

        echo "- Trivy: æ¼æ´æƒæ" >> container-security-report.md

        echo "- Grype: æ¼æ´æƒæ" >> container-security-report.md

        echo "- Docker Bench Security: å®‰å…¨é…ç½®æª¢æŸ¥" >> container-security-report.md


        cat container-security-report.md

        '
    - name: ä¸Šå‚³å®¹å™¨å®‰å…¨å ±å‘Š
      uses: 65462800fd760344b1a7b4382951275a0abb4808
      with:
        name: container-security-report
        path: 'container-security-report.md

          trivy-container-results.sarif

          grype-container-results.sarif

          docker-bench-results.json

          docker-bench-report.md

          '
        retention-days: 30
    timeout-minutes: 20
  dependency-scan:
    name: ğŸ“¦ Dependency Vulnerability Scan
    runs-on: ubuntu-latest
    steps:
      - name: "æª¢å‡ºä»£ç¢¼"
        uses: 0ad4b8f3a27c304e21892351cbf9860471245599
        with:
          fetch-depth: 0

      - name: "é‹è¡Œ Gitleaks"
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          report-format: sarif
          output: gitleaks-results.sarif

      - name: "é‹è¡Œ TruffleHog"
        uses: trufflesecurity/trufflehog@main
        with:
          path: ./
          base: main
          head: HEAD
          extra_args: --debug --json
          output: trufflehog-results.json

      - name: "é‹è¡Œ GitGuardian"
        uses: GitGuardian/ggshield-action@v1
        env:
          GGUARDIAN_API_KEY: ${{ secrets.GITGUARDIAN_API_KEY }}
        with:
          args: -v

      - name: "ç”Ÿæˆå¯†é‘°æƒæå ±å‘Š"
        run: |
          echo "# ğŸ”‘ Secrets Detection Report" > secrets-scan-report.md
          echo "" >> secrets-scan-report.md
          echo "**æƒææ™‚é–“**: $(date)" >> secrets-scan-report.md
          echo "**æäº¤**: ${{ github.sha }}" >> secrets-scan-report.md
          echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> secrets-scan-report.md
          echo "" >> secrets-scan-report.md
          
          echo "## ğŸ” å¯†é‘°æƒæçµæœ" >> secrets-scan-report.md
          echo "âœ… å¯†é‘°æƒæå·²å®Œæˆ" >> secrets-scan-report.md
          echo "" >> secrets-scan-report.md
          
          echo "### ğŸ›¡ï¸ æƒæå·¥å…·" >> secrets-scan-report.md
          echo "- Gitleaks: Git æ­·å²å¯†é‘°æƒæ" >> secrets-scan-report.md
          echo "- TruffleHog: æ·±åº¦å¯†é‘°æƒæ" >> secrets-scan-report.md
          echo "- GitGuardian: åœ¨ç·šå¯†é‘°æª¢æ¸¬" >> secrets-scan-report.md
          
          cat secrets-scan-report.md

      - name: "ä¸Šå‚³ Gitleaks çµæœ"
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: 'gitleaks-results.sarif'

      - name: "ä¸Šå‚³å¯†é‘°æƒæå ±å‘Š"
        uses: 65462800fd760344b1a7b4382951275a0abb4808
        with:
          name: secrets-scan-report
          path: |
            secrets-scan-report.md
            gitleaks-results.sarif
            trufflehog-results.json
          retention-days: 30

  # =============================================================================
  # å®‰å…¨åˆè¦æ€§æª¢æŸ¥
  # =============================================================================
  compliance-check:
    name: "ğŸ“‹ Security Compliance Check"
    - name: æª¢å‡ºä»£ç¢¼
      uses: 0ad4b8f3a27c304e21892351cbf9860471245599
    - name: è¨­ç½® Python ç’°å¢ƒ
      uses: 82c7e631bb3cdc910f68e0081d534527d238d7a7
      with:
        python-version: ${{ env.PYTHON_VERSION }}
    - name: è¨­ç½® Node.js ç’°å¢ƒ
      uses: 1e60f620b9541d16bece96c5465dc8ee9832be0b
      with:
        node-version: ${{ env.NODE_VERSION }}
    - name: å®‰è£æƒæå·¥å…·
      run: 'pip install --user safety requirements-parser pip-audit

        npm install -g audit-ci npm-audit-resolver

        '
    - name: Python ä¾è³´å®‰å…¨æƒæ
      run: "echo \"\U0001F50D æƒæ Python ä¾è³´æ¼æ´...\"\n\n# æŸ¥æ‰¾æ‰€æœ‰ä¾è³´æ–‡ä»¶\nfind . -name \"requirements*.txt\"\
        \ -o -name \"setup.py\" -o -name \"pyproject.toml\" | grep -v node_modules\
        \ > python-deps.txt\n\nif [ -s python-deps.txt ]; then\n  echo \"\U0001F4CB\
        \ ç™¼ç¾ Python ä¾è³´æ–‡ä»¶:\"\n  cat python-deps.txt\n  \n  # ä½¿ç”¨ safety æƒæ\n  while\
        \ IFS= read -r dep_file; do\n    if [ -f \"$dep_file\" ]; then\n      echo\
        \ \"\U0001F50D æƒææ–‡ä»¶: $dep_file\"\n      safety check -r \"$dep_file\" --json\
        \ --output \"safety-$(basename $dep_file).json\" || echo \"âš ï¸ Safety ç™¼ç¾æ¼æ´\"\
        \n    fi\n  done < python-deps.txt\n  \n  # ä½¿ç”¨ pip-audit æƒæ\n  pip-audit --requirement\
        \ $(head -1 python-deps.txt) --format json --output pip-audit-results.json\
        \ || echo \"âš ï¸ pip-audit ç™¼ç¾æ¼æ´\"\nelse\n  echo \"â„¹ï¸ æœªç™¼ç¾ Python ä¾è³´æ–‡ä»¶\"\nfi\n"
    - name: Node.js ä¾è³´å®‰å…¨æƒæ
      run: "echo \"\U0001F50D æƒæ Node.js ä¾è³´æ¼æ´...\"\n\n# æŸ¥æ‰¾æ‰€æœ‰ package.json\nfind .\
        \ -name \"package.json\" | grep -v node_modules > nodejs-deps.txt\n\nif [\
        \ -s nodejs-deps.txt ]; then\n  echo \"\U0001F4CB ç™¼ç¾ Node.js ä¾è³´æ–‡ä»¶:\"\n  cat\
        \ nodejs-deps.txt\n  \n  # æƒææ¯å€‹ package.json\n  while IFS= read -r pkg_file;\
        \ do\n    pkg_dir=$(dirname \"$pkg_file\")\n    echo \"\U0001F50D æƒæç›®éŒ„: $pkg_dir\"\
        \n    \n    cd \"$pkg_dir\"\n    npm audit --audit-level moderate --json >\
        \ \"../npm-audit-$(basename $pkg_dir).json\" || echo \"âš ï¸ npm audit ç™¼ç¾æ¼æ´\"\
        \n    cd - > /dev/null\n  done < nodejs-deps.txt\nelse\n  echo \"â„¹ï¸ æœªç™¼ç¾ Node.js\
        \ ä¾è³´æ–‡ä»¶\"\nfi\n"
    - name: Go ä¾è³´å®‰å…¨æƒæ
      run: "echo \"\U0001F50D æƒæ Go ä¾è³´æ¼æ´...\"\n\n# æŸ¥æ‰¾ go.mod æ–‡ä»¶\nfind . -name \"go.mod\"\
        \ | grep -v vendor > go-deps.txt\n\nif [ -s go-deps.txt ]; then\n  echo \"\
        \U0001F4CB ç™¼ç¾ Go ä¾è³´æ–‡ä»¶:\"\n  cat go-deps.txt\n  \n  # å®‰è£ govulncheck\n  go\
        \ install golang.org/x/vuln/cmd/govulncheck@latest\n  \n  while IFS= read\
        \ -r go_mod; do\n    mod_dir=$(dirname \"$go_mod\")\n    echo \"\U0001F50D\
        \ æƒææ¨¡å¡Š: $mod_dir\"\n    \n    cd \"$mod_dir\"\n    ~/go/bin/govulncheck ./...\
        \ > \"../go-vuln-$(basename $mod_dir).txt\" || echo \"âš ï¸ govulncheck ç™¼ç¾æ¼æ´\"\
        \n    cd - > /dev/null\n  done < go-deps.txt\nelse\n  echo \"â„¹ï¸ æœªç™¼ç¾ Go ä¾è³´æ–‡ä»¶\"\
        \nfi\n"
    - name: ç”Ÿæˆä¾è³´æƒæå ±å‘Š
      run: 'echo "# ğŸ“¦ Dependency Security Scan Report" > dependency-security-report.md

        echo "" >> dependency-security-report.md

        echo "**æƒææ™‚é–“**: $(date)" >> dependency-security-report.md

        echo "**æäº¤**: ${{ github.sha }}" >> dependency-security-report.md

        echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> dependency-security-report.md

        echo "" >> dependency-security-report.md


        echo "## ğŸ” æƒæçµæœæ‘˜è¦" >> dependency-security-report.md


        # çµ±è¨ˆå„èªè¨€ä¾è³´æ–‡ä»¶

        PYTHON_DEPS=$(find . -name "requirements*.txt" -o -name "setup.py" -o -name
        "pyproject.toml" | grep -v node_modules | wc -l)

        NODEJS_DEPS=$(find . -name "package.json" | grep -v node_modules | wc -l)

        GO_DEPS=$(find . -name "go.mod" | grep -v vendor | wc -l)


        echo "- Python ä¾è³´æ–‡ä»¶: $PYTHON_DEPS" >> dependency-security-report.md

        echo "- Node.js ä¾è³´æ–‡ä»¶: $NODEJS_DEPS" >> dependency-security-report.md

        echo "- Go ä¾è³´æ–‡ä»¶: $GO_DEPS" >> dependency-security-report.md

        echo "" >> dependency-security-report.md


        echo "### ğŸ”’ å®‰å…¨å·¥å…·" >> dependency-security-report.md

        echo "- Python: Safety, pip-audit" >> dependency-security-report.md

        echo "- Node.js: npm audit" >> dependency-security-report.md

        echo "- Go: govulncheck" >> dependency-security-report.md


        cat dependency-security-report.md

        '
    - name: ä¸Šå‚³ä¾è³´æƒæå ±å‘Š
      uses: 65462800fd760344b1a7b4382951275a0abb4808
      with:
        name: dependency-security-report
        path: 'dependency-security-report.md

          safety-*.json

          npm-audit-*.json

          pip-audit-results.json

          go-vuln-*.txt

          '
        retention-days: 30
    timeout-minutes: 25
  secrets-scan:
    name: ğŸ”‘ Secrets Detection
    runs-on: ubuntu-latest
    steps:
      - name: "æª¢å‡ºä»£ç¢¼"
        uses: 0ad4b8f3a27c304e21892351cbf9860471245599

      - name: "è¨­ç½® Python ç’°å¢ƒ"
        uses: 82c7e631bb3cdc910f68e0081d534527d238d7a7
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: "å®‰è£åˆè¦æ€§æª¢æŸ¥å·¥å…·"
        run: |
          pip install --user checkov compliance-as-code

      - name: "Checkov IaC å®‰å…¨æƒæ"
        run: |
          echo "ğŸ” åŸ·è¡Œ Checkov IaC å®‰å…¨æƒæ..."
          
          # æƒæ Terraform æ–‡ä»¶
          find . -name "*.tf" -type f > terraform-files.txt
          if [ -s terraform-files.txt ]; then
            checkov -d $(dirname $(head -1 terraform-files.txt)) -f $(cat terraform-files.txt | tr '\n' ',') --output json --output-file-path checkov-terraform-results.json || echo "âš ï¸ Checkov ç™¼ç¾ IaC å®‰å…¨å•é¡Œ"
          fi
          
          # æƒæ Kubernetes æ–‡ä»¶
          find . -name "*.yaml" -o -name "*.yml" | grep -E "(k8s|kubernetes)" > k8s-files.txt
          if [ -s k8s-files.txt ]; then
            checkov -d $(dirname $(head -1 k8s-files.txt)) -f $(cat k8s-files.txt | tr '\n' ',') --framework kubernetes --output json --output-file-path checkov-k8s-results.json || echo "âš ï¸ Checkov ç™¼ç¾ Kubernetes å®‰å…¨å•é¡Œ"
          fi
          
          # æƒæ CloudFormation æ–‡ä»¶
          find . -name "*.yaml" -o -name "*.yml" | grep -E "(cloudformation|cfn)" > cfn-files.txt
          if [ -s cfn-files.txt ]; then
            checkov -d $(dirname $(head -1 cfn-files.txt)) -f $(cat cfn-files.txt | tr '\n' ',') --framework cloudformation --output json --output-file-path checkov-cfn-results.json || echo "âš ï¸ Checkov ç™¼ç¾ CloudFormation å®‰å…¨å•é¡Œ"
          fi

      - name: "OSCAL åˆè¦æ€§æª¢æŸ¥"
        run: |
          echo "ğŸ” åŸ·è¡Œ OSCAL åˆè¦æ€§æª¢æŸ¥..."
          
          # æª¢æŸ¥æ˜¯å¦æœ‰åˆè¦æ€§é…ç½®æ–‡ä»¶
          if [ -f "compliance/oscal-catalog.json" ]; then
            echo "ğŸ“‹ ç™¼ç¾ OSCAL ç›®éŒ„æ–‡ä»¶"
            # é€™è£¡å¯ä»¥æ·»åŠ  OSCAL é©—è­‰é‚è¼¯
          else
            echo "â„¹ï¸ æœªç™¼ç¾ OSCAL åˆè¦æ€§é…ç½®æ–‡ä»¶"
          fi

      - name: "ç”Ÿæˆåˆè¦æ€§å ±å‘Š"
        run: |
          echo "# ğŸ“‹ Security Compliance Report" > compliance-report.md
          echo "" >> compliance-report.md
          echo "**æª¢æŸ¥æ™‚é–“**: $(date)" >> compliance-report.md
          echo "**æäº¤**: ${{ github.sha }}" >> compliance-commit.md
          echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> compliance-report.md
          echo "" >> compliance-report.md
          
          echo "## ğŸ” åˆè¦æ€§æª¢æŸ¥çµæœ" >> compliance-report.md
          echo "âœ… åˆè¦æ€§æª¢æŸ¥å·²å®Œæˆ" >> compliance-report.md
          echo "" >> compliance-report.md
          
          echo "### ğŸ›¡ï¸ æª¢æŸ¥é …ç›®" >> compliance-report.md
          echo "- IaC å®‰å…¨æƒæ (Checkov)" >> compliance-report.md
          echo "- OSCAL åˆè¦æ€§æª¢æŸ¥" >> compliance-report.md
          echo "- å®‰å…¨é…ç½®é©—è­‰" >> compliance-report.md
          
          # çµ±è¨ˆæª¢æŸ¥çš„æ–‡ä»¶é¡å‹
          TF_FILES=$(find . -name "*.tf" -type f | wc -l)
          K8S_FILES=$(find . -name "*.yaml" -o -name "*.yml" | grep -E "(k8s|kubernetes)" | wc -l)
          CFN_FILES=$(find . -name "*.yaml" -o -name "*.yml" | grep -E "(cloudformation|cfn)" | wc -l)
          
          echo "" >> compliance-report.md
          echo "### ğŸ“Š æ–‡ä»¶çµ±è¨ˆ" >> compliance-report.md
          echo "- Terraform æ–‡ä»¶: $TF_FILES" >> compliance-report.md
          echo "- Kubernetes æ–‡ä»¶: $K8S_FILES" >> compliance-report.md
          echo "- CloudFormation æ–‡ä»¶: $CFN_FILES" >> compliance-report.md
          
          cat compliance-report.md

      - name: "ä¸Šå‚³åˆè¦æ€§å ±å‘Š"
        uses: 65462800fd760344b1a7b4382951275a0abb4808
        with:
          name: compliance-report
          path: |
            compliance-report.md
            checkov-*.json
          retention-days: 30

  # =============================================================================
  # å®‰å…¨ç¸½çµå ±å‘Š
  # =============================================================================
    - name: æª¢å‡ºä»£ç¢¼
      uses: 0ad4b8f3a27c304e21892351cbf9860471245599
      with:
        fetch-depth: 0
    - env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      name: é‹è¡Œ Gitleaks
      uses: gitleaks/gitleaks-action@v2
      with:
        output: gitleaks-results.sarif
        report-format: sarif
    - name: é‹è¡Œ TruffleHog
      uses: trufflesecurity/trufflehog@main
      with:
        base: main
        extra_args: --debug --json
        head: HEAD
        output: trufflehog-results.json
        path: ./
    - env:
        GGUARDIAN_API_KEY: ${{ secrets.GITGUARDIAN_API_KEY }}
      name: é‹è¡Œ GitGuardian
      uses: GitGuardian/ggshield-action@v1
      with:
        args: -v
    - name: ç”Ÿæˆå¯†é‘°æƒæå ±å‘Š
      run: 'echo "# ğŸ”‘ Secrets Detection Report" > secrets-scan-report.md

        echo "" >> secrets-scan-report.md

        echo "**æƒææ™‚é–“**: $(date)" >> secrets-scan-report.md

        echo "**æäº¤**: ${{ github.sha }}" >> secrets-scan-report.md

        echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> secrets-scan-report.md

        echo "" >> secrets-scan-report.md


        echo "## ğŸ” å¯†é‘°æƒæçµæœ" >> secrets-scan-report.md

        echo "âœ… å¯†é‘°æƒæå·²å®Œæˆ" >> secrets-scan-report.md

        echo "" >> secrets-scan-report.md


        echo "### ğŸ›¡ï¸ æƒæå·¥å…·" >> secrets-scan-report.md

        echo "- Gitleaks: Git æ­·å²å¯†é‘°æƒæ" >> secrets-scan-report.md

        echo "- TruffleHog: æ·±åº¦å¯†é‘°æƒæ" >> secrets-scan-report.md

        echo "- GitGuardian: åœ¨ç·šå¯†é‘°æª¢æ¸¬" >> secrets-scan-report.md


        cat secrets-scan-report.md

        '
    - name: ä¸Šå‚³ Gitleaks çµæœ
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: gitleaks-results.sarif
    - name: ä¸Šå‚³å¯†é‘°æƒæå ±å‘Š
      uses: 65462800fd760344b1a7b4382951275a0abb4808
      with:
        name: secrets-scan-report
        path: 'secrets-scan-report.md

          gitleaks-results.sarif

          trufflehog-results.json

          '
        retention-days: 30
    timeout-minutes: 15
  security-summary:
    if: always()
    name: ğŸ“‹ Security Summary Report
    needs:
    - code-security-analysis
    - dependency-scan
    - container-security
    - secrets-scan
    - compliance-check
    runs-on: ubuntu-latest
    steps:
      - name: "ä¸‹è¼‰æ‰€æœ‰å®‰å…¨å ±å‘Š"
        uses: 6b208ae046db98c579e8a328f74b955651f427c0
        with:
          merge-multiple: true

      - name: "ç”Ÿæˆå®‰å…¨ç¸½çµå ±å‘Š"
        run: |
          echo "# ğŸ”’ Security Pipeline Summary Report" > security-summary-report.md
          echo "" >> security-summary-report.md
          echo "**ç”Ÿæˆæ™‚é–“**: $(date)" >> security-summary-report.md
          echo "**åˆ†æ”¯**: ${{ github.ref_name }}" >> security-summary-report.md
          echo "**æäº¤**: ${{ github.sha }}" >> security-summary-report.md
          echo "**è§¸ç™¼äº‹ä»¶**: ${{ github.event_name }}" >> security-summary-report.md
          echo "" >> security-summary-report.md
          
          echo "## ğŸ“Š å®‰å…¨æƒæç‹€æ…‹" >> security-summary-report.md
          echo "- ğŸ” ä»£ç¢¼å®‰å…¨åˆ†æ: ${{ needs.code-security-analysis.result }}" >> security-summary-report.md
          echo "- ğŸ“¦ ä¾è³´æ¼æ´æƒæ: ${{ needs.dependency-scan.result }}" >> security-summary-report.md
          echo "- ğŸ³ å®¹å™¨å®‰å…¨æƒæ: ${{ needs.container-security.result }}" >> security-summary-report.md
          echo "- ğŸ”‘ å¯†é‘°æª¢æ¸¬: ${{ needs.secrets-scan.result }}" >> security-summary-report.md
          echo "- ğŸ“‹ åˆè¦æ€§æª¢æŸ¥: ${{ needs.compliance-check.result }}" >> security-summary-report.md
          echo "" >> security-summary-report.md
          
          # åˆ¤æ–·æ•´é«”å®‰å…¨ç‹€æ…‹
          FAILED_JOBS=0
          if [ "${{ needs.code-security-analysis.result }}" != "success" ]; then FAILED_JOBS=$((FAILED_JOBS + 1)); fi
          if [ "${{ needs.dependency-scan.result }}" != "success" ]; then FAILED_JOBS=$((FAILED_JOBS + 1)); fi
          if [ "${{ needs.container-security.result }}" != "success" ] && [ "${{ needs.container-security.result }}" != "skipped" ]; then FAILED_JOBS=$((FAILED_JOBS + 1)); fi
          if [ "${{ needs.secrets-scan.result }}" != "success" ]; then FAILED_JOBS=$((FAILED_JOBS + 1)); fi
          if [ "${{ needs.compliance-check.result }}" != "success" ]; then FAILED_JOBS=$((FAILED_JOBS + 1)); fi
          
          if [ $FAILED_JOBS -eq 0 ]; then
            echo "## âœ… æ•´é«”å®‰å…¨ç‹€æ…‹: é€šé" >> security-summary-report.md
            echo "ğŸ‰ æ‰€æœ‰å®‰å…¨æª¢æŸ¥éƒ½å·²é€šéï¼" >> security-summary-report.md
          else
            echo "## âš ï¸ æ•´é«”å®‰å…¨ç‹€æ…‹: éœ€è¦é—œæ³¨" >> security-summary-report.md
            echo "âŒ $FAILED_JOBS å€‹å®‰å…¨æª¢æŸ¥å¤±æ•—ï¼Œè«‹æŸ¥çœ‹è©³ç´°å ±å‘Šã€‚" >> security-summary-report.md
          fi
          
          echo "" >> security-summary-report.md
          echo "## ğŸ“‹ è©³ç´°å ±å‘Š" >> security-summary-report.md
          echo "- [ä»£ç¢¼å®‰å…¨åˆ†æå ±å‘Š](#)" >> security-summary-report.md
          echo "- [ä¾è³´æ¼æ´æƒæå ±å‘Š](dependency-security-report.md)" >> security-summary-report.md
          echo "- [å®¹å™¨å®‰å…¨æƒæå ±å‘Š](container-security-report.md)" >> security-summary-report.md
          echo "- [å¯†é‘°æª¢æ¸¬å ±å‘Š](secrets-scan-report.md)" >> security-summary-report.md
          echo "- [åˆè¦æ€§æª¢æŸ¥å ±å‘Š](compliance-report.md)" >> security-summary-report.md
          
          cat security-summary-report.md

      - name: "è©•è«–PRï¼ˆå¦‚æœç™¼ç¾å®‰å…¨å•é¡Œï¼‰"
        if: failure() && github.event_name == 'pull_request'
        uses: 60a0d83039c74a4aee543508d2ffcb1c3799cdea
        with:
          script: |
            const fs = require('fs');
            
            if (fs.existsSync('security-summary-report.md')) {
              const report = fs.readFileSync('security-summary-report.md', 'utf8');
              
              github.rest.issues.createComment({
                issue_number: context.issue.number,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: report
              });
            }

      - name: "ä¸Šå‚³å®‰å…¨ç¸½çµå ±å‘Š"
        uses: 65462800fd760344b1a7b4382951275a0abb4808
        with:
          name: security-summary-report
          path: security-summary-report.md
          retention-days: 30
    - name: ä¸‹è¼‰æ‰€æœ‰å®‰å…¨å ±å‘Š
      uses: 6b208ae046db98c579e8a328f74b955651f427c0
      with:
        merge-multiple: true
    - name: ç”Ÿæˆå®‰å…¨ç¸½çµå ±å‘Š
      run: "echo \"# \U0001F512 Security Pipeline Summary Report\" > security-summary-report.md\n\
        echo \"\" >> security-summary-report.md\necho \"**ç”Ÿæˆæ™‚é–“**: $(date)\" >> security-summary-report.md\n\
        echo \"**åˆ†æ”¯**: ${{ github.ref_name }}\" >> security-summary-report.md\necho\
        \ \"**æäº¤**: ${{ github.sha }}\" >> security-summary-report.md\necho \"**è§¸ç™¼äº‹ä»¶**:\
        \ ${{ github.event_name }}\" >> security-summary-report.md\necho \"\" >> security-summary-report.md\n\
        \necho \"## \U0001F4CA å®‰å…¨æƒæç‹€æ…‹\" >> security-summary-report.md\necho \"- \U0001F50D\
        \ ä»£ç¢¼å®‰å…¨åˆ†æ: ${{ needs.code-security-analysis.result }}\" >> security-summary-report.md\n\
        echo \"- \U0001F4E6 ä¾è³´æ¼æ´æƒæ: ${{ needs.dependency-scan.result }}\" >> security-summary-report.md\n\
        echo \"- \U0001F433 å®¹å™¨å®‰å…¨æƒæ: ${{ needs.container-security.result }}\" >> security-summary-report.md\n\
        echo \"- \U0001F511 å¯†é‘°æª¢æ¸¬: ${{ needs.secrets-scan.result }}\" >> security-summary-report.md\n\
        echo \"- \U0001F4CB åˆè¦æ€§æª¢æŸ¥: ${{ needs.compliance-check.result }}\" >> security-summary-report.md\n\
        echo \"\" >> security-summary-report.md\n\n# åˆ¤æ–·æ•´é«”å®‰å…¨ç‹€æ…‹\nFAILED_JOBS=0\nif [\
        \ \"${{ needs.code-security-analysis.result }}\" != \"success\" ]; then FAILED_JOBS=$((FAILED_JOBS\
        \ + 1)); fi\nif [ \"${{ needs.dependency-scan.result }}\" != \"success\" ];\
        \ then FAILED_JOBS=$((FAILED_JOBS + 1)); fi\nif [ \"${{ needs.container-security.result\
        \ }}\" != \"success\" ] && [ \"${{ needs.container-security.result }}\" !=\
        \ \"skipped\" ]; then FAILED_JOBS=$((FAILED_JOBS + 1)); fi\nif [ \"${{ needs.secrets-scan.result\
        \ }}\" != \"success\" ]; then FAILED_JOBS=$((FAILED_JOBS + 1)); fi\nif [ \"\
        ${{ needs.compliance-check.result }}\" != \"success\" ]; then FAILED_JOBS=$((FAILED_JOBS\
        \ + 1)); fi\n\nif [ $FAILED_JOBS -eq 0 ]; then\n  echo \"## âœ… æ•´é«”å®‰å…¨ç‹€æ…‹: é€šé\"\
        \ >> security-summary-report.md\n  echo \"\U0001F389 æ‰€æœ‰å®‰å…¨æª¢æŸ¥éƒ½å·²é€šéï¼\" >> security-summary-report.md\n\
        else\n  echo \"## âš ï¸ æ•´é«”å®‰å…¨ç‹€æ…‹: éœ€è¦é—œæ³¨\" >> security-summary-report.md\n  echo\
        \ \"âŒ $FAILED_JOBS å€‹å®‰å…¨æª¢æŸ¥å¤±æ•—ï¼Œè«‹æŸ¥çœ‹è©³ç´°å ±å‘Šã€‚\" >> security-summary-report.md\nfi\n\n\
        echo \"\" >> security-summary-report.md\necho \"## \U0001F4CB è©³ç´°å ±å‘Š\" >> security-summary-report.md\n\
        echo \"- [ä»£ç¢¼å®‰å…¨åˆ†æå ±å‘Š](#)\" >> security-summary-report.md\necho \"- [ä¾è³´æ¼æ´æƒæå ±å‘Š](dependency-security-report.md)\"\
        \ >> security-summary-report.md\necho \"- [å®¹å™¨å®‰å…¨æƒæå ±å‘Š](container-security-report.md)\"\
        \ >> security-summary-report.md\necho \"- [å¯†é‘°æª¢æ¸¬å ±å‘Š](secrets-scan-report.md)\"\
        \ >> security-summary-report.md\necho \"- [åˆè¦æ€§æª¢æŸ¥å ±å‘Š](compliance-report.md)\"\
        \ >> security-summary-report.md\n\ncat security-summary-report.md\n"
    - if: failure() && github.event_name == 'pull_request'
      name: è©•è«–PRï¼ˆå¦‚æœç™¼ç¾å®‰å…¨å•é¡Œï¼‰
      uses: 60a0d83039c74a4aee543508d2ffcb1c3799cdea
      with:
        script: "const fs = require('fs');\n\nif (fs.existsSync('security-summary-report.md'))\
          \ {\n  const report = fs.readFileSync('security-summary-report.md', 'utf8');\n\
          \  \n  github.rest.issues.createComment({\n    issue_number: context.issue.number,\n\
          \    owner: context.repo.owner,\n    repo: context.repo.repo,\n    body:\
          \ report\n  });\n}\n"
    - name: ä¸Šå‚³å®‰å…¨ç¸½çµå ±å‘Š
      uses: 65462800fd760344b1a7b4382951275a0abb4808
      with:
        name: security-summary-report
        path: security-summary-report.md
        retention-days: 30
